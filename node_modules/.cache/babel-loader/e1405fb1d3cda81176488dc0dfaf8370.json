{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _lodash = require(\"lodash\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _reactstrap = require(\"reactstrap\");\n\nvar _core = require(\"@buffetjs/core\");\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _SettingsPageTitle = _interopRequireDefault(require(\"../../../components/SettingsPageTitle\"));\n\nvar _ContainerFluid = _interopRequireDefault(require(\"../../../components/ContainerFluid\"));\n\nvar _FormBloc = _interopRequireDefault(require(\"../../../components/FormBloc\"));\n\nvar _Settings = require(\"../../../components/Settings\");\n\nvar _Users = require(\"../../../components/Users\");\n\nvar _hooks = require(\"../../../hooks\");\n\nvar _users = require(\"../../../validations/users\");\n\nvar _form = _interopRequireDefault(require(\"./utils/form\"));\n\nvar EditPage = function EditPage(_ref) {\n  var canUpdate = _ref.canUpdate;\n\n  var _useGlobalContext = (0, _strapiHelperPlugin.useGlobalContext)(),\n      settingsBaseURL = _useGlobalContext.settingsBaseURL;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useRouteMatch = (0, _reactRouterDom.useRouteMatch)(\"\".concat(settingsBaseURL, \"/users/:id\")),\n      id = _useRouteMatch.params.id;\n\n  var cbSuccess = function cbSuccess(data) {\n    var userInfos = _strapiHelperPlugin.auth.getUserInfo(); // The user is updating themself\n\n\n    if (data.id === userInfos.id) {\n      _strapiHelperPlugin.auth.setUserInfo(data);\n    }\n  };\n\n  var _useSettingsForm = (0, _hooks.useSettingsForm)(\"/admin/users/\".concat(id), _users.editValidation, cbSuccess, ['email', 'firstname', 'lastname', 'username', 'isActive', 'roles', 'registrationToken']),\n      _useSettingsForm2 = (0, _slicedToArray2[\"default\"])(_useSettingsForm, 3),\n      _useSettingsForm2$ = _useSettingsForm2[0],\n      formErrors = _useSettingsForm2$.formErrors,\n      initialData = _useSettingsForm2$.initialData,\n      isLoading = _useSettingsForm2$.isLoading,\n      modifiedData = _useSettingsForm2$.modifiedData,\n      showHeaderButtonLoader = _useSettingsForm2$.showHeaderButtonLoader,\n      showHeaderLoader = _useSettingsForm2$.showHeaderLoader,\n      // eslint-disable-next-line no-unused-vars\n  dispatch = _useSettingsForm2[1],\n      _useSettingsForm2$2 = _useSettingsForm2[2],\n      handleCancel = _useSettingsForm2$2.handleCancel,\n      handleChange = _useSettingsForm2$2.handleChange,\n      handleSubmit = _useSettingsForm2$2.handleSubmit;\n\n  var headerLabelId = isLoading ? 'app.containers.Users.EditPage.header.label-loading' : 'app.containers.Users.EditPage.header.label';\n  var headerLabelName = initialData.username ? initialData.username : \"\".concat(initialData.firstname, \" \").concat(initialData.lastname);\n  var headerLabel = formatMessage({\n    id: headerLabelId\n  }, {\n    name: headerLabelName\n  });\n  var hasRegistrationToken = modifiedData.registrationToken;\n  var hasRolesError = formErrors.roles && (0, _lodash.isEmpty)(modifiedData.roles);\n  return /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(_SettingsPageTitle[\"default\"], {\n    name: \"Users\"\n  }), /*#__PURE__*/_react[\"default\"].createElement(\"form\", {\n    onSubmit: handleSubmit\n  }, /*#__PURE__*/_react[\"default\"].createElement(_ContainerFluid[\"default\"], {\n    padding: \"0\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Settings.Header, {\n    isLoading: showHeaderLoader,\n    initialData: initialData,\n    label: headerLabel,\n    modifiedData: modifiedData,\n    onCancel: handleCancel,\n    showHeaderButtonLoader: showHeaderButtonLoader\n  }), hasRegistrationToken ? /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n    top: true,\n    bottom: true,\n    size: \"sm\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Users.MagicLink, {\n    registrationToken: initialData.registrationToken\n  })), /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.BaselineAlignment, {\n    top: true,\n    size: \"1px\"\n  })) : /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.BaselineAlignment, {\n    top: true,\n    size: \"3px\"\n  }), /*#__PURE__*/_react[\"default\"].createElement(_FormBloc[\"default\"], {\n    isLoading: isLoading,\n    title: formatMessage({\n      id: 'app.components.Users.ModalCreateBody.block-title.details'\n    })\n  }, Object.keys(_form[\"default\"]).map(function (key) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.SizedInput, (0, _extends2[\"default\"])({}, _form[\"default\"][key], {\n      key: key,\n      disabled: !canUpdate,\n      error: formErrors[key],\n      name: key,\n      onChange: handleChange,\n      value: (0, _lodash.get)(modifiedData, key, '')\n    }));\n  })), /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.BaselineAlignment, {\n    top: true,\n    size: \"2px\"\n  }), /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n    top: true,\n    size: \"md\"\n  }, !isLoading && /*#__PURE__*/_react[\"default\"].createElement(_FormBloc[\"default\"], {\n    title: formatMessage({\n      id: 'app.containers.Users.EditPage.roles-bloc-title'\n    })\n  }, /*#__PURE__*/_react[\"default\"].createElement(_reactstrap.Col, {\n    xs: \"6\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n    top: true,\n    size: \"sm\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Users.SelectRoles, {\n    name: \"roles\",\n    isDisabled: !canUpdate,\n    onChange: handleChange,\n    error: formErrors.roles,\n    value: (0, _lodash.get)(modifiedData, 'roles', [])\n  }), /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.BaselineAlignment, {\n    top: true,\n    size: hasRolesError ? '0' : '17px'\n  })))))), /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n    bottom: true,\n    size: \"md\"\n  })), /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.BaselineAlignment, {\n    bottom: true,\n    size: \"80px\"\n  }));\n};\n\nEditPage.propTypes = {\n  canUpdate: _propTypes[\"default\"].bool.isRequired\n};\nvar _default = EditPage;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/admin/src/containers/Users/EditPage/index.js"],"names":["EditPage","canUpdate","settingsBaseURL","formatMessage","id","params","cbSuccess","data","userInfos","auth","getUserInfo","setUserInfo","editValidation","formErrors","initialData","isLoading","modifiedData","showHeaderButtonLoader","showHeaderLoader","dispatch","handleCancel","handleChange","handleSubmit","headerLabelId","headerLabelName","username","firstname","lastname","headerLabel","name","hasRegistrationToken","registrationToken","hasRolesError","roles","Object","keys","form","map","key","propTypes","PropTypes","bool","isRequired"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { useRouteMatch } from 'react-router-dom';\nimport { useIntl } from 'react-intl';\nimport { get, isEmpty } from 'lodash';\nimport { BaselineAlignment, useGlobalContext, SizedInput, auth } from 'strapi-helper-plugin';\nimport { Col } from 'reactstrap';\nimport { Padded } from '@buffetjs/core';\nimport PropTypes from 'prop-types';\nimport PageTitle from '../../../components/SettingsPageTitle';\nimport ContainerFluid from '../../../components/ContainerFluid';\nimport FormBloc from '../../../components/FormBloc';\nimport { Header } from '../../../components/Settings';\nimport { MagicLink, SelectRoles } from '../../../components/Users';\nimport { useSettingsForm } from '../../../hooks';\nimport { editValidation } from '../../../validations/users';\nimport form from './utils/form';\n\nconst EditPage = ({ canUpdate }) => {\n  const { settingsBaseURL } = useGlobalContext();\n  const { formatMessage } = useIntl();\n  const {\n    params: { id },\n  } = useRouteMatch(`${settingsBaseURL}/users/:id`);\n\n  const cbSuccess = data => {\n    const userInfos = auth.getUserInfo();\n\n    // The user is updating themself\n    if (data.id === userInfos.id) {\n      auth.setUserInfo(data);\n    }\n  };\n  const [\n    { formErrors, initialData, isLoading, modifiedData, showHeaderButtonLoader, showHeaderLoader },\n    // eslint-disable-next-line no-unused-vars\n    dispatch,\n    { handleCancel, handleChange, handleSubmit },\n  ] = useSettingsForm(`/admin/users/${id}`, editValidation, cbSuccess, [\n    'email',\n    'firstname',\n    'lastname',\n    'username',\n    'isActive',\n    'roles',\n    'registrationToken',\n  ]);\n  const headerLabelId = isLoading\n    ? 'app.containers.Users.EditPage.header.label-loading'\n    : 'app.containers.Users.EditPage.header.label';\n  const headerLabelName = initialData.username\n    ? initialData.username\n    : `${initialData.firstname} ${initialData.lastname}`;\n  const headerLabel = formatMessage({ id: headerLabelId }, { name: headerLabelName });\n\n  const hasRegistrationToken = modifiedData.registrationToken;\n  const hasRolesError = formErrors.roles && isEmpty(modifiedData.roles);\n\n  return (\n    <>\n      <PageTitle name=\"Users\" />\n      <form onSubmit={handleSubmit}>\n        <ContainerFluid padding=\"0\">\n          <Header\n            isLoading={showHeaderLoader}\n            initialData={initialData}\n            label={headerLabel}\n            modifiedData={modifiedData}\n            onCancel={handleCancel}\n            showHeaderButtonLoader={showHeaderButtonLoader}\n          />\n          {hasRegistrationToken ? (\n            <>\n              <Padded top bottom size=\"sm\">\n                <MagicLink registrationToken={initialData.registrationToken} />\n              </Padded>\n              <BaselineAlignment top size=\"1px\" />\n            </>\n          ) : (\n            <BaselineAlignment top size=\"3px\" />\n          )}\n\n          <FormBloc\n            isLoading={isLoading}\n            title={formatMessage({\n              id: 'app.components.Users.ModalCreateBody.block-title.details',\n            })}\n          >\n            {Object.keys(form).map(key => {\n              return (\n                <SizedInput\n                  {...form[key]}\n                  key={key}\n                  disabled={!canUpdate}\n                  error={formErrors[key]}\n                  name={key}\n                  onChange={handleChange}\n                  value={get(modifiedData, key, '')}\n                />\n              );\n            })}\n          </FormBloc>\n\n          <BaselineAlignment top size=\"2px\" />\n\n          <Padded top size=\"md\">\n            {!isLoading && (\n              <FormBloc\n                title={formatMessage({ id: 'app.containers.Users.EditPage.roles-bloc-title' })}\n              >\n                <Col xs=\"6\">\n                  <Padded top size=\"sm\">\n                    <SelectRoles\n                      name=\"roles\"\n                      isDisabled={!canUpdate}\n                      onChange={handleChange}\n                      error={formErrors.roles}\n                      value={get(modifiedData, 'roles', [])}\n                    />\n                    <BaselineAlignment top size={hasRolesError ? '0' : '17px'} />\n                  </Padded>\n                </Col>\n              </FormBloc>\n            )}\n          </Padded>\n        </ContainerFluid>\n        <Padded bottom size=\"md\" />\n      </form>\n      <BaselineAlignment bottom size=\"80px\" />\n    </>\n  );\n};\n\nEditPage.propTypes = {\n  canUpdate: PropTypes.bool.isRequired,\n};\n\nexport default EditPage;\n"]},"metadata":{},"sourceType":"script"}