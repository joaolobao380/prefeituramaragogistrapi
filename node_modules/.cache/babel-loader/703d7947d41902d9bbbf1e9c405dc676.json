{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _reactFastCompare = _interopRequireDefault(require(\"react-fast-compare\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _custom = require(\"@buffetjs/custom\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _hooks = require(\"../../hooks\");\n\nvar _utils = require(\"../../utils\");\n\nvar _InputJSONWithErrors = _interopRequireDefault(require(\"../InputJSONWithErrors\"));\n\nvar _SelectWrapper = _interopRequireDefault(require(\"../SelectWrapper\"));\n\nvar _WysiwygWithErrors = _interopRequireDefault(require(\"../WysiwygWithErrors\"));\n\nvar _InputUID = _interopRequireDefault(require(\"../InputUID\"));\n\nvar _utils2 = require(\"./utils\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction Inputs(_ref) {\n  var allowedFields = _ref.allowedFields,\n      autoFocus = _ref.autoFocus,\n      fieldSchema = _ref.fieldSchema,\n      formErrors = _ref.formErrors,\n      isCreatingEntry = _ref.isCreatingEntry,\n      keys = _ref.keys,\n      labelIcon = _ref.labelIcon,\n      metadatas = _ref.metadatas,\n      onBlur = _ref.onBlur,\n      onChange = _ref.onChange,\n      readableFields = _ref.readableFields,\n      shouldNotRunValidations = _ref.shouldNotRunValidations,\n      queryInfos = _ref.queryInfos,\n      value = _ref.value;\n\n  var _useStrapi = (0, _strapiHelperPlugin.useStrapi)(),\n      fieldApi = _useStrapi.strapi.fieldApi;\n\n  var _useContentTypeLayout = (0, _hooks.useContentTypeLayout)(),\n      currentContentTypeLayout = _useContentTypeLayout.contentType;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var labelIconformatted = labelIcon ? {\n    icon: labelIcon.icon,\n    title: formatMessage(labelIcon.title)\n  } : labelIcon;\n  var disabled = (0, _react.useMemo)(function () {\n    return !(0, _lodash.get)(metadatas, 'editable', true);\n  }, [metadatas]);\n  var type = fieldSchema.type;\n  var errorId = (0, _react.useMemo)(function () {\n    return (0, _lodash.get)(formErrors, [keys, 'id'], null);\n  }, [formErrors, keys]);\n  var errorMessage = errorId ? formatMessage({\n    id: errorId,\n    defaultMessage: errorId\n  }) : null;\n  var fieldName = (0, _react.useMemo)(function () {\n    return (0, _utils.getFieldName)(keys);\n  }, [keys]);\n  var validations = (0, _react.useMemo)(function () {\n    var inputValidations = (0, _lodash.omit)(fieldSchema, shouldNotRunValidations ? [].concat((0, _toConsumableArray2[\"default\"])(_utils2.VALIDATIONS_TO_OMIT), ['required', 'minLength']) : _utils2.VALIDATIONS_TO_OMIT);\n    var regexpString = fieldSchema.regex || null;\n\n    if (regexpString) {\n      var regexp = new RegExp(regexpString);\n\n      if (regexp) {\n        inputValidations.regex = regexp;\n      }\n    }\n\n    return inputValidations;\n  }, [fieldSchema, shouldNotRunValidations]);\n  var isRequired = (0, _react.useMemo)(function () {\n    return (0, _lodash.get)(validations, ['required'], false);\n  }, [validations]);\n  var isChildOfDynamicZone = (0, _react.useMemo)(function () {\n    var attributes = (0, _lodash.get)(currentContentTypeLayout, ['attributes'], {});\n    var foundAttributeType = (0, _lodash.get)(attributes, [fieldName[0], 'type'], null);\n    return foundAttributeType === 'dynamiczone';\n  }, [currentContentTypeLayout, fieldName]);\n  var inputType = (0, _react.useMemo)(function () {\n    return (0, _utils2.getInputType)(type);\n  }, [type]);\n  var inputValue = (0, _react.useMemo)(function () {\n    // Fix for input file multipe\n    if (type === 'media' && !value) {\n      return [];\n    }\n\n    return value;\n  }, [type, value]);\n  var step = (0, _react.useMemo)(function () {\n    return (0, _utils2.getStep)(type);\n  }, [type]);\n  var isUserAllowedToEditField = (0, _react.useMemo)(function () {\n    var joinedName = fieldName.join('.');\n\n    if (allowedFields.includes(joinedName)) {\n      return true;\n    }\n\n    if (isChildOfDynamicZone) {\n      return allowedFields.includes(fieldName[0]);\n    }\n\n    var isChildOfComponent = fieldName.length > 1;\n\n    if (isChildOfComponent) {\n      var parentFieldName = (0, _lodash.take)(fieldName, fieldName.length - 1).join('.');\n      return allowedFields.includes(parentFieldName);\n    }\n\n    return false;\n  }, [allowedFields, fieldName, isChildOfDynamicZone]);\n  var isUserAllowedToReadField = (0, _react.useMemo)(function () {\n    var joinedName = fieldName.join('.');\n\n    if (readableFields.includes(joinedName)) {\n      return true;\n    }\n\n    if (isChildOfDynamicZone) {\n      return readableFields.includes(fieldName[0]);\n    }\n\n    var isChildOfComponent = fieldName.length > 1;\n\n    if (isChildOfComponent) {\n      var parentFieldName = (0, _lodash.take)(fieldName, fieldName.length - 1).join('.');\n      return readableFields.includes(parentFieldName);\n    }\n\n    return false;\n  }, [readableFields, fieldName, isChildOfDynamicZone]);\n  var shouldDisplayNotAllowedInput = (0, _react.useMemo)(function () {\n    return isUserAllowedToReadField || isUserAllowedToEditField;\n  }, [isUserAllowedToEditField, isUserAllowedToReadField]);\n  var shouldDisableField = (0, _react.useMemo)(function () {\n    if (!isCreatingEntry) {\n      var doesNotHaveRight = isUserAllowedToReadField && !isUserAllowedToEditField;\n\n      if (doesNotHaveRight) {\n        return true;\n      }\n\n      return disabled;\n    }\n\n    return disabled;\n  }, [disabled, isCreatingEntry, isUserAllowedToEditField, isUserAllowedToReadField]);\n  var options = (0, _react.useMemo)(function () {\n    return (0, _utils2.generateOptions)(fieldSchema[\"enum\"] || [], isRequired);\n  }, [fieldSchema, isRequired]);\n  var otherFields = (0, _react.useMemo)(function () {\n    return fieldApi.getFields();\n  }, [fieldApi]);\n  var description = metadatas.description,\n      visible = metadatas.visible;\n\n  if (visible === false) {\n    return null;\n  }\n\n  if (!shouldDisplayNotAllowedInput) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.NotAllowedInput, {\n      label: metadatas.label,\n      labelIcon: labelIconformatted,\n      error: errorMessage\n    });\n  }\n\n  if (type === 'relation') {\n    return /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      key: keys\n    }, /*#__PURE__*/_react[\"default\"].createElement(_SelectWrapper[\"default\"], (0, _extends2[\"default\"])({}, metadatas, fieldSchema, {\n      labelIcon: labelIcon,\n      isUserAllowedToEditField: isUserAllowedToEditField,\n      isUserAllowedToReadField: isUserAllowedToReadField,\n      name: keys,\n      queryInfos: queryInfos,\n      value: value\n    })));\n  }\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_custom.Inputs, (0, _extends2[\"default\"])({}, metadatas, {\n    autoComplete: \"new-password\",\n    autoFocus: autoFocus,\n    disabled: shouldDisableField,\n    error: errorMessage,\n    inputDescription: description,\n    labelIcon: labelIconformatted,\n    description: description,\n    contentTypeUID: currentContentTypeLayout.uid,\n    customInputs: _objectSpread({\n      json: _InputJSONWithErrors[\"default\"],\n      wysiwyg: _WysiwygWithErrors[\"default\"],\n      uid: _InputUID[\"default\"]\n    }, otherFields),\n    multiple: fieldSchema.multiple || false,\n    attribute: fieldSchema,\n    name: keys,\n    onBlur: onBlur,\n    onChange: onChange,\n    options: options,\n    step: step,\n    type: inputType,\n    validations: validations,\n    value: inputValue,\n    withDefaultValue: false\n  }));\n}\n\nInputs.defaultProps = {\n  autoFocus: false,\n  formErrors: {},\n  labelIcon: null,\n  onBlur: null,\n  queryInfos: {},\n  value: null\n};\nInputs.propTypes = {\n  allowedFields: _propTypes[\"default\"].array.isRequired,\n  autoFocus: _propTypes[\"default\"].bool,\n  fieldSchema: _propTypes[\"default\"].object.isRequired,\n  formErrors: _propTypes[\"default\"].object,\n  keys: _propTypes[\"default\"].string.isRequired,\n  isCreatingEntry: _propTypes[\"default\"].bool.isRequired,\n  labelIcon: _propTypes[\"default\"].shape({\n    icon: _propTypes[\"default\"].node.isRequired,\n    title: _propTypes[\"default\"].shape({\n      id: _propTypes[\"default\"].string.isRequired,\n      defaultMessage: _propTypes[\"default\"].string.isRequired\n    }).isRequired\n  }),\n  metadatas: _propTypes[\"default\"].object.isRequired,\n  onBlur: _propTypes[\"default\"].func,\n  onChange: _propTypes[\"default\"].func.isRequired,\n  readableFields: _propTypes[\"default\"].array.isRequired,\n  shouldNotRunValidations: _propTypes[\"default\"].bool.isRequired,\n  queryInfos: _propTypes[\"default\"].shape({\n    containsKey: _propTypes[\"default\"].string,\n    defaultParams: _propTypes[\"default\"].object,\n    endPoint: _propTypes[\"default\"].string\n  }),\n  value: _propTypes[\"default\"].any\n};\nvar Memoized = /*#__PURE__*/(0, _react.memo)(Inputs, _reactFastCompare[\"default\"]);\n\nvar _default = (0, _utils2.connect)(Memoized, _utils2.select);\n\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-content-manager/admin/src/components/Inputs/index.js"],"names":["Inputs","allowedFields","autoFocus","fieldSchema","formErrors","isCreatingEntry","keys","labelIcon","metadatas","onBlur","onChange","readableFields","shouldNotRunValidations","queryInfos","value","fieldApi","strapi","currentContentTypeLayout","contentType","formatMessage","labelIconformatted","icon","title","disabled","type","errorId","errorMessage","id","defaultMessage","fieldName","validations","inputValidations","VALIDATIONS_TO_OMIT","regexpString","regex","regexp","RegExp","isRequired","isChildOfDynamicZone","attributes","foundAttributeType","inputType","inputValue","step","isUserAllowedToEditField","joinedName","join","includes","isChildOfComponent","length","parentFieldName","isUserAllowedToReadField","shouldDisplayNotAllowedInput","shouldDisableField","doesNotHaveRight","options","otherFields","getFields","description","visible","label","uid","json","InputJSONWithErrors","wysiwyg","WysiwygWithErrors","InputUID","multiple","defaultProps","propTypes","PropTypes","array","bool","object","string","shape","node","func","containsKey","defaultParams","endPoint","any","Memoized","isEqual","select"],"mappings":"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","sourcesContent":["import React, { memo, useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport { get, omit, take } from 'lodash';\nimport isEqual from 'react-fast-compare';\nimport { useIntl } from 'react-intl';\nimport { Inputs as InputsIndex } from '@buffetjs/custom';\nimport { NotAllowedInput, useStrapi } from 'strapi-helper-plugin';\nimport { useContentTypeLayout } from '../../hooks';\nimport { getFieldName } from '../../utils';\nimport InputJSONWithErrors from '../InputJSONWithErrors';\nimport SelectWrapper from '../SelectWrapper';\nimport WysiwygWithErrors from '../WysiwygWithErrors';\nimport InputUID from '../InputUID';\nimport {\n  connect,\n  generateOptions,\n  getInputType,\n  getStep,\n  select,\n  VALIDATIONS_TO_OMIT,\n} from './utils';\n\nfunction Inputs({\n  allowedFields,\n  autoFocus,\n  fieldSchema,\n  formErrors,\n  isCreatingEntry,\n  keys,\n  labelIcon,\n  metadatas,\n  onBlur,\n  onChange,\n  readableFields,\n  shouldNotRunValidations,\n  queryInfos,\n  value,\n}) {\n  const {\n    strapi: { fieldApi },\n  } = useStrapi();\n  const { contentType: currentContentTypeLayout } = useContentTypeLayout();\n  const { formatMessage } = useIntl();\n\n  const labelIconformatted = labelIcon\n    ? { icon: labelIcon.icon, title: formatMessage(labelIcon.title) }\n    : labelIcon;\n\n  const disabled = useMemo(() => !get(metadatas, 'editable', true), [metadatas]);\n  const type = fieldSchema.type;\n\n  const errorId = useMemo(() => {\n    return get(formErrors, [keys, 'id'], null);\n  }, [formErrors, keys]);\n\n  const errorMessage = errorId ? formatMessage({ id: errorId, defaultMessage: errorId }) : null;\n\n  const fieldName = useMemo(() => {\n    return getFieldName(keys);\n  }, [keys]);\n\n  const validations = useMemo(() => {\n    const inputValidations = omit(\n      fieldSchema,\n      shouldNotRunValidations\n        ? [...VALIDATIONS_TO_OMIT, 'required', 'minLength']\n        : VALIDATIONS_TO_OMIT\n    );\n\n    const regexpString = fieldSchema.regex || null;\n\n    if (regexpString) {\n      const regexp = new RegExp(regexpString);\n\n      if (regexp) {\n        inputValidations.regex = regexp;\n      }\n    }\n\n    return inputValidations;\n  }, [fieldSchema, shouldNotRunValidations]);\n\n  const isRequired = useMemo(() => get(validations, ['required'], false), [validations]);\n\n  const isChildOfDynamicZone = useMemo(() => {\n    const attributes = get(currentContentTypeLayout, ['attributes'], {});\n    const foundAttributeType = get(attributes, [fieldName[0], 'type'], null);\n\n    return foundAttributeType === 'dynamiczone';\n  }, [currentContentTypeLayout, fieldName]);\n\n  const inputType = useMemo(() => {\n    return getInputType(type);\n  }, [type]);\n\n  const inputValue = useMemo(() => {\n    // Fix for input file multipe\n    if (type === 'media' && !value) {\n      return [];\n    }\n\n    return value;\n  }, [type, value]);\n\n  const step = useMemo(() => {\n    return getStep(type);\n  }, [type]);\n\n  const isUserAllowedToEditField = useMemo(() => {\n    const joinedName = fieldName.join('.');\n\n    if (allowedFields.includes(joinedName)) {\n      return true;\n    }\n\n    if (isChildOfDynamicZone) {\n      return allowedFields.includes(fieldName[0]);\n    }\n\n    const isChildOfComponent = fieldName.length > 1;\n\n    if (isChildOfComponent) {\n      const parentFieldName = take(fieldName, fieldName.length - 1).join('.');\n\n      return allowedFields.includes(parentFieldName);\n    }\n\n    return false;\n  }, [allowedFields, fieldName, isChildOfDynamicZone]);\n\n  const isUserAllowedToReadField = useMemo(() => {\n    const joinedName = fieldName.join('.');\n\n    if (readableFields.includes(joinedName)) {\n      return true;\n    }\n\n    if (isChildOfDynamicZone) {\n      return readableFields.includes(fieldName[0]);\n    }\n\n    const isChildOfComponent = fieldName.length > 1;\n\n    if (isChildOfComponent) {\n      const parentFieldName = take(fieldName, fieldName.length - 1).join('.');\n\n      return readableFields.includes(parentFieldName);\n    }\n\n    return false;\n  }, [readableFields, fieldName, isChildOfDynamicZone]);\n\n  const shouldDisplayNotAllowedInput = useMemo(() => {\n    return isUserAllowedToReadField || isUserAllowedToEditField;\n  }, [isUserAllowedToEditField, isUserAllowedToReadField]);\n\n  const shouldDisableField = useMemo(() => {\n    if (!isCreatingEntry) {\n      const doesNotHaveRight = isUserAllowedToReadField && !isUserAllowedToEditField;\n\n      if (doesNotHaveRight) {\n        return true;\n      }\n\n      return disabled;\n    }\n\n    return disabled;\n  }, [disabled, isCreatingEntry, isUserAllowedToEditField, isUserAllowedToReadField]);\n\n  const options = useMemo(() => generateOptions(fieldSchema.enum || [], isRequired), [\n    fieldSchema,\n    isRequired,\n  ]);\n\n  const otherFields = useMemo(() => {\n    return fieldApi.getFields();\n  }, [fieldApi]);\n\n  const { description, visible } = metadatas;\n\n  if (visible === false) {\n    return null;\n  }\n\n  if (!shouldDisplayNotAllowedInput) {\n    return (\n      <NotAllowedInput\n        label={metadatas.label}\n        labelIcon={labelIconformatted}\n        error={errorMessage}\n      />\n    );\n  }\n\n  if (type === 'relation') {\n    return (\n      <div key={keys}>\n        <SelectWrapper\n          {...metadatas}\n          {...fieldSchema}\n          labelIcon={labelIcon}\n          isUserAllowedToEditField={isUserAllowedToEditField}\n          isUserAllowedToReadField={isUserAllowedToReadField}\n          name={keys}\n          queryInfos={queryInfos}\n          value={value}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <InputsIndex\n      {...metadatas}\n      autoComplete=\"new-password\"\n      autoFocus={autoFocus}\n      disabled={shouldDisableField}\n      error={errorMessage}\n      inputDescription={description}\n      labelIcon={labelIconformatted}\n      description={description}\n      contentTypeUID={currentContentTypeLayout.uid}\n      customInputs={{\n        json: InputJSONWithErrors,\n        wysiwyg: WysiwygWithErrors,\n        uid: InputUID,\n        ...otherFields,\n      }}\n      multiple={fieldSchema.multiple || false}\n      attribute={fieldSchema}\n      name={keys}\n      onBlur={onBlur}\n      onChange={onChange}\n      options={options}\n      step={step}\n      type={inputType}\n      validations={validations}\n      value={inputValue}\n      withDefaultValue={false}\n    />\n  );\n}\n\nInputs.defaultProps = {\n  autoFocus: false,\n  formErrors: {},\n  labelIcon: null,\n  onBlur: null,\n  queryInfos: {},\n  value: null,\n};\n\nInputs.propTypes = {\n  allowedFields: PropTypes.array.isRequired,\n  autoFocus: PropTypes.bool,\n  fieldSchema: PropTypes.object.isRequired,\n  formErrors: PropTypes.object,\n  keys: PropTypes.string.isRequired,\n  isCreatingEntry: PropTypes.bool.isRequired,\n  labelIcon: PropTypes.shape({\n    icon: PropTypes.node.isRequired,\n    title: PropTypes.shape({\n      id: PropTypes.string.isRequired,\n      defaultMessage: PropTypes.string.isRequired,\n    }).isRequired,\n  }),\n  metadatas: PropTypes.object.isRequired,\n  onBlur: PropTypes.func,\n  onChange: PropTypes.func.isRequired,\n  readableFields: PropTypes.array.isRequired,\n  shouldNotRunValidations: PropTypes.bool.isRequired,\n  queryInfos: PropTypes.shape({\n    containsKey: PropTypes.string,\n    defaultParams: PropTypes.object,\n    endPoint: PropTypes.string,\n  }),\n  value: PropTypes.any,\n};\n\nconst Memoized = memo(Inputs, isEqual);\n\nexport default connect(Memoized, select);\n"]},"metadata":{},"sourceType":"script"}