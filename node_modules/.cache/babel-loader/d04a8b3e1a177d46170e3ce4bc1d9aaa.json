{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DynamicZone = exports[\"default\"] = void 0;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _reactFastCompare = _interopRequireDefault(require(\"react-fast-compare\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _core = require(\"@buffetjs/core\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _pluginId = _interopRequireDefault(require(\"../../pluginId\"));\n\nvar _connect = _interopRequireDefault(require(\"./utils/connect\"));\n\nvar _select = _interopRequireDefault(require(\"./utils/select\"));\n\nvar _BaselineAlignement = _interopRequireDefault(require(\"./BaselineAlignement\"));\n\nvar _Button = _interopRequireDefault(require(\"./Button\"));\n\nvar _Component = _interopRequireDefault(require(\"./Component\"));\n\nvar _ComponentWrapper = _interopRequireDefault(require(\"./ComponentWrapper\"));\n\nvar _DynamicZoneWrapper = _interopRequireDefault(require(\"./DynamicZoneWrapper\"));\n\nvar _Label = _interopRequireDefault(require(\"./Label\"));\n\nvar _Wrapper = _interopRequireDefault(require(\"./Wrapper\"));\n\nvar _Picker = _interopRequireDefault(require(\"./Picker\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n/* eslint-disable react/no-array-index-key */\nvar DynamicZone = function DynamicZone(_ref) {\n  var name = _ref.name,\n      addComponentToDynamicZone = _ref.addComponentToDynamicZone,\n      formErrors = _ref.formErrors,\n      isCreatingEntry = _ref.isCreatingEntry,\n      isFieldAllowed = _ref.isFieldAllowed,\n      isFieldReadable = _ref.isFieldReadable,\n      labelIcon = _ref.labelIcon,\n      moveComponentUp = _ref.moveComponentUp,\n      moveComponentDown = _ref.moveComponentDown,\n      removeComponentFromDynamicZone = _ref.removeComponentFromDynamicZone,\n      dynamicDisplayedComponents = _ref.dynamicDisplayedComponents,\n      fieldSchema = _ref.fieldSchema,\n      metadatas = _ref.metadatas;\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      isOpen = _useState2[0],\n      setIsOpen = _useState2[1];\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage; // We cannot use the default props here\n\n\n  var _fieldSchema$max = fieldSchema.max,\n      max = _fieldSchema$max === void 0 ? Infinity : _fieldSchema$max,\n      _fieldSchema$min = fieldSchema.min,\n      min = _fieldSchema$min === void 0 ? -Infinity : _fieldSchema$min;\n  var dynamicZoneErrors = (0, _react.useMemo)(function () {\n    return Object.keys(formErrors).filter(function (key) {\n      return key === name;\n    }).map(function (key) {\n      return formErrors[key];\n    });\n  }, [formErrors, name]);\n  var dynamicZoneAvailableComponents = (0, _react.useMemo)(function () {\n    return fieldSchema.components || [];\n  }, [fieldSchema]);\n  var dynamicDisplayedComponentsLength = dynamicDisplayedComponents.length;\n  var missingComponentNumber = min - dynamicDisplayedComponentsLength;\n  var hasError = dynamicZoneErrors.length > 0;\n  var hasMinError = dynamicZoneErrors.length > 0 && (0, _lodash.get)(dynamicZoneErrors, [0, 'id'], '').includes('min');\n  var hasRequiredError = hasError && !hasMinError;\n  var hasMaxError = hasError && (0, _lodash.get)(dynamicZoneErrors, [0, 'id'], '') === 'components.Input.error.validation.max';\n  var handleAddComponent = (0, _react.useCallback)(function (componentUid) {\n    setIsOpen(false);\n    addComponentToDynamicZone(name, componentUid, hasError);\n  }, [addComponentToDynamicZone, hasError, name]);\n\n  var handleClickOpenPicker = function handleClickOpenPicker() {\n    if (dynamicDisplayedComponentsLength < max) {\n      setIsOpen(function (prev) {\n        return !prev;\n      });\n    } else {\n      strapi.notification.info(\"\".concat(_pluginId[\"default\"], \".components.notification.info.maximum-requirement\"));\n    }\n  };\n\n  var formattedLabelIcon = labelIcon ? {\n    icon: labelIcon.icon,\n    title: formatMessage(labelIcon.title)\n  } : null;\n\n  if (!isFieldAllowed && isCreatingEntry) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_BaselineAlignement[\"default\"], null, /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.NotAllowedInput, {\n      label: metadatas.label,\n      spacerHeight: \"5px\",\n      labelIcon: formattedLabelIcon\n    }));\n  }\n\n  if (!isFieldAllowed && !isFieldReadable && !isCreatingEntry) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_BaselineAlignement[\"default\"], null, /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.NotAllowedInput, {\n      label: metadatas.label,\n      spacerHeight: \"5px\",\n      labelIcon: formattedLabelIcon\n    }));\n  }\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_DynamicZoneWrapper[\"default\"], null, dynamicDisplayedComponentsLength > 0 && /*#__PURE__*/_react[\"default\"].createElement(_Label[\"default\"], null, /*#__PURE__*/_react[\"default\"].createElement(_core.Flex, null, /*#__PURE__*/_react[\"default\"].createElement(\"p\", null, /*#__PURE__*/_react[\"default\"].createElement(\"span\", null, metadatas.label)), formattedLabelIcon && /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.LabelIconWrapper, {\n    title: formattedLabelIcon.title\n  }, formattedLabelIcon.icon)), /*#__PURE__*/_react[\"default\"].createElement(\"p\", null, metadatas.description)), /*#__PURE__*/_react[\"default\"].createElement(_ComponentWrapper[\"default\"], null, dynamicDisplayedComponents.map(function (componentUid, index) {\n    var showDownIcon = isFieldAllowed && dynamicDisplayedComponentsLength > 0 && index < dynamicDisplayedComponentsLength - 1;\n    var showUpIcon = isFieldAllowed && dynamicDisplayedComponentsLength > 0 && index > 0;\n    return /*#__PURE__*/_react[\"default\"].createElement(_Component[\"default\"], {\n      componentUid: componentUid,\n      key: index,\n      index: index,\n      isFieldAllowed: isFieldAllowed,\n      moveComponentDown: moveComponentDown,\n      moveComponentUp: moveComponentUp,\n      name: name,\n      removeComponentFromDynamicZone: removeComponentFromDynamicZone,\n      showDownIcon: showDownIcon,\n      showUpIcon: showUpIcon\n    });\n  })), isFieldAllowed ? /*#__PURE__*/_react[\"default\"].createElement(_Wrapper[\"default\"], null, /*#__PURE__*/_react[\"default\"].createElement(_Button[\"default\"], {\n    type: \"button\",\n    hasError: hasError,\n    className: isOpen && 'isOpen',\n    onClick: handleClickOpenPicker\n  }), hasRequiredError && !isOpen && !hasMaxError && /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    className: \"error-label\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_reactIntl.FormattedMessage, {\n    id: \"\".concat(_pluginId[\"default\"], \".components.DynamicZone.required\")\n  })), hasMaxError && !isOpen && /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    className: \"error-label\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_reactIntl.FormattedMessage, {\n    id: \"components.Input.error.validation.max\"\n  })), hasMinError && !isOpen && /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    className: \"error-label\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_reactIntl.FormattedMessage, {\n    id: \"\".concat(_pluginId[\"default\"], \".components.DynamicZone.missing\").concat(missingComponentNumber > 1 ? '.plural' : '.singular'),\n    values: {\n      count: missingComponentNumber\n    }\n  })), /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    className: \"info\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_reactIntl.FormattedMessage, {\n    id: \"\".concat(_pluginId[\"default\"], \".components.DynamicZone.add-compo\"),\n    values: {\n      componentName: metadatas.label\n    }\n  })), /*#__PURE__*/_react[\"default\"].createElement(_Picker[\"default\"], {\n    isOpen: isOpen,\n    components: dynamicZoneAvailableComponents,\n    onClickAddComponent: handleAddComponent\n  })) : /*#__PURE__*/_react[\"default\"].createElement(_BaselineAlignement[\"default\"], {\n    top: \"9px\"\n  }));\n};\n\nexports.DynamicZone = DynamicZone;\nDynamicZone.defaultProps = {\n  dynamicDisplayedComponents: [],\n  fieldSchema: {\n    max: Infinity,\n    min: -Infinity\n  },\n  labelIcon: null\n};\nDynamicZone.propTypes = {\n  addComponentToDynamicZone: _propTypes[\"default\"].func.isRequired,\n  dynamicDisplayedComponents: _propTypes[\"default\"].array,\n  fieldSchema: _propTypes[\"default\"].shape({\n    components: _propTypes[\"default\"].array.isRequired,\n    max: _propTypes[\"default\"].number,\n    min: _propTypes[\"default\"].number\n  }),\n  formErrors: _propTypes[\"default\"].object.isRequired,\n  isCreatingEntry: _propTypes[\"default\"].bool.isRequired,\n  isFieldAllowed: _propTypes[\"default\"].bool.isRequired,\n  isFieldReadable: _propTypes[\"default\"].bool.isRequired,\n  labelIcon: _propTypes[\"default\"].shape({\n    icon: _propTypes[\"default\"].node.isRequired,\n    title: _propTypes[\"default\"].shape({\n      id: _propTypes[\"default\"].string.isRequired,\n      defaultMessage: _propTypes[\"default\"].string.isRequired\n    }).isRequired\n  }),\n  metadatas: _propTypes[\"default\"].shape({\n    description: _propTypes[\"default\"].string,\n    label: _propTypes[\"default\"].string\n  }).isRequired,\n  moveComponentUp: _propTypes[\"default\"].func.isRequired,\n  moveComponentDown: _propTypes[\"default\"].func.isRequired,\n  name: _propTypes[\"default\"].string.isRequired,\n  removeComponentFromDynamicZone: _propTypes[\"default\"].func.isRequired\n};\nvar Memoized = /*#__PURE__*/(0, _react.memo)(DynamicZone, _reactFastCompare[\"default\"]);\n\nvar _default = (0, _connect[\"default\"])(Memoized, _select[\"default\"]);\n\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-content-manager/admin/src/components/DynamicZone/index.js"],"names":["DynamicZone","name","addComponentToDynamicZone","formErrors","isCreatingEntry","isFieldAllowed","isFieldReadable","labelIcon","moveComponentUp","moveComponentDown","removeComponentFromDynamicZone","dynamicDisplayedComponents","fieldSchema","metadatas","isOpen","setIsOpen","formatMessage","max","Infinity","min","dynamicZoneErrors","Object","keys","filter","key","map","dynamicZoneAvailableComponents","components","dynamicDisplayedComponentsLength","length","missingComponentNumber","hasError","hasMinError","includes","hasRequiredError","hasMaxError","handleAddComponent","componentUid","handleClickOpenPicker","prev","strapi","notification","info","pluginId","formattedLabelIcon","icon","title","label","description","index","showDownIcon","showUpIcon","count","componentName","defaultProps","propTypes","PropTypes","func","isRequired","array","shape","number","object","bool","node","id","string","defaultMessage","Memoized","isEqual","select"],"mappings":"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","sourcesContent":["import React, { memo, useCallback, useMemo, useState } from 'react';\nimport { get } from 'lodash';\nimport isEqual from 'react-fast-compare';\nimport PropTypes from 'prop-types';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { Flex } from '@buffetjs/core';\nimport { LabelIconWrapper, NotAllowedInput } from 'strapi-helper-plugin';\nimport pluginId from '../../pluginId';\nimport connect from './utils/connect';\nimport select from './utils/select';\nimport BaselineAlignement from './BaselineAlignement';\nimport Button from './Button';\nimport Component from './Component';\nimport ComponentWrapper from './ComponentWrapper';\nimport DynamicZoneWrapper from './DynamicZoneWrapper';\nimport Label from './Label';\nimport Wrapper from './Wrapper';\nimport Picker from './Picker';\n\n/* eslint-disable react/no-array-index-key */\n\nconst DynamicZone = ({\n  name,\n  // Passed with the select function\n  addComponentToDynamicZone,\n  formErrors,\n  isCreatingEntry,\n  isFieldAllowed,\n  isFieldReadable,\n  labelIcon,\n  moveComponentUp,\n  moveComponentDown,\n  removeComponentFromDynamicZone,\n  dynamicDisplayedComponents,\n  fieldSchema,\n  metadatas,\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const { formatMessage } = useIntl();\n  // We cannot use the default props here\n  const { max = Infinity, min = -Infinity } = fieldSchema;\n  const dynamicZoneErrors = useMemo(() => {\n    return Object.keys(formErrors)\n      .filter(key => {\n        return key === name;\n      })\n      .map(key => formErrors[key]);\n  }, [formErrors, name]);\n\n  const dynamicZoneAvailableComponents = useMemo(() => fieldSchema.components || [], [fieldSchema]);\n  const dynamicDisplayedComponentsLength = dynamicDisplayedComponents.length;\n  const missingComponentNumber = min - dynamicDisplayedComponentsLength;\n  const hasError = dynamicZoneErrors.length > 0;\n  const hasMinError =\n    dynamicZoneErrors.length > 0 && get(dynamicZoneErrors, [0, 'id'], '').includes('min');\n\n  const hasRequiredError = hasError && !hasMinError;\n  const hasMaxError =\n    hasError && get(dynamicZoneErrors, [0, 'id'], '') === 'components.Input.error.validation.max';\n\n  const handleAddComponent = useCallback(\n    componentUid => {\n      setIsOpen(false);\n\n      addComponentToDynamicZone(name, componentUid, hasError);\n    },\n    [addComponentToDynamicZone, hasError, name]\n  );\n\n  const handleClickOpenPicker = () => {\n    if (dynamicDisplayedComponentsLength < max) {\n      setIsOpen(prev => !prev);\n    } else {\n      strapi.notification.info(`${pluginId}.components.notification.info.maximum-requirement`);\n    }\n  };\n\n  const formattedLabelIcon = labelIcon\n    ? { icon: labelIcon.icon, title: formatMessage(labelIcon.title) }\n    : null;\n\n  if (!isFieldAllowed && isCreatingEntry) {\n    return (\n      <BaselineAlignement>\n        <NotAllowedInput\n          label={metadatas.label}\n          spacerHeight=\"5px\"\n          labelIcon={formattedLabelIcon}\n        />\n      </BaselineAlignement>\n    );\n  }\n\n  if (!isFieldAllowed && !isFieldReadable && !isCreatingEntry) {\n    return (\n      <BaselineAlignement>\n        <NotAllowedInput\n          label={metadatas.label}\n          spacerHeight=\"5px\"\n          labelIcon={formattedLabelIcon}\n        />\n      </BaselineAlignement>\n    );\n  }\n\n  return (\n    <DynamicZoneWrapper>\n      {dynamicDisplayedComponentsLength > 0 && (\n        <Label>\n          <Flex>\n            <p>\n              <span>{metadatas.label}</span>\n            </p>\n            {formattedLabelIcon && (\n              <LabelIconWrapper title={formattedLabelIcon.title}>\n                {formattedLabelIcon.icon}\n              </LabelIconWrapper>\n            )}\n          </Flex>\n          <p>{metadatas.description}</p>\n        </Label>\n      )}\n\n      {/* List of displayed components */}\n      <ComponentWrapper>\n        {dynamicDisplayedComponents.map((componentUid, index) => {\n          const showDownIcon =\n            isFieldAllowed &&\n            dynamicDisplayedComponentsLength > 0 &&\n            index < dynamicDisplayedComponentsLength - 1;\n          const showUpIcon = isFieldAllowed && dynamicDisplayedComponentsLength > 0 && index > 0;\n\n          return (\n            <Component\n              componentUid={componentUid}\n              key={index}\n              index={index}\n              isFieldAllowed={isFieldAllowed}\n              moveComponentDown={moveComponentDown}\n              moveComponentUp={moveComponentUp}\n              name={name}\n              removeComponentFromDynamicZone={removeComponentFromDynamicZone}\n              showDownIcon={showDownIcon}\n              showUpIcon={showUpIcon}\n            />\n          );\n        })}\n      </ComponentWrapper>\n      {isFieldAllowed ? (\n        <Wrapper>\n          <Button\n            type=\"button\"\n            hasError={hasError}\n            className={isOpen && 'isOpen'}\n            onClick={handleClickOpenPicker}\n          />\n          {hasRequiredError && !isOpen && !hasMaxError && (\n            <div className=\"error-label\">\n              <FormattedMessage id={`${pluginId}.components.DynamicZone.required`} />\n            </div>\n          )}\n          {hasMaxError && !isOpen && (\n            <div className=\"error-label\">\n              <FormattedMessage id=\"components.Input.error.validation.max\" />\n            </div>\n          )}\n          {hasMinError && !isOpen && (\n            <div className=\"error-label\">\n              <FormattedMessage\n                id={`${pluginId}.components.DynamicZone.missing${\n                  missingComponentNumber > 1 ? '.plural' : '.singular'\n                }`}\n                values={{ count: missingComponentNumber }}\n              />\n            </div>\n          )}\n          <div className=\"info\">\n            <FormattedMessage\n              id={`${pluginId}.components.DynamicZone.add-compo`}\n              values={{ componentName: metadatas.label }}\n            />\n          </div>\n          <Picker\n            isOpen={isOpen}\n            components={dynamicZoneAvailableComponents}\n            onClickAddComponent={handleAddComponent}\n          />\n        </Wrapper>\n      ) : (\n        <BaselineAlignement top=\"9px\" />\n      )}\n    </DynamicZoneWrapper>\n  );\n};\n\nDynamicZone.defaultProps = {\n  dynamicDisplayedComponents: [],\n  fieldSchema: {\n    max: Infinity,\n    min: -Infinity,\n  },\n  labelIcon: null,\n};\n\nDynamicZone.propTypes = {\n  addComponentToDynamicZone: PropTypes.func.isRequired,\n  dynamicDisplayedComponents: PropTypes.array,\n  fieldSchema: PropTypes.shape({\n    components: PropTypes.array.isRequired,\n    max: PropTypes.number,\n    min: PropTypes.number,\n  }),\n  formErrors: PropTypes.object.isRequired,\n  isCreatingEntry: PropTypes.bool.isRequired,\n  isFieldAllowed: PropTypes.bool.isRequired,\n  isFieldReadable: PropTypes.bool.isRequired,\n  labelIcon: PropTypes.shape({\n    icon: PropTypes.node.isRequired,\n    title: PropTypes.shape({\n      id: PropTypes.string.isRequired,\n      defaultMessage: PropTypes.string.isRequired,\n    }).isRequired,\n  }),\n  metadatas: PropTypes.shape({\n    description: PropTypes.string,\n    label: PropTypes.string,\n  }).isRequired,\n  moveComponentUp: PropTypes.func.isRequired,\n  moveComponentDown: PropTypes.func.isRequired,\n  name: PropTypes.string.isRequired,\n  removeComponentFromDynamicZone: PropTypes.func.isRequired,\n};\n\nconst Memoized = memo(DynamicZone, isEqual);\n\nexport default connect(Memoized, select);\n\nexport { DynamicZone };\n"]},"metadata":{},"sourceType":"script"}