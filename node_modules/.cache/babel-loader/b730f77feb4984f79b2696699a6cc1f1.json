{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createPermissionWithProperties = exports.createPropertyArray = exports[\"default\"] = void 0;\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _utils = require(\"../../utils\");\n\nvar _formatSettingsPermissionsToAPI = require(\"./formatSettingsPermissionsToAPI\");\n\n/**\n * Returns an array of property values\n * @param {object} propertyValue\n * @param {string} prefix\n * @returns {array<string>}\n */\nvar createPropertyArray = function createPropertyArray(propertyValue) {\n  var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n  return Object.entries(propertyValue).reduce(function (acc, current) {\n    var _current = (0, _slicedToArray2[\"default\"])(current, 2),\n        name = _current[0],\n        value = _current[1];\n\n    if ((0, _lodash.isObject)(value)) {\n      return [].concat((0, _toConsumableArray2[\"default\"])(acc), (0, _toConsumableArray2[\"default\"])(createPropertyArray(value, \"\".concat(prefix).concat(name, \".\"))));\n    }\n\n    if (value && !(0, _lodash.isObject)(value)) {\n      acc.push(\"\".concat(prefix).concat(name));\n    }\n\n    return acc;\n  }, []);\n};\n/**\n *\n * @param {string} action\n * @param {string} subject\n * @param {object} param2\n * @config {object} conditions\n * @config {object} the name of the properties array we need to fill\n * @returns {object}\n */\n\n\nexports.createPropertyArray = createPropertyArray;\n\nvar createPermissionWithProperties = function createPermissionWithProperties(action, subject, _ref) {\n  var conditions = _ref.conditions,\n      properties = _ref.properties;\n  return Object.entries(properties).reduce(function (acc, current) {\n    var _current2 = (0, _slicedToArray2[\"default\"])(current, 2),\n        propertyName = _current2[0],\n        propertyValue = _current2[1];\n\n    acc.properties[propertyName] = createPropertyArray(propertyValue);\n    return acc;\n  }, {\n    action: action,\n    subject: subject,\n    conditions: (0, _formatSettingsPermissionsToAPI.createConditionsArray)(conditions),\n    properties: {}\n  });\n};\n/**\n *\n * @param {string} action The name of the action\n * @param {string} subject The name of the subject\n * @param {object} param2\n * @returns {object}\n */\n\n\nexports.createPermissionWithProperties = createPermissionWithProperties;\n\nvar createPermissionWithoutProperties = function createPermissionWithoutProperties(action, subject, _ref2) {\n  var conditions = _ref2.conditions;\n  return {\n    action: action,\n    subject: subject,\n    properties: {},\n    conditions: (0, _formatSettingsPermissionsToAPI.createConditionsArray)(conditions)\n  };\n};\n/**\n *\n * @param {string} subject  The name of the subject\n * @param {object} actions The subject's actions\n * @returns {array<object>}\n */\n\n\nvar createSubjectPermissions = function createSubjectPermissions(subject, actions) {\n  var permissions = Object.entries(actions).reduce(function (acc, current) {\n    var _current3 = (0, _slicedToArray2[\"default\"])(current, 2),\n        actionName = _current3[0],\n        permissions = _current3[1];\n\n    var shouldCreatePermission = (0, _utils.createArrayOfValues)(permissions).some(function (val) {\n      return val;\n    });\n\n    if (!shouldCreatePermission) {\n      return acc;\n    }\n\n    if (!(0, _lodash.has)(permissions, 'properties.enabled')) {\n      var createdPermissionsArray = createPermissionWithProperties(actionName, subject, permissions);\n      return [].concat((0, _toConsumableArray2[\"default\"])(acc), [createdPermissionsArray]);\n    }\n\n    if (!permissions.properties.enabled) {\n      return acc;\n    }\n\n    var permission = createPermissionWithoutProperties(actionName, subject, permissions);\n    acc.push(permission);\n    return acc;\n  }, []);\n  return permissions;\n};\n/**\n *\n * @param {object} contentTypesPermissions\n * @returns {array<object>}\n */\n\n\nvar formatContentTypesPermissionToAPI = function formatContentTypesPermissionToAPI(contentTypesPermissions) {\n  var permissions = Object.entries(contentTypesPermissions).reduce(function (allPermissions, current) {\n    var _current4 = (0, _slicedToArray2[\"default\"])(current, 2),\n        subject = _current4[0],\n        currentSubjectActions = _current4[1];\n\n    var permissions = createSubjectPermissions(subject, currentSubjectActions);\n    return [].concat((0, _toConsumableArray2[\"default\"])(allPermissions), (0, _toConsumableArray2[\"default\"])(permissions));\n  }, []);\n  return permissions;\n};\n\nvar _default = formatContentTypesPermissionToAPI;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/admin/src/components/Roles/Permissions/utils/formatContentTypesPermissionToAPI.js"],"names":["createPropertyArray","propertyValue","prefix","Object","entries","reduce","acc","current","name","value","push","createPermissionWithProperties","action","subject","conditions","properties","propertyName","createPermissionWithoutProperties","createSubjectPermissions","actions","permissions","actionName","shouldCreatePermission","some","val","createdPermissionsArray","enabled","permission","formatContentTypesPermissionToAPI","contentTypesPermissions","allPermissions","currentSubjectActions"],"mappings":"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","sourcesContent":["import { has, isObject } from 'lodash';\nimport { createArrayOfValues } from '../../utils';\nimport { createConditionsArray } from './formatSettingsPermissionsToAPI';\n\n/**\n * Returns an array of property values\n * @param {object} propertyValue\n * @param {string} prefix\n * @returns {array<string>}\n */\nconst createPropertyArray = (propertyValue, prefix = '') => {\n  return Object.entries(propertyValue).reduce((acc, current) => {\n    const [name, value] = current;\n\n    if (isObject(value)) {\n      return [...acc, ...createPropertyArray(value, `${prefix}${name}.`)];\n    }\n\n    if (value && !isObject(value)) {\n      acc.push(`${prefix}${name}`);\n    }\n\n    return acc;\n  }, []);\n};\n\n/**\n *\n * @param {string} action\n * @param {string} subject\n * @param {object} param2\n * @config {object} conditions\n * @config {object} the name of the properties array we need to fill\n * @returns {object}\n */\nconst createPermissionWithProperties = (action, subject, { conditions, properties }) => {\n  return Object.entries(properties).reduce(\n    (acc, current) => {\n      const [propertyName, propertyValue] = current;\n\n      acc.properties[propertyName] = createPropertyArray(propertyValue);\n\n      return acc;\n    },\n    { action, subject, conditions: createConditionsArray(conditions), properties: {} }\n  );\n};\n\n/**\n *\n * @param {string} action The name of the action\n * @param {string} subject The name of the subject\n * @param {object} param2\n * @returns {object}\n */\nconst createPermissionWithoutProperties = (action, subject, { conditions }) => {\n  return {\n    action,\n    subject,\n    properties: {},\n    conditions: createConditionsArray(conditions),\n  };\n};\n\n/**\n *\n * @param {string} subject  The name of the subject\n * @param {object} actions The subject's actions\n * @returns {array<object>}\n */\nconst createSubjectPermissions = (subject, actions) => {\n  const permissions = Object.entries(actions).reduce((acc, current) => {\n    const [actionName, permissions] = current;\n    const shouldCreatePermission = createArrayOfValues(permissions).some(val => val);\n\n    if (!shouldCreatePermission) {\n      return acc;\n    }\n\n    if (!has(permissions, 'properties.enabled')) {\n      const createdPermissionsArray = createPermissionWithProperties(\n        actionName,\n        subject,\n        permissions\n      );\n\n      return [...acc, createdPermissionsArray];\n    }\n\n    if (!permissions.properties.enabled) {\n      return acc;\n    }\n\n    const permission = createPermissionWithoutProperties(actionName, subject, permissions);\n\n    acc.push(permission);\n\n    return acc;\n  }, []);\n\n  return permissions;\n};\n\n/**\n *\n * @param {object} contentTypesPermissions\n * @returns {array<object>}\n */\nconst formatContentTypesPermissionToAPI = contentTypesPermissions => {\n  const permissions = Object.entries(contentTypesPermissions).reduce((allPermissions, current) => {\n    const [subject, currentSubjectActions] = current;\n\n    const permissions = createSubjectPermissions(subject, currentSubjectActions);\n\n    return [...allPermissions, ...permissions];\n  }, []);\n\n  return permissions;\n};\n\nexport default formatContentTypesPermissionToAPI;\nexport { createPropertyArray, createPermissionWithProperties };\n"]},"metadata":{},"sourceType":"script"}