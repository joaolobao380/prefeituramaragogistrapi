{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.initialState = exports[\"default\"] = void 0;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _immutable = require(\"immutable\");\n\nvar _utils = require(\"../../utils\");\n\nvar initialState = (0, _immutable.fromJS)({\n  componentsDataStructure: {},\n  contentTypeDataStructure: {},\n  formErrors: {},\n  initialData: {},\n  modifiedData: {},\n  shouldCheckErrors: false,\n  modifiedDZName: null\n});\nexports.initialState = initialState;\n\nvar reducer = function reducer(state, action) {\n  switch (action.type) {\n    case 'ADD_NON_REPEATABLE_COMPONENT_TO_FIELD':\n      return state.updateIn(['modifiedData'].concat((0, _toConsumableArray2[\"default\"])(action.keys)), function () {\n        var defaultDataStructure = state.getIn(['componentsDataStructure', action.componentUid]);\n        return (0, _immutable.fromJS)(defaultDataStructure);\n      });\n\n    case 'ADD_REPEATABLE_COMPONENT_TO_FIELD':\n      {\n        return state.updateIn(['modifiedData'].concat((0, _toConsumableArray2[\"default\"])(action.keys)), function (list) {\n          var defaultDataStructure = state.getIn(['componentsDataStructure', action.componentUid]).set('__temp_key__', (0, _utils.getMaxTempKey)(list ? list.toJS() : []) + 1);\n\n          if (list) {\n            return list.push(defaultDataStructure);\n          }\n\n          return (0, _immutable.fromJS)([defaultDataStructure]);\n        }).update('shouldCheckErrors', function (v) {\n          if (action.shouldCheckErrors === true) {\n            return !v;\n          }\n\n          return v;\n        });\n      }\n\n    case 'ADD_COMPONENT_TO_DYNAMIC_ZONE':\n      return state.updateIn(['modifiedData'].concat((0, _toConsumableArray2[\"default\"])(action.keys)), function (list) {\n        var defaultDataStructure = state.getIn(['componentsDataStructure', action.componentUid]).set('__component', action.componentUid);\n\n        if (list) {\n          return list.push(defaultDataStructure);\n        }\n\n        return (0, _immutable.fromJS)([defaultDataStructure]);\n      }).update('modifiedDZName', function () {\n        return action.keys[0];\n      }).update('shouldCheckErrors', function (v) {\n        if (action.shouldCheckErrors === true) {\n          return !v;\n        }\n\n        return v;\n      });\n\n    case 'ADD_RELATION':\n      return state.updateIn(['modifiedData'].concat((0, _toConsumableArray2[\"default\"])(action.keys)), function (list) {\n        if (!Array.isArray(action.value) || !action.value.length) {\n          return list;\n        }\n\n        var el = action.value[0].value;\n\n        if (list) {\n          return list.push((0, _immutable.fromJS)(el));\n        }\n\n        return (0, _immutable.fromJS)([el]);\n      });\n\n    case 'INIT_FORM':\n      {\n        return state.update('formErrors', function () {\n          return (0, _immutable.fromJS)({});\n        }).update('initialData', function () {\n          return (0, _immutable.fromJS)(action.initialValues);\n        }).update('modifiedData', function () {\n          return (0, _immutable.fromJS)(action.initialValues);\n        }).update('modifiedDZName', function () {\n          return null;\n        }).update('shouldCheckErrors', function () {\n          return false;\n        });\n      }\n\n    case 'MOVE_COMPONENT_FIELD':\n      return state.updateIn(['modifiedData'].concat((0, _toConsumableArray2[\"default\"])(action.pathToComponent)), function (list) {\n        return list[\"delete\"](action.dragIndex).insert(action.hoverIndex, state.getIn(['modifiedData'].concat((0, _toConsumableArray2[\"default\"])(action.pathToComponent), [action.dragIndex])));\n      });\n\n    case 'MOVE_COMPONENT_UP':\n      return state.update('shouldCheckErrors', function (v) {\n        if (action.shouldCheckErrors) {\n          return !v;\n        }\n\n        return v;\n      }).updateIn(['modifiedData', action.dynamicZoneName], function (list) {\n        return list[\"delete\"](action.currentIndex).insert(action.currentIndex - 1, state.getIn(['modifiedData', action.dynamicZoneName, action.currentIndex]));\n      });\n\n    case 'MOVE_COMPONENT_DOWN':\n      return state.update('shouldCheckErrors', function (v) {\n        if (action.shouldCheckErrors) {\n          return !v;\n        }\n\n        return v;\n      }).updateIn(['modifiedData', action.dynamicZoneName], function (list) {\n        return list[\"delete\"](action.currentIndex).insert(action.currentIndex + 1, state.getIn(['modifiedData', action.dynamicZoneName, action.currentIndex]));\n      });\n\n    case 'MOVE_FIELD':\n      return state.updateIn(['modifiedData'].concat((0, _toConsumableArray2[\"default\"])(action.keys)), function (list) {\n        return list[\"delete\"](action.dragIndex).insert(action.overIndex, list.get(action.dragIndex));\n      });\n\n    case 'ON_CHANGE':\n      {\n        var newState = state;\n\n        var _action$keys = (0, _slicedToArray2[\"default\"])(action.keys, 1),\n            nonRepeatableComponentKey = _action$keys[0]; // This is used to set the initialData for inputs\n        // that needs an asynchronous initial value like the UID field\n        // This is just a temporary patch.\n        // TODO : Refactor the default form creation (workflow) to accept async default values.\n\n\n        if (action.shouldSetInitialValue) {\n          newState = state.updateIn(['initialData'].concat((0, _toConsumableArray2[\"default\"])(action.keys)), function () {\n            return action.value;\n          });\n        }\n\n        if (action.keys.length === 2 && state.getIn(['modifiedData', nonRepeatableComponentKey]) === null) {\n          newState = newState.updateIn(['modifiedData', nonRepeatableComponentKey], function () {\n            return (0, _immutable.fromJS)({});\n          });\n        }\n\n        return newState.updateIn(['modifiedData'].concat((0, _toConsumableArray2[\"default\"])(action.keys)), function () {\n          return action.value;\n        });\n      }\n\n    case 'REMOVE_COMPONENT_FROM_DYNAMIC_ZONE':\n      return state.update('shouldCheckErrors', function (v) {\n        if (action.shouldCheckErrors) {\n          return !v;\n        }\n\n        return v;\n      }).deleteIn(['modifiedData', action.dynamicZoneName, action.index]);\n\n    case 'REMOVE_COMPONENT_FROM_FIELD':\n      {\n        var componentPathToRemove = ['modifiedData'].concat((0, _toConsumableArray2[\"default\"])(action.keys));\n        return state.updateIn(componentPathToRemove, function () {\n          return null;\n        });\n      }\n\n    case 'REMOVE_PASSWORD_FIELD':\n      {\n        return state.removeIn(['modifiedData'].concat((0, _toConsumableArray2[\"default\"])(action.keys)));\n      }\n\n    case 'REMOVE_REPEATABLE_FIELD':\n      {\n        var _componentPathToRemove = ['modifiedData'].concat((0, _toConsumableArray2[\"default\"])(action.keys));\n\n        return state.update('shouldCheckErrors', function (v) {\n          var hasErrors = state.get('formErrors').keySeq().size > 0;\n\n          if (hasErrors) {\n            return !v;\n          }\n\n          return v;\n        }).deleteIn(_componentPathToRemove);\n      }\n\n    case 'REMOVE_RELATION':\n      return state.removeIn(['modifiedData'].concat((0, _toConsumableArray2[\"default\"])(action.keys.split('.'))));\n\n    case 'SET_DEFAULT_DATA_STRUCTURES':\n      return state.update('componentsDataStructure', function () {\n        return (0, _immutable.fromJS)(action.componentsDataStructure);\n      }).update('contentTypeDataStructure', function () {\n        return (0, _immutable.fromJS)(action.contentTypeDataStructure);\n      });\n\n    case 'SET_FORM_ERRORS':\n      {\n        return state.update('modifiedDZName', function () {\n          return null;\n        }).update('formErrors', function () {\n          return (0, _immutable.fromJS)(action.errors);\n        });\n      }\n\n    case 'TRIGGER_FORM_VALIDATION':\n      return state.update('shouldCheckErrors', function (v) {\n        var hasErrors = state.get('formErrors').keySeq().size > 0;\n\n        if (hasErrors) {\n          return !v;\n        }\n\n        return v;\n      });\n\n    default:\n      return state;\n  }\n};\n\nvar _default = reducer;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-content-manager/admin/src/containers/EditViewDataManagerProvider/reducer.js"],"names":["initialState","componentsDataStructure","contentTypeDataStructure","formErrors","initialData","modifiedData","shouldCheckErrors","modifiedDZName","reducer","state","action","type","updateIn","keys","defaultDataStructure","getIn","componentUid","list","set","toJS","push","update","v","Array","isArray","value","length","el","initialValues","pathToComponent","dragIndex","insert","hoverIndex","dynamicZoneName","currentIndex","overIndex","get","newState","nonRepeatableComponentKey","shouldSetInitialValue","deleteIn","index","componentPathToRemove","removeIn","hasErrors","keySeq","size","split","errors"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;AAEA,IAAMA,YAAY,GAAG,uBAAO;AAC1BC,EAAAA,uBAAuB,EAAE,EADC;AAE1BC,EAAAA,wBAAwB,EAAE,EAFA;AAG1BC,EAAAA,UAAU,EAAE,EAHc;AAI1BC,EAAAA,WAAW,EAAE,EAJa;AAK1BC,EAAAA,YAAY,EAAE,EALY;AAM1BC,EAAAA,iBAAiB,EAAE,KANO;AAO1BC,EAAAA,cAAc,EAAE;AAPU,CAAP,CAArB;;;AAUA,IAAMC,OAAO,GAAG,SAAVA,OAAU,CAACC,KAAD,EAAQC,MAAR,EAAmB;AACjC,UAAQA,MAAM,CAACC,IAAf;AACE,SAAK,uCAAL;AACE,aAAOF,KAAK,CAACG,QAAN,EAAgB,cAAhB,6CAAmCF,MAAM,CAACG,IAA1C,IAAiD,YAAM;AAC5D,YAAMC,oBAAoB,GAAGL,KAAK,CAACM,KAAN,CAAY,CAAC,yBAAD,EAA4BL,MAAM,CAACM,YAAnC,CAAZ,CAA7B;AAEA,eAAO,uBAAOF,oBAAP,CAAP;AACD,OAJM,CAAP;;AAKF,SAAK,mCAAL;AAA0C;AACxC,eAAOL,KAAK,CACTG,QADI,EACM,cADN,6CACyBF,MAAM,CAACG,IADhC,IACuC,UAAAI,IAAI,EAAI;AAClD,cAAMH,oBAAoB,GAAGL,KAAK,CAC/BM,KAD0B,CACpB,CAAC,yBAAD,EAA4BL,MAAM,CAACM,YAAnC,CADoB,EAE1BE,GAF0B,CAEtB,cAFsB,EAEN,0BAAcD,IAAI,GAAGA,IAAI,CAACE,IAAL,EAAH,GAAiB,EAAnC,IAAyC,CAFnC,CAA7B;;AAIA,cAAIF,IAAJ,EAAU;AACR,mBAAOA,IAAI,CAACG,IAAL,CAAUN,oBAAV,CAAP;AACD;;AAED,iBAAO,uBAAO,CAACA,oBAAD,CAAP,CAAP;AACD,SAXI,EAYJO,MAZI,CAYG,mBAZH,EAYwB,UAAAC,CAAC,EAAI;AAChC,cAAIZ,MAAM,CAACJ,iBAAP,KAA6B,IAAjC,EAAuC;AACrC,mBAAO,CAACgB,CAAR;AACD;;AAED,iBAAOA,CAAP;AACD,SAlBI,CAAP;AAmBD;;AACD,SAAK,+BAAL;AACE,aAAOb,KAAK,CACTG,QADI,EACM,cADN,6CACyBF,MAAM,CAACG,IADhC,IACuC,UAAAI,IAAI,EAAI;AAClD,YAAMH,oBAAoB,GAAGL,KAAK,CAC/BM,KAD0B,CACpB,CAAC,yBAAD,EAA4BL,MAAM,CAACM,YAAnC,CADoB,EAE1BE,GAF0B,CAEtB,aAFsB,EAEPR,MAAM,CAACM,YAFA,CAA7B;;AAIA,YAAIC,IAAJ,EAAU;AACR,iBAAOA,IAAI,CAACG,IAAL,CAAUN,oBAAV,CAAP;AACD;;AAED,eAAO,uBAAO,CAACA,oBAAD,CAAP,CAAP;AACD,OAXI,EAYJO,MAZI,CAYG,gBAZH,EAYqB;AAAA,eAAMX,MAAM,CAACG,IAAP,CAAY,CAAZ,CAAN;AAAA,OAZrB,EAaJQ,MAbI,CAaG,mBAbH,EAawB,UAAAC,CAAC,EAAI;AAChC,YAAIZ,MAAM,CAACJ,iBAAP,KAA6B,IAAjC,EAAuC;AACrC,iBAAO,CAACgB,CAAR;AACD;;AAED,eAAOA,CAAP;AACD,OAnBI,CAAP;;AAoBF,SAAK,cAAL;AACE,aAAOb,KAAK,CAACG,QAAN,EAAgB,cAAhB,6CAAmCF,MAAM,CAACG,IAA1C,IAAiD,UAAAI,IAAI,EAAI;AAC9D,YAAI,CAACM,KAAK,CAACC,OAAN,CAAcd,MAAM,CAACe,KAArB,CAAD,IAAgC,CAACf,MAAM,CAACe,KAAP,CAAaC,MAAlD,EAA0D;AACxD,iBAAOT,IAAP;AACD;;AAED,YAAMU,EAAE,GAAGjB,MAAM,CAACe,KAAP,CAAa,CAAb,EAAgBA,KAA3B;;AAEA,YAAIR,IAAJ,EAAU;AACR,iBAAOA,IAAI,CAACG,IAAL,CAAU,uBAAOO,EAAP,CAAV,CAAP;AACD;;AAED,eAAO,uBAAO,CAACA,EAAD,CAAP,CAAP;AACD,OAZM,CAAP;;AAaF,SAAK,WAAL;AAAkB;AAChB,eAAOlB,KAAK,CACTY,MADI,CACG,YADH,EACiB;AAAA,iBAAM,uBAAO,EAAP,CAAN;AAAA,SADjB,EAEJA,MAFI,CAEG,aAFH,EAEkB;AAAA,iBAAM,uBAAOX,MAAM,CAACkB,aAAd,CAAN;AAAA,SAFlB,EAGJP,MAHI,CAGG,cAHH,EAGmB;AAAA,iBAAM,uBAAOX,MAAM,CAACkB,aAAd,CAAN;AAAA,SAHnB,EAIJP,MAJI,CAIG,gBAJH,EAIqB;AAAA,iBAAM,IAAN;AAAA,SAJrB,EAKJA,MALI,CAKG,mBALH,EAKwB;AAAA,iBAAM,KAAN;AAAA,SALxB,CAAP;AAMD;;AACD,SAAK,sBAAL;AACE,aAAOZ,KAAK,CAACG,QAAN,EAAgB,cAAhB,6CAAmCF,MAAM,CAACmB,eAA1C,IAA4D,UAAAZ,IAAI,EAAI;AACzE,eAAOA,IAAI,UAAJ,CACGP,MAAM,CAACoB,SADV,EAEJC,MAFI,CAGHrB,MAAM,CAACsB,UAHJ,EAIHvB,KAAK,CAACM,KAAN,EAAa,cAAb,6CAAgCL,MAAM,CAACmB,eAAvC,IAAwDnB,MAAM,CAACoB,SAA/D,GAJG,CAAP;AAMD,OAPM,CAAP;;AAQF,SAAK,mBAAL;AACE,aAAOrB,KAAK,CACTY,MADI,CACG,mBADH,EACwB,UAAAC,CAAC,EAAI;AAChC,YAAIZ,MAAM,CAACJ,iBAAX,EAA8B;AAC5B,iBAAO,CAACgB,CAAR;AACD;;AAED,eAAOA,CAAP;AACD,OAPI,EAQJV,QARI,CAQK,CAAC,cAAD,EAAiBF,MAAM,CAACuB,eAAxB,CARL,EAQ+C,UAAAhB,IAAI,EAAI;AAC1D,eAAOA,IAAI,UAAJ,CACGP,MAAM,CAACwB,YADV,EAEJH,MAFI,CAGHrB,MAAM,CAACwB,YAAP,GAAsB,CAHnB,EAIHzB,KAAK,CAACM,KAAN,CAAY,CAAC,cAAD,EAAiBL,MAAM,CAACuB,eAAxB,EAAyCvB,MAAM,CAACwB,YAAhD,CAAZ,CAJG,CAAP;AAMD,OAfI,CAAP;;AAgBF,SAAK,qBAAL;AACE,aAAOzB,KAAK,CACTY,MADI,CACG,mBADH,EACwB,UAAAC,CAAC,EAAI;AAChC,YAAIZ,MAAM,CAACJ,iBAAX,EAA8B;AAC5B,iBAAO,CAACgB,CAAR;AACD;;AAED,eAAOA,CAAP;AACD,OAPI,EAQJV,QARI,CAQK,CAAC,cAAD,EAAiBF,MAAM,CAACuB,eAAxB,CARL,EAQ+C,UAAAhB,IAAI,EAAI;AAC1D,eAAOA,IAAI,UAAJ,CACGP,MAAM,CAACwB,YADV,EAEJH,MAFI,CAGHrB,MAAM,CAACwB,YAAP,GAAsB,CAHnB,EAIHzB,KAAK,CAACM,KAAN,CAAY,CAAC,cAAD,EAAiBL,MAAM,CAACuB,eAAxB,EAAyCvB,MAAM,CAACwB,YAAhD,CAAZ,CAJG,CAAP;AAMD,OAfI,CAAP;;AAgBF,SAAK,YAAL;AACE,aAAOzB,KAAK,CAACG,QAAN,EAAgB,cAAhB,6CAAmCF,MAAM,CAACG,IAA1C,IAAiD,UAAAI,IAAI,EAAI;AAC9D,eAAOA,IAAI,UAAJ,CAAYP,MAAM,CAACoB,SAAnB,EAA8BC,MAA9B,CAAqCrB,MAAM,CAACyB,SAA5C,EAAuDlB,IAAI,CAACmB,GAAL,CAAS1B,MAAM,CAACoB,SAAhB,CAAvD,CAAP;AACD,OAFM,CAAP;;AAGF,SAAK,WAAL;AAAkB;AAChB,YAAIO,QAAQ,GAAG5B,KAAf;;AACA,2DAAoCC,MAAM,CAACG,IAA3C;AAAA,YAAOyB,yBAAP,mBAFgB,CAIhB;AACA;AACA;AACA;;;AACA,YAAI5B,MAAM,CAAC6B,qBAAX,EAAkC;AAChCF,UAAAA,QAAQ,GAAG5B,KAAK,CAACG,QAAN,EAAgB,aAAhB,6CAAkCF,MAAM,CAACG,IAAzC,IAAgD,YAAM;AAC/D,mBAAOH,MAAM,CAACe,KAAd;AACD,WAFU,CAAX;AAGD;;AAED,YACEf,MAAM,CAACG,IAAP,CAAYa,MAAZ,KAAuB,CAAvB,IACAjB,KAAK,CAACM,KAAN,CAAY,CAAC,cAAD,EAAiBuB,yBAAjB,CAAZ,MAA6D,IAF/D,EAGE;AACAD,UAAAA,QAAQ,GAAGA,QAAQ,CAACzB,QAAT,CAAkB,CAAC,cAAD,EAAiB0B,yBAAjB,CAAlB,EAA+D;AAAA,mBAAM,uBAAO,EAAP,CAAN;AAAA,WAA/D,CAAX;AACD;;AAED,eAAOD,QAAQ,CAACzB,QAAT,EAAmB,cAAnB,6CAAsCF,MAAM,CAACG,IAA7C,IAAoD,YAAM;AAC/D,iBAAOH,MAAM,CAACe,KAAd;AACD,SAFM,CAAP;AAGD;;AACD,SAAK,oCAAL;AACE,aAAOhB,KAAK,CACTY,MADI,CACG,mBADH,EACwB,UAAAC,CAAC,EAAI;AAChC,YAAIZ,MAAM,CAACJ,iBAAX,EAA8B;AAC5B,iBAAO,CAACgB,CAAR;AACD;;AAED,eAAOA,CAAP;AACD,OAPI,EAQJkB,QARI,CAQK,CAAC,cAAD,EAAiB9B,MAAM,CAACuB,eAAxB,EAAyCvB,MAAM,CAAC+B,KAAhD,CARL,CAAP;;AASF,SAAK,6BAAL;AAAoC;AAClC,YAAMC,qBAAqB,IAAI,cAAJ,6CAAuBhC,MAAM,CAACG,IAA9B,EAA3B;AAEA,eAAOJ,KAAK,CAACG,QAAN,CAAe8B,qBAAf,EAAsC;AAAA,iBAAM,IAAN;AAAA,SAAtC,CAAP;AACD;;AACD,SAAK,uBAAL;AAA8B;AAC5B,eAAOjC,KAAK,CAACkC,QAAN,EAAgB,cAAhB,6CAAmCjC,MAAM,CAACG,IAA1C,GAAP;AACD;;AACD,SAAK,yBAAL;AAAgC;AAC9B,YAAM6B,sBAAqB,IAAI,cAAJ,6CAAuBhC,MAAM,CAACG,IAA9B,EAA3B;;AAEA,eAAOJ,KAAK,CACTY,MADI,CACG,mBADH,EACwB,UAAAC,CAAC,EAAI;AAChC,cAAMsB,SAAS,GAAGnC,KAAK,CAAC2B,GAAN,CAAU,YAAV,EAAwBS,MAAxB,GAAiCC,IAAjC,GAAwC,CAA1D;;AAEA,cAAIF,SAAJ,EAAe;AACb,mBAAO,CAACtB,CAAR;AACD;;AAED,iBAAOA,CAAP;AACD,SATI,EAUJkB,QAVI,CAUKE,sBAVL,CAAP;AAWD;;AACD,SAAK,iBAAL;AACE,aAAOjC,KAAK,CAACkC,QAAN,EAAgB,cAAhB,6CAAmCjC,MAAM,CAACG,IAAP,CAAYkC,KAAZ,CAAkB,GAAlB,CAAnC,GAAP;;AACF,SAAK,6BAAL;AACE,aAAOtC,KAAK,CACTY,MADI,CACG,yBADH,EAC8B;AAAA,eAAM,uBAAOX,MAAM,CAACT,uBAAd,CAAN;AAAA,OAD9B,EAEJoB,MAFI,CAEG,0BAFH,EAE+B;AAAA,eAAM,uBAAOX,MAAM,CAACR,wBAAd,CAAN;AAAA,OAF/B,CAAP;;AAGF,SAAK,iBAAL;AAAwB;AACtB,eAAOO,KAAK,CACTY,MADI,CACG,gBADH,EACqB;AAAA,iBAAM,IAAN;AAAA,SADrB,EAEJA,MAFI,CAEG,YAFH,EAEiB;AAAA,iBAAM,uBAAOX,MAAM,CAACsC,MAAd,CAAN;AAAA,SAFjB,CAAP;AAGD;;AACD,SAAK,yBAAL;AACE,aAAOvC,KAAK,CAACY,MAAN,CAAa,mBAAb,EAAkC,UAAAC,CAAC,EAAI;AAC5C,YAAMsB,SAAS,GAAGnC,KAAK,CAAC2B,GAAN,CAAU,YAAV,EAAwBS,MAAxB,GAAiCC,IAAjC,GAAwC,CAA1D;;AAEA,YAAIF,SAAJ,EAAe;AACb,iBAAO,CAACtB,CAAR;AACD;;AAED,eAAOA,CAAP;AACD,OARM,CAAP;;AASF;AACE,aAAOb,KAAP;AAtMJ;AAwMD,CAzMD;;eA2MeD,O","sourcesContent":["import { fromJS } from 'immutable';\nimport { getMaxTempKey } from '../../utils';\n\nconst initialState = fromJS({\n  componentsDataStructure: {},\n  contentTypeDataStructure: {},\n  formErrors: {},\n  initialData: {},\n  modifiedData: {},\n  shouldCheckErrors: false,\n  modifiedDZName: null,\n});\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'ADD_NON_REPEATABLE_COMPONENT_TO_FIELD':\n      return state.updateIn(['modifiedData', ...action.keys], () => {\n        const defaultDataStructure = state.getIn(['componentsDataStructure', action.componentUid]);\n\n        return fromJS(defaultDataStructure);\n      });\n    case 'ADD_REPEATABLE_COMPONENT_TO_FIELD': {\n      return state\n        .updateIn(['modifiedData', ...action.keys], list => {\n          const defaultDataStructure = state\n            .getIn(['componentsDataStructure', action.componentUid])\n            .set('__temp_key__', getMaxTempKey(list ? list.toJS() : []) + 1);\n\n          if (list) {\n            return list.push(defaultDataStructure);\n          }\n\n          return fromJS([defaultDataStructure]);\n        })\n        .update('shouldCheckErrors', v => {\n          if (action.shouldCheckErrors === true) {\n            return !v;\n          }\n\n          return v;\n        });\n    }\n    case 'ADD_COMPONENT_TO_DYNAMIC_ZONE':\n      return state\n        .updateIn(['modifiedData', ...action.keys], list => {\n          const defaultDataStructure = state\n            .getIn(['componentsDataStructure', action.componentUid])\n            .set('__component', action.componentUid);\n\n          if (list) {\n            return list.push(defaultDataStructure);\n          }\n\n          return fromJS([defaultDataStructure]);\n        })\n        .update('modifiedDZName', () => action.keys[0])\n        .update('shouldCheckErrors', v => {\n          if (action.shouldCheckErrors === true) {\n            return !v;\n          }\n\n          return v;\n        });\n    case 'ADD_RELATION':\n      return state.updateIn(['modifiedData', ...action.keys], list => {\n        if (!Array.isArray(action.value) || !action.value.length) {\n          return list;\n        }\n\n        const el = action.value[0].value;\n\n        if (list) {\n          return list.push(fromJS(el));\n        }\n\n        return fromJS([el]);\n      });\n    case 'INIT_FORM': {\n      return state\n        .update('formErrors', () => fromJS({}))\n        .update('initialData', () => fromJS(action.initialValues))\n        .update('modifiedData', () => fromJS(action.initialValues))\n        .update('modifiedDZName', () => null)\n        .update('shouldCheckErrors', () => false);\n    }\n    case 'MOVE_COMPONENT_FIELD':\n      return state.updateIn(['modifiedData', ...action.pathToComponent], list => {\n        return list\n          .delete(action.dragIndex)\n          .insert(\n            action.hoverIndex,\n            state.getIn(['modifiedData', ...action.pathToComponent, action.dragIndex])\n          );\n      });\n    case 'MOVE_COMPONENT_UP':\n      return state\n        .update('shouldCheckErrors', v => {\n          if (action.shouldCheckErrors) {\n            return !v;\n          }\n\n          return v;\n        })\n        .updateIn(['modifiedData', action.dynamicZoneName], list => {\n          return list\n            .delete(action.currentIndex)\n            .insert(\n              action.currentIndex - 1,\n              state.getIn(['modifiedData', action.dynamicZoneName, action.currentIndex])\n            );\n        });\n    case 'MOVE_COMPONENT_DOWN':\n      return state\n        .update('shouldCheckErrors', v => {\n          if (action.shouldCheckErrors) {\n            return !v;\n          }\n\n          return v;\n        })\n        .updateIn(['modifiedData', action.dynamicZoneName], list => {\n          return list\n            .delete(action.currentIndex)\n            .insert(\n              action.currentIndex + 1,\n              state.getIn(['modifiedData', action.dynamicZoneName, action.currentIndex])\n            );\n        });\n    case 'MOVE_FIELD':\n      return state.updateIn(['modifiedData', ...action.keys], list => {\n        return list.delete(action.dragIndex).insert(action.overIndex, list.get(action.dragIndex));\n      });\n    case 'ON_CHANGE': {\n      let newState = state;\n      const [nonRepeatableComponentKey] = action.keys;\n\n      // This is used to set the initialData for inputs\n      // that needs an asynchronous initial value like the UID field\n      // This is just a temporary patch.\n      // TODO : Refactor the default form creation (workflow) to accept async default values.\n      if (action.shouldSetInitialValue) {\n        newState = state.updateIn(['initialData', ...action.keys], () => {\n          return action.value;\n        });\n      }\n\n      if (\n        action.keys.length === 2 &&\n        state.getIn(['modifiedData', nonRepeatableComponentKey]) === null\n      ) {\n        newState = newState.updateIn(['modifiedData', nonRepeatableComponentKey], () => fromJS({}));\n      }\n\n      return newState.updateIn(['modifiedData', ...action.keys], () => {\n        return action.value;\n      });\n    }\n    case 'REMOVE_COMPONENT_FROM_DYNAMIC_ZONE':\n      return state\n        .update('shouldCheckErrors', v => {\n          if (action.shouldCheckErrors) {\n            return !v;\n          }\n\n          return v;\n        })\n        .deleteIn(['modifiedData', action.dynamicZoneName, action.index]);\n    case 'REMOVE_COMPONENT_FROM_FIELD': {\n      const componentPathToRemove = ['modifiedData', ...action.keys];\n\n      return state.updateIn(componentPathToRemove, () => null);\n    }\n    case 'REMOVE_PASSWORD_FIELD': {\n      return state.removeIn(['modifiedData', ...action.keys]);\n    }\n    case 'REMOVE_REPEATABLE_FIELD': {\n      const componentPathToRemove = ['modifiedData', ...action.keys];\n\n      return state\n        .update('shouldCheckErrors', v => {\n          const hasErrors = state.get('formErrors').keySeq().size > 0;\n\n          if (hasErrors) {\n            return !v;\n          }\n\n          return v;\n        })\n        .deleteIn(componentPathToRemove);\n    }\n    case 'REMOVE_RELATION':\n      return state.removeIn(['modifiedData', ...action.keys.split('.')]);\n    case 'SET_DEFAULT_DATA_STRUCTURES':\n      return state\n        .update('componentsDataStructure', () => fromJS(action.componentsDataStructure))\n        .update('contentTypeDataStructure', () => fromJS(action.contentTypeDataStructure));\n    case 'SET_FORM_ERRORS': {\n      return state\n        .update('modifiedDZName', () => null)\n        .update('formErrors', () => fromJS(action.errors));\n    }\n    case 'TRIGGER_FORM_VALIDATION':\n      return state.update('shouldCheckErrors', v => {\n        const hasErrors = state.get('formErrors').keySeq().size > 0;\n\n        if (hasErrors) {\n          return !v;\n        }\n\n        return v;\n      });\n    default:\n      return state;\n  }\n};\n\nexport default reducer;\nexport { initialState };\n"]},"metadata":{},"sourceType":"script"}