{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _custom = require(\"@buffetjs/custom\");\n\nvar _core = require(\"@buffetjs/core\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _utils = require(\"../../utils\");\n\nvar _Container = _interopRequireDefault(require(\"../../components/Container\"));\n\nvar _HomePageContent = _interopRequireDefault(require(\"./HomePageContent\"));\n\nvar _hooks = require(\"../../hooks\");\n\nvar _ModalStepper = _interopRequireDefault(require(\"../ModalStepper\"));\n\nvar _utils2 = require(\"./utils\");\n\nvar _init = _interopRequireDefault(require(\"./init\"));\n\nvar _reducer = _interopRequireWildcard(require(\"./reducer\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar HomePage = function HomePage() {\n  var _useAppContext = (0, _hooks.useAppContext)(),\n      allowedActions = _useAppContext.allowedActions;\n\n  var canRead = allowedActions.canRead;\n\n  var _useGlobalContext = (0, _strapiHelperPlugin.useGlobalContext)(),\n      formatMessage = _useGlobalContext.formatMessage,\n      plugins = _useGlobalContext.plugins;\n\n  var _getFileModelTimestam = (0, _utils.getFileModelTimestamps)(plugins),\n      _getFileModelTimestam2 = (0, _slicedToArray2[\"default\"])(_getFileModelTimestam, 2),\n      updated_at = _getFileModelTimestam2[1];\n\n  var _useReducer = (0, _react.useReducer)(_reducer[\"default\"], _reducer.initialState, function () {\n    return (0, _init[\"default\"])(_reducer.initialState, allowedActions);\n  }),\n      _useReducer2 = (0, _slicedToArray2[\"default\"])(_useReducer, 2),\n      reducerState = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var query = (0, _strapiHelperPlugin.useQuery)();\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      isModalOpen = _useState2[0],\n      setIsModalOpen = _useState2[1];\n\n  var _useState3 = (0, _react.useState)(false),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      isPopupOpen = _useState4[0],\n      setIsPopupOpen = _useState4[1];\n\n  var _useState5 = (0, _react.useState)(null),\n      _useState6 = (0, _slicedToArray2[\"default\"])(_useState5, 2),\n      fileToEdit = _useState6[0],\n      setFileToEdit = _useState6[1];\n\n  var _useState7 = (0, _react.useState)(false),\n      _useState8 = (0, _slicedToArray2[\"default\"])(_useState7, 2),\n      shouldRefetch = _useState8[0],\n      setShouldRefetch = _useState8[1];\n\n  var _useState9 = (0, _react.useState)('browse'),\n      _useState10 = (0, _slicedToArray2[\"default\"])(_useState9, 2),\n      modalInitialStep = _useState10[0],\n      setModalInitialStep = _useState10[1];\n\n  var _useHistory = (0, _reactRouterDom.useHistory)(),\n      push = _useHistory.push;\n\n  var _useLocation = (0, _reactRouterDom.useLocation)(),\n      search = _useLocation.search;\n\n  var isMounted = (0, _react.useRef)(true);\n\n  var _reducerState$toJS = reducerState.toJS(),\n      data = _reducerState$toJS.data,\n      dataCount = _reducerState$toJS.dataCount,\n      dataToDelete = _reducerState$toJS.dataToDelete,\n      isLoading = _reducerState$toJS.isLoading,\n      shouldRefetchData = _reducerState$toJS.shouldRefetchData,\n      showModalConfirmButtonLoading = _reducerState$toJS.showModalConfirmButtonLoading;\n\n  var pluginName = formatMessage({\n    id: (0, _utils.getTrad)('plugin.name')\n  });\n  var paramsKeys = ['_limit', '_start', '_q', '_sort'];\n  (0, _react.useEffect)(function () {\n    return function () {\n      return isMounted.current = false;\n    };\n  }, []);\n  (0, _react.useEffect)(function () {\n    fetchListData(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [search]);\n\n  var deleteMedia = /*#__PURE__*/function () {\n    var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(id) {\n      var requestURL, errorMessage;\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              requestURL = (0, _utils.getRequestUrl)(\"files/\".concat(id));\n              _context.prev = 1;\n              _context.next = 4;\n              return (0, _strapiHelperPlugin.request)(requestURL, {\n                method: 'DELETE'\n              });\n\n            case 4:\n              return _context.abrupt(\"return\", Promise.resolve());\n\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](1);\n              errorMessage = (0, _lodash.get)(_context.t0, 'response.payload.message', 'An error occured');\n              return _context.abrupt(\"return\", Promise.reject(errorMessage));\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 7]]);\n    }));\n\n    return function deleteMedia(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var fetchData = /*#__PURE__*/function () {\n    var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n      var dataRequestURL, params, paramsToSend, _data;\n\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              dataRequestURL = (0, _utils.getRequestUrl)('files');\n              params = (0, _utils2.generateStringFromParams)(query);\n              paramsToSend = params.includes('_sort') ? params : params.concat(\"&_sort=\".concat(updated_at, \":DESC\"));\n              _context2.prev = 3;\n              _context2.next = 6;\n              return (0, _strapiHelperPlugin.request)(\"\".concat(dataRequestURL, \"?\").concat(paramsToSend), {\n                method: 'GET'\n              });\n\n            case 6:\n              _data = _context2.sent;\n              return _context2.abrupt(\"return\", Promise.resolve(_data));\n\n            case 10:\n              _context2.prev = 10;\n              _context2.t0 = _context2[\"catch\"](3);\n\n              if (isMounted.current) {\n                dispatch({\n                  type: 'GET_DATA_ERROR'\n                });\n                strapi.notification.toggle({\n                  type: 'warning',\n                  message: {\n                    id: 'notification.error'\n                  }\n                });\n              }\n\n            case 13:\n              return _context2.abrupt(\"return\", []);\n\n            case 14:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[3, 10]]);\n    }));\n\n    return function fetchData() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var fetchDataCount = /*#__PURE__*/function () {\n    var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3() {\n      var params, requestURL, _yield$request, count;\n\n      return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              params = (0, _utils2.generateStringFromParams)(query, ['_limit', '_sort', '_start']);\n              requestURL = (0, _utils.getRequestUrl)('files/count');\n              _context3.prev = 2;\n              _context3.next = 5;\n              return (0, _strapiHelperPlugin.request)(\"\".concat(requestURL, \"?\").concat(params), {\n                method: 'GET'\n              });\n\n            case 5:\n              _yield$request = _context3.sent;\n              count = _yield$request.count;\n              return _context3.abrupt(\"return\", Promise.resolve(count));\n\n            case 10:\n              _context3.prev = 10;\n              _context3.t0 = _context3[\"catch\"](2);\n\n              if (isMounted.current) {\n                dispatch({\n                  type: 'GET_DATA_ERROR'\n                });\n                strapi.notification.toggle({\n                  type: 'warning',\n                  message: {\n                    id: 'notification.error'\n                  }\n                });\n              }\n\n            case 13:\n              return _context3.abrupt(\"return\", null);\n\n            case 14:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[2, 10]]);\n    }));\n\n    return function fetchDataCount() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var fetchListData = /*#__PURE__*/function () {\n    var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4() {\n      var _yield$Promise$all, _yield$Promise$all2, _data2, count;\n\n      return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (!canRead) {\n                _context4.next = 9;\n                break;\n              }\n\n              dispatch({\n                type: 'GET_DATA'\n              });\n              _context4.next = 4;\n              return Promise.all([fetchData(), fetchDataCount()]);\n\n            case 4:\n              _yield$Promise$all = _context4.sent;\n              _yield$Promise$all2 = (0, _slicedToArray2[\"default\"])(_yield$Promise$all, 2);\n              _data2 = _yield$Promise$all2[0];\n              count = _yield$Promise$all2[1];\n\n              if (isMounted.current) {\n                dispatch({\n                  type: 'GET_DATA_SUCCEEDED',\n                  data: _data2,\n                  count: count\n                });\n              }\n\n            case 9:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function fetchListData() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var generateNewSearch = function generateNewSearch() {\n    var updatedParams = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    return _objectSpread(_objectSpread({}, getSearchParams()), {}, {\n      filters: (0, _strapiHelperPlugin.generateFiltersFromSearch)(search)\n    }, updatedParams);\n  };\n\n  var getSearchParams = function getSearchParams() {\n    var params = {};\n    query.forEach(function (value, key) {\n      if ((0, _lodash.includes)(paramsKeys, key)) {\n        params[key] = value;\n      }\n    });\n    return params;\n  };\n\n  var handleChangeCheck = function handleChangeCheck(_ref5) {\n    var name = _ref5.target.name;\n    dispatch({\n      type: 'ON_CHANGE_DATA_TO_DELETE',\n      id: name\n    });\n  };\n\n  var handleChangeParams = function handleChangeParams(_ref6) {\n    var _ref6$target = _ref6.target,\n        name = _ref6$target.name,\n        value = _ref6$target.value;\n    var updatedQueryParams = generateNewSearch((0, _defineProperty2[\"default\"])({}, name, value));\n\n    if (name === 'filters') {\n      var existingFilters = (0, _strapiHelperPlugin.generateFiltersFromSearch)(search);\n      var canAddFilter = (0, _lodash.intersectionWith)(existingFilters, [value], _lodash.isEqual).length === 0;\n      updatedQueryParams = generateNewSearch((0, _defineProperty2[\"default\"])({}, name, existingFilters));\n\n      if (canAddFilter) {\n        var filters = [].concat((0, _toConsumableArray2[\"default\"])(existingFilters), [value]);\n        updatedQueryParams = generateNewSearch((0, _defineProperty2[\"default\"])({}, name, filters));\n      }\n    }\n\n    if (name === '_limit') {\n      var _generateNewSearch4;\n\n      updatedQueryParams = generateNewSearch((_generateNewSearch4 = {}, (0, _defineProperty2[\"default\"])(_generateNewSearch4, name, value), (0, _defineProperty2[\"default\"])(_generateNewSearch4, \"_start\", 0), _generateNewSearch4));\n    }\n\n    var newSearch = (0, _strapiHelperPlugin.generateSearchFromFilters)(updatedQueryParams);\n    push({\n      search: newSearch\n    });\n  };\n\n  var handleClickEditFile = function handleClickEditFile(id) {\n    if (allowedActions.canUpdate) {\n      var file = (0, _utils.formatFileForEditing)(data.find(function (file) {\n        return (0, _lodash.toString)(file.id) === (0, _lodash.toString)(id);\n      }));\n      setFileToEdit(file);\n      setModalInitialStep('edit');\n      handleClickToggleModal();\n    }\n  };\n\n  var handleClickToggleModal = function handleClickToggleModal() {\n    var refetch = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    setIsModalOpen(function (prev) {\n      return !prev;\n    });\n    setShouldRefetch(refetch);\n  };\n\n  var handleClickTogglePopup = function handleClickTogglePopup() {\n    setIsPopupOpen(function (prev) {\n      return !prev;\n    });\n  };\n\n  var handleDeleteFilter = function handleDeleteFilter(index) {\n    var filters = (0, _strapiHelperPlugin.generateFiltersFromSearch)(search).filter(function (filter, filterIndex) {\n      return filterIndex !== index;\n    });\n    var updatedQueryParams = generateNewSearch({\n      filters: filters\n    });\n    var newSearch = (0, _strapiHelperPlugin.generateSearchFromFilters)(updatedQueryParams);\n    push({\n      search: newSearch\n    });\n  };\n\n  var handleConfirmDeleteMedias = (0, _react.useCallback)( /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5() {\n    return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            dispatch({\n              type: 'ON_DELETE_MEDIAS'\n            });\n            _context5.prev = 1;\n            _context5.next = 4;\n            return Promise.all(dataToDelete.map(function (item) {\n              return deleteMedia(item.id);\n            }));\n\n          case 4:\n            dispatch({\n              type: 'ON_DELETE_MEDIAS_SUCCEEDED'\n            });\n            _context5.next = 11;\n            break;\n\n          case 7:\n            _context5.prev = 7;\n            _context5.t0 = _context5[\"catch\"](1);\n            strapi.notification.toggle({\n              type: 'warning',\n              message: _context5.t0\n            });\n            dispatch({\n              type: 'ON_DELETE_MEDIAS_ERROR'\n            });\n\n          case 11:\n            _context5.prev = 11;\n            setIsPopupOpen(false);\n            return _context5.finish(11);\n\n          case 14:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5, null, [[1, 7, 11, 14]]);\n  })), [dataToDelete]);\n  var handleClosedModalDeleteAll = (0, _react.useCallback)(function () {\n    if (shouldRefetchData) {\n      fetchListData();\n    } else {\n      dispatch({\n        type: 'RESET_DATA_TO_DELETE'\n      });\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [shouldRefetchData]);\n\n  var handleModalClose = function handleModalClose() {\n    resetModalState();\n\n    if (shouldRefetch) {\n      fetchListData();\n      setShouldRefetch(false);\n    }\n  };\n\n  var handleSelectAll = function handleSelectAll() {\n    dispatch({\n      type: 'TOGGLE_SELECT_ALL'\n    });\n  };\n\n  var resetModalState = function resetModalState() {\n    setModalInitialStep('browse');\n    setFileToEdit(null);\n  };\n\n  var headerProps = {\n    title: {\n      label: pluginName\n    },\n\n    /* eslint-disable indent */\n    content: canRead ? formatMessage({\n      id: (0, _utils.getTrad)((0, _utils2.getHeaderLabel)(dataCount))\n    }, {\n      number: dataCount\n    }) : null,\n\n    /* eslint-enable indent */\n    actions: [{\n      disabled: dataToDelete.length === 0,\n      color: 'delete',\n      // TradId from the strapi-admin package\n      label: formatMessage({\n        id: 'app.utils.delete'\n      }),\n      onClick: function onClick() {\n        return setIsPopupOpen(true);\n      },\n      type: 'button',\n      Component: function Component(buttonProps) {\n        if (!allowedActions.canUpdate) {\n          return null;\n        }\n\n        return /*#__PURE__*/_react[\"default\"].createElement(_core.Button, buttonProps);\n      }\n    }, {\n      disabled: false,\n      color: 'primary',\n      label: formatMessage({\n        id: (0, _utils.getTrad)('header.actions.upload-assets')\n      }),\n      onClick: function onClick() {\n        return handleClickToggleModal();\n      },\n      type: 'button',\n      Component: function Component(buttonProps) {\n        if (!allowedActions.canCreate) {\n          return null;\n        }\n\n        return /*#__PURE__*/_react[\"default\"].createElement(_core.Button, buttonProps);\n      }\n    }]\n  };\n  var handleRemoveFileFromDataToDelete = (0, _react.useCallback)(function (id) {\n    dispatch({\n      type: 'ON_CHANGE_DATA_TO_DELETE',\n      id: id\n    });\n  }, []);\n  var content = canRead ? /*#__PURE__*/_react[\"default\"].createElement(_HomePageContent[\"default\"], {\n    data: data,\n    dataCount: dataCount,\n    dataToDelete: dataToDelete,\n    isLoading: isLoading,\n    onCardCheck: handleChangeCheck,\n    onCardClick: handleClickEditFile,\n    onClick: handleClickToggleModal,\n    onFilterDelete: handleDeleteFilter,\n    onParamsChange: handleChangeParams,\n    onSelectAll: handleSelectAll\n  }) : null;\n  return /*#__PURE__*/_react[\"default\"].createElement(_Container[\"default\"], null, /*#__PURE__*/_react[\"default\"].createElement(_custom.Header, (0, _extends2[\"default\"])({}, headerProps, {\n    isLoading: isLoading\n  })), content, /*#__PURE__*/_react[\"default\"].createElement(_ModalStepper[\"default\"], {\n    initialFileToEdit: fileToEdit,\n    initialStep: modalInitialStep,\n    isOpen: isModalOpen,\n    onClosed: handleModalClose,\n    onRemoveFileFromDataToDelete: handleRemoveFileFromDataToDelete,\n    onToggle: handleClickToggleModal,\n    refetchData: fetchListData\n  }), /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.PopUpWarning, {\n    isOpen: isPopupOpen,\n    isConfirmButtonLoading: showModalConfirmButtonLoading,\n    onConfirm: handleConfirmDeleteMedias,\n    onClosed: handleClosedModalDeleteAll,\n    toggleModal: handleClickTogglePopup,\n    popUpWarningType: \"danger\"\n  }), /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n    bottom: true,\n    size: \"md\"\n  }), /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n    bottom: true,\n    size: \"md\"\n  }));\n};\n\nvar _default = HomePage;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-upload/admin/src/containers/HomePage/index.js"],"names":["HomePage","allowedActions","canRead","formatMessage","plugins","updated_at","reducer","initialState","reducerState","dispatch","query","isModalOpen","setIsModalOpen","isPopupOpen","setIsPopupOpen","fileToEdit","setFileToEdit","shouldRefetch","setShouldRefetch","modalInitialStep","setModalInitialStep","push","search","isMounted","toJS","data","dataCount","dataToDelete","isLoading","shouldRefetchData","showModalConfirmButtonLoading","pluginName","id","paramsKeys","current","fetchListData","deleteMedia","requestURL","method","Promise","resolve","errorMessage","reject","fetchData","dataRequestURL","params","paramsToSend","includes","concat","type","strapi","notification","toggle","message","fetchDataCount","count","all","generateNewSearch","updatedParams","getSearchParams","filters","forEach","value","key","handleChangeCheck","name","target","handleChangeParams","updatedQueryParams","existingFilters","canAddFilter","isEqual","length","newSearch","handleClickEditFile","canUpdate","file","find","handleClickToggleModal","refetch","prev","handleClickTogglePopup","handleDeleteFilter","index","filter","filterIndex","handleConfirmDeleteMedias","map","item","handleClosedModalDeleteAll","handleModalClose","resetModalState","handleSelectAll","headerProps","title","label","content","number","actions","disabled","color","onClick","Component","buttonProps","canCreate","handleRemoveFileFromDataToDelete"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAQA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;AAEA,IAAMA,QAAQ,GAAG,SAAXA,QAAW,GAAM;AACrB,uBAA2B,2BAA3B;AAAA,MAAQC,cAAR,kBAAQA,cAAR;;AACA,MAAQC,OAAR,GAAoBD,cAApB,CAAQC,OAAR;;AACA,0BAAmC,2CAAnC;AAAA,MAAQC,aAAR,qBAAQA,aAAR;AAAA,MAAuBC,OAAvB,qBAAuBA,OAAvB;;AACA,8BAAuB,mCAAuBA,OAAvB,CAAvB;AAAA;AAAA,MAASC,UAAT;;AACA,oBAAiC,uBAAWC,mBAAX,EAAoBC,qBAApB,EAAkC;AAAA,WACjE,sBAAKA,qBAAL,EAAmBN,cAAnB,CADiE;AAAA,GAAlC,CAAjC;AAAA;AAAA,MAAOO,YAAP;AAAA,MAAqBC,QAArB;;AAGA,MAAMC,KAAK,GAAG,mCAAd;;AACA,kBAAsC,qBAAS,KAAT,CAAtC;AAAA;AAAA,MAAOC,WAAP;AAAA,MAAoBC,cAApB;;AACA,mBAAsC,qBAAS,KAAT,CAAtC;AAAA;AAAA,MAAOC,WAAP;AAAA,MAAoBC,cAApB;;AACA,mBAAoC,qBAAS,IAAT,CAApC;AAAA;AAAA,MAAOC,UAAP;AAAA,MAAmBC,aAAnB;;AACA,mBAA0C,qBAAS,KAAT,CAA1C;AAAA;AAAA,MAAOC,aAAP;AAAA,MAAsBC,gBAAtB;;AACA,mBAAgD,qBAAS,QAAT,CAAhD;AAAA;AAAA,MAAOC,gBAAP;AAAA,MAAyBC,mBAAzB;;AACA,oBAAiB,iCAAjB;AAAA,MAAQC,IAAR,eAAQA,IAAR;;AACA,qBAAmB,kCAAnB;AAAA,MAAQC,MAAR,gBAAQA,MAAR;;AACA,MAAMC,SAAS,GAAG,mBAAO,IAAP,CAAlB;;AACA,2BAOIf,YAAY,CAACgB,IAAb,EAPJ;AAAA,MACEC,IADF,sBACEA,IADF;AAAA,MAEEC,SAFF,sBAEEA,SAFF;AAAA,MAGEC,YAHF,sBAGEA,YAHF;AAAA,MAIEC,SAJF,sBAIEA,SAJF;AAAA,MAKEC,iBALF,sBAKEA,iBALF;AAAA,MAMEC,6BANF,sBAMEA,6BANF;;AAQA,MAAMC,UAAU,GAAG5B,aAAa,CAAC;AAAE6B,IAAAA,EAAE,EAAE,oBAAQ,aAAR;AAAN,GAAD,CAAhC;AACA,MAAMC,UAAU,GAAG,CAAC,QAAD,EAAW,QAAX,EAAqB,IAArB,EAA2B,OAA3B,CAAnB;AAEA,wBAAU,YAAM;AACd,WAAO;AAAA,aAAOV,SAAS,CAACW,OAAV,GAAoB,KAA3B;AAAA,KAAP;AACD,GAFD,EAEG,EAFH;AAIA,wBAAU,YAAM;AACdC,IAAAA,aAAa,GADC,CAGd;AACD,GAJD,EAIG,CAACb,MAAD,CAJH;;AAMA,MAAMc,WAAW;AAAA,6FAAG,iBAAMJ,EAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACZK,cAAAA,UADY,GACC,0CAAuBL,EAAvB,EADD;AAAA;AAAA;AAAA,qBAIV,iCAAQK,UAAR,EAAoB;AACxBC,gBAAAA,MAAM,EAAE;AADgB,eAApB,CAJU;;AAAA;AAAA,+CAQTC,OAAO,CAACC,OAAR,EARS;;AAAA;AAAA;AAAA;AAUVC,cAAAA,YAVU,GAUK,8BAAS,0BAAT,EAAqC,kBAArC,CAVL;AAAA,+CAYTF,OAAO,CAACG,MAAR,CAAeD,YAAf,CAZS;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAXL,WAAW;AAAA;AAAA;AAAA,KAAjB;;AAgBA,MAAMO,SAAS;AAAA,8FAAG;AAAA;;AAAA;AAAA;AAAA;AAAA;AACVC,cAAAA,cADU,GACO,0BAAc,OAAd,CADP;AAEVC,cAAAA,MAFU,GAED,sCAAyBnC,KAAzB,CAFC;AAIVoC,cAAAA,YAJU,GAIKD,MAAM,CAACE,QAAP,CAAgB,OAAhB,IACjBF,MADiB,GAEjBA,MAAM,CAACG,MAAP,kBAAwB3C,UAAxB,WANY;AAAA;AAAA;AAAA,qBASK,2CAAWuC,cAAX,cAA6BE,YAA7B,GAA6C;AAC9DR,gBAAAA,MAAM,EAAE;AADsD,eAA7C,CATL;;AAAA;AASRb,cAAAA,KATQ;AAAA,gDAaPc,OAAO,CAACC,OAAR,CAAgBf,KAAhB,CAbO;;AAAA;AAAA;AAAA;;AAed,kBAAIF,SAAS,CAACW,OAAd,EAAuB;AACrBzB,gBAAAA,QAAQ,CAAC;AAAEwC,kBAAAA,IAAI,EAAE;AAAR,iBAAD,CAAR;AACAC,gBAAAA,MAAM,CAACC,YAAP,CAAoBC,MAApB,CAA2B;AACzBH,kBAAAA,IAAI,EAAE,SADmB;AAEzBI,kBAAAA,OAAO,EAAE;AAAErB,oBAAAA,EAAE,EAAE;AAAN;AAFgB,iBAA3B;AAID;;AArBa;AAAA,gDAwBT,EAxBS;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAATW,SAAS;AAAA;AAAA;AAAA,KAAf;;AA2BA,MAAMW,cAAc;AAAA,8FAAG;AAAA;;AAAA;AAAA;AAAA;AAAA;AACfT,cAAAA,MADe,GACN,sCAAyBnC,KAAzB,EAAgC,CAAC,QAAD,EAAW,OAAX,EAAoB,QAApB,CAAhC,CADM;AAEf2B,cAAAA,UAFe,GAEF,0BAAc,aAAd,CAFE;AAAA;AAAA;AAAA,qBAKK,2CAAWA,UAAX,cAAyBQ,MAAzB,GAAmC;AACzDP,gBAAAA,MAAM,EAAE;AADiD,eAAnC,CALL;;AAAA;AAAA;AAKXiB,cAAAA,KALW,kBAKXA,KALW;AAAA,gDASZhB,OAAO,CAACC,OAAR,CAAgBe,KAAhB,CATY;;AAAA;AAAA;AAAA;;AAWnB,kBAAIhC,SAAS,CAACW,OAAd,EAAuB;AACrBzB,gBAAAA,QAAQ,CAAC;AAAEwC,kBAAAA,IAAI,EAAE;AAAR,iBAAD,CAAR;AACAC,gBAAAA,MAAM,CAACC,YAAP,CAAoBC,MAApB,CAA2B;AACzBH,kBAAAA,IAAI,EAAE,SADmB;AAEzBI,kBAAAA,OAAO,EAAE;AAAErB,oBAAAA,EAAE,EAAE;AAAN;AAFgB,iBAA3B;AAID;;AAjBkB;AAAA,gDAoBd,IApBc;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAdsB,cAAc;AAAA;AAAA;AAAA,KAApB;;AAuBA,MAAMnB,aAAa;AAAA,8FAAG;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,mBAChBjC,OADgB;AAAA;AAAA;AAAA;;AAElBO,cAAAA,QAAQ,CAAC;AAAEwC,gBAAAA,IAAI,EAAE;AAAR,eAAD,CAAR;AAFkB;AAAA,qBAIUV,OAAO,CAACiB,GAAR,CAAY,CAACb,SAAS,EAAV,EAAcW,cAAc,EAA5B,CAAZ,CAJV;;AAAA;AAAA;AAAA;AAIX7B,cAAAA,MAJW;AAIL8B,cAAAA,KAJK;;AAMlB,kBAAIhC,SAAS,CAACW,OAAd,EAAuB;AACrBzB,gBAAAA,QAAQ,CAAC;AACPwC,kBAAAA,IAAI,EAAE,oBADC;AAEPxB,kBAAAA,IAAI,EAAJA,MAFO;AAGP8B,kBAAAA,KAAK,EAALA;AAHO,iBAAD,CAAR;AAKD;;AAZiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAbpB,aAAa;AAAA;AAAA;AAAA,KAAnB;;AAgBA,MAAMsB,iBAAiB,GAAG,SAApBA,iBAAoB,GAAwB;AAAA,QAAvBC,aAAuB,uEAAP,EAAO;AAChD,2CACKC,eAAe,EADpB;AAEEC,MAAAA,OAAO,EAAE,mDAA0BtC,MAA1B;AAFX,OAGKoC,aAHL;AAKD,GAND;;AAQA,MAAMC,eAAe,GAAG,SAAlBA,eAAkB,GAAM;AAC5B,QAAMd,MAAM,GAAG,EAAf;AAEAnC,IAAAA,KAAK,CAACmD,OAAN,CAAc,UAACC,KAAD,EAAQC,GAAR,EAAgB;AAC5B,UAAI,sBAAS9B,UAAT,EAAqB8B,GAArB,CAAJ,EAA+B;AAC7BlB,QAAAA,MAAM,CAACkB,GAAD,CAAN,GAAcD,KAAd;AACD;AACF,KAJD;AAMA,WAAOjB,MAAP;AACD,GAVD;;AAYA,MAAMmB,iBAAiB,GAAG,SAApBA,iBAAoB,QAA0B;AAAA,QAAbC,IAAa,SAAvBC,MAAuB,CAAbD,IAAa;AAClDxD,IAAAA,QAAQ,CAAC;AACPwC,MAAAA,IAAI,EAAE,0BADC;AAEPjB,MAAAA,EAAE,EAAEiC;AAFG,KAAD,CAAR;AAID,GALD;;AAOA,MAAME,kBAAkB,GAAG,SAArBA,kBAAqB,QAAiC;AAAA,6BAA9BD,MAA8B;AAAA,QAApBD,IAAoB,gBAApBA,IAAoB;AAAA,QAAdH,KAAc,gBAAdA,KAAc;AAC1D,QAAIM,kBAAkB,GAAGX,iBAAiB,sCAAIQ,IAAJ,EAAWH,KAAX,EAA1C;;AAEA,QAAIG,IAAI,KAAK,SAAb,EAAwB;AACtB,UAAMI,eAAe,GAAG,mDAA0B/C,MAA1B,CAAxB;AACA,UAAMgD,YAAY,GAAG,8BAAiBD,eAAjB,EAAkC,CAACP,KAAD,CAAlC,EAA2CS,eAA3C,EAAoDC,MAApD,KAA+D,CAApF;AACAJ,MAAAA,kBAAkB,GAAGX,iBAAiB,sCAAIQ,IAAJ,EAAWI,eAAX,EAAtC;;AAEA,UAAIC,YAAJ,EAAkB;AAChB,YAAMV,OAAO,iDAAOS,eAAP,IAAwBP,KAAxB,EAAb;AAEAM,QAAAA,kBAAkB,GAAGX,iBAAiB,sCAAIQ,IAAJ,EAAWL,OAAX,EAAtC;AACD;AACF;;AAED,QAAIK,IAAI,KAAK,QAAb,EAAuB;AAAA;;AACrBG,MAAAA,kBAAkB,GAAGX,iBAAiB,kFAAIQ,IAAJ,EAAWH,KAAX,mEAA0B,CAA1B,wBAAtC;AACD;;AAED,QAAMW,SAAS,GAAG,mDAA0BL,kBAA1B,CAAlB;AAEA/C,IAAAA,IAAI,CAAC;AAAEC,MAAAA,MAAM,EAAEmD;AAAV,KAAD,CAAJ;AACD,GAtBD;;AAwBA,MAAMC,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAA1C,EAAE,EAAI;AAChC,QAAI/B,cAAc,CAAC0E,SAAnB,EAA8B;AAC5B,UAAMC,IAAI,GAAG,iCAAqBnD,IAAI,CAACoD,IAAL,CAAU,UAAAD,IAAI;AAAA,eAAI,sBAASA,IAAI,CAAC5C,EAAd,MAAsB,sBAASA,EAAT,CAA1B;AAAA,OAAd,CAArB,CAAb;AAEAhB,MAAAA,aAAa,CAAC4D,IAAD,CAAb;AACAxD,MAAAA,mBAAmB,CAAC,MAAD,CAAnB;AACA0D,MAAAA,sBAAsB;AACvB;AACF,GARD;;AAUA,MAAMA,sBAAsB,GAAG,SAAzBA,sBAAyB,GAAqB;AAAA,QAApBC,OAAoB,uEAAV,KAAU;AAClDnE,IAAAA,cAAc,CAAC,UAAAoE,IAAI;AAAA,aAAI,CAACA,IAAL;AAAA,KAAL,CAAd;AACA9D,IAAAA,gBAAgB,CAAC6D,OAAD,CAAhB;AACD,GAHD;;AAKA,MAAME,sBAAsB,GAAG,SAAzBA,sBAAyB,GAAM;AACnCnE,IAAAA,cAAc,CAAC,UAAAkE,IAAI;AAAA,aAAI,CAACA,IAAL;AAAA,KAAL,CAAd;AACD,GAFD;;AAIA,MAAME,kBAAkB,GAAG,SAArBA,kBAAqB,CAAAC,KAAK,EAAI;AAClC,QAAMvB,OAAO,GAAG,mDAA0BtC,MAA1B,EAAkC8D,MAAlC,CACd,UAACA,MAAD,EAASC,WAAT;AAAA,aAAyBA,WAAW,KAAKF,KAAzC;AAAA,KADc,CAAhB;AAIA,QAAMf,kBAAkB,GAAGX,iBAAiB,CAAC;AAAEG,MAAAA,OAAO,EAAPA;AAAF,KAAD,CAA5C;AAEA,QAAMa,SAAS,GAAG,mDAA0BL,kBAA1B,CAAlB;AAEA/C,IAAAA,IAAI,CAAC;AAAEC,MAAAA,MAAM,EAAEmD;AAAV,KAAD,CAAJ;AACD,GAVD;;AAYA,MAAMa,yBAAyB,GAAG,oHAAY;AAAA;AAAA;AAAA;AAAA;AAC5C7E,YAAAA,QAAQ,CAAC;AAAEwC,cAAAA,IAAI,EAAE;AAAR,aAAD,CAAR;AAD4C;AAAA;AAAA,mBAIpCV,OAAO,CAACiB,GAAR,CAAY7B,YAAY,CAAC4D,GAAb,CAAiB,UAAAC,IAAI;AAAA,qBAAIpD,WAAW,CAACoD,IAAI,CAACxD,EAAN,CAAf;AAAA,aAArB,CAAZ,CAJoC;;AAAA;AAM1CvB,YAAAA,QAAQ,CAAC;AACPwC,cAAAA,IAAI,EAAE;AADC,aAAD,CAAR;AAN0C;AAAA;;AAAA;AAAA;AAAA;AAU1CC,YAAAA,MAAM,CAACC,YAAP,CAAoBC,MAApB,CAA2B;AACzBH,cAAAA,IAAI,EAAE,SADmB;AAEzBI,cAAAA,OAAO;AAFkB,aAA3B;AAKA5C,YAAAA,QAAQ,CAAC;AACPwC,cAAAA,IAAI,EAAE;AADC,aAAD,CAAR;;AAf0C;AAAA;AAmB1CnC,YAAAA,cAAc,CAAC,KAAD,CAAd;AAnB0C;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAZ,IAqB/B,CAACa,YAAD,CArB+B,CAAlC;AAuBA,MAAM8D,0BAA0B,GAAG,wBAAY,YAAM;AACnD,QAAI5D,iBAAJ,EAAuB;AACrBM,MAAAA,aAAa;AACd,KAFD,MAEO;AACL1B,MAAAA,QAAQ,CAAC;AAAEwC,QAAAA,IAAI,EAAE;AAAR,OAAD,CAAR;AACD,KALkD,CAMnD;;AACD,GAPkC,EAOhC,CAACpB,iBAAD,CAPgC,CAAnC;;AASA,MAAM6D,gBAAgB,GAAG,SAAnBA,gBAAmB,GAAM;AAC7BC,IAAAA,eAAe;;AAEf,QAAI1E,aAAJ,EAAmB;AACjBkB,MAAAA,aAAa;AACbjB,MAAAA,gBAAgB,CAAC,KAAD,CAAhB;AACD;AACF,GAPD;;AASA,MAAM0E,eAAe,GAAG,SAAlBA,eAAkB,GAAM;AAC5BnF,IAAAA,QAAQ,CAAC;AACPwC,MAAAA,IAAI,EAAE;AADC,KAAD,CAAR;AAGD,GAJD;;AAMA,MAAM0C,eAAe,GAAG,SAAlBA,eAAkB,GAAM;AAC5BvE,IAAAA,mBAAmB,CAAC,QAAD,CAAnB;AACAJ,IAAAA,aAAa,CAAC,IAAD,CAAb;AACD,GAHD;;AAKA,MAAM6E,WAAW,GAAG;AAClBC,IAAAA,KAAK,EAAE;AACLC,MAAAA,KAAK,EAAEhE;AADF,KADW;;AAIlB;AACAiE,IAAAA,OAAO,EAAE9F,OAAO,GACZC,aAAa,CACX;AACE6B,MAAAA,EAAE,EAAE,oBAAQ,4BAAeN,SAAf,CAAR;AADN,KADW,EAIX;AAAEuE,MAAAA,MAAM,EAAEvE;AAAV,KAJW,CADD,GAOZ,IAZc;;AAalB;AACAwE,IAAAA,OAAO,EAAE,CACP;AACEC,MAAAA,QAAQ,EAAExE,YAAY,CAAC6C,MAAb,KAAwB,CADpC;AAEE4B,MAAAA,KAAK,EAAE,QAFT;AAGE;AACAL,MAAAA,KAAK,EAAE5F,aAAa,CAAC;AAAE6B,QAAAA,EAAE,EAAE;AAAN,OAAD,CAJtB;AAKEqE,MAAAA,OAAO,EAAE;AAAA,eAAMvF,cAAc,CAAC,IAAD,CAApB;AAAA,OALX;AAMEmC,MAAAA,IAAI,EAAE,QANR;AAOEqD,MAAAA,SAAS,EAAE,mBAAAC,WAAW,EAAI;AACxB,YAAI,CAACtG,cAAc,CAAC0E,SAApB,EAA+B;AAC7B,iBAAO,IAAP;AACD;;AAED,4BAAO,gCAAC,YAAD,EAAY4B,WAAZ,CAAP;AACD;AAbH,KADO,EAgBP;AACEJ,MAAAA,QAAQ,EAAE,KADZ;AAEEC,MAAAA,KAAK,EAAE,SAFT;AAGEL,MAAAA,KAAK,EAAE5F,aAAa,CAAC;AAAE6B,QAAAA,EAAE,EAAE,oBAAQ,8BAAR;AAAN,OAAD,CAHtB;AAIEqE,MAAAA,OAAO,EAAE;AAAA,eAAMvB,sBAAsB,EAA5B;AAAA,OAJX;AAKE7B,MAAAA,IAAI,EAAE,QALR;AAMEqD,MAAAA,SAAS,EAAE,mBAAAC,WAAW,EAAI;AACxB,YAAI,CAACtG,cAAc,CAACuG,SAApB,EAA+B;AAC7B,iBAAO,IAAP;AACD;;AAED,4BAAO,gCAAC,YAAD,EAAYD,WAAZ,CAAP;AACD;AAZH,KAhBO;AAdS,GAApB;AA+CA,MAAME,gCAAgC,GAAG,wBAAY,UAAAzE,EAAE,EAAI;AACzDvB,IAAAA,QAAQ,CAAC;AACPwC,MAAAA,IAAI,EAAE,0BADC;AAEPjB,MAAAA,EAAE,EAAFA;AAFO,KAAD,CAAR;AAID,GALwC,EAKtC,EALsC,CAAzC;AAOA,MAAMgE,OAAO,GAAG9F,OAAO,gBACrB,gCAAC,2BAAD;AACE,IAAA,IAAI,EAAEuB,IADR;AAEE,IAAA,SAAS,EAAEC,SAFb;AAGE,IAAA,YAAY,EAAEC,YAHhB;AAIE,IAAA,SAAS,EAAEC,SAJb;AAKE,IAAA,WAAW,EAAEoC,iBALf;AAME,IAAA,WAAW,EAAEU,mBANf;AAOE,IAAA,OAAO,EAAEI,sBAPX;AAQE,IAAA,cAAc,EAAEI,kBARlB;AASE,IAAA,cAAc,EAAEf,kBATlB;AAUE,IAAA,WAAW,EAAEyB;AAVf,IADqB,GAanB,IAbJ;AAeA,sBACE,gCAAC,qBAAD,qBACE,gCAAC,cAAD,gCAAYC,WAAZ;AAAyB,IAAA,SAAS,EAAEjE;AAApC,KADF,EAEGoE,OAFH,eAGE,gCAAC,wBAAD;AACE,IAAA,iBAAiB,EAAEjF,UADrB;AAEE,IAAA,WAAW,EAAEI,gBAFf;AAGE,IAAA,MAAM,EAAER,WAHV;AAIE,IAAA,QAAQ,EAAE+E,gBAJZ;AAKE,IAAA,4BAA4B,EAAEe,gCALhC;AAME,IAAA,QAAQ,EAAE3B,sBANZ;AAOE,IAAA,WAAW,EAAE3C;AAPf,IAHF,eAYE,gCAAC,gCAAD;AACE,IAAA,MAAM,EAAEtB,WADV;AAEE,IAAA,sBAAsB,EAAEiB,6BAF1B;AAGE,IAAA,SAAS,EAAEwD,yBAHb;AAIE,IAAA,QAAQ,EAAEG,0BAJZ;AAKE,IAAA,WAAW,EAAER,sBALf;AAME,IAAA,gBAAgB,EAAC;AANnB,IAZF,eAoBE,gCAAC,YAAD;AAAQ,IAAA,MAAM,MAAd;AAAe,IAAA,IAAI,EAAC;AAApB,IApBF,eAqBE,gCAAC,YAAD;AAAQ,IAAA,MAAM,MAAd;AAAe,IAAA,IAAI,EAAC;AAApB,IArBF,CADF;AAyBD,CA5VD;;eA8VejF,Q","sourcesContent":["import React, { useCallback, useReducer, useRef, useState, useEffect } from 'react';\nimport { get, includes, toString, isEqual, intersectionWith } from 'lodash';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport { Header } from '@buffetjs/custom';\nimport { Button, Padded } from '@buffetjs/core';\nimport {\n  PopUpWarning,\n  useGlobalContext,\n  generateFiltersFromSearch,\n  generateSearchFromFilters,\n  request,\n  useQuery,\n} from 'strapi-helper-plugin';\nimport { formatFileForEditing, getRequestUrl, getTrad, getFileModelTimestamps } from '../../utils';\nimport Container from '../../components/Container';\nimport HomePageContent from './HomePageContent';\nimport { useAppContext } from '../../hooks';\nimport ModalStepper from '../ModalStepper';\nimport { generateStringFromParams, getHeaderLabel } from './utils';\nimport init from './init';\nimport reducer, { initialState } from './reducer';\n\nconst HomePage = () => {\n  const { allowedActions } = useAppContext();\n  const { canRead } = allowedActions;\n  const { formatMessage, plugins } = useGlobalContext();\n  const [, updated_at] = getFileModelTimestamps(plugins);\n  const [reducerState, dispatch] = useReducer(reducer, initialState, () =>\n    init(initialState, allowedActions)\n  );\n  const query = useQuery();\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [isPopupOpen, setIsPopupOpen] = useState(false);\n  const [fileToEdit, setFileToEdit] = useState(null);\n  const [shouldRefetch, setShouldRefetch] = useState(false);\n  const [modalInitialStep, setModalInitialStep] = useState('browse');\n  const { push } = useHistory();\n  const { search } = useLocation();\n  const isMounted = useRef(true);\n  const {\n    data,\n    dataCount,\n    dataToDelete,\n    isLoading,\n    shouldRefetchData,\n    showModalConfirmButtonLoading,\n  } = reducerState.toJS();\n  const pluginName = formatMessage({ id: getTrad('plugin.name') });\n  const paramsKeys = ['_limit', '_start', '_q', '_sort'];\n\n  useEffect(() => {\n    return () => (isMounted.current = false);\n  }, []);\n\n  useEffect(() => {\n    fetchListData();\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [search]);\n\n  const deleteMedia = async id => {\n    const requestURL = getRequestUrl(`files/${id}`);\n\n    try {\n      await request(requestURL, {\n        method: 'DELETE',\n      });\n\n      return Promise.resolve();\n    } catch (err) {\n      const errorMessage = get(err, 'response.payload.message', 'An error occured');\n\n      return Promise.reject(errorMessage);\n    }\n  };\n\n  const fetchData = async () => {\n    const dataRequestURL = getRequestUrl('files');\n    const params = generateStringFromParams(query);\n\n    const paramsToSend = params.includes('_sort')\n      ? params\n      : params.concat(`&_sort=${updated_at}:DESC`);\n\n    try {\n      const data = await request(`${dataRequestURL}?${paramsToSend}`, {\n        method: 'GET',\n      });\n\n      return Promise.resolve(data);\n    } catch (err) {\n      if (isMounted.current) {\n        dispatch({ type: 'GET_DATA_ERROR' });\n        strapi.notification.toggle({\n          type: 'warning',\n          message: { id: 'notification.error' },\n        });\n      }\n    }\n\n    return [];\n  };\n\n  const fetchDataCount = async () => {\n    const params = generateStringFromParams(query, ['_limit', '_sort', '_start']);\n    const requestURL = getRequestUrl('files/count');\n\n    try {\n      const { count } = await request(`${requestURL}?${params}`, {\n        method: 'GET',\n      });\n\n      return Promise.resolve(count);\n    } catch (err) {\n      if (isMounted.current) {\n        dispatch({ type: 'GET_DATA_ERROR' });\n        strapi.notification.toggle({\n          type: 'warning',\n          message: { id: 'notification.error' },\n        });\n      }\n    }\n\n    return null;\n  };\n\n  const fetchListData = async () => {\n    if (canRead) {\n      dispatch({ type: 'GET_DATA' });\n\n      const [data, count] = await Promise.all([fetchData(), fetchDataCount()]);\n\n      if (isMounted.current) {\n        dispatch({\n          type: 'GET_DATA_SUCCEEDED',\n          data,\n          count,\n        });\n      }\n    }\n  };\n\n  const generateNewSearch = (updatedParams = {}) => {\n    return {\n      ...getSearchParams(),\n      filters: generateFiltersFromSearch(search),\n      ...updatedParams,\n    };\n  };\n\n  const getSearchParams = () => {\n    const params = {};\n\n    query.forEach((value, key) => {\n      if (includes(paramsKeys, key)) {\n        params[key] = value;\n      }\n    });\n\n    return params;\n  };\n\n  const handleChangeCheck = ({ target: { name } }) => {\n    dispatch({\n      type: 'ON_CHANGE_DATA_TO_DELETE',\n      id: name,\n    });\n  };\n\n  const handleChangeParams = ({ target: { name, value } }) => {\n    let updatedQueryParams = generateNewSearch({ [name]: value });\n\n    if (name === 'filters') {\n      const existingFilters = generateFiltersFromSearch(search);\n      const canAddFilter = intersectionWith(existingFilters, [value], isEqual).length === 0;\n      updatedQueryParams = generateNewSearch({ [name]: existingFilters });\n\n      if (canAddFilter) {\n        const filters = [...existingFilters, value];\n\n        updatedQueryParams = generateNewSearch({ [name]: filters });\n      }\n    }\n\n    if (name === '_limit') {\n      updatedQueryParams = generateNewSearch({ [name]: value, _start: 0 });\n    }\n\n    const newSearch = generateSearchFromFilters(updatedQueryParams);\n\n    push({ search: newSearch });\n  };\n\n  const handleClickEditFile = id => {\n    if (allowedActions.canUpdate) {\n      const file = formatFileForEditing(data.find(file => toString(file.id) === toString(id)));\n\n      setFileToEdit(file);\n      setModalInitialStep('edit');\n      handleClickToggleModal();\n    }\n  };\n\n  const handleClickToggleModal = (refetch = false) => {\n    setIsModalOpen(prev => !prev);\n    setShouldRefetch(refetch);\n  };\n\n  const handleClickTogglePopup = () => {\n    setIsPopupOpen(prev => !prev);\n  };\n\n  const handleDeleteFilter = index => {\n    const filters = generateFiltersFromSearch(search).filter(\n      (filter, filterIndex) => filterIndex !== index\n    );\n\n    const updatedQueryParams = generateNewSearch({ filters });\n\n    const newSearch = generateSearchFromFilters(updatedQueryParams);\n\n    push({ search: newSearch });\n  };\n\n  const handleConfirmDeleteMedias = useCallback(async () => {\n    dispatch({ type: 'ON_DELETE_MEDIAS' });\n\n    try {\n      await Promise.all(dataToDelete.map(item => deleteMedia(item.id)));\n\n      dispatch({\n        type: 'ON_DELETE_MEDIAS_SUCCEEDED',\n      });\n    } catch (err) {\n      strapi.notification.toggle({\n        type: 'warning',\n        message: err,\n      });\n\n      dispatch({\n        type: 'ON_DELETE_MEDIAS_ERROR',\n      });\n    } finally {\n      setIsPopupOpen(false);\n    }\n  }, [dataToDelete]);\n\n  const handleClosedModalDeleteAll = useCallback(() => {\n    if (shouldRefetchData) {\n      fetchListData();\n    } else {\n      dispatch({ type: 'RESET_DATA_TO_DELETE' });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [shouldRefetchData]);\n\n  const handleModalClose = () => {\n    resetModalState();\n\n    if (shouldRefetch) {\n      fetchListData();\n      setShouldRefetch(false);\n    }\n  };\n\n  const handleSelectAll = () => {\n    dispatch({\n      type: 'TOGGLE_SELECT_ALL',\n    });\n  };\n\n  const resetModalState = () => {\n    setModalInitialStep('browse');\n    setFileToEdit(null);\n  };\n\n  const headerProps = {\n    title: {\n      label: pluginName,\n    },\n    /* eslint-disable indent */\n    content: canRead\n      ? formatMessage(\n          {\n            id: getTrad(getHeaderLabel(dataCount)),\n          },\n          { number: dataCount }\n        )\n      : null,\n    /* eslint-enable indent */\n    actions: [\n      {\n        disabled: dataToDelete.length === 0,\n        color: 'delete',\n        // TradId from the strapi-admin package\n        label: formatMessage({ id: 'app.utils.delete' }),\n        onClick: () => setIsPopupOpen(true),\n        type: 'button',\n        Component: buttonProps => {\n          if (!allowedActions.canUpdate) {\n            return null;\n          }\n\n          return <Button {...buttonProps} />;\n        },\n      },\n      {\n        disabled: false,\n        color: 'primary',\n        label: formatMessage({ id: getTrad('header.actions.upload-assets') }),\n        onClick: () => handleClickToggleModal(),\n        type: 'button',\n        Component: buttonProps => {\n          if (!allowedActions.canCreate) {\n            return null;\n          }\n\n          return <Button {...buttonProps} />;\n        },\n      },\n    ],\n  };\n\n  const handleRemoveFileFromDataToDelete = useCallback(id => {\n    dispatch({\n      type: 'ON_CHANGE_DATA_TO_DELETE',\n      id,\n    });\n  }, []);\n\n  const content = canRead ? (\n    <HomePageContent\n      data={data}\n      dataCount={dataCount}\n      dataToDelete={dataToDelete}\n      isLoading={isLoading}\n      onCardCheck={handleChangeCheck}\n      onCardClick={handleClickEditFile}\n      onClick={handleClickToggleModal}\n      onFilterDelete={handleDeleteFilter}\n      onParamsChange={handleChangeParams}\n      onSelectAll={handleSelectAll}\n    />\n  ) : null;\n\n  return (\n    <Container>\n      <Header {...headerProps} isLoading={isLoading} />\n      {content}\n      <ModalStepper\n        initialFileToEdit={fileToEdit}\n        initialStep={modalInitialStep}\n        isOpen={isModalOpen}\n        onClosed={handleModalClose}\n        onRemoveFileFromDataToDelete={handleRemoveFileFromDataToDelete}\n        onToggle={handleClickToggleModal}\n        refetchData={fetchListData}\n      />\n      <PopUpWarning\n        isOpen={isPopupOpen}\n        isConfirmButtonLoading={showModalConfirmButtonLoading}\n        onConfirm={handleConfirmDeleteMedias}\n        onClosed={handleClosedModalDeleteAll}\n        toggleModal={handleClickTogglePopup}\n        popUpWarningType=\"danger\"\n      />\n      <Padded bottom size=\"md\" />\n      <Padded bottom size=\"md\" />\n    </Container>\n  );\n};\n\nexport default HomePage;\n"]},"metadata":{},"sourceType":"script"}