{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reactSelect = require(\"react-select\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _lodash = require(\"lodash\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _styles = require(\"@buffetjs/styles\");\n\nvar _reactFontawesome = require(\"@fortawesome/react-fontawesome\");\n\nvar _useDataManager2 = _interopRequireDefault(require(\"../../hooks/useDataManager\"));\n\nvar _getTrad = _interopRequireDefault(require(\"../../utils/getTrad\"));\n\nvar _SelectCheckbox = _interopRequireDefault(require(\"../SelectCheckbox\"));\n\nvar _SelectMenuUl = _interopRequireDefault(require(\"../SelectMenuUl\"));\n\nvar _SelectMenuSubUl = _interopRequireDefault(require(\"../SelectMenuSubUl\"));\n\nvar _UpperFirst = _interopRequireDefault(require(\"../UpperFirst\"));\n\nvar _hasSubArray = _interopRequireDefault(require(\"./utils/hasSubArray\"));\n\nvar _HasSomeSubArray = _interopRequireDefault(require(\"./utils/HasSomeSubArray\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n/* eslint-disable jsx-a11y/no-static-element-interactions */\n\n/* eslint-disable jsx-a11y/click-events-have-key-events */\nvar MultipleMenuList = function MultipleMenuList(_ref) {\n  var _ref$selectProps = _ref.selectProps,\n      name = _ref$selectProps.name,\n      addComponentsToDynamicZone = _ref$selectProps.addComponentsToDynamicZone,\n      inputValue = _ref$selectProps.inputValue,\n      value = _ref$selectProps.value,\n      rest = (0, _objectWithoutProperties2[\"default\"])(_ref, [\"selectProps\"]);\n\n  var _useDataManager = (0, _useDataManager2[\"default\"])(),\n      componentsGroupedByCategory = _useDataManager.componentsGroupedByCategory,\n      modifiedData = _useDataManager.modifiedData;\n\n  var query = (0, _strapiHelperPlugin.useQuery)();\n  var dzName = query.get('dynamicZoneTarget');\n  var alreadyUsedComponents = (0, _lodash.get)(modifiedData, ['contentType', 'schema', 'attributes', dzName, 'components'], []);\n  var filteredComponentsGroupedByCategory = Object.keys(componentsGroupedByCategory).reduce(function (acc, current) {\n    var filteredComponents = componentsGroupedByCategory[current].filter(function (_ref2) {\n      var uid = _ref2.uid;\n      return !alreadyUsedComponents.includes(uid);\n    });\n\n    if (filteredComponents.length > 0) {\n      acc[current] = filteredComponents;\n    }\n\n    return acc;\n  }, {});\n  var collapsesObject = Object.keys(filteredComponentsGroupedByCategory).reduce(function (acc, current) {\n    acc[current] = false;\n    return acc;\n  }, {});\n\n  var _useState = (0, _react.useState)(collapsesObject),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      collapses = _useState2[0],\n      setCollapses = _useState2[1];\n\n  var _useState3 = (0, _react.useState)(filteredComponentsGroupedByCategory),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      options = _useState4[0],\n      setOptions = _useState4[1]; // Search for component\n\n\n  (0, _react.useEffect)(function () {\n    var formattedOptions = Object.keys(filteredComponentsGroupedByCategory).reduce(function (acc, current) {\n      var filteredComponents = filteredComponentsGroupedByCategory[current].filter(function (_ref3) {\n        var name = _ref3.schema.name;\n        return name.includes(inputValue);\n      });\n\n      if (filteredComponents.length > 0) {\n        acc[current] = filteredComponents;\n      }\n\n      return acc;\n    }, {});\n    setOptions(formattedOptions);\n    var categoriesToOpen = Object.keys(formattedOptions);\n\n    if (inputValue !== '') {\n      // Close collapses\n      Object.keys(filteredComponentsGroupedByCategory).filter(function (cat) {\n        return categoriesToOpen.indexOf(cat) === -1;\n      }).forEach(function (catName) {\n        setCollapses(function (prevState) {\n          return _objectSpread(_objectSpread({}, prevState), {}, (0, _defineProperty2[\"default\"])({}, catName, false));\n        });\n      });\n      categoriesToOpen.forEach(function (catName) {\n        setCollapses(function (prevState) {\n          return _objectSpread(_objectSpread({}, prevState), {}, (0, _defineProperty2[\"default\"])({}, catName, true));\n        });\n      });\n    } else {\n      // Close all collapses\n      categoriesToOpen.forEach(function (catName, index) {\n        setCollapses(function (prevState) {\n          return _objectSpread(_objectSpread({}, prevState), {}, (0, _defineProperty2[\"default\"])({}, catName, index === 0));\n        });\n      });\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [inputValue]);\n\n  var toggleCollapse = function toggleCollapse(catName) {\n    setCollapses(function (prevState) {\n      return _objectSpread(_objectSpread({}, prevState), {}, (0, _defineProperty2[\"default\"])({}, catName, !prevState[catName]));\n    });\n  };\n\n  var Component = _reactSelect.components.MenuList;\n  var allComponentsCategory = Object.keys(options).reduce(function (acc, current) {\n    var categoryCompos = options[current].map(function (compo) {\n      return compo.uid;\n    });\n    acc[current] = categoryCompos;\n    return acc;\n  }, {});\n\n  var getCategoryValue = function getCategoryValue(categoryName) {\n    var componentsCategory = allComponentsCategory[categoryName];\n    return (0, _hasSubArray[\"default\"])(value.value, componentsCategory);\n  };\n\n  var doesCategoryHasSomeElements = function doesCategoryHasSomeElements(categoryName) {\n    var componentsCategory = allComponentsCategory[categoryName];\n    return (0, _HasSomeSubArray[\"default\"])(value.value, componentsCategory);\n  };\n\n  var handleChangeCategory = function handleChangeCategory(_ref4) {\n    var target = _ref4.target;\n    // refState.current.select.blur();\n    var dataTarget = {\n      name: name,\n      components: allComponentsCategory[target.name],\n      shouldAddComponents: target.value\n    };\n    addComponentsToDynamicZone({\n      target: dataTarget\n    });\n  };\n\n  var handleChange = function handleChange(_ref5) {\n    var target = _ref5.target;\n    var dataTarget = {\n      name: name,\n      components: [target.name],\n      shouldAddComponents: target.value\n    };\n    addComponentsToDynamicZone({\n      target: dataTarget\n    });\n  };\n\n  return /*#__PURE__*/_react[\"default\"].createElement(Component, rest, /*#__PURE__*/_react[\"default\"].createElement(_SelectMenuUl[\"default\"], null, Object.keys(options).length === 0 && /*#__PURE__*/_react[\"default\"].createElement(_reactIntl.FormattedMessage, {\n    id: (0, _getTrad[\"default\"])(\"components.componentSelect.no-component-available\".concat(inputValue === '' ? '' : '.with-search'))\n  }, function (msg) {\n    return /*#__PURE__*/_react[\"default\"].createElement(\"li\", {\n      style: {\n        paddingTop: 11\n      }\n    }, msg);\n  }), Object.keys(options).map(function (categoryName) {\n    var isChecked = getCategoryValue(categoryName);\n    var someChecked = !isChecked && doesCategoryHasSomeElements(categoryName);\n    var target = {\n      name: categoryName,\n      value: !isChecked\n    };\n    return /*#__PURE__*/_react[\"default\"].createElement(\"li\", {\n      key: categoryName,\n      className: \"li-multi-menu\"\n    }, /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      style: {\n        marginTop: 3\n      }\n    }, /*#__PURE__*/_react[\"default\"].createElement(_styles.CheckboxWrapper, {\n      style: {\n        display: 'flex'\n      }\n    }, /*#__PURE__*/_react[\"default\"].createElement(_styles.Label, {\n      htmlFor: \"overrideReactSelectBehavior\",\n      onClick: function onClick() {\n        handleChangeCategory({\n          target: target\n        });\n      }\n    }, /*#__PURE__*/_react[\"default\"].createElement(_SelectCheckbox[\"default\"], {\n      id: \"checkCategory\",\n      checked: isChecked,\n      name: categoryName,\n      onChange: function onChange() {},\n      someChecked: someChecked\n    }), /*#__PURE__*/_react[\"default\"].createElement(_UpperFirst[\"default\"], {\n      content: categoryName\n    })), /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      style: {\n        width: '150px',\n        textAlign: 'right',\n        flexGrow: 2\n      },\n      onClick: function onClick(e) {\n        e.stopPropagation();\n        toggleCollapse(categoryName);\n      }\n    }, /*#__PURE__*/_react[\"default\"].createElement(_reactFontawesome.FontAwesomeIcon, {\n      className: \"chevron\",\n      icon: collapses[categoryName] ? 'chevron-up' : 'chevron-down'\n    })))), /*#__PURE__*/_react[\"default\"].createElement(_SelectMenuSubUl[\"default\"], {\n      tag: \"ul\",\n      isOpen: collapses[categoryName]\n    }, options[categoryName].map(function (component) {\n      var isChecked = (0, _lodash.get)(value, 'value', []).includes(component.uid);\n      var target = {\n        name: component.uid,\n        value: !isChecked\n      };\n      return /*#__PURE__*/_react[\"default\"].createElement(\"li\", {\n        key: component.uid\n      }, /*#__PURE__*/_react[\"default\"].createElement(_styles.CheckboxWrapper, null, /*#__PURE__*/_react[\"default\"].createElement(_styles.Label, {\n        htmlFor: component.uid,\n        message: component.schema.name,\n        onClick: function onClick() {\n          handleChange({\n            target: target\n          });\n        }\n      }, /*#__PURE__*/_react[\"default\"].createElement(_SelectCheckbox[\"default\"], {\n        id: \"check\",\n        name: component.uid // Remove the handler\n        ,\n        onChange: function onChange() {},\n        checked: isChecked\n      }), component.schema.name)));\n    })));\n  })));\n};\n\nMultipleMenuList.defaultProps = {\n  selectProps: {\n    inputValue: '',\n    refState: {\n      current: {\n        select: {\n          blur: function blur() {}\n        }\n      }\n    },\n    value: {}\n  }\n};\nMultipleMenuList.propTypes = {\n  selectProps: _propTypes[\"default\"].shape({\n    addComponentsToDynamicZone: _propTypes[\"default\"].func.isRequired,\n    inputValue: _propTypes[\"default\"].string,\n    name: _propTypes[\"default\"].string.isRequired,\n    refState: _propTypes[\"default\"].object,\n    value: _propTypes[\"default\"].object\n  })\n};\nvar _default = MultipleMenuList;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-content-type-builder/admin/src/components/ComponentSelect/MultipleMenuList.js"],"names":["MultipleMenuList","selectProps","name","addComponentsToDynamicZone","inputValue","value","rest","componentsGroupedByCategory","modifiedData","query","dzName","get","alreadyUsedComponents","filteredComponentsGroupedByCategory","Object","keys","reduce","acc","current","filteredComponents","filter","uid","includes","length","collapsesObject","collapses","setCollapses","options","setOptions","formattedOptions","schema","categoriesToOpen","cat","indexOf","forEach","catName","prevState","index","toggleCollapse","Component","components","MenuList","allComponentsCategory","categoryCompos","map","compo","getCategoryValue","categoryName","componentsCategory","doesCategoryHasSomeElements","handleChangeCategory","target","dataTarget","shouldAddComponents","handleChange","msg","paddingTop","isChecked","someChecked","marginTop","display","width","textAlign","flexGrow","e","stopPropagation","component","defaultProps","refState","select","blur","propTypes","PropTypes","shape","func","isRequired","string","object"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { components } from 'react-select';\nimport { FormattedMessage } from 'react-intl';\nimport { get } from 'lodash';\nimport { useQuery } from 'strapi-helper-plugin';\nimport { CheckboxWrapper, Label } from '@buffetjs/styles';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport useDataManager from '../../hooks/useDataManager';\nimport getTrad from '../../utils/getTrad';\nimport SelectCheckbox from '../SelectCheckbox';\nimport Ul from '../SelectMenuUl';\nimport SubUl from '../SelectMenuSubUl';\nimport UpperFirst from '../UpperFirst';\n\nimport hasSubArray from './utils/hasSubArray';\nimport hasSomeSubArray from './utils/HasSomeSubArray';\n\n/* eslint-disable jsx-a11y/no-static-element-interactions */\n/* eslint-disable jsx-a11y/click-events-have-key-events */\n\nconst MultipleMenuList = ({\n  selectProps: { name, addComponentsToDynamicZone, inputValue, value },\n  ...rest\n}) => {\n  const { componentsGroupedByCategory, modifiedData } = useDataManager();\n  const query = useQuery();\n  const dzName = query.get('dynamicZoneTarget');\n  const alreadyUsedComponents = get(\n    modifiedData,\n    ['contentType', 'schema', 'attributes', dzName, 'components'],\n    []\n  );\n  const filteredComponentsGroupedByCategory = Object.keys(componentsGroupedByCategory).reduce(\n    (acc, current) => {\n      const filteredComponents = componentsGroupedByCategory[current].filter(({ uid }) => {\n        return !alreadyUsedComponents.includes(uid);\n      });\n\n      if (filteredComponents.length > 0) {\n        acc[current] = filteredComponents;\n      }\n\n      return acc;\n    },\n    {}\n  );\n\n  const collapsesObject = Object.keys(filteredComponentsGroupedByCategory).reduce(\n    (acc, current) => {\n      acc[current] = false;\n\n      return acc;\n    },\n    {}\n  );\n  const [collapses, setCollapses] = useState(collapsesObject);\n  const [options, setOptions] = useState(filteredComponentsGroupedByCategory);\n\n  // Search for component\n  useEffect(() => {\n    const formattedOptions = Object.keys(filteredComponentsGroupedByCategory).reduce(\n      (acc, current) => {\n        const filteredComponents = filteredComponentsGroupedByCategory[current].filter(\n          ({ schema: { name } }) => {\n            return name.includes(inputValue);\n          }\n        );\n\n        if (filteredComponents.length > 0) {\n          acc[current] = filteredComponents;\n        }\n\n        return acc;\n      },\n      {}\n    );\n\n    setOptions(formattedOptions);\n\n    const categoriesToOpen = Object.keys(formattedOptions);\n\n    if (inputValue !== '') {\n      // Close collapses\n      Object.keys(filteredComponentsGroupedByCategory)\n        .filter(cat => categoriesToOpen.indexOf(cat) === -1)\n        .forEach(catName => {\n          setCollapses(prevState => ({ ...prevState, [catName]: false }));\n        });\n\n      categoriesToOpen.forEach(catName => {\n        setCollapses(prevState => ({ ...prevState, [catName]: true }));\n      });\n    } else {\n      // Close all collapses\n      categoriesToOpen.forEach((catName, index) => {\n        setCollapses(prevState => ({ ...prevState, [catName]: index === 0 }));\n      });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [inputValue]);\n\n  const toggleCollapse = catName => {\n    setCollapses(prevState => ({\n      ...prevState,\n      [catName]: !prevState[catName],\n    }));\n  };\n\n  const Component = components.MenuList;\n\n  const allComponentsCategory = Object.keys(options).reduce((acc, current) => {\n    const categoryCompos = options[current].map(compo => {\n      return compo.uid;\n    });\n\n    acc[current] = categoryCompos;\n\n    return acc;\n  }, {});\n\n  const getCategoryValue = categoryName => {\n    const componentsCategory = allComponentsCategory[categoryName];\n\n    return hasSubArray(value.value, componentsCategory);\n  };\n\n  const doesCategoryHasSomeElements = categoryName => {\n    const componentsCategory = allComponentsCategory[categoryName];\n\n    return hasSomeSubArray(value.value, componentsCategory);\n  };\n\n  const handleChangeCategory = ({ target }) => {\n    // refState.current.select.blur();\n    const dataTarget = {\n      name,\n      components: allComponentsCategory[target.name],\n      shouldAddComponents: target.value,\n    };\n    addComponentsToDynamicZone({ target: dataTarget });\n  };\n\n  const handleChange = ({ target }) => {\n    const dataTarget = {\n      name,\n      components: [target.name],\n      shouldAddComponents: target.value,\n    };\n\n    addComponentsToDynamicZone({ target: dataTarget });\n  };\n\n  return (\n    <Component {...rest}>\n      <Ul>\n        {Object.keys(options).length === 0 && (\n          <FormattedMessage\n            id={getTrad(\n              `components.componentSelect.no-component-available${\n                inputValue === '' ? '' : '.with-search'\n              }`\n            )}\n          >\n            {msg => <li style={{ paddingTop: 11 }}>{msg}</li>}\n          </FormattedMessage>\n        )}\n        {Object.keys(options).map(categoryName => {\n          const isChecked = getCategoryValue(categoryName);\n          const someChecked = !isChecked && doesCategoryHasSomeElements(categoryName);\n          const target = { name: categoryName, value: !isChecked };\n\n          return (\n            <li key={categoryName} className=\"li-multi-menu\">\n              <div style={{ marginTop: 3 }}>\n                <CheckboxWrapper style={{ display: 'flex' }}>\n                  <Label\n                    htmlFor=\"overrideReactSelectBehavior\"\n                    onClick={() => {\n                      handleChangeCategory({ target });\n                    }}\n                  >\n                    <SelectCheckbox\n                      id=\"checkCategory\"\n                      checked={isChecked}\n                      name={categoryName}\n                      onChange={() => {}}\n                      someChecked={someChecked}\n                    />\n                    <UpperFirst content={categoryName} />\n                  </Label>\n                  <div\n                    style={{\n                      width: '150px',\n                      textAlign: 'right',\n                      flexGrow: 2,\n                    }}\n                    onClick={e => {\n                      e.stopPropagation();\n                      toggleCollapse(categoryName);\n                    }}\n                  >\n                    <FontAwesomeIcon\n                      className=\"chevron\"\n                      icon={collapses[categoryName] ? 'chevron-up' : 'chevron-down'}\n                    />\n                  </div>\n                </CheckboxWrapper>\n              </div>\n              <SubUl tag=\"ul\" isOpen={collapses[categoryName]}>\n                {options[categoryName].map(component => {\n                  const isChecked = get(value, 'value', []).includes(component.uid);\n                  const target = { name: component.uid, value: !isChecked };\n\n                  return (\n                    <li key={component.uid}>\n                      <CheckboxWrapper>\n                        <Label\n                          htmlFor={component.uid}\n                          message={component.schema.name}\n                          onClick={() => {\n                            handleChange({ target });\n                          }}\n                        >\n                          <SelectCheckbox\n                            id=\"check\"\n                            name={component.uid}\n                            // Remove the handler\n                            onChange={() => {}}\n                            checked={isChecked}\n                          />\n                          {component.schema.name}\n                        </Label>\n                      </CheckboxWrapper>\n                    </li>\n                  );\n                })}\n              </SubUl>\n            </li>\n          );\n        })}\n      </Ul>\n    </Component>\n  );\n};\n\nMultipleMenuList.defaultProps = {\n  selectProps: {\n    inputValue: '',\n    refState: {\n      current: {\n        select: {\n          blur: () => {},\n        },\n      },\n    },\n    value: {},\n  },\n};\n\nMultipleMenuList.propTypes = {\n  selectProps: PropTypes.shape({\n    addComponentsToDynamicZone: PropTypes.func.isRequired,\n    inputValue: PropTypes.string,\n    name: PropTypes.string.isRequired,\n    refState: PropTypes.object,\n    value: PropTypes.object,\n  }),\n};\n\nexport default MultipleMenuList;\n"]},"metadata":{},"sourceType":"script"}