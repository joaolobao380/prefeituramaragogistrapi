{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _core = require(\"@buffetjs/core\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _styles = require(\"@buffetjs/styles\");\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _utils = require(\"../../utils\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar RelationPreviewTooltip = function RelationPreviewTooltip(_ref) {\n  var tooltipId = _ref.tooltipId,\n      rowId = _ref.rowId,\n      mainField = _ref.mainField,\n      name = _ref.name,\n      endPoint = _ref.queryInfos.endPoint,\n      size = _ref.size;\n\n  var _useState = (0, _react.useState)(true),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      isLoading = _useState2[0],\n      setIsLoading = _useState2[1];\n\n  var _useState3 = (0, _react.useState)([]),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      relationData = _useState4[0],\n      setRelationData = _useState4[1];\n\n  var tooltipRef = (0, _react.useRef)();\n  var fetchRelationData = (0, _react.useCallback)( /*#__PURE__*/function () {\n    var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(signal) {\n      var requestURL, _yield$request, results;\n\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              requestURL = (0, _utils.getRequestUrl)(\"\".concat(endPoint, \"/\").concat(rowId, \"/\").concat(name));\n              _context.prev = 1;\n              _context.next = 4;\n              return (0, _strapiHelperPlugin.request)(requestURL, {\n                method: 'GET',\n                signal: signal\n              });\n\n            case 4:\n              _yield$request = _context.sent;\n              results = _yield$request.results;\n              setRelationData(results);\n              setIsLoading(false);\n              _context.next = 14;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](1);\n              console.error({\n                err: _context.t0\n              });\n              setIsLoading(false);\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 10]]);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), [endPoint, name, rowId]);\n  (0, _react.useEffect)(function () {\n    var abortController = new AbortController();\n    var signal = abortController.signal;\n    var timeout = setTimeout(function () {\n      fetchRelationData(signal);\n    }, 500);\n    return function () {\n      clearTimeout(timeout);\n      abortController.abort();\n    };\n  }, [fetchRelationData]);\n  var getValueToDisplay = (0, _react.useCallback)(function (item) {\n    return (0, _utils.getDisplayedValue)(mainField.schema.type, item[mainField.name], mainField.name);\n  }, [mainField]); // Used to update the position after the loader\n\n  (0, _react.useLayoutEffect)(function () {\n    if (!isLoading && tooltipRef.current) {\n      // A react-tooltip uncaught error is triggered when updatePosition is called in firefox.\n      // https://github.com/wwayne/react-tooltip/issues/619\n      try {\n        tooltipRef.current.updatePosition();\n      } catch (err) {\n        console.log(err);\n      }\n    }\n  }, [isLoading]);\n  return /*#__PURE__*/_react[\"default\"].createElement(_styles.Tooltip, {\n    ref: tooltipRef,\n    id: tooltipId\n  }, /*#__PURE__*/_react[\"default\"].createElement(\"div\", null, isLoading ? /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n    left: true,\n    right: true,\n    size: \"sm\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_styles.LoadingIndicator, {\n    borderWidth: \"3px\",\n    size: \"2rem\"\n  })) : /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, relationData.map(function (item) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n      key: item.id,\n      top: true,\n      bottom: true,\n      size: \"xs\"\n    }, /*#__PURE__*/_react[\"default\"].createElement(_core.Text, {\n      ellipsis: true,\n      color: \"white\"\n    }, getValueToDisplay(item)));\n  }), size > 10 && /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n    top: true,\n    size: \"xs\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_core.Text, {\n    color: \"white\"\n  }, \"[...]\")))));\n};\n\nRelationPreviewTooltip.propTypes = {\n  tooltipId: _propTypes[\"default\"].string.isRequired,\n  mainField: _propTypes[\"default\"].exact({\n    name: _propTypes[\"default\"].string.isRequired,\n    schema: _propTypes[\"default\"].shape({\n      type: _propTypes[\"default\"].string.isRequired\n    }).isRequired\n  }).isRequired,\n  name: _propTypes[\"default\"].string.isRequired,\n  size: _propTypes[\"default\"].number.isRequired,\n  rowId: _propTypes[\"default\"].oneOfType([_propTypes[\"default\"].string, _propTypes[\"default\"].number]).isRequired,\n  queryInfos: _propTypes[\"default\"].shape({\n    endPoint: _propTypes[\"default\"].string.isRequired\n  }).isRequired\n};\nvar _default = RelationPreviewTooltip;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-content-manager/admin/src/components/RelationPreviewList/RelationPreviewTooltip.js"],"names":["RelationPreviewTooltip","tooltipId","rowId","mainField","name","endPoint","queryInfos","size","isLoading","setIsLoading","relationData","setRelationData","tooltipRef","fetchRelationData","signal","requestURL","method","results","console","error","err","abortController","AbortController","timeout","setTimeout","clearTimeout","abort","getValueToDisplay","item","schema","type","current","updatePosition","log","map","id","propTypes","PropTypes","string","isRequired","exact","shape","number","oneOfType"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback, useRef, useLayoutEffect } from 'react';\nimport { Text, Padded } from '@buffetjs/core';\nimport { request } from 'strapi-helper-plugin';\nimport { LoadingIndicator, Tooltip } from '@buffetjs/styles';\nimport PropTypes from 'prop-types';\nimport { getDisplayedValue, getRequestUrl } from '../../utils';\n\nconst RelationPreviewTooltip = ({\n  tooltipId,\n  rowId,\n  mainField,\n  name,\n  queryInfos: { endPoint },\n  size,\n}) => {\n  const [isLoading, setIsLoading] = useState(true);\n  const [relationData, setRelationData] = useState([]);\n  const tooltipRef = useRef();\n\n  const fetchRelationData = useCallback(\n    async signal => {\n      const requestURL = getRequestUrl(`${endPoint}/${rowId}/${name}`);\n      try {\n        const { results } = await request(requestURL, {\n          method: 'GET',\n          signal,\n        });\n\n        setRelationData(results);\n        setIsLoading(false);\n      } catch (err) {\n        console.error({ err });\n        setIsLoading(false);\n      }\n    },\n    [endPoint, name, rowId]\n  );\n\n  useEffect(() => {\n    const abortController = new AbortController();\n    const { signal } = abortController;\n\n    const timeout = setTimeout(() => {\n      fetchRelationData(signal);\n    }, 500);\n\n    return () => {\n      clearTimeout(timeout);\n      abortController.abort();\n    };\n  }, [fetchRelationData]);\n\n  const getValueToDisplay = useCallback(\n    item => {\n      return getDisplayedValue(mainField.schema.type, item[mainField.name], mainField.name);\n    },\n    [mainField]\n  );\n\n  // Used to update the position after the loader\n  useLayoutEffect(() => {\n    if (!isLoading && tooltipRef.current) {\n      // A react-tooltip uncaught error is triggered when updatePosition is called in firefox.\n      // https://github.com/wwayne/react-tooltip/issues/619\n      try {\n        tooltipRef.current.updatePosition();\n      } catch (err) {\n        console.log(err);\n      }\n    }\n  }, [isLoading]);\n\n  return (\n    <Tooltip ref={tooltipRef} id={tooltipId}>\n      <div>\n        {isLoading ? (\n          <Padded left right size=\"sm\">\n            <LoadingIndicator borderWidth=\"3px\" size=\"2rem\" />\n          </Padded>\n        ) : (\n          <>\n            {relationData.map(item => (\n              <Padded key={item.id} top bottom size=\"xs\">\n                <Text ellipsis color=\"white\">\n                  {getValueToDisplay(item)}\n                </Text>\n              </Padded>\n            ))}\n            {size > 10 && (\n              <Padded top size=\"xs\">\n                <Text color=\"white\">[...]</Text>\n              </Padded>\n            )}\n          </>\n        )}\n      </div>\n    </Tooltip>\n  );\n};\n\nRelationPreviewTooltip.propTypes = {\n  tooltipId: PropTypes.string.isRequired,\n  mainField: PropTypes.exact({\n    name: PropTypes.string.isRequired,\n    schema: PropTypes.shape({\n      type: PropTypes.string.isRequired,\n    }).isRequired,\n  }).isRequired,\n  name: PropTypes.string.isRequired,\n  size: PropTypes.number.isRequired,\n  rowId: PropTypes.oneOfType([PropTypes.string, PropTypes.number]).isRequired,\n  queryInfos: PropTypes.shape({\n    endPoint: PropTypes.string.isRequired,\n  }).isRequired,\n};\n\nexport default RelationPreviewTooltip;\n"]},"metadata":{},"sourceType":"script"}