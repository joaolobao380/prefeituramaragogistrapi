{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = require(\"react\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _reducer = _interopRequireWildcard(require(\"./reducer\"));\n\nvar _init = _interopRequireDefault(require(\"./init\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar useSettingsMenu = function useSettingsMenu() {\n  var noCheck = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n  var _useContext = (0, _react.useContext)(_strapiHelperPlugin.UserContext),\n      permissions = _useContext.userPermissions;\n\n  var _useGlobalContext = (0, _strapiHelperPlugin.useGlobalContext)(),\n      plugins = _useGlobalContext.plugins;\n\n  var _useReducer = (0, _react.useReducer)(_reducer[\"default\"], _reducer.initialState, function () {\n    return (0, _init[\"default\"])(_reducer.initialState, plugins);\n  }),\n      _useReducer2 = (0, _slicedToArray2[\"default\"])(_useReducer, 2),\n      _useReducer2$ = _useReducer2[0],\n      isLoading = _useReducer2$.isLoading,\n      menu = _useReducer2$.menu,\n      dispatch = _useReducer2[1];\n\n  (0, _react.useEffect)(function () {\n    var getData = /*#__PURE__*/function () {\n      var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n        var checkPermissions, generateArrayOfPromises, generalSectionLinksArrayOfPromises, data;\n        return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                checkPermissions = /*#__PURE__*/function () {\n                  var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(permissionsToCheck, path) {\n                    var hasPermission;\n                    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            _context.next = 2;\n                            return (0, _strapiHelperPlugin.hasPermissions)(permissions, permissionsToCheck);\n\n                          case 2:\n                            hasPermission = _context.sent;\n                            return _context.abrupt(\"return\", {\n                              hasPermission: hasPermission,\n                              path: path\n                            });\n\n                          case 4:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee);\n                  }));\n\n                  return function checkPermissions(_x, _x2) {\n                    return _ref2.apply(this, arguments);\n                  };\n                }();\n\n                generateArrayOfPromises = function generateArrayOfPromises(array) {\n                  return array.reduce(function (acc, current, sectionIndex) {\n                    var generateArrayOfPromises = function generateArrayOfPromises(array) {\n                      return array.map(function (link, index) {\n                        return checkPermissions(array[index].permissions, \"\".concat(sectionIndex, \".links.\").concat(index));\n                      });\n                    };\n\n                    return [].concat((0, _toConsumableArray2[\"default\"])(acc), (0, _toConsumableArray2[\"default\"])(generateArrayOfPromises(current.links)));\n                  }, []);\n                };\n\n                generalSectionLinksArrayOfPromises = generateArrayOfPromises(menu);\n                _context2.next = 5;\n                return Promise.all(generalSectionLinksArrayOfPromises);\n\n              case 5:\n                data = _context2.sent;\n                dispatch({\n                  type: 'CHECK_PERMISSIONS_SUCCEEDED',\n                  data: data\n                });\n\n              case 7:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function getData() {\n        return _ref.apply(this, arguments);\n      };\n    }(); // This hook is also used by the main LeftMenu component in order to know which sections it needs to display/hide\n    // Therefore, we don't need to make the checking all the times when the hook is used.\n\n\n    if (!noCheck) {\n      getData();\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [permissions, noCheck]);\n  return {\n    isLoading: isLoading,\n    menu: menu\n  };\n};\n\nvar _default = useSettingsMenu;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/admin/src/hooks/useSettingsMenu/index.js"],"names":["useSettingsMenu","noCheck","UserContext","permissions","userPermissions","plugins","reducer","initialState","isLoading","menu","dispatch","getData","checkPermissions","permissionsToCheck","path","hasPermission","generateArrayOfPromises","array","reduce","acc","current","sectionIndex","map","link","index","links","generalSectionLinksArrayOfPromises","Promise","all","data","type"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AAEA;;AACA;;;;;;AAEA,IAAMA,eAAe,GAAG,SAAlBA,eAAkB,GAAqB;AAAA,MAApBC,OAAoB,uEAAV,KAAU;;AAC3C,oBAAyC,uBAAWC,+BAAX,CAAzC;AAAA,MAAyBC,WAAzB,eAAQC,eAAR;;AACA,0BAAoB,2CAApB;AAAA,MAAQC,OAAR,qBAAQA,OAAR;;AAEA,oBAAwC,uBAAWC,mBAAX,EAAoBC,qBAApB,EAAkC;AAAA,WACxE,sBAAKA,qBAAL,EAAmBF,OAAnB,CADwE;AAAA,GAAlC,CAAxC;AAAA;AAAA;AAAA,MAASG,SAAT,iBAASA,SAAT;AAAA,MAAoBC,IAApB,iBAAoBA,IAApB;AAAA,MAA4BC,QAA5B;;AAIA,wBAAU,YAAM;AACd,QAAMC,OAAO;AAAA,+FAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AACRC,gBAAAA,gBADQ;AAAA,4GACW,iBAAOC,kBAAP,EAA2BC,IAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mCACK,wCAAeX,WAAf,EAA4BU,kBAA5B,CADL;;AAAA;AACjBE,4BAAAA,aADiB;AAAA,6DAGhB;AAAEA,8BAAAA,aAAa,EAAbA,aAAF;AAAiBD,8BAAAA,IAAI,EAAJA;AAAjB,6BAHgB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADX;;AAAA,kCACRF,gBADQ;AAAA;AAAA;AAAA;;AAORI,gBAAAA,uBAPQ,GAOkB,SAA1BA,uBAA0B,CAAAC,KAAK,EAAI;AACvC,yBAAOA,KAAK,CAACC,MAAN,CAAa,UAACC,GAAD,EAAMC,OAAN,EAAeC,YAAf,EAAgC;AAClD,wBAAML,uBAAuB,GAAG,SAA1BA,uBAA0B,CAAAC,KAAK;AAAA,6BACnCA,KAAK,CAACK,GAAN,CAAU,UAACC,IAAD,EAAOC,KAAP;AAAA,+BACRZ,gBAAgB,CAACK,KAAK,CAACO,KAAD,CAAL,CAAarB,WAAd,YAA8BkB,YAA9B,oBAAoDG,KAApD,EADR;AAAA,uBAAV,CADmC;AAAA,qBAArC;;AAKA,yEAAWL,GAAX,uCAAmBH,uBAAuB,CAACI,OAAO,CAACK,KAAT,CAA1C;AACD,mBAPM,EAOJ,EAPI,CAAP;AAQD,iBAhBa;;AAkBRC,gBAAAA,kCAlBQ,GAkB6BV,uBAAuB,CAACP,IAAD,CAlBpD;AAAA;AAAA,uBAoBKkB,OAAO,CAACC,GAAR,CAAYF,kCAAZ,CApBL;;AAAA;AAoBRG,gBAAAA,IApBQ;AAsBdnB,gBAAAA,QAAQ,CAAC;AACPoB,kBAAAA,IAAI,EAAE,6BADC;AAEPD,kBAAAA,IAAI,EAAJA;AAFO,iBAAD,CAAR;;AAtBc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAH;;AAAA,sBAAPlB,OAAO;AAAA;AAAA;AAAA,OAAb,CADc,CA6Bd;AACA;;;AACA,QAAI,CAACV,OAAL,EAAc;AACZU,MAAAA,OAAO;AACR,KAjCa,CAmCd;;AACD,GApCD,EAoCG,CAACR,WAAD,EAAcF,OAAd,CApCH;AAsCA,SAAO;AAAEO,IAAAA,SAAS,EAATA,SAAF;AAAaC,IAAAA,IAAI,EAAJA;AAAb,GAAP;AACD,CA/CD;;eAiDeT,e","sourcesContent":["import { useContext, useEffect, useReducer } from 'react';\nimport { useGlobalContext, hasPermissions, UserContext } from 'strapi-helper-plugin';\n\nimport reducer, { initialState } from './reducer';\nimport init from './init';\n\nconst useSettingsMenu = (noCheck = false) => {\n  const { userPermissions: permissions } = useContext(UserContext);\n  const { plugins } = useGlobalContext();\n\n  const [{ isLoading, menu }, dispatch] = useReducer(reducer, initialState, () =>\n    init(initialState, plugins)\n  );\n\n  useEffect(() => {\n    const getData = async () => {\n      const checkPermissions = async (permissionsToCheck, path) => {\n        const hasPermission = await hasPermissions(permissions, permissionsToCheck);\n\n        return { hasPermission, path };\n      };\n\n      const generateArrayOfPromises = array => {\n        return array.reduce((acc, current, sectionIndex) => {\n          const generateArrayOfPromises = array =>\n            array.map((link, index) =>\n              checkPermissions(array[index].permissions, `${sectionIndex}.links.${index}`)\n            );\n\n          return [...acc, ...generateArrayOfPromises(current.links)];\n        }, []);\n      };\n\n      const generalSectionLinksArrayOfPromises = generateArrayOfPromises(menu);\n\n      const data = await Promise.all(generalSectionLinksArrayOfPromises);\n\n      dispatch({\n        type: 'CHECK_PERMISSIONS_SUCCEEDED',\n        data,\n      });\n    };\n\n    // This hook is also used by the main LeftMenu component in order to know which sections it needs to display/hide\n    // Therefore, we don't need to make the checking all the times when the hook is used.\n    if (!noCheck) {\n      getData();\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [permissions, noCheck]);\n\n  return { isLoading, menu };\n};\n\nexport default useSettingsMenu;\n"]},"metadata":{},"sourceType":"script"}