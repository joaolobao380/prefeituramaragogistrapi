{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _custom = require(\"@buffetjs/custom\");\n\nvar _lodash = require(\"lodash\");\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reactFastCompare = _interopRequireDefault(require(\"react-fast-compare\"));\n\nvar _core = require(\"@buffetjs/core\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _utils = require(\"../../../utils\");\n\nvar _utils2 = require(\"./utils\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar primaryButtonObject = {\n  color: 'primary',\n  type: 'button',\n  style: {\n    minWidth: 150,\n    fontWeight: 600\n  }\n};\n\nvar Header = function Header(_ref) {\n  var _ref$allowedActions = _ref.allowedActions,\n      canUpdate = _ref$allowedActions.canUpdate,\n      canCreate = _ref$allowedActions.canCreate,\n      canPublish = _ref$allowedActions.canPublish,\n      componentLayouts = _ref.componentLayouts,\n      initialData = _ref.initialData,\n      isCreatingEntry = _ref.isCreatingEntry,\n      isSingleType = _ref.isSingleType,\n      hasDraftAndPublish = _ref.hasDraftAndPublish,\n      layout = _ref.layout,\n      modifiedData = _ref.modifiedData,\n      onPublish = _ref.onPublish,\n      onUnpublish = _ref.onUnpublish,\n      status = _ref.status;\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      showWarningUnpublish = _useState2[0],\n      setWarningUnpublish = _useState2[1];\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var formatMessageRef = (0, _react.useRef)(formatMessage);\n\n  var _useState3 = (0, _react.useState)(0),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      draftRelationsCount = _useState4[0],\n      setDraftRelationsCount = _useState4[1];\n\n  var _useState5 = (0, _react.useState)(false),\n      _useState6 = (0, _slicedToArray2[\"default\"])(_useState5, 2),\n      showWarningDraftRelation = _useState6[0],\n      setShowWarningDraftRelation = _useState6[1];\n\n  var _useState7 = (0, _react.useState)(false),\n      _useState8 = (0, _slicedToArray2[\"default\"])(_useState7, 2),\n      shouldUnpublish = _useState8[0],\n      setShouldUnpublish = _useState8[1];\n\n  var _useState9 = (0, _react.useState)(false),\n      _useState10 = (0, _slicedToArray2[\"default\"])(_useState9, 2),\n      shouldPublish = _useState10[0],\n      setShouldPublish = _useState10[1];\n\n  var currentContentTypeMainField = (0, _react.useMemo)(function () {\n    return (0, _lodash.get)(layout, ['settings', 'mainField'], 'id');\n  }, [layout]);\n  var currentContentTypeName = (0, _react.useMemo)(function () {\n    return (0, _lodash.get)(layout, ['info', 'name']);\n  }, [layout]);\n  var didChangeData = (0, _react.useMemo)(function () {\n    return !(0, _lodash.isEqual)(initialData, modifiedData) || isCreatingEntry && !(0, _lodash.isEmpty)(modifiedData);\n  }, [initialData, isCreatingEntry, modifiedData]);\n  var apiID = (0, _react.useMemo)(function () {\n    return layout.apiID;\n  }, [layout.apiID]);\n  /* eslint-disable indent */\n\n  var entryHeaderTitle = isCreatingEntry ? formatMessage({\n    id: (0, _utils.getTrad)('containers.Edit.pluginHeader.title.new')\n  }) : (0, _strapiHelperPlugin.templateObject)({\n    mainField: currentContentTypeMainField\n  }, initialData).mainField;\n  /* eslint-enable indent */\n\n  var headerTitle = (0, _react.useMemo)(function () {\n    var title = isSingleType ? currentContentTypeName : entryHeaderTitle;\n    return title || currentContentTypeName;\n  }, [currentContentTypeName, entryHeaderTitle, isSingleType]);\n  var checkIfHasDraftRelations = (0, _react.useCallback)(function () {\n    var count = (0, _utils2.getDraftRelations)(modifiedData, layout, componentLayouts);\n    setDraftRelationsCount(count);\n    return count > 0;\n  }, [modifiedData, layout, componentLayouts]);\n  var headerActions = (0, _react.useMemo)(function () {\n    var headerActions = [];\n\n    if (isCreatingEntry && canCreate || !isCreatingEntry && canUpdate) {\n      headerActions = [{\n        disabled: !didChangeData,\n        color: 'success',\n        label: formatMessage({\n          id: (0, _utils.getTrad)('containers.Edit.submit')\n        }),\n        isLoading: status === 'submit-pending',\n        type: 'submit',\n        style: {\n          minWidth: 150,\n          fontWeight: 600\n        }\n      }];\n    }\n\n    if (hasDraftAndPublish && canPublish) {\n      var isPublished = !(0, _lodash.isEmpty)(initialData.published_at);\n      var isLoading = isPublished ? status === 'unpublish-pending' : status === 'publish-pending';\n      var labelID = isPublished ? 'app.utils.unpublish' : 'app.utils.publish';\n      /* eslint-disable indent */\n\n      var onClick = isPublished ? function () {\n        return setWarningUnpublish(true);\n      } : function (e) {\n        if (!checkIfHasDraftRelations()) {\n          onPublish(e);\n        } else {\n          setShowWarningDraftRelation(true);\n        }\n      };\n      /* eslint-enable indent */\n\n      var action = _objectSpread(_objectSpread({}, primaryButtonObject), {}, {\n        disabled: isCreatingEntry || didChangeData,\n        isLoading: isLoading,\n        label: formatMessage({\n          id: labelID\n        }),\n        onClick: onClick\n      });\n\n      headerActions.unshift(action);\n    }\n\n    return headerActions;\n  }, [isCreatingEntry, canCreate, canUpdate, hasDraftAndPublish, canPublish, didChangeData, formatMessage, status, initialData, onPublish, checkIfHasDraftRelations]);\n  var headerProps = (0, _react.useMemo)(function () {\n    return {\n      title: {\n        label: (0, _lodash.toString)(headerTitle)\n      },\n      content: \"\".concat(formatMessageRef.current({\n        id: (0, _utils.getTrad)('api.id')\n      }), \" : \").concat(apiID),\n      actions: headerActions\n    };\n  }, [headerActions, headerTitle, apiID]);\n\n  var toggleWarningPublish = function toggleWarningPublish() {\n    return setWarningUnpublish(function (prevState) {\n      return !prevState;\n    });\n  };\n\n  var toggleWarningDraftRelation = (0, _react.useCallback)(function () {\n    setShowWarningDraftRelation(function (prev) {\n      return !prev;\n    });\n  }, []);\n  var handleConfirmPublish = (0, _react.useCallback)(function () {\n    setShouldPublish(true);\n    setShowWarningDraftRelation(false);\n  }, []);\n  var handleConfirmUnpublish = (0, _react.useCallback)(function () {\n    setShouldUnpublish(true);\n    setWarningUnpublish(false);\n  }, []);\n  var handleCloseModalPublish = (0, _react.useCallback)(function (e) {\n    if (shouldPublish) {\n      onPublish(e);\n    }\n\n    setShouldUnpublish(false);\n  }, [onPublish, shouldPublish]);\n  var handleCloseModalUnpublish = (0, _react.useCallback)(function (e) {\n    if (shouldUnpublish) {\n      onUnpublish(e);\n    }\n\n    setShouldUnpublish(false);\n  }, [onUnpublish, shouldUnpublish]);\n  var contentIdSuffix = draftRelationsCount > 1 ? 'plural' : 'singular';\n  return /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(_custom.Header, headerProps), hasDraftAndPublish && /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.ModalConfirm, {\n    isOpen: showWarningUnpublish,\n    toggle: toggleWarningPublish,\n    content: {\n      id: (0, _utils.getTrad)('popUpWarning.warning.unpublish'),\n      values: {\n        br: function br() {\n          return /*#__PURE__*/_react[\"default\"].createElement(\"br\", null);\n        }\n      }\n    },\n    type: \"xwarning\",\n    onConfirm: handleConfirmUnpublish,\n    onClosed: handleCloseModalUnpublish\n  }, /*#__PURE__*/_react[\"default\"].createElement(_core.Text, null, formatMessage({\n    id: (0, _utils.getTrad)('popUpWarning.warning.unpublish-question')\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.ModalConfirm, {\n    confirmButtonLabel: {\n      id: (0, _utils.getTrad)('popUpwarning.warning.has-draft-relations.button-confirm')\n    },\n    isOpen: showWarningDraftRelation,\n    toggle: toggleWarningDraftRelation,\n    onClosed: handleCloseModalPublish,\n    onConfirm: handleConfirmPublish,\n    type: \"success\",\n    content: {\n      id: (0, _utils.getTrad)(\"popUpwarning.warning.has-draft-relations.message.\".concat(contentIdSuffix)),\n      values: {\n        count: draftRelationsCount,\n        b: function b(chunks) {\n          return /*#__PURE__*/_react[\"default\"].createElement(_core.Text, {\n            as: \"span\",\n            fontWeight: \"bold\"\n          }, chunks);\n        },\n        br: function br() {\n          return /*#__PURE__*/_react[\"default\"].createElement(\"br\", null);\n        }\n      }\n    }\n  }, /*#__PURE__*/_react[\"default\"].createElement(_core.Text, null, formatMessage({\n    id: (0, _utils.getTrad)('popUpWarning.warning.publish-question')\n  })))));\n};\n\nHeader.propTypes = {\n  allowedActions: _propTypes[\"default\"].shape({\n    canUpdate: _propTypes[\"default\"].bool.isRequired,\n    canCreate: _propTypes[\"default\"].bool.isRequired,\n    canPublish: _propTypes[\"default\"].bool.isRequired\n  }).isRequired,\n  componentLayouts: _propTypes[\"default\"].object.isRequired,\n  initialData: _propTypes[\"default\"].object.isRequired,\n  isCreatingEntry: _propTypes[\"default\"].bool.isRequired,\n  isSingleType: _propTypes[\"default\"].bool.isRequired,\n  status: _propTypes[\"default\"].string.isRequired,\n  layout: _propTypes[\"default\"].object.isRequired,\n  hasDraftAndPublish: _propTypes[\"default\"].bool.isRequired,\n  modifiedData: _propTypes[\"default\"].object.isRequired,\n  onPublish: _propTypes[\"default\"].func.isRequired,\n  onUnpublish: _propTypes[\"default\"].func.isRequired\n};\nvar Memoized = /*#__PURE__*/(0, _react.memo)(Header, _reactFastCompare[\"default\"]);\n\nvar _default = (0, _utils2.connect)(Memoized, _utils2.select);\n\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-content-manager/admin/src/containers/EditView/Header/index.js"],"names":["primaryButtonObject","color","type","style","minWidth","fontWeight","Header","allowedActions","canUpdate","canCreate","canPublish","componentLayouts","initialData","isCreatingEntry","isSingleType","hasDraftAndPublish","layout","modifiedData","onPublish","onUnpublish","status","showWarningUnpublish","setWarningUnpublish","formatMessage","formatMessageRef","draftRelationsCount","setDraftRelationsCount","showWarningDraftRelation","setShowWarningDraftRelation","shouldUnpublish","setShouldUnpublish","shouldPublish","setShouldPublish","currentContentTypeMainField","currentContentTypeName","didChangeData","apiID","entryHeaderTitle","id","mainField","headerTitle","title","checkIfHasDraftRelations","count","headerActions","disabled","label","isLoading","isPublished","published_at","labelID","onClick","e","action","unshift","headerProps","content","current","actions","toggleWarningPublish","prevState","toggleWarningDraftRelation","prev","handleConfirmPublish","handleConfirmUnpublish","handleCloseModalPublish","handleCloseModalUnpublish","contentIdSuffix","values","br","b","chunks","propTypes","PropTypes","shape","bool","isRequired","object","string","func","Memoized","isEqualFastCompare","select"],"mappings":"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","sourcesContent":["import React, { memo, useCallback, useMemo, useRef, useState } from 'react';\nimport { useIntl } from 'react-intl';\nimport { Header as PluginHeader } from '@buffetjs/custom';\nimport { get, isEqual, isEmpty, toString } from 'lodash';\nimport PropTypes from 'prop-types';\nimport isEqualFastCompare from 'react-fast-compare';\nimport { Text } from '@buffetjs/core';\nimport { templateObject, ModalConfirm } from 'strapi-helper-plugin';\nimport { getTrad } from '../../../utils';\nimport { connect, getDraftRelations, select } from './utils';\n\nconst primaryButtonObject = {\n  color: 'primary',\n  type: 'button',\n  style: {\n    minWidth: 150,\n    fontWeight: 600,\n  },\n};\n\nconst Header = ({\n  allowedActions: { canUpdate, canCreate, canPublish },\n  componentLayouts,\n  initialData,\n  isCreatingEntry,\n  isSingleType,\n  hasDraftAndPublish,\n  layout,\n  modifiedData,\n  onPublish,\n  onUnpublish,\n  status,\n}) => {\n  const [showWarningUnpublish, setWarningUnpublish] = useState(false);\n  const { formatMessage } = useIntl();\n  const formatMessageRef = useRef(formatMessage);\n  const [draftRelationsCount, setDraftRelationsCount] = useState(0);\n  const [showWarningDraftRelation, setShowWarningDraftRelation] = useState(false);\n  const [shouldUnpublish, setShouldUnpublish] = useState(false);\n  const [shouldPublish, setShouldPublish] = useState(false);\n\n  const currentContentTypeMainField = useMemo(() => get(layout, ['settings', 'mainField'], 'id'), [\n    layout,\n  ]);\n\n  const currentContentTypeName = useMemo(() => get(layout, ['info', 'name']), [layout]);\n\n  const didChangeData = useMemo(() => {\n    return !isEqual(initialData, modifiedData) || (isCreatingEntry && !isEmpty(modifiedData));\n  }, [initialData, isCreatingEntry, modifiedData]);\n  const apiID = useMemo(() => layout.apiID, [layout.apiID]);\n\n  /* eslint-disable indent */\n  const entryHeaderTitle = isCreatingEntry\n    ? formatMessage({\n        id: getTrad('containers.Edit.pluginHeader.title.new'),\n      })\n    : templateObject({ mainField: currentContentTypeMainField }, initialData).mainField;\n  /* eslint-enable indent */\n\n  const headerTitle = useMemo(() => {\n    const title = isSingleType ? currentContentTypeName : entryHeaderTitle;\n\n    return title || currentContentTypeName;\n  }, [currentContentTypeName, entryHeaderTitle, isSingleType]);\n\n  const checkIfHasDraftRelations = useCallback(() => {\n    const count = getDraftRelations(modifiedData, layout, componentLayouts);\n\n    setDraftRelationsCount(count);\n\n    return count > 0;\n  }, [modifiedData, layout, componentLayouts]);\n\n  const headerActions = useMemo(() => {\n    let headerActions = [];\n\n    if ((isCreatingEntry && canCreate) || (!isCreatingEntry && canUpdate)) {\n      headerActions = [\n        {\n          disabled: !didChangeData,\n          color: 'success',\n          label: formatMessage({\n            id: getTrad('containers.Edit.submit'),\n          }),\n          isLoading: status === 'submit-pending',\n          type: 'submit',\n          style: {\n            minWidth: 150,\n            fontWeight: 600,\n          },\n        },\n      ];\n    }\n\n    if (hasDraftAndPublish && canPublish) {\n      const isPublished = !isEmpty(initialData.published_at);\n      const isLoading = isPublished ? status === 'unpublish-pending' : status === 'publish-pending';\n      const labelID = isPublished ? 'app.utils.unpublish' : 'app.utils.publish';\n      /* eslint-disable indent */\n      const onClick = isPublished\n        ? () => setWarningUnpublish(true)\n        : e => {\n            if (!checkIfHasDraftRelations()) {\n              onPublish(e);\n            } else {\n              setShowWarningDraftRelation(true);\n            }\n          };\n      /* eslint-enable indent */\n\n      const action = {\n        ...primaryButtonObject,\n        disabled: isCreatingEntry || didChangeData,\n        isLoading,\n        label: formatMessage({ id: labelID }),\n        onClick,\n      };\n\n      headerActions.unshift(action);\n    }\n\n    return headerActions;\n  }, [\n    isCreatingEntry,\n    canCreate,\n    canUpdate,\n    hasDraftAndPublish,\n    canPublish,\n    didChangeData,\n    formatMessage,\n    status,\n    initialData,\n    onPublish,\n    checkIfHasDraftRelations,\n  ]);\n\n  const headerProps = useMemo(() => {\n    return {\n      title: {\n        label: toString(headerTitle),\n      },\n      content: `${formatMessageRef.current({ id: getTrad('api.id') })} : ${apiID}`,\n      actions: headerActions,\n    };\n  }, [headerActions, headerTitle, apiID]);\n\n  const toggleWarningPublish = () => setWarningUnpublish(prevState => !prevState);\n\n  const toggleWarningDraftRelation = useCallback(() => {\n    setShowWarningDraftRelation(prev => !prev);\n  }, []);\n\n  const handleConfirmPublish = useCallback(() => {\n    setShouldPublish(true);\n    setShowWarningDraftRelation(false);\n  }, []);\n\n  const handleConfirmUnpublish = useCallback(() => {\n    setShouldUnpublish(true);\n    setWarningUnpublish(false);\n  }, []);\n\n  const handleCloseModalPublish = useCallback(\n    e => {\n      if (shouldPublish) {\n        onPublish(e);\n      }\n\n      setShouldUnpublish(false);\n    },\n    [onPublish, shouldPublish]\n  );\n\n  const handleCloseModalUnpublish = useCallback(\n    e => {\n      if (shouldUnpublish) {\n        onUnpublish(e);\n      }\n\n      setShouldUnpublish(false);\n    },\n    [onUnpublish, shouldUnpublish]\n  );\n\n  const contentIdSuffix = draftRelationsCount > 1 ? 'plural' : 'singular';\n\n  return (\n    <>\n      <PluginHeader {...headerProps} />\n      {hasDraftAndPublish && (\n        <>\n          <ModalConfirm\n            isOpen={showWarningUnpublish}\n            toggle={toggleWarningPublish}\n            content={{\n              id: getTrad('popUpWarning.warning.unpublish'),\n              values: {\n                br: () => <br />,\n              },\n            }}\n            type=\"xwarning\"\n            onConfirm={handleConfirmUnpublish}\n            onClosed={handleCloseModalUnpublish}\n          >\n            <Text>{formatMessage({ id: getTrad('popUpWarning.warning.unpublish-question') })}</Text>\n          </ModalConfirm>\n          <ModalConfirm\n            confirmButtonLabel={{\n              id: getTrad('popUpwarning.warning.has-draft-relations.button-confirm'),\n            }}\n            isOpen={showWarningDraftRelation}\n            toggle={toggleWarningDraftRelation}\n            onClosed={handleCloseModalPublish}\n            onConfirm={handleConfirmPublish}\n            type=\"success\"\n            content={{\n              id: getTrad(`popUpwarning.warning.has-draft-relations.message.${contentIdSuffix}`),\n              values: {\n                count: draftRelationsCount,\n                b: chunks => (\n                  <Text as=\"span\" fontWeight=\"bold\">\n                    {chunks}\n                  </Text>\n                ),\n                br: () => <br />,\n              },\n            }}\n          >\n            <Text>{formatMessage({ id: getTrad('popUpWarning.warning.publish-question') })}</Text>\n          </ModalConfirm>\n        </>\n      )}\n    </>\n  );\n};\n\nHeader.propTypes = {\n  allowedActions: PropTypes.shape({\n    canUpdate: PropTypes.bool.isRequired,\n    canCreate: PropTypes.bool.isRequired,\n    canPublish: PropTypes.bool.isRequired,\n  }).isRequired,\n  componentLayouts: PropTypes.object.isRequired,\n  initialData: PropTypes.object.isRequired,\n  isCreatingEntry: PropTypes.bool.isRequired,\n  isSingleType: PropTypes.bool.isRequired,\n  status: PropTypes.string.isRequired,\n  layout: PropTypes.object.isRequired,\n  hasDraftAndPublish: PropTypes.bool.isRequired,\n  modifiedData: PropTypes.object.isRequired,\n  onPublish: PropTypes.func.isRequired,\n  onUnpublish: PropTypes.func.isRequired,\n};\n\nconst Memoized = memo(Header, isEqualFastCompare);\n\nexport default connect(Memoized, select);\n"]},"metadata":{},"sourceType":"script"}