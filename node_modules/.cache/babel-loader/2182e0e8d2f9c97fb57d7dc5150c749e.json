{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _lodash = require(\"lodash\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _core = require(\"@buffetjs/core\");\n\nvar _qs = require(\"qs\");\n\nvar _pluginId = _interopRequireDefault(require(\"../../pluginId\"));\n\nvar _SelectOne = _interopRequireDefault(require(\"../SelectOne\"));\n\nvar _SelectMany = _interopRequireDefault(require(\"../SelectMany\"));\n\nvar _ClearIndicator = _interopRequireDefault(require(\"./ClearIndicator\"));\n\nvar _IndicatorSeparator = _interopRequireDefault(require(\"./IndicatorSeparator\"));\n\nvar _Option = _interopRequireDefault(require(\"./Option\"));\n\nvar _components = require(\"./components\");\n\nvar _utils = require(\"./utils\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar initialPaginationState = {\n  _contains: '',\n  _limit: 20,\n  _start: 0\n};\n\nvar buildParams = function buildParams(query, paramsToKeep) {\n  if (!paramsToKeep) {\n    return {};\n  }\n\n  return paramsToKeep.reduce(function (acc, current) {\n    var value = (0, _lodash.get)(query, current, null);\n\n    if (value) {\n      (0, _lodash.set)(acc, current, value);\n    }\n\n    return acc;\n  }, {});\n};\n\nfunction SelectWrapper(_ref) {\n  var description = _ref.description,\n      editable = _ref.editable,\n      label = _ref.label,\n      labelIcon = _ref.labelIcon,\n      isCreatingEntry = _ref.isCreatingEntry,\n      isFieldAllowed = _ref.isFieldAllowed,\n      isFieldReadable = _ref.isFieldReadable,\n      mainField = _ref.mainField,\n      name = _ref.name,\n      relationType = _ref.relationType,\n      targetModel = _ref.targetModel,\n      placeholder = _ref.placeholder,\n      queryInfos = _ref.queryInfos;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useQueryParams = (0, _strapiHelperPlugin.useQueryParams)(),\n      _useQueryParams2 = (0, _slicedToArray2[\"default\"])(_useQueryParams, 1),\n      query = _useQueryParams2[0].query; // Disable the input in case of a polymorphic relation\n\n\n  var isMorph = (0, _react.useMemo)(function () {\n    return relationType.toLowerCase().includes('morph');\n  }, [relationType]);\n\n  var _useContentManagerEdi = (0, _strapiHelperPlugin.useContentManagerEditViewDataManager)(),\n      addRelation = _useContentManagerEdi.addRelation,\n      modifiedData = _useContentManagerEdi.modifiedData,\n      moveRelation = _useContentManagerEdi.moveRelation,\n      onChange = _useContentManagerEdi.onChange,\n      onRemoveRelation = _useContentManagerEdi.onRemoveRelation;\n\n  var _useLocation = (0, _reactRouterDom.useLocation)(),\n      pathname = _useLocation.pathname;\n\n  var value = (0, _lodash.get)(modifiedData, name, null);\n\n  var _useState = (0, _react.useState)(initialPaginationState),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      state = _useState2[0],\n      setState = _useState2[1];\n\n  var _useState3 = (0, _react.useState)([]),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      options = _useState4[0],\n      setOptions = _useState4[1];\n\n  var _useState5 = (0, _react.useState)(false),\n      _useState6 = (0, _slicedToArray2[\"default\"])(_useState5, 2),\n      isLoading = _useState6[0],\n      setIsLoading = _useState6[1];\n\n  var _useState7 = (0, _react.useState)(false),\n      _useState8 = (0, _slicedToArray2[\"default\"])(_useState7, 2),\n      isOpen = _useState8[0],\n      setIsOpen = _useState8[1];\n\n  var filteredOptions = (0, _react.useMemo)(function () {\n    return options.filter(function (option) {\n      if (!(0, _lodash.isEmpty)(value)) {\n        // SelectMany\n        if (Array.isArray(value)) {\n          return (0, _lodash.findIndex)(value, function (o) {\n            return o.id === option.value.id;\n          }) === -1;\n        } // SelectOne\n\n\n        return (0, _lodash.get)(value, 'id', '') !== option.value.id;\n      }\n\n      return true;\n    });\n  }, [options, value]);\n  var endPoint = queryInfos.endPoint,\n      containsKey = queryInfos.containsKey,\n      defaultParams = queryInfos.defaultParams,\n      shouldDisplayRelationLink = queryInfos.shouldDisplayRelationLink,\n      paramsToKeep = queryInfos.paramsToKeep;\n  var isSingle = ['oneWay', 'oneToOne', 'manyToOne', 'oneToManyMorph', 'oneToOneMorph'].includes(relationType);\n  var idsToOmit = (0, _react.useMemo)(function () {\n    if (!value) {\n      return [];\n    }\n\n    if (isSingle) {\n      return [value.id];\n    }\n\n    return value.map(function (val) {\n      return val.id;\n    });\n  }, [isSingle, value]);\n  var getData = (0, _react.useCallback)( /*#__PURE__*/function () {\n    var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(signal) {\n      var params, data, formattedData;\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!isMorph) {\n                _context.next = 3;\n                break;\n              }\n\n              setIsLoading(false);\n              return _context.abrupt(\"return\");\n\n            case 3:\n              if (isFieldAllowed) {\n                _context.next = 6;\n                break;\n              }\n\n              setIsLoading(false);\n              return _context.abrupt(\"return\");\n\n            case 6:\n              setIsLoading(true);\n              params = _objectSpread({\n                _limit: state._limit\n              }, defaultParams);\n\n              if (state._contains) {\n                params[containsKey] = state._contains;\n              }\n\n              _context.prev = 9;\n              _context.next = 12;\n              return (0, _strapiHelperPlugin.request)(endPoint, {\n                method: 'POST',\n                params: params,\n                signal: signal,\n                body: {\n                  idsToOmit: idsToOmit\n                }\n              });\n\n            case 12:\n              data = _context.sent;\n              formattedData = data.map(function (obj) {\n                return {\n                  value: obj,\n                  label: obj[mainField.name]\n                };\n              });\n              setOptions(function (prevState) {\n                return prevState.concat(formattedData).filter(function (obj, index) {\n                  var objIndex = prevState.findIndex(function (el) {\n                    return el.value.id === obj.value.id;\n                  });\n\n                  if (objIndex === -1) {\n                    return true;\n                  }\n\n                  return prevState.findIndex(function (el) {\n                    return el.value.id === obj.value.id;\n                  }) === index;\n                });\n              });\n              setIsLoading(false);\n              _context.next = 20;\n              break;\n\n            case 18:\n              _context.prev = 18;\n              _context.t0 = _context[\"catch\"](9);\n\n            case 20:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[9, 18]]);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), [isMorph, isFieldAllowed, state._limit, state._contains, defaultParams, containsKey, endPoint, idsToOmit, mainField.name]);\n  (0, _react.useEffect)(function () {\n    var abortController = new AbortController();\n    var signal = abortController.signal;\n\n    if (isOpen) {\n      getData(signal);\n    }\n\n    return function () {\n      return abortController.abort();\n    };\n  }, [getData, isOpen]);\n\n  var handleInputChange = function handleInputChange(inputValue, _ref3) {\n    var action = _ref3.action;\n\n    if (action === 'input-change') {\n      setState(function (prevState) {\n        if (prevState._contains === inputValue) {\n          return prevState;\n        }\n\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          _contains: inputValue,\n          _start: 0\n        });\n      });\n    }\n\n    return inputValue;\n  };\n\n  var handleMenuScrollToBottom = function handleMenuScrollToBottom() {\n    setState(function (prevState) {\n      return _objectSpread(_objectSpread({}, prevState), {}, {\n        _limit: prevState._limit + 20\n      });\n    });\n  };\n\n  var handleMenuClose = function handleMenuClose() {\n    setState(initialPaginationState);\n    setIsOpen(false);\n  };\n\n  var handleChange = function handleChange(value) {\n    onChange({\n      target: {\n        name: name,\n        value: value ? value.value : value\n      }\n    });\n  };\n\n  var handleAddRelation = function handleAddRelation(value) {\n    if (!(0, _lodash.isEmpty)(value)) {\n      addRelation({\n        target: {\n          name: name,\n          value: value\n        }\n      });\n    }\n  };\n\n  var handleMenuOpen = function handleMenuOpen() {\n    setIsOpen(true);\n  };\n\n  var to = \"/plugins/\".concat(_pluginId[\"default\"], \"/collectionType/\").concat(targetModel, \"/\").concat(value ? value.id : null);\n  var searchToPersist = (0, _qs.stringify)(buildParams(query, paramsToKeep), {\n    encode: false\n  });\n  var link = (0, _react.useMemo)(function () {\n    if (!value) {\n      return null;\n    }\n\n    if (!shouldDisplayRelationLink) {\n      return null;\n    }\n\n    return /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Link, {\n      to: {\n        pathname: to,\n        state: {\n          from: pathname\n        },\n        search: searchToPersist\n      }\n    }, /*#__PURE__*/_react[\"default\"].createElement(_reactIntl.FormattedMessage, {\n      id: \"content-manager.containers.Edit.seeDetails\"\n    }, function (msg) {\n      return /*#__PURE__*/_react[\"default\"].createElement(_components.A, {\n        color: \"mediumBlue\"\n      }, msg);\n    }));\n  }, [shouldDisplayRelationLink, pathname, to, value, searchToPersist]);\n  var Component = isSingle ? _SelectOne[\"default\"] : _SelectMany[\"default\"];\n  var associationsLength = (0, _lodash.isArray)(value) ? value.length : 0;\n  var isDisabled = (0, _react.useMemo)(function () {\n    if (isMorph) {\n      return true;\n    }\n\n    if (!isCreatingEntry) {\n      return !isFieldAllowed && isFieldReadable || !editable;\n    }\n\n    return !editable;\n  }, [isMorph, isCreatingEntry, editable, isFieldAllowed, isFieldReadable]);\n  var labelIconformatted = labelIcon ? {\n    icon: labelIcon.icon,\n    title: formatMessage(labelIcon.title)\n  } : labelIcon;\n\n  if (!isFieldAllowed && isCreatingEntry) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.NotAllowedInput, {\n      label: label,\n      labelIcon: labelIconformatted\n    });\n  }\n\n  if (!isCreatingEntry && !isFieldAllowed && !isFieldReadable) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.NotAllowedInput, {\n      label: label,\n      labelIcon: labelIconformatted\n    });\n  }\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, null, /*#__PURE__*/_react[\"default\"].createElement(_components.BaselineAlignment, null), /*#__PURE__*/_react[\"default\"].createElement(_core.Flex, {\n    justifyContent: \"space-between\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_core.Flex, null, /*#__PURE__*/_react[\"default\"].createElement(_core.Text, {\n    fontWeight: \"semiBold\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(\"span\", null, label, !isSingle && \" (\".concat(associationsLength, \")\"))), labelIconformatted && /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    style: {\n      lineHeight: '13px'\n    }\n  }, /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.LabelIconWrapper, {\n    title: labelIconformatted.title\n  }, labelIconformatted.icon))), isSingle && link), !(0, _lodash.isEmpty)(description) && /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n    top: true,\n    size: \"xs\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_components.BaselineAlignment, null), /*#__PURE__*/_react[\"default\"].createElement(_core.Text, {\n    fontSize: \"sm\",\n    color: \"grey\",\n    lineHeight: \"12px\",\n    ellipsis: true\n  }, description)), /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n    top: true,\n    size: \"sm\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_components.BaselineAlignment, null), /*#__PURE__*/_react[\"default\"].createElement(Component, {\n    addRelation: handleAddRelation,\n    components: {\n      ClearIndicator: _ClearIndicator[\"default\"],\n      DropdownIndicator: _strapiHelperPlugin.DropdownIndicator,\n      IndicatorSeparator: _IndicatorSeparator[\"default\"],\n      Option: _Option[\"default\"]\n    },\n    displayNavigationLink: shouldDisplayRelationLink,\n    id: name,\n    isDisabled: isDisabled,\n    isLoading: isLoading,\n    isClearable: true,\n    mainField: mainField,\n    move: moveRelation,\n    name: name,\n    options: filteredOptions,\n    onChange: handleChange,\n    onInputChange: handleInputChange,\n    onMenuClose: handleMenuClose,\n    onMenuOpen: handleMenuOpen,\n    onMenuScrollToBottom: handleMenuScrollToBottom,\n    onRemove: onRemoveRelation,\n    placeholder: (0, _lodash.isEmpty)(placeholder) ? /*#__PURE__*/_react[\"default\"].createElement(_reactIntl.FormattedMessage, {\n      id: \"\".concat(_pluginId[\"default\"], \".containers.Edit.addAnItem\")\n    }) : placeholder,\n    searchToPersist: searchToPersist,\n    styles: _utils.styles,\n    targetModel: targetModel,\n    value: value\n  })), /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    style: {\n      marginBottom: 28\n    }\n  }));\n}\n\nSelectWrapper.defaultProps = {\n  editable: true,\n  description: '',\n  label: '',\n  labelIcon: null,\n  isFieldAllowed: true,\n  placeholder: ''\n};\nSelectWrapper.propTypes = {\n  editable: _propTypes[\"default\"].bool,\n  description: _propTypes[\"default\"].string,\n  label: _propTypes[\"default\"].string,\n  labelIcon: _propTypes[\"default\"].shape({\n    icon: _propTypes[\"default\"].node.isRequired,\n    title: _propTypes[\"default\"].shape({\n      id: _propTypes[\"default\"].string.isRequired,\n      defaultMessage: _propTypes[\"default\"].string\n    })\n  }),\n  isCreatingEntry: _propTypes[\"default\"].bool.isRequired,\n  isFieldAllowed: _propTypes[\"default\"].bool,\n  isFieldReadable: _propTypes[\"default\"].bool.isRequired,\n  mainField: _propTypes[\"default\"].shape({\n    name: _propTypes[\"default\"].string.isRequired,\n    schema: _propTypes[\"default\"].shape({\n      type: _propTypes[\"default\"].string.isRequired\n    }).isRequired\n  }).isRequired,\n  name: _propTypes[\"default\"].string.isRequired,\n  placeholder: _propTypes[\"default\"].string,\n  relationType: _propTypes[\"default\"].string.isRequired,\n  targetModel: _propTypes[\"default\"].string.isRequired,\n  queryInfos: _propTypes[\"default\"].shape({\n    containsKey: _propTypes[\"default\"].string.isRequired,\n    defaultParams: _propTypes[\"default\"].object,\n    endPoint: _propTypes[\"default\"].string.isRequired,\n    shouldDisplayRelationLink: _propTypes[\"default\"].bool.isRequired,\n    paramsToKeep: _propTypes[\"default\"].array\n  }).isRequired\n};\nvar Memoized = /*#__PURE__*/(0, _react.memo)(SelectWrapper);\n\nvar _default = (0, _utils.connect)(Memoized, _utils.select);\n\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-content-manager/admin/src/components/SelectWrapper/index.js"],"names":["initialPaginationState","_contains","_limit","_start","buildParams","query","paramsToKeep","reduce","acc","current","value","SelectWrapper","description","editable","label","labelIcon","isCreatingEntry","isFieldAllowed","isFieldReadable","mainField","name","relationType","targetModel","placeholder","queryInfos","formatMessage","isMorph","toLowerCase","includes","addRelation","modifiedData","moveRelation","onChange","onRemoveRelation","pathname","state","setState","options","setOptions","isLoading","setIsLoading","isOpen","setIsOpen","filteredOptions","filter","option","Array","isArray","o","id","endPoint","containsKey","defaultParams","shouldDisplayRelationLink","isSingle","idsToOmit","map","val","getData","signal","params","method","body","data","formattedData","obj","prevState","concat","index","objIndex","findIndex","el","abortController","AbortController","abort","handleInputChange","inputValue","action","handleMenuScrollToBottom","handleMenuClose","handleChange","target","handleAddRelation","handleMenuOpen","to","pluginId","searchToPersist","encode","link","from","search","msg","Component","SelectOne","SelectMany","associationsLength","length","isDisabled","labelIconformatted","icon","title","lineHeight","ClearIndicator","DropdownIndicator","IndicatorSeparator","Option","styles","marginBottom","defaultProps","propTypes","PropTypes","bool","string","shape","node","isRequired","defaultMessage","schema","type","object","array","Memoized","select"],"mappings":"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","sourcesContent":["import React, { useCallback, useState, useEffect, useMemo, memo } from 'react';\nimport PropTypes from 'prop-types';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { Link, useLocation } from 'react-router-dom';\nimport { findIndex, get, isArray, isEmpty, set } from 'lodash';\nimport {\n  DropdownIndicator,\n  LabelIconWrapper,\n  NotAllowedInput,\n  request,\n  useContentManagerEditViewDataManager,\n  useQueryParams,\n} from 'strapi-helper-plugin';\nimport { Flex, Text, Padded } from '@buffetjs/core';\nimport { stringify } from 'qs';\nimport pluginId from '../../pluginId';\nimport SelectOne from '../SelectOne';\nimport SelectMany from '../SelectMany';\nimport ClearIndicator from './ClearIndicator';\nimport IndicatorSeparator from './IndicatorSeparator';\nimport Option from './Option';\nimport { A, BaselineAlignment } from './components';\nimport { connect, select, styles } from './utils';\n\nconst initialPaginationState = {\n  _contains: '',\n  _limit: 20,\n  _start: 0,\n};\n\nconst buildParams = (query, paramsToKeep) => {\n  if (!paramsToKeep) {\n    return {};\n  }\n\n  return paramsToKeep.reduce((acc, current) => {\n    const value = get(query, current, null);\n\n    if (value) {\n      set(acc, current, value);\n    }\n\n    return acc;\n  }, {});\n};\nfunction SelectWrapper({\n  description,\n  editable,\n  label,\n  labelIcon,\n  isCreatingEntry,\n  isFieldAllowed,\n  isFieldReadable,\n  mainField,\n  name,\n  relationType,\n  targetModel,\n  placeholder,\n  queryInfos,\n}) {\n  const { formatMessage } = useIntl();\n  const [{ query }] = useQueryParams();\n  // Disable the input in case of a polymorphic relation\n  const isMorph = useMemo(() => relationType.toLowerCase().includes('morph'), [relationType]);\n  const {\n    addRelation,\n    modifiedData,\n    moveRelation,\n    onChange,\n    onRemoveRelation,\n  } = useContentManagerEditViewDataManager();\n  const { pathname } = useLocation();\n\n  const value = get(modifiedData, name, null);\n  const [state, setState] = useState(initialPaginationState);\n  const [options, setOptions] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [isOpen, setIsOpen] = useState(false);\n\n  const filteredOptions = useMemo(() => {\n    return options.filter(option => {\n      if (!isEmpty(value)) {\n        // SelectMany\n        if (Array.isArray(value)) {\n          return findIndex(value, o => o.id === option.value.id) === -1;\n        }\n\n        // SelectOne\n        return get(value, 'id', '') !== option.value.id;\n      }\n\n      return true;\n    });\n  }, [options, value]);\n\n  const {\n    endPoint,\n    containsKey,\n    defaultParams,\n    shouldDisplayRelationLink,\n    paramsToKeep,\n  } = queryInfos;\n\n  const isSingle = ['oneWay', 'oneToOne', 'manyToOne', 'oneToManyMorph', 'oneToOneMorph'].includes(\n    relationType\n  );\n\n  const idsToOmit = useMemo(() => {\n    if (!value) {\n      return [];\n    }\n\n    if (isSingle) {\n      return [value.id];\n    }\n\n    return value.map(val => val.id);\n  }, [isSingle, value]);\n\n  const getData = useCallback(\n    async signal => {\n      // Currently polymorphic relations are not handled\n      if (isMorph) {\n        setIsLoading(false);\n\n        return;\n      }\n\n      if (!isFieldAllowed) {\n        setIsLoading(false);\n\n        return;\n      }\n\n      setIsLoading(true);\n\n      const params = { _limit: state._limit, ...defaultParams };\n\n      if (state._contains) {\n        params[containsKey] = state._contains;\n      }\n\n      try {\n        const data = await request(endPoint, {\n          method: 'POST',\n          params,\n          signal,\n          body: { idsToOmit },\n        });\n\n        const formattedData = data.map(obj => {\n          return { value: obj, label: obj[mainField.name] };\n        });\n\n        setOptions(prevState =>\n          prevState.concat(formattedData).filter((obj, index) => {\n            const objIndex = prevState.findIndex(el => el.value.id === obj.value.id);\n\n            if (objIndex === -1) {\n              return true;\n            }\n\n            return prevState.findIndex(el => el.value.id === obj.value.id) === index;\n          })\n        );\n        setIsLoading(false);\n      } catch (err) {\n        // Silent\n      }\n    },\n    [\n      isMorph,\n      isFieldAllowed,\n      state._limit,\n      state._contains,\n      defaultParams,\n      containsKey,\n      endPoint,\n      idsToOmit,\n      mainField.name,\n    ]\n  );\n\n  useEffect(() => {\n    const abortController = new AbortController();\n    const { signal } = abortController;\n\n    if (isOpen) {\n      getData(signal);\n    }\n\n    return () => abortController.abort();\n  }, [getData, isOpen]);\n\n  const handleInputChange = (inputValue, { action }) => {\n    if (action === 'input-change') {\n      setState(prevState => {\n        if (prevState._contains === inputValue) {\n          return prevState;\n        }\n\n        return { ...prevState, _contains: inputValue, _start: 0 };\n      });\n    }\n\n    return inputValue;\n  };\n\n  const handleMenuScrollToBottom = () => {\n    setState(prevState => ({ ...prevState, _limit: prevState._limit + 20 }));\n  };\n\n  const handleMenuClose = () => {\n    setState(initialPaginationState);\n    setIsOpen(false);\n  };\n\n  const handleChange = value => {\n    onChange({ target: { name, value: value ? value.value : value } });\n  };\n\n  const handleAddRelation = value => {\n    if (!isEmpty(value)) {\n      addRelation({ target: { name, value } });\n    }\n  };\n\n  const handleMenuOpen = () => {\n    setIsOpen(true);\n  };\n\n  const to = `/plugins/${pluginId}/collectionType/${targetModel}/${value ? value.id : null}`;\n\n  const searchToPersist = stringify(buildParams(query, paramsToKeep), { encode: false });\n\n  const link = useMemo(() => {\n    if (!value) {\n      return null;\n    }\n\n    if (!shouldDisplayRelationLink) {\n      return null;\n    }\n\n    return (\n      <Link to={{ pathname: to, state: { from: pathname }, search: searchToPersist }}>\n        <FormattedMessage id=\"content-manager.containers.Edit.seeDetails\">\n          {msg => <A color=\"mediumBlue\">{msg}</A>}\n        </FormattedMessage>\n      </Link>\n    );\n  }, [shouldDisplayRelationLink, pathname, to, value, searchToPersist]);\n\n  const Component = isSingle ? SelectOne : SelectMany;\n  const associationsLength = isArray(value) ? value.length : 0;\n\n  const isDisabled = useMemo(() => {\n    if (isMorph) {\n      return true;\n    }\n\n    if (!isCreatingEntry) {\n      return (!isFieldAllowed && isFieldReadable) || !editable;\n    }\n\n    return !editable;\n  }, [isMorph, isCreatingEntry, editable, isFieldAllowed, isFieldReadable]);\n\n  const labelIconformatted = labelIcon\n    ? { icon: labelIcon.icon, title: formatMessage(labelIcon.title) }\n    : labelIcon;\n\n  if (!isFieldAllowed && isCreatingEntry) {\n    return <NotAllowedInput label={label} labelIcon={labelIconformatted} />;\n  }\n\n  if (!isCreatingEntry && !isFieldAllowed && !isFieldReadable) {\n    return <NotAllowedInput label={label} labelIcon={labelIconformatted} />;\n  }\n\n  return (\n    <Padded>\n      <BaselineAlignment />\n      <Flex justifyContent=\"space-between\">\n        <Flex>\n          <Text fontWeight=\"semiBold\">\n            <span>\n              {label}\n              {!isSingle && ` (${associationsLength})`}\n            </span>\n          </Text>\n          {labelIconformatted && (\n            <div style={{ lineHeight: '13px' }}>\n              <LabelIconWrapper title={labelIconformatted.title}>\n                {labelIconformatted.icon}\n              </LabelIconWrapper>\n            </div>\n          )}\n        </Flex>\n        {isSingle && link}\n      </Flex>\n      {!isEmpty(description) && (\n        <Padded top size=\"xs\">\n          <BaselineAlignment />\n          <Text fontSize=\"sm\" color=\"grey\" lineHeight=\"12px\" ellipsis>\n            {description}\n          </Text>\n        </Padded>\n      )}\n      <Padded top size=\"sm\">\n        <BaselineAlignment />\n\n        <Component\n          addRelation={handleAddRelation}\n          components={{ ClearIndicator, DropdownIndicator, IndicatorSeparator, Option }}\n          displayNavigationLink={shouldDisplayRelationLink}\n          id={name}\n          isDisabled={isDisabled}\n          isLoading={isLoading}\n          isClearable\n          mainField={mainField}\n          move={moveRelation}\n          name={name}\n          options={filteredOptions}\n          onChange={handleChange}\n          onInputChange={handleInputChange}\n          onMenuClose={handleMenuClose}\n          onMenuOpen={handleMenuOpen}\n          onMenuScrollToBottom={handleMenuScrollToBottom}\n          onRemove={onRemoveRelation}\n          placeholder={\n            isEmpty(placeholder) ? (\n              <FormattedMessage id={`${pluginId}.containers.Edit.addAnItem`} />\n            ) : (\n              placeholder\n            )\n          }\n          searchToPersist={searchToPersist}\n          styles={styles}\n          targetModel={targetModel}\n          value={value}\n        />\n      </Padded>\n      <div style={{ marginBottom: 28 }} />\n    </Padded>\n  );\n}\n\nSelectWrapper.defaultProps = {\n  editable: true,\n  description: '',\n  label: '',\n  labelIcon: null,\n  isFieldAllowed: true,\n  placeholder: '',\n};\n\nSelectWrapper.propTypes = {\n  editable: PropTypes.bool,\n  description: PropTypes.string,\n  label: PropTypes.string,\n  labelIcon: PropTypes.shape({\n    icon: PropTypes.node.isRequired,\n    title: PropTypes.shape({\n      id: PropTypes.string.isRequired,\n      defaultMessage: PropTypes.string,\n    }),\n  }),\n  isCreatingEntry: PropTypes.bool.isRequired,\n  isFieldAllowed: PropTypes.bool,\n  isFieldReadable: PropTypes.bool.isRequired,\n  mainField: PropTypes.shape({\n    name: PropTypes.string.isRequired,\n    schema: PropTypes.shape({\n      type: PropTypes.string.isRequired,\n    }).isRequired,\n  }).isRequired,\n  name: PropTypes.string.isRequired,\n  placeholder: PropTypes.string,\n  relationType: PropTypes.string.isRequired,\n  targetModel: PropTypes.string.isRequired,\n  queryInfos: PropTypes.shape({\n    containsKey: PropTypes.string.isRequired,\n    defaultParams: PropTypes.object,\n    endPoint: PropTypes.string.isRequired,\n    shouldDisplayRelationLink: PropTypes.bool.isRequired,\n    paramsToKeep: PropTypes.array,\n  }).isRequired,\n};\n\nconst Memoized = memo(SelectWrapper);\n\nexport default connect(Memoized, select);\n"]},"metadata":{},"sourceType":"script"}