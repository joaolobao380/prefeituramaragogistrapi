{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _custom = require(\"@buffetjs/custom\");\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _hooks = require(\"../../hooks\");\n\nvar _PageTitle = _interopRequireDefault(require(\"../../components/PageTitle\"));\n\nvar _PluginCard = _interopRequireDefault(require(\"./PluginCard\"));\n\nvar _Wrapper = _interopRequireDefault(require(\"./Wrapper\"));\n\nvar MarketPlacePage = function MarketPlacePage() {\n  var history = (0, _reactRouterDom.useHistory)();\n\n  var _useGlobalContext = (0, _strapiHelperPlugin.useGlobalContext)(),\n      autoReload = _useGlobalContext.autoReload,\n      currentEnvironment = _useGlobalContext.currentEnvironment,\n      formatMessage = _useGlobalContext.formatMessage,\n      plugins = _useGlobalContext.plugins;\n\n  var _useFetchPluginsFromM = (0, _hooks.useFetchPluginsFromMarketPlace)(),\n      error = _useFetchPluginsFromM.error,\n      isLoading = _useFetchPluginsFromM.isLoading,\n      data = _useFetchPluginsFromM.data;\n\n  if (isLoading || error) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.LoadingIndicatorPage, null);\n  }\n\n  var handleDownloadPlugin = /*#__PURE__*/function () {\n    var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(pluginId) {\n      var overlayblockerParams, opts, response;\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              // Force the Overlayblocker to be displayed\n              overlayblockerParams = {\n                enabled: true,\n                title: 'app.components.InstallPluginPage.Download.title',\n                description: 'app.components.InstallPluginPage.Download.description'\n              }; // Lock the app\n\n              strapi.lockApp(overlayblockerParams);\n              _context.prev = 2;\n              opts = {\n                method: 'POST',\n                body: {\n                  plugin: pluginId,\n                  port: window.location.port\n                }\n              };\n              _context.next = 6;\n              return (0, _strapiHelperPlugin.request)('/admin/plugins/install', opts, overlayblockerParams);\n\n            case 6:\n              response = _context.sent;\n\n              if (response.ok) {\n                // Reload the app\n                window.location.reload();\n              }\n\n              _context.next = 14;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](2);\n              strapi.unlockApp();\n              strapi.notification.toggle({\n                type: 'warning',\n                message: {\n                  id: 'notification.error'\n                }\n              });\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 10]]);\n    }));\n\n    return function handleDownloadPlugin(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_react[\"default\"].createElement(\"div\", null, /*#__PURE__*/_react[\"default\"].createElement(_PageTitle[\"default\"], {\n    title: formatMessage({\n      id: 'app.components.InstallPluginPage.helmet'\n    })\n  }), /*#__PURE__*/_react[\"default\"].createElement(_Wrapper[\"default\"], null, /*#__PURE__*/_react[\"default\"].createElement(_custom.Header, {\n    title: {\n      label: formatMessage({\n        id: 'app.components.InstallPluginPage.title'\n      })\n    },\n    content: formatMessage({\n      id: 'app.components.InstallPluginPage.description'\n    })\n  }), /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    className: \"row\",\n    style: {\n      paddingTop: '4.1rem'\n    }\n  }, data.map(function (plugin) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_PluginCard[\"default\"], {\n      autoReload: autoReload,\n      currentEnvironment: currentEnvironment,\n      downloadPlugin: handleDownloadPlugin,\n      key: plugin.id,\n      history: history,\n      plugin: plugin,\n      showSupportUsButton: false,\n      isAlreadyInstalled: plugins[plugin.id] !== undefined\n    });\n  }))));\n};\n\nvar _default = MarketPlacePage;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/admin/src/containers/MarketplacePage/index.js"],"names":["MarketPlacePage","history","autoReload","currentEnvironment","formatMessage","plugins","error","isLoading","data","handleDownloadPlugin","pluginId","overlayblockerParams","enabled","title","description","strapi","lockApp","opts","method","body","plugin","port","window","location","response","ok","reload","unlockApp","notification","toggle","type","message","id","label","paddingTop","map","undefined"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { LoadingIndicatorPage, useGlobalContext, request } from 'strapi-helper-plugin';\nimport { Header } from '@buffetjs/custom';\nimport { useHistory } from 'react-router-dom';\n\nimport { useFetchPluginsFromMarketPlace } from '../../hooks';\nimport PageTitle from '../../components/PageTitle';\nimport PluginCard from './PluginCard';\nimport Wrapper from './Wrapper';\n\nconst MarketPlacePage = () => {\n  const history = useHistory();\n  const { autoReload, currentEnvironment, formatMessage, plugins } = useGlobalContext();\n  const { error, isLoading, data } = useFetchPluginsFromMarketPlace();\n\n  if (isLoading || error) {\n    return <LoadingIndicatorPage />;\n  }\n\n  const handleDownloadPlugin = async pluginId => {\n    // Force the Overlayblocker to be displayed\n    const overlayblockerParams = {\n      enabled: true,\n      title: 'app.components.InstallPluginPage.Download.title',\n      description: 'app.components.InstallPluginPage.Download.description',\n    };\n    // Lock the app\n    strapi.lockApp(overlayblockerParams);\n\n    try {\n      const opts = {\n        method: 'POST',\n        body: {\n          plugin: pluginId,\n          port: window.location.port,\n        },\n      };\n      const response = await request('/admin/plugins/install', opts, overlayblockerParams);\n\n      if (response.ok) {\n        // Reload the app\n        window.location.reload();\n      }\n    } catch (err) {\n      strapi.unlockApp();\n      strapi.notification.toggle({\n        type: 'warning',\n        message: { id: 'notification.error' },\n      });\n    }\n  };\n\n  return (\n    <div>\n      <PageTitle\n        title={formatMessage({\n          id: 'app.components.InstallPluginPage.helmet',\n        })}\n      />\n      <Wrapper>\n        <Header\n          title={{\n            label: formatMessage({\n              id: 'app.components.InstallPluginPage.title',\n            }),\n          }}\n          content={formatMessage({\n            id: 'app.components.InstallPluginPage.description',\n          })}\n        />\n        <div className=\"row\" style={{ paddingTop: '4.1rem' }}>\n          {data.map(plugin => {\n            return (\n              <PluginCard\n                autoReload={autoReload}\n                currentEnvironment={currentEnvironment}\n                downloadPlugin={handleDownloadPlugin}\n                key={plugin.id}\n                history={history}\n                plugin={plugin}\n                showSupportUsButton={false}\n                isAlreadyInstalled={plugins[plugin.id] !== undefined}\n              />\n            );\n          })}\n        </div>\n      </Wrapper>\n    </div>\n  );\n};\n\nexport default MarketPlacePage;\n"]},"metadata":{},"sourceType":"script"}