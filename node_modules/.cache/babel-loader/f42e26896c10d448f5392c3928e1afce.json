{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _taggedTemplateLiteral2 = _interopRequireDefault(require(\"@babel/runtime/helpers/taggedTemplateLiteral\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _Duration = _interopRequireDefault(require(\"../Duration\"));\n\nvar _LoadingIndicator = _interopRequireDefault(require(\"../LoadingIndicator\"));\n\nvar _PlayIcon = _interopRequireDefault(require(\"../PlayIcon\"));\n\nvar _Wrapper = _interopRequireDefault(require(\"./Wrapper\"));\n\nvar _CanvasWrapper = _interopRequireDefault(require(\"./CanvasWrapper\"));\n\nvar _Thumbnail = _interopRequireDefault(require(\"./Thumbnail\"));\n\nvar _reducer = _interopRequireWildcard(require(\"./reducer\"));\n\nvar _getTrad = _interopRequireDefault(require(\"../../utils/getTrad\"));\n\nvar _templateObject;\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar EmptyPreview = _styledComponents[\"default\"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  font-size: \", \";\\n  color: \", \";\\n\"])), function (_ref) {\n  var theme = _ref.theme;\n  return theme.main.sizes.fonts.xs;\n}, function (_ref2) {\n  var theme = _ref2.theme;\n  return theme.main.colors.grey;\n});\n\nvar VideoPreview = function VideoPreview(_ref3) {\n  var hasIcon = _ref3.hasIcon,\n      previewUrl = _ref3.previewUrl,\n      src = _ref3.src;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useReducer = (0, _react.useReducer)(_reducer[\"default\"], _reducer.initialState),\n      _useReducer2 = (0, _slicedToArray2[\"default\"])(_useReducer, 2),\n      reducerState = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var _reducerState$toJS = reducerState.toJS(),\n      duration = _reducerState$toJS.duration,\n      dataLoaded = _reducerState$toJS.dataLoaded,\n      isHover = _reducerState$toJS.isHover,\n      metadataLoaded = _reducerState$toJS.metadataLoaded,\n      snapshot = _reducerState$toJS.snapshot,\n      seeked = _reducerState$toJS.seeked,\n      isError = _reducerState$toJS.isError; // Adapted from https://github.com/brothatru/react-video-thumbnail/blob/master/src/components/VideoThumbnail.js\n  // And from https://github.com/soupette/poc-video-preview\n\n\n  var canvasRef = (0, _react.useRef)();\n  var videoRef = (0, _react.useRef)();\n  (0, _react.useEffect)(function () {\n    var getSnapshot = function getSnapshot() {\n      try {\n        var video = videoRef.current;\n        var canvas = canvasRef.current;\n        canvas.height = video.videoHeight;\n        canvas.width = video.videoWidth;\n        canvas.getContext('2d').drawImage(video, 0, 0);\n        var thumbnail = canvas.toDataURL('image/png');\n        video.src = ''; // setting to empty string stops video from loading\n\n        dispatch({\n          type: 'SET_SNAPSHOT',\n          snapshot: thumbnail\n        });\n      } catch (e) {\n        console.error(e);\n      }\n    };\n\n    if (dataLoaded && metadataLoaded && videoRef.current) {\n      videoRef.current.currentTime = 0;\n\n      if (seeked && !snapshot) {\n        getSnapshot();\n      }\n    }\n  }, [dataLoaded, metadataLoaded, seeked, snapshot]);\n\n  if (isError) {\n    return /*#__PURE__*/_react[\"default\"].createElement(EmptyPreview, null, /*#__PURE__*/_react[\"default\"].createElement(_reactIntl.FormattedMessage, {\n      id: (0, _getTrad[\"default\"])('list.assets.not-supported-content')\n    }));\n  }\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_Wrapper[\"default\"] // Specify isHover to prevent bad behavior when compo is under the cursor on modal open\n  , {\n    onMouseEnter: function onMouseEnter() {\n      dispatch({\n        type: 'SET_IS_HOVER',\n        isHover: true\n      });\n    },\n    onMouseLeave: function onMouseLeave() {\n      dispatch({\n        type: 'SET_IS_HOVER',\n        isHover: false\n      });\n    }\n  }, !snapshot && /*#__PURE__*/_react[\"default\"].createElement(_LoadingIndicator[\"default\"], {\n    \"aria-label\": formatMessage({\n      id: (0, _getTrad[\"default\"])('list.assets.loading-asset')\n    }, {\n      path: src\n    })\n  }), /*#__PURE__*/_react[\"default\"].createElement(_CanvasWrapper[\"default\"], null, previewUrl ? /*#__PURE__*/_react[\"default\"].createElement(_Thumbnail[\"default\"], {\n    src: previewUrl,\n    alt: formatMessage({\n      id: (0, _getTrad[\"default\"])('list.assets.preview-asset')\n    }, {\n      path: src\n    })\n  }) : /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(\"video\", {\n    muted: true,\n    ref: videoRef,\n    src: src,\n    onError: function onError() {\n      return dispatch({\n        type: 'SET_ERROR',\n        isError: true\n      });\n    },\n    onLoadedMetadata: function onLoadedMetadata() {\n      dispatch({\n        type: 'METADATA_LOADED'\n      });\n    },\n    onLoadedData: function onLoadedData(_ref4) {\n      var duration = _ref4.target.duration;\n      dispatch({\n        type: 'DATA_LOADED',\n        duration: duration\n      });\n    },\n    onSeeked: function onSeeked() {\n      dispatch({\n        type: 'SEEKED'\n      });\n    }\n  }), /*#__PURE__*/_react[\"default\"].createElement(\"canvas\", {\n    ref: canvasRef\n  })), /*#__PURE__*/_react[\"default\"].createElement(_Duration[\"default\"], {\n    duration: duration\n  }), (hasIcon || isHover) && /*#__PURE__*/_react[\"default\"].createElement(_PlayIcon[\"default\"], {\n    small: true\n  })));\n};\n\nVideoPreview.defaultProps = {\n  hasIcon: false,\n  previewUrl: null,\n  src: null\n};\nVideoPreview.propTypes = {\n  hasIcon: _propTypes[\"default\"].bool,\n  previewUrl: _propTypes[\"default\"].string,\n  src: _propTypes[\"default\"].string\n};\nvar _default = VideoPreview;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-upload/admin/src/components/VideoPreview/index.js"],"names":["EmptyPreview","styled","div","theme","main","sizes","fonts","xs","colors","grey","VideoPreview","hasIcon","previewUrl","src","formatMessage","reducer","initialState","reducerState","dispatch","toJS","duration","dataLoaded","isHover","metadataLoaded","snapshot","seeked","isError","canvasRef","videoRef","getSnapshot","video","current","canvas","height","videoHeight","width","videoWidth","getContext","drawImage","thumbnail","toDataURL","type","e","console","error","currentTime","id","path","target","defaultProps","propTypes","PropTypes","bool","string"],"mappings":"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","sourcesContent":["import React, { useEffect, useReducer, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport Duration from '../Duration';\nimport LoadingIndicator from '../LoadingIndicator';\nimport PlayIcon from '../PlayIcon';\nimport Wrapper from './Wrapper';\nimport CanvasWrapper from './CanvasWrapper';\nimport Thumbnail from './Thumbnail';\nimport reducer, { initialState } from './reducer';\nimport getTrad from '../../utils/getTrad';\n\nconst EmptyPreview = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: ${({ theme }) => theme.main.sizes.fonts.xs};\n  color: ${({ theme }) => theme.main.colors.grey};\n`;\n\nconst VideoPreview = ({ hasIcon, previewUrl, src }) => {\n  const { formatMessage } = useIntl();\n  const [reducerState, dispatch] = useReducer(reducer, initialState);\n  const {\n    duration,\n    dataLoaded,\n    isHover,\n    metadataLoaded,\n    snapshot,\n    seeked,\n    isError,\n  } = reducerState.toJS();\n\n  // Adapted from https://github.com/brothatru/react-video-thumbnail/blob/master/src/components/VideoThumbnail.js\n  // And from https://github.com/soupette/poc-video-preview\n  const canvasRef = useRef();\n  const videoRef = useRef();\n\n  useEffect(() => {\n    const getSnapshot = () => {\n      try {\n        const video = videoRef.current;\n        const canvas = canvasRef.current;\n\n        canvas.height = video.videoHeight;\n        canvas.width = video.videoWidth;\n        canvas.getContext('2d').drawImage(video, 0, 0);\n\n        const thumbnail = canvas.toDataURL('image/png');\n\n        video.src = ''; // setting to empty string stops video from loading\n\n        dispatch({\n          type: 'SET_SNAPSHOT',\n          snapshot: thumbnail,\n        });\n      } catch (e) {\n        console.error(e);\n      }\n    };\n\n    if (dataLoaded && metadataLoaded && videoRef.current) {\n      videoRef.current.currentTime = 0;\n\n      if (seeked && !snapshot) {\n        getSnapshot();\n      }\n    }\n  }, [dataLoaded, metadataLoaded, seeked, snapshot]);\n\n  if (isError) {\n    return (\n      <EmptyPreview>\n        <FormattedMessage id={getTrad('list.assets.not-supported-content')} />\n      </EmptyPreview>\n    );\n  }\n\n  return (\n    <Wrapper\n      // Specify isHover to prevent bad behavior when compo is under the cursor on modal open\n      onMouseEnter={() => {\n        dispatch({\n          type: 'SET_IS_HOVER',\n          isHover: true,\n        });\n      }}\n      onMouseLeave={() => {\n        dispatch({\n          type: 'SET_IS_HOVER',\n          isHover: false,\n        });\n      }}\n    >\n      {!snapshot && (\n        <LoadingIndicator\n          aria-label={formatMessage(\n            {\n              id: getTrad('list.assets.loading-asset'),\n            },\n            { path: src }\n          )}\n        />\n      )}\n\n      <CanvasWrapper>\n        {previewUrl ? (\n          <Thumbnail\n            src={previewUrl}\n            alt={formatMessage(\n              {\n                id: getTrad('list.assets.preview-asset'),\n              },\n              { path: src }\n            )}\n          />\n        ) : (\n          <>\n            <video\n              muted\n              ref={videoRef}\n              src={src}\n              onError={() => dispatch({ type: 'SET_ERROR', isError: true })}\n              onLoadedMetadata={() => {\n                dispatch({\n                  type: 'METADATA_LOADED',\n                });\n              }}\n              onLoadedData={({ target: { duration } }) => {\n                dispatch({\n                  type: 'DATA_LOADED',\n                  duration,\n                });\n              }}\n              onSeeked={() => {\n                dispatch({\n                  type: 'SEEKED',\n                });\n              }}\n            />\n            <canvas ref={canvasRef} />\n          </>\n        )}\n        <Duration duration={duration} />\n\n        {(hasIcon || isHover) && <PlayIcon small />}\n      </CanvasWrapper>\n    </Wrapper>\n  );\n};\n\nVideoPreview.defaultProps = {\n  hasIcon: false,\n  previewUrl: null,\n  src: null,\n};\n\nVideoPreview.propTypes = {\n  hasIcon: PropTypes.bool,\n  previewUrl: PropTypes.string,\n  src: PropTypes.string,\n};\n\nexport default VideoPreview;\n"]},"metadata":{},"sourceType":"script"}