{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _utils = require(\"../../utils\");\n\nvar _reducer = _interopRequireWildcard(require(\"./reducer\"));\n\nvar _utils2 = require(\"./utils\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar EditViewDataManagerProvider = function EditViewDataManagerProvider(_ref) {\n  var allLayoutData = _ref.allLayoutData,\n      _ref$allowedActions = _ref.allowedActions,\n      canRead = _ref$allowedActions.canRead,\n      canUpdate = _ref$allowedActions.canUpdate,\n      children = _ref.children,\n      componentsDataStructure = _ref.componentsDataStructure,\n      contentTypeDataStructure = _ref.contentTypeDataStructure,\n      createActionAllowedFields = _ref.createActionAllowedFields,\n      from = _ref.from,\n      initialValues = _ref.initialValues,\n      isCreatingEntry = _ref.isCreatingEntry,\n      isLoadingForData = _ref.isLoadingForData,\n      isSingleType = _ref.isSingleType,\n      onPost = _ref.onPost,\n      onPublish = _ref.onPublish,\n      onPut = _ref.onPut,\n      onUnpublish = _ref.onUnpublish,\n      readActionAllowedFields = _ref.readActionAllowedFields,\n      redirectToPreviousPage = _ref.redirectToPreviousPage,\n      slug = _ref.slug,\n      status = _ref.status,\n      updateActionAllowedFields = _ref.updateActionAllowedFields;\n\n  var _useReducer = (0, _react.useReducer)(_reducer[\"default\"], _reducer.initialState),\n      _useReducer2 = (0, _slicedToArray2[\"default\"])(_useReducer, 2),\n      reducerState = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var _reducerState$toJS = reducerState.toJS(),\n      formErrors = _reducerState$toJS.formErrors,\n      initialData = _reducerState$toJS.initialData,\n      modifiedData = _reducerState$toJS.modifiedData,\n      modifiedDZName = _reducerState$toJS.modifiedDZName,\n      shouldCheckErrors = _reducerState$toJS.shouldCheckErrors;\n\n  var currentContentTypeLayout = (0, _lodash.get)(allLayoutData, ['contentType'], {});\n  var hasDraftAndPublish = (0, _react.useMemo)(function () {\n    return (0, _lodash.get)(currentContentTypeLayout, ['options', 'draftAndPublish'], false);\n  }, [currentContentTypeLayout]);\n  var shouldNotRunValidations = (0, _react.useMemo)(function () {\n    return hasDraftAndPublish && !initialData.published_at;\n  }, [hasDraftAndPublish, initialData.published_at]);\n\n  var _useGlobalContext = (0, _strapiHelperPlugin.useGlobalContext)(),\n      emitEvent = _useGlobalContext.emitEvent,\n      formatMessage = _useGlobalContext.formatMessage;\n\n  var emitEventRef = (0, _react.useRef)(emitEvent);\n  var shouldRedirectToHomepageWhenEditingEntry = (0, _react.useMemo)(function () {\n    if (isLoadingForData) {\n      return false;\n    }\n\n    if (isCreatingEntry) {\n      return false;\n    }\n\n    if (canRead === false && canUpdate === false) {\n      return true;\n    }\n\n    return false;\n  }, [isLoadingForData, isCreatingEntry, canRead, canUpdate]); // TODO check this effect if it is really needed (not prio)\n\n  (0, _react.useEffect)(function () {\n    if (!isLoadingForData) {\n      checkFormErrors();\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [shouldCheckErrors]);\n  (0, _react.useEffect)(function () {\n    if (shouldRedirectToHomepageWhenEditingEntry) {\n      strapi.notification.info((0, _utils.getTrad)('permissions.not-allowed.update'));\n    }\n  }, [shouldRedirectToHomepageWhenEditingEntry]);\n  (0, _react.useEffect)(function () {\n    dispatch({\n      type: 'SET_DEFAULT_DATA_STRUCTURES',\n      componentsDataStructure: componentsDataStructure,\n      contentTypeDataStructure: contentTypeDataStructure\n    });\n  }, [componentsDataStructure, contentTypeDataStructure]);\n  (0, _react.useEffect)(function () {\n    dispatch({\n      type: 'INIT_FORM',\n      initialValues: initialValues\n    });\n  }, [initialValues]);\n  var addComponentToDynamicZone = (0, _react.useCallback)(function (keys, componentUid) {\n    var shouldCheckErrors = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    emitEventRef.current('didAddComponentToDynamicZone');\n    dispatch({\n      type: 'ADD_COMPONENT_TO_DYNAMIC_ZONE',\n      keys: keys.split('.'),\n      componentUid: componentUid,\n      shouldCheckErrors: shouldCheckErrors\n    });\n  }, []);\n  var addNonRepeatableComponentToField = (0, _react.useCallback)(function (keys, componentUid) {\n    dispatch({\n      type: 'ADD_NON_REPEATABLE_COMPONENT_TO_FIELD',\n      keys: keys.split('.'),\n      componentUid: componentUid\n    });\n  }, []);\n  var addRelation = (0, _react.useCallback)(function (_ref2) {\n    var _ref2$target = _ref2.target,\n        name = _ref2$target.name,\n        value = _ref2$target.value;\n    dispatch({\n      type: 'ADD_RELATION',\n      keys: name.split('.'),\n      value: value\n    });\n  }, []);\n  var addRepeatableComponentToField = (0, _react.useCallback)(function (keys, componentUid) {\n    var shouldCheckErrors = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    dispatch({\n      type: 'ADD_REPEATABLE_COMPONENT_TO_FIELD',\n      keys: keys.split('.'),\n      componentUid: componentUid,\n      shouldCheckErrors: shouldCheckErrors\n    });\n  }, []);\n  var yupSchema = (0, _react.useMemo)(function () {\n    var options = {\n      isCreatingEntry: isCreatingEntry,\n      isDraft: shouldNotRunValidations,\n      isFromComponent: false\n    };\n    return (0, _utils2.createYupSchema)(currentContentTypeLayout, {\n      components: allLayoutData.components || {}\n    }, options);\n  }, [allLayoutData.components, currentContentTypeLayout, isCreatingEntry, shouldNotRunValidations]);\n  var checkFormErrors = (0, _react.useCallback)( /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n    var dataToSet,\n        errors,\n        updatedData,\n        _args = arguments;\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            dataToSet = _args.length > 0 && _args[0] !== undefined ? _args[0] : {};\n            errors = {};\n            updatedData = (0, _lodash.cloneDeep)(modifiedData);\n\n            if (!(0, _lodash.isEmpty)(updatedData)) {\n              (0, _lodash.set)(updatedData, dataToSet.path, dataToSet.value);\n            }\n\n            _context.prev = 4;\n            _context.next = 7;\n            return yupSchema.validate(updatedData, {\n              abortEarly: false\n            });\n\n          case 7:\n            _context.next = 13;\n            break;\n\n          case 9:\n            _context.prev = 9;\n            _context.t0 = _context[\"catch\"](4);\n            errors = (0, _utils2.getYupInnerErrors)(_context.t0);\n\n            if (modifiedDZName) {\n              errors = Object.keys(errors).reduce(function (acc, current) {\n                var dzName = current.split('.')[0];\n\n                if (dzName !== modifiedDZName) {\n                  acc[current] = errors[current];\n                }\n\n                return acc;\n              }, {});\n            }\n\n          case 13:\n            dispatch({\n              type: 'SET_FORM_ERRORS',\n              errors: errors\n            });\n\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[4, 9]]);\n  })), [modifiedDZName, modifiedData, yupSchema]);\n  var handleChange = (0, _react.useCallback)(function (_ref4) {\n    var _ref4$target = _ref4.target,\n        name = _ref4$target.name,\n        value = _ref4$target.value,\n        type = _ref4$target.type;\n    var shouldSetInitialValue = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    var inputValue = value; // Empty string is not a valid date,\n    // Set the date to null when it's empty\n\n    if (type === 'date' && value === '') {\n      inputValue = null;\n    }\n\n    if (type === 'password' && !value) {\n      dispatch({\n        type: 'REMOVE_PASSWORD_FIELD',\n        keys: name.split('.')\n      });\n      return;\n    } // Allow to reset enum\n\n\n    if (type === 'select-one' && value === '') {\n      inputValue = null;\n    } // Allow to reset number input\n\n\n    if (type === 'number' && value === '') {\n      inputValue = null;\n    }\n\n    dispatch({\n      type: 'ON_CHANGE',\n      keys: name.split('.'),\n      value: inputValue,\n      shouldSetInitialValue: shouldSetInitialValue\n    });\n  }, []);\n  var createFormData = (0, _react.useCallback)(function (data) {\n    // First we need to remove the added keys needed for the dnd\n    var preparedData = (0, _utils.removeKeyInObject)((0, _lodash.cloneDeep)(data), '__temp_key__'); // Then we need to apply our helper\n\n    var cleanedData = (0, _utils2.cleanData)(preparedData, currentContentTypeLayout, allLayoutData.components);\n    return cleanedData;\n  }, [allLayoutData.components, currentContentTypeLayout]);\n  var trackerProperty = (0, _react.useMemo)(function () {\n    if (!hasDraftAndPublish) {\n      return {};\n    }\n\n    return shouldNotRunValidations ? {\n      status: 'draft'\n    } : {};\n  }, [hasDraftAndPublish, shouldNotRunValidations]);\n  var handleSubmit = (0, _react.useCallback)( /*#__PURE__*/function () {\n    var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(e) {\n      var errors, formData;\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              e.preventDefault();\n              errors = {}; // First validate the form\n\n              _context2.prev = 2;\n              _context2.next = 5;\n              return yupSchema.validate(modifiedData, {\n                abortEarly: false\n              });\n\n            case 5:\n              formData = createFormData(modifiedData);\n\n              if (isCreatingEntry) {\n                onPost(formData, trackerProperty);\n              } else {\n                onPut(formData, trackerProperty);\n              }\n\n              _context2.next = 14;\n              break;\n\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](2);\n              console.error('ValidationError');\n              console.error(_context2.t0);\n              errors = (0, _utils2.getYupInnerErrors)(_context2.t0);\n\n            case 14:\n              dispatch({\n                type: 'SET_FORM_ERRORS',\n                errors: errors\n              });\n\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[2, 9]]);\n    }));\n\n    return function (_x) {\n      return _ref5.apply(this, arguments);\n    };\n  }(), [createFormData, isCreatingEntry, modifiedData, onPost, onPut, trackerProperty, yupSchema]);\n  var handlePublish = (0, _react.useCallback)( /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3() {\n    var schema, errors;\n    return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            // Create yup schema here's we need to apply all the validations\n            schema = (0, _utils2.createYupSchema)(currentContentTypeLayout, {\n              components: (0, _lodash.get)(allLayoutData, 'components', {})\n            }, {\n              isCreatingEntry: isCreatingEntry,\n              isDraft: false,\n              isFromComponent: false\n            });\n            errors = {};\n            _context3.prev = 2;\n            _context3.next = 5;\n            return schema.validate(modifiedData, {\n              abortEarly: false\n            });\n\n          case 5:\n            onPublish();\n            _context3.next = 13;\n            break;\n\n          case 8:\n            _context3.prev = 8;\n            _context3.t0 = _context3[\"catch\"](2);\n            console.error('ValidationError');\n            console.error(_context3.t0);\n            errors = (0, _utils2.getYupInnerErrors)(_context3.t0);\n\n          case 13:\n            dispatch({\n              type: 'SET_FORM_ERRORS',\n              errors: errors\n            });\n\n          case 14:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, null, [[2, 8]]);\n  })), [allLayoutData, currentContentTypeLayout, isCreatingEntry, modifiedData, onPublish]);\n  var shouldCheckDZErrors = (0, _react.useCallback)(function (dzName) {\n    var doesDZHaveError = Object.keys(formErrors).some(function (key) {\n      return key.split('.')[0] === dzName;\n    });\n    var shouldCheckErrors = !(0, _lodash.isEmpty)(formErrors) && doesDZHaveError;\n    return shouldCheckErrors;\n  }, [formErrors]);\n  var moveComponentDown = (0, _react.useCallback)(function (dynamicZoneName, currentIndex) {\n    emitEventRef.current('changeComponentsOrder');\n    dispatch({\n      type: 'MOVE_COMPONENT_DOWN',\n      dynamicZoneName: dynamicZoneName,\n      currentIndex: currentIndex,\n      shouldCheckErrors: shouldCheckDZErrors(dynamicZoneName)\n    });\n  }, [shouldCheckDZErrors]);\n  var moveComponentUp = (0, _react.useCallback)(function (dynamicZoneName, currentIndex) {\n    emitEventRef.current('changeComponentsOrder');\n    dispatch({\n      type: 'MOVE_COMPONENT_UP',\n      dynamicZoneName: dynamicZoneName,\n      currentIndex: currentIndex,\n      shouldCheckErrors: shouldCheckDZErrors(dynamicZoneName)\n    });\n  }, [shouldCheckDZErrors]);\n  var moveComponentField = (0, _react.useCallback)(function (pathToComponent, dragIndex, hoverIndex) {\n    dispatch({\n      type: 'MOVE_COMPONENT_FIELD',\n      pathToComponent: pathToComponent,\n      dragIndex: dragIndex,\n      hoverIndex: hoverIndex\n    });\n  }, []);\n  var moveRelation = (0, _react.useCallback)(function (dragIndex, overIndex, name) {\n    dispatch({\n      type: 'MOVE_FIELD',\n      dragIndex: dragIndex,\n      overIndex: overIndex,\n      keys: name.split('.')\n    });\n  }, []);\n  var onRemoveRelation = (0, _react.useCallback)(function (keys) {\n    dispatch({\n      type: 'REMOVE_RELATION',\n      keys: keys\n    });\n  }, []);\n  var removeComponentFromDynamicZone = (0, _react.useCallback)(function (dynamicZoneName, index) {\n    emitEventRef.current('removeComponentFromDynamicZone');\n    dispatch({\n      type: 'REMOVE_COMPONENT_FROM_DYNAMIC_ZONE',\n      dynamicZoneName: dynamicZoneName,\n      index: index,\n      shouldCheckErrors: shouldCheckDZErrors(dynamicZoneName)\n    });\n  }, [shouldCheckDZErrors]);\n  var removeComponentFromField = (0, _react.useCallback)(function (keys, componentUid) {\n    dispatch({\n      type: 'REMOVE_COMPONENT_FROM_FIELD',\n      keys: keys.split('.'),\n      componentUid: componentUid\n    });\n  }, []);\n  var removeRepeatableField = (0, _react.useCallback)(function (keys, componentUid) {\n    dispatch({\n      type: 'REMOVE_REPEATABLE_FIELD',\n      keys: keys.split('.'),\n      componentUid: componentUid\n    });\n  }, []);\n  var triggerFormValidation = (0, _react.useCallback)(function () {\n    dispatch({\n      type: 'TRIGGER_FORM_VALIDATION'\n    });\n  }, []);\n  var overlayBlockerParams = (0, _react.useMemo)(function () {\n    return {\n      children: /*#__PURE__*/_react[\"default\"].createElement(\"div\", null),\n      noGradient: true\n    };\n  }, []); // Redirect the user to the previous page if he is not allowed to read/update a document\n\n  if (shouldRedirectToHomepageWhenEditingEntry) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Redirect, {\n      to: from\n    });\n  }\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.ContentManagerEditViewDataManagerContext.Provider, {\n    value: {\n      addComponentToDynamicZone: addComponentToDynamicZone,\n      addNonRepeatableComponentToField: addNonRepeatableComponentToField,\n      addRelation: addRelation,\n      addRepeatableComponentToField: addRepeatableComponentToField,\n      allLayoutData: allLayoutData,\n      checkFormErrors: checkFormErrors,\n      createActionAllowedFields: createActionAllowedFields,\n      formErrors: formErrors,\n      hasDraftAndPublish: hasDraftAndPublish,\n      initialData: initialData,\n      isCreatingEntry: isCreatingEntry,\n      isSingleType: isSingleType,\n      shouldNotRunValidations: shouldNotRunValidations,\n      status: status,\n      layout: currentContentTypeLayout,\n      modifiedData: modifiedData,\n      moveComponentDown: moveComponentDown,\n      moveComponentField: moveComponentField,\n      moveComponentUp: moveComponentUp,\n      moveRelation: moveRelation,\n      onChange: handleChange,\n      onPublish: handlePublish,\n      onUnpublish: onUnpublish,\n      onRemoveRelation: onRemoveRelation,\n      readActionAllowedFields: readActionAllowedFields,\n      redirectToPreviousPage: redirectToPreviousPage,\n      removeComponentFromDynamicZone: removeComponentFromDynamicZone,\n      removeComponentFromField: removeComponentFromField,\n      removeRepeatableField: removeRepeatableField,\n      slug: slug,\n      triggerFormValidation: triggerFormValidation,\n      updateActionAllowedFields: updateActionAllowedFields\n    }\n  }, /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.OverlayBlocker, (0, _extends2[\"default\"])({\n    key: \"overlayBlocker\",\n    isOpen: status !== 'resolved'\n  }, overlayBlockerParams)), isLoadingForData ? /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.LoadingIndicatorPage, null) : /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(_reactRouterDom.Prompt, {\n    when: !(0, _lodash.isEqual)(modifiedData, initialData),\n    message: formatMessage({\n      id: 'global.prompt.unsaved'\n    })\n  }), /*#__PURE__*/_react[\"default\"].createElement(\"form\", {\n    onSubmit: handleSubmit\n  }, children))));\n};\n\nEditViewDataManagerProvider.defaultProps = {\n  from: '/',\n  redirectToPreviousPage: function redirectToPreviousPage() {}\n};\nEditViewDataManagerProvider.propTypes = {\n  allLayoutData: _propTypes[\"default\"].object.isRequired,\n  allowedActions: _propTypes[\"default\"].object.isRequired,\n  children: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].element).isRequired,\n  componentsDataStructure: _propTypes[\"default\"].object.isRequired,\n  contentTypeDataStructure: _propTypes[\"default\"].object.isRequired,\n  createActionAllowedFields: _propTypes[\"default\"].array.isRequired,\n  from: _propTypes[\"default\"].string,\n  initialValues: _propTypes[\"default\"].object.isRequired,\n  isCreatingEntry: _propTypes[\"default\"].bool.isRequired,\n  isLoadingForData: _propTypes[\"default\"].bool.isRequired,\n  isSingleType: _propTypes[\"default\"].bool.isRequired,\n  onPost: _propTypes[\"default\"].func.isRequired,\n  onPublish: _propTypes[\"default\"].func.isRequired,\n  onPut: _propTypes[\"default\"].func.isRequired,\n  onUnpublish: _propTypes[\"default\"].func.isRequired,\n  readActionAllowedFields: _propTypes[\"default\"].array.isRequired,\n  redirectToPreviousPage: _propTypes[\"default\"].func,\n  slug: _propTypes[\"default\"].string.isRequired,\n  status: _propTypes[\"default\"].string.isRequired,\n  updateActionAllowedFields: _propTypes[\"default\"].array.isRequired\n};\nvar _default = EditViewDataManagerProvider;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-content-manager/admin/src/containers/EditViewDataManagerProvider/index.js"],"names":["EditViewDataManagerProvider","allLayoutData","allowedActions","canRead","canUpdate","children","componentsDataStructure","contentTypeDataStructure","createActionAllowedFields","from","initialValues","isCreatingEntry","isLoadingForData","isSingleType","onPost","onPublish","onPut","onUnpublish","readActionAllowedFields","redirectToPreviousPage","slug","status","updateActionAllowedFields","reducer","initialState","reducerState","dispatch","toJS","formErrors","initialData","modifiedData","modifiedDZName","shouldCheckErrors","currentContentTypeLayout","hasDraftAndPublish","shouldNotRunValidations","published_at","emitEvent","formatMessage","emitEventRef","shouldRedirectToHomepageWhenEditingEntry","checkFormErrors","strapi","notification","info","type","addComponentToDynamicZone","keys","componentUid","current","split","addNonRepeatableComponentToField","addRelation","target","name","value","addRepeatableComponentToField","yupSchema","options","isDraft","isFromComponent","components","dataToSet","errors","updatedData","path","validate","abortEarly","Object","reduce","acc","dzName","handleChange","shouldSetInitialValue","inputValue","createFormData","data","preparedData","cleanedData","trackerProperty","handleSubmit","e","preventDefault","formData","console","error","handlePublish","schema","shouldCheckDZErrors","doesDZHaveError","some","key","moveComponentDown","dynamicZoneName","currentIndex","moveComponentUp","moveComponentField","pathToComponent","dragIndex","hoverIndex","moveRelation","overIndex","onRemoveRelation","removeComponentFromDynamicZone","index","removeComponentFromField","removeRepeatableField","triggerFormValidation","overlayBlockerParams","noGradient","layout","onChange","id","defaultProps","propTypes","PropTypes","object","isRequired","arrayOf","element","array","string","bool","func"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useReducer } from 'react';\nimport { cloneDeep, get, isEmpty, isEqual, set } from 'lodash';\nimport PropTypes from 'prop-types';\nimport { Prompt, Redirect } from 'react-router-dom';\nimport {\n  LoadingIndicatorPage,\n  useGlobalContext,\n  OverlayBlocker,\n  ContentManagerEditViewDataManagerContext,\n} from 'strapi-helper-plugin';\nimport { getTrad, removeKeyInObject } from '../../utils';\nimport reducer, { initialState } from './reducer';\nimport { cleanData, createYupSchema, getYupInnerErrors } from './utils';\n\nconst EditViewDataManagerProvider = ({\n  allLayoutData,\n  allowedActions: { canRead, canUpdate },\n  children,\n  componentsDataStructure,\n  contentTypeDataStructure,\n  createActionAllowedFields,\n  from,\n  initialValues,\n  isCreatingEntry,\n  isLoadingForData,\n  isSingleType,\n  onPost,\n  onPublish,\n  onPut,\n  onUnpublish,\n  readActionAllowedFields,\n  // Not sure this is needed anymore\n  redirectToPreviousPage,\n  slug,\n  status,\n  updateActionAllowedFields,\n}) => {\n  const [reducerState, dispatch] = useReducer(reducer, initialState);\n  const {\n    formErrors,\n    initialData,\n    modifiedData,\n    modifiedDZName,\n    shouldCheckErrors,\n  } = reducerState.toJS();\n\n  const currentContentTypeLayout = get(allLayoutData, ['contentType'], {});\n\n  const hasDraftAndPublish = useMemo(() => {\n    return get(currentContentTypeLayout, ['options', 'draftAndPublish'], false);\n  }, [currentContentTypeLayout]);\n\n  const shouldNotRunValidations = useMemo(() => {\n    return hasDraftAndPublish && !initialData.published_at;\n  }, [hasDraftAndPublish, initialData.published_at]);\n\n  const { emitEvent, formatMessage } = useGlobalContext();\n  const emitEventRef = useRef(emitEvent);\n\n  const shouldRedirectToHomepageWhenEditingEntry = useMemo(() => {\n    if (isLoadingForData) {\n      return false;\n    }\n\n    if (isCreatingEntry) {\n      return false;\n    }\n\n    if (canRead === false && canUpdate === false) {\n      return true;\n    }\n\n    return false;\n  }, [isLoadingForData, isCreatingEntry, canRead, canUpdate]);\n\n  // TODO check this effect if it is really needed (not prio)\n  useEffect(() => {\n    if (!isLoadingForData) {\n      checkFormErrors();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [shouldCheckErrors]);\n\n  useEffect(() => {\n    if (shouldRedirectToHomepageWhenEditingEntry) {\n      strapi.notification.info(getTrad('permissions.not-allowed.update'));\n    }\n  }, [shouldRedirectToHomepageWhenEditingEntry]);\n\n  useEffect(() => {\n    dispatch({\n      type: 'SET_DEFAULT_DATA_STRUCTURES',\n      componentsDataStructure,\n      contentTypeDataStructure,\n    });\n  }, [componentsDataStructure, contentTypeDataStructure]);\n\n  useEffect(() => {\n    dispatch({\n      type: 'INIT_FORM',\n      initialValues,\n    });\n  }, [initialValues]);\n\n  const addComponentToDynamicZone = useCallback((keys, componentUid, shouldCheckErrors = false) => {\n    emitEventRef.current('didAddComponentToDynamicZone');\n\n    dispatch({\n      type: 'ADD_COMPONENT_TO_DYNAMIC_ZONE',\n      keys: keys.split('.'),\n      componentUid,\n      shouldCheckErrors,\n    });\n  }, []);\n\n  const addNonRepeatableComponentToField = useCallback((keys, componentUid) => {\n    dispatch({\n      type: 'ADD_NON_REPEATABLE_COMPONENT_TO_FIELD',\n      keys: keys.split('.'),\n      componentUid,\n    });\n  }, []);\n\n  const addRelation = useCallback(({ target: { name, value } }) => {\n    dispatch({\n      type: 'ADD_RELATION',\n      keys: name.split('.'),\n      value,\n    });\n  }, []);\n\n  const addRepeatableComponentToField = useCallback(\n    (keys, componentUid, shouldCheckErrors = false) => {\n      dispatch({\n        type: 'ADD_REPEATABLE_COMPONENT_TO_FIELD',\n        keys: keys.split('.'),\n        componentUid,\n        shouldCheckErrors,\n      });\n    },\n    []\n  );\n\n  const yupSchema = useMemo(() => {\n    const options = { isCreatingEntry, isDraft: shouldNotRunValidations, isFromComponent: false };\n\n    return createYupSchema(\n      currentContentTypeLayout,\n      {\n        components: allLayoutData.components || {},\n      },\n      options\n    );\n  }, [\n    allLayoutData.components,\n    currentContentTypeLayout,\n    isCreatingEntry,\n    shouldNotRunValidations,\n  ]);\n\n  const checkFormErrors = useCallback(\n    async (dataToSet = {}) => {\n      let errors = {};\n      const updatedData = cloneDeep(modifiedData);\n\n      if (!isEmpty(updatedData)) {\n        set(updatedData, dataToSet.path, dataToSet.value);\n      }\n\n      try {\n        // Validate the form using yup\n        await yupSchema.validate(updatedData, { abortEarly: false });\n      } catch (err) {\n        errors = getYupInnerErrors(err);\n\n        if (modifiedDZName) {\n          errors = Object.keys(errors).reduce((acc, current) => {\n            const dzName = current.split('.')[0];\n\n            if (dzName !== modifiedDZName) {\n              acc[current] = errors[current];\n            }\n\n            return acc;\n          }, {});\n        }\n      }\n\n      dispatch({\n        type: 'SET_FORM_ERRORS',\n        errors,\n      });\n    },\n    [modifiedDZName, modifiedData, yupSchema]\n  );\n\n  const handleChange = useCallback(\n    ({ target: { name, value, type } }, shouldSetInitialValue = false) => {\n      let inputValue = value;\n\n      // Empty string is not a valid date,\n      // Set the date to null when it's empty\n      if (type === 'date' && value === '') {\n        inputValue = null;\n      }\n\n      if (type === 'password' && !value) {\n        dispatch({\n          type: 'REMOVE_PASSWORD_FIELD',\n          keys: name.split('.'),\n        });\n\n        return;\n      }\n\n      // Allow to reset enum\n      if (type === 'select-one' && value === '') {\n        inputValue = null;\n      }\n\n      // Allow to reset number input\n      if (type === 'number' && value === '') {\n        inputValue = null;\n      }\n\n      dispatch({\n        type: 'ON_CHANGE',\n        keys: name.split('.'),\n        value: inputValue,\n        shouldSetInitialValue,\n      });\n    },\n    []\n  );\n\n  const createFormData = useCallback(\n    data => {\n      // First we need to remove the added keys needed for the dnd\n      const preparedData = removeKeyInObject(cloneDeep(data), '__temp_key__');\n      // Then we need to apply our helper\n      const cleanedData = cleanData(\n        preparedData,\n        currentContentTypeLayout,\n        allLayoutData.components\n      );\n\n      return cleanedData;\n    },\n    [allLayoutData.components, currentContentTypeLayout]\n  );\n\n  const trackerProperty = useMemo(() => {\n    if (!hasDraftAndPublish) {\n      return {};\n    }\n\n    return shouldNotRunValidations ? { status: 'draft' } : {};\n  }, [hasDraftAndPublish, shouldNotRunValidations]);\n\n  const handleSubmit = useCallback(\n    async e => {\n      e.preventDefault();\n      let errors = {};\n\n      // First validate the form\n      try {\n        await yupSchema.validate(modifiedData, { abortEarly: false });\n\n        const formData = createFormData(modifiedData);\n\n        if (isCreatingEntry) {\n          onPost(formData, trackerProperty);\n        } else {\n          onPut(formData, trackerProperty);\n        }\n      } catch (err) {\n        console.error('ValidationError');\n        console.error(err);\n\n        errors = getYupInnerErrors(err);\n      }\n\n      dispatch({\n        type: 'SET_FORM_ERRORS',\n        errors,\n      });\n    },\n    [createFormData, isCreatingEntry, modifiedData, onPost, onPut, trackerProperty, yupSchema]\n  );\n\n  const handlePublish = useCallback(async () => {\n    // Create yup schema here's we need to apply all the validations\n    const schema = createYupSchema(\n      currentContentTypeLayout,\n      {\n        components: get(allLayoutData, 'components', {}),\n      },\n      { isCreatingEntry, isDraft: false, isFromComponent: false }\n    );\n    let errors = {};\n\n    try {\n      // Validate the form using yup\n      await schema.validate(modifiedData, { abortEarly: false });\n\n      onPublish();\n    } catch (err) {\n      console.error('ValidationError');\n      console.error(err);\n\n      errors = getYupInnerErrors(err);\n    }\n\n    dispatch({\n      type: 'SET_FORM_ERRORS',\n      errors,\n    });\n  }, [allLayoutData, currentContentTypeLayout, isCreatingEntry, modifiedData, onPublish]);\n\n  const shouldCheckDZErrors = useCallback(\n    dzName => {\n      const doesDZHaveError = Object.keys(formErrors).some(key => key.split('.')[0] === dzName);\n      const shouldCheckErrors = !isEmpty(formErrors) && doesDZHaveError;\n\n      return shouldCheckErrors;\n    },\n    [formErrors]\n  );\n\n  const moveComponentDown = useCallback(\n    (dynamicZoneName, currentIndex) => {\n      emitEventRef.current('changeComponentsOrder');\n\n      dispatch({\n        type: 'MOVE_COMPONENT_DOWN',\n        dynamicZoneName,\n        currentIndex,\n        shouldCheckErrors: shouldCheckDZErrors(dynamicZoneName),\n      });\n    },\n    [shouldCheckDZErrors]\n  );\n\n  const moveComponentUp = useCallback(\n    (dynamicZoneName, currentIndex) => {\n      emitEventRef.current('changeComponentsOrder');\n\n      dispatch({\n        type: 'MOVE_COMPONENT_UP',\n        dynamicZoneName,\n        currentIndex,\n        shouldCheckErrors: shouldCheckDZErrors(dynamicZoneName),\n      });\n    },\n    [shouldCheckDZErrors]\n  );\n\n  const moveComponentField = useCallback((pathToComponent, dragIndex, hoverIndex) => {\n    dispatch({\n      type: 'MOVE_COMPONENT_FIELD',\n      pathToComponent,\n      dragIndex,\n      hoverIndex,\n    });\n  }, []);\n\n  const moveRelation = useCallback((dragIndex, overIndex, name) => {\n    dispatch({\n      type: 'MOVE_FIELD',\n      dragIndex,\n      overIndex,\n      keys: name.split('.'),\n    });\n  }, []);\n\n  const onRemoveRelation = useCallback(keys => {\n    dispatch({\n      type: 'REMOVE_RELATION',\n      keys,\n    });\n  }, []);\n\n  const removeComponentFromDynamicZone = useCallback(\n    (dynamicZoneName, index) => {\n      emitEventRef.current('removeComponentFromDynamicZone');\n\n      dispatch({\n        type: 'REMOVE_COMPONENT_FROM_DYNAMIC_ZONE',\n        dynamicZoneName,\n        index,\n        shouldCheckErrors: shouldCheckDZErrors(dynamicZoneName),\n      });\n    },\n    [shouldCheckDZErrors]\n  );\n\n  const removeComponentFromField = useCallback((keys, componentUid) => {\n    dispatch({\n      type: 'REMOVE_COMPONENT_FROM_FIELD',\n      keys: keys.split('.'),\n      componentUid,\n    });\n  }, []);\n\n  const removeRepeatableField = useCallback((keys, componentUid) => {\n    dispatch({\n      type: 'REMOVE_REPEATABLE_FIELD',\n      keys: keys.split('.'),\n      componentUid,\n    });\n  }, []);\n\n  const triggerFormValidation = useCallback(() => {\n    dispatch({\n      type: 'TRIGGER_FORM_VALIDATION',\n    });\n  }, []);\n\n  const overlayBlockerParams = useMemo(\n    () => ({\n      children: <div />,\n      noGradient: true,\n    }),\n    []\n  );\n\n  // Redirect the user to the previous page if he is not allowed to read/update a document\n  if (shouldRedirectToHomepageWhenEditingEntry) {\n    return <Redirect to={from} />;\n  }\n\n  return (\n    <ContentManagerEditViewDataManagerContext.Provider\n      value={{\n        addComponentToDynamicZone,\n        addNonRepeatableComponentToField,\n        addRelation,\n        addRepeatableComponentToField,\n        allLayoutData,\n        checkFormErrors,\n        createActionAllowedFields,\n        formErrors,\n        hasDraftAndPublish,\n        initialData,\n        isCreatingEntry,\n        isSingleType,\n        shouldNotRunValidations,\n        status,\n        layout: currentContentTypeLayout,\n        modifiedData,\n        moveComponentDown,\n        moveComponentField,\n        moveComponentUp,\n        moveRelation,\n        onChange: handleChange,\n        onPublish: handlePublish,\n        onUnpublish,\n        onRemoveRelation,\n        readActionAllowedFields,\n        redirectToPreviousPage,\n        removeComponentFromDynamicZone,\n        removeComponentFromField,\n        removeRepeatableField,\n        slug,\n        triggerFormValidation,\n        updateActionAllowedFields,\n      }}\n    >\n      <>\n        <OverlayBlocker\n          key=\"overlayBlocker\"\n          isOpen={status !== 'resolved'}\n          {...overlayBlockerParams}\n        />\n        {isLoadingForData ? (\n          <LoadingIndicatorPage />\n        ) : (\n          <>\n            <Prompt\n              when={!isEqual(modifiedData, initialData)}\n              message={formatMessage({ id: 'global.prompt.unsaved' })}\n            />\n            <form onSubmit={handleSubmit}>{children}</form>\n          </>\n        )}\n      </>\n    </ContentManagerEditViewDataManagerContext.Provider>\n  );\n};\n\nEditViewDataManagerProvider.defaultProps = {\n  from: '/',\n  redirectToPreviousPage: () => {},\n};\n\nEditViewDataManagerProvider.propTypes = {\n  allLayoutData: PropTypes.object.isRequired,\n  allowedActions: PropTypes.object.isRequired,\n  children: PropTypes.arrayOf(PropTypes.element).isRequired,\n  componentsDataStructure: PropTypes.object.isRequired,\n  contentTypeDataStructure: PropTypes.object.isRequired,\n  createActionAllowedFields: PropTypes.array.isRequired,\n  from: PropTypes.string,\n  initialValues: PropTypes.object.isRequired,\n  isCreatingEntry: PropTypes.bool.isRequired,\n  isLoadingForData: PropTypes.bool.isRequired,\n  isSingleType: PropTypes.bool.isRequired,\n  onPost: PropTypes.func.isRequired,\n  onPublish: PropTypes.func.isRequired,\n  onPut: PropTypes.func.isRequired,\n  onUnpublish: PropTypes.func.isRequired,\n  readActionAllowedFields: PropTypes.array.isRequired,\n  redirectToPreviousPage: PropTypes.func,\n  slug: PropTypes.string.isRequired,\n  status: PropTypes.string.isRequired,\n  updateActionAllowedFields: PropTypes.array.isRequired,\n};\n\nexport default EditViewDataManagerProvider;\n"]},"metadata":{},"sourceType":"script"}