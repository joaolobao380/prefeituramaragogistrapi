{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _custom = require(\"@buffetjs/custom\");\n\nvar _lodash = require(\"lodash\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _permissions = _interopRequireDefault(require(\"../../permissions\"));\n\nvar _utils = require(\"../../utils\");\n\nvar _ListBaselineAlignment = _interopRequireDefault(require(\"../../components/ListBaselineAlignment\"));\n\nvar _form = _interopRequireDefault(require(\"./utils/form\"));\n\nvar _reducer = _interopRequireWildcard(require(\"./reducer\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar AdvancedSettingsPage = function AdvancedSettingsPage() {\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      showModalWarning = _useState2[0],\n      setShowModalWarning = _useState2[1];\n\n  var pageTitle = formatMessage({\n    id: (0, _utils.getTrad)('HeaderNav.link.advancedSettings')\n  });\n  var updatePermissions = (0, _react.useMemo)(function () {\n    return {\n      update: _permissions[\"default\"].updateAdvancedSettings\n    };\n  }, []);\n\n  var _useUserPermissions = (0, _strapiHelperPlugin.useUserPermissions)(updatePermissions),\n      isLoadingForPermissions = _useUserPermissions.isLoading,\n      canUpdate = _useUserPermissions.allowedActions.canUpdate;\n\n  var _useReducer = (0, _react.useReducer)(_reducer[\"default\"], _reducer.initialState),\n      _useReducer2 = (0, _slicedToArray2[\"default\"])(_useReducer, 2),\n      _useReducer2$ = _useReducer2[0],\n      initialData = _useReducer2$.initialData,\n      isConfirmButtonLoading = _useReducer2$.isConfirmButtonLoading,\n      isLoading = _useReducer2$.isLoading,\n      modifiedData = _useReducer2$.modifiedData,\n      roles = _useReducer2$.roles,\n      dispatch = _useReducer2[1];\n\n  var isMounted = (0, _react.useRef)(true);\n  var abortController = new AbortController();\n  var signal = abortController.signal;\n  (0, _react.useEffect)(function () {\n    var getData = /*#__PURE__*/function () {\n      var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n        var data;\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                dispatch({\n                  type: 'GET_DATA'\n                });\n                _context.next = 4;\n                return (0, _strapiHelperPlugin.request)((0, _utils.getRequestURL)('advanced'), {\n                  method: 'GET',\n                  signal: signal\n                });\n\n              case 4:\n                data = _context.sent;\n                dispatch({\n                  type: 'GET_DATA_SUCCEEDED',\n                  data: data\n                });\n                _context.next = 11;\n                break;\n\n              case 8:\n                _context.prev = 8;\n                _context.t0 = _context[\"catch\"](0);\n\n                if (isMounted.current) {\n                  dispatch({\n                    type: 'GET_DATA_ERROR'\n                  });\n                  console.error(_context.t0);\n                  strapi.notification.toggle({\n                    type: 'warning',\n                    message: {\n                      id: 'notification.error'\n                    }\n                  });\n                }\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 8]]);\n      }));\n\n      return function getData() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    if (!isLoadingForPermissions) {\n      getData();\n    }\n\n    return function () {\n      abortController.abort();\n      isMounted.current = false;\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isLoadingForPermissions]);\n  var handleChange = (0, _react.useCallback)(function (_ref2) {\n    var target = _ref2.target;\n    dispatch({\n      type: 'ON_CHANGE',\n      keys: target.name,\n      value: target.value\n    });\n  }, []);\n  var handleSubmit = (0, _react.useCallback)( /*#__PURE__*/function () {\n    var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(e) {\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              e.preventDefault();\n              _context2.prev = 1;\n              dispatch({\n                type: 'ON_SUBMIT'\n              });\n              strapi.lockAppWithOverlay();\n              _context2.next = 6;\n              return (0, _strapiHelperPlugin.request)((0, _utils.getRequestURL)('advanced'), {\n                method: 'PUT',\n                body: modifiedData\n              });\n\n            case 6:\n              dispatch({\n                type: 'ON_SUBMIT_SUCCEEDED'\n              });\n              strapi.notification.toggle({\n                type: 'success',\n                message: {\n                  id: (0, _utils.getTrad)('notification.success.submit')\n                }\n              });\n              _context2.next = 15;\n              break;\n\n            case 10:\n              _context2.prev = 10;\n              _context2.t0 = _context2[\"catch\"](1);\n              dispatch({\n                type: 'ON_SUBMIT_ERROR'\n              });\n              console.error(_context2.t0);\n              strapi.notification.toggle({\n                type: 'warning',\n                message: {\n                  id: 'notification.error'\n                }\n              });\n\n            case 15:\n              strapi.unlockApp();\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 10]]);\n    }));\n\n    return function (_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }(), [modifiedData]);\n  var handleConfirmReset = (0, _react.useCallback)(function () {\n    dispatch({\n      type: 'ON_RESET'\n    });\n    setShowModalWarning(false);\n  }, []);\n  var handleToggleModal = (0, _react.useCallback)(function () {\n    setShowModalWarning(function (prev) {\n      return !prev;\n    });\n  }, []);\n  var headerActions = (0, _react.useMemo)(function () {\n    var isDisabled = (0, _lodash.isEqual)(initialData, modifiedData);\n    return [{\n      disabled: isDisabled,\n      onClick: function onClick() {\n        handleToggleModal();\n      },\n      color: 'cancel',\n      label: formatMessage({\n        id: 'app.components.Button.reset'\n      }),\n      type: 'button',\n      style: {\n        paddingLeft: 15,\n        paddingRight: 15,\n        fontWeight: 600\n      }\n    }, {\n      disabled: isDisabled,\n      color: 'success',\n      label: formatMessage({\n        id: 'app.components.Button.save'\n      }),\n      isLoading: isConfirmButtonLoading,\n      type: 'submit',\n      style: {\n        minWidth: 150,\n        fontWeight: 600\n      }\n    }];\n  }, [initialData, isConfirmButtonLoading, modifiedData, formatMessage, handleToggleModal]);\n  var showLoader = isLoadingForPermissions || isLoading;\n  return /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.SettingsPageTitle, {\n    name: pageTitle\n  }), /*#__PURE__*/_react[\"default\"].createElement(\"div\", null, /*#__PURE__*/_react[\"default\"].createElement(\"form\", {\n    onSubmit: handleSubmit\n  }, /*#__PURE__*/_react[\"default\"].createElement(_custom.Header, {\n    actions: headerActions,\n    title: {\n      label: pageTitle\n    },\n    isLoading: showLoader\n  }), /*#__PURE__*/_react[\"default\"].createElement(_ListBaselineAlignment[\"default\"], null), /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.FormBloc, {\n    title: \"Settings\",\n    isLoading: showLoader\n  }, _form[\"default\"].map(function (input) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.SizedInput, (0, _extends2[\"default\"])({\n      key: input.name\n    }, input, {\n      disabled: !canUpdate,\n      onChange: handleChange,\n      options: roles,\n      value: modifiedData[input.name]\n    }));\n  })))), /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.PopUpWarning, {\n    isOpen: showModalWarning,\n    toggleModal: handleToggleModal,\n    content: {\n      title: (0, _utils.getTrad)('popUpWarning.title'),\n      message: (0, _utils.getTrad)('popUpWarning.warning.cancel'),\n      cancel: (0, _utils.getTrad)('popUpWarning.button.cancel'),\n      confirm: (0, _utils.getTrad)('popUpWarning.button.confirm')\n    },\n    popUpWarningType: \"danger\",\n    onConfirm: handleConfirmReset\n  }));\n};\n\nvar _default = AdvancedSettingsPage;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-users-permissions/admin/src/containers/AdvancedSettings/index.js"],"names":["AdvancedSettingsPage","formatMessage","showModalWarning","setShowModalWarning","pageTitle","id","updatePermissions","update","pluginPermissions","updateAdvancedSettings","isLoadingForPermissions","isLoading","canUpdate","allowedActions","reducer","initialState","initialData","isConfirmButtonLoading","modifiedData","roles","dispatch","isMounted","abortController","AbortController","signal","getData","type","method","data","current","console","error","strapi","notification","toggle","message","abort","handleChange","target","keys","name","value","handleSubmit","e","preventDefault","lockAppWithOverlay","body","unlockApp","handleConfirmReset","handleToggleModal","prev","headerActions","isDisabled","disabled","onClick","color","label","style","paddingLeft","paddingRight","fontWeight","minWidth","showLoader","form","map","input","title","cancel","confirm"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useMemo, useReducer, useRef, useState } from 'react';\nimport { useIntl } from 'react-intl';\nimport { Header } from '@buffetjs/custom';\nimport { isEqual } from 'lodash';\nimport {\n  FormBloc,\n  PopUpWarning,\n  SettingsPageTitle,\n  SizedInput,\n  useUserPermissions,\n  request,\n} from 'strapi-helper-plugin';\nimport pluginPermissions from '../../permissions';\nimport { getTrad, getRequestURL } from '../../utils';\nimport ListBaselineAlignment from '../../components/ListBaselineAlignment';\nimport form from './utils/form';\nimport reducer, { initialState } from './reducer';\n\nconst AdvancedSettingsPage = () => {\n  const { formatMessage } = useIntl();\n  const [showModalWarning, setShowModalWarning] = useState(false);\n  const pageTitle = formatMessage({ id: getTrad('HeaderNav.link.advancedSettings') });\n  const updatePermissions = useMemo(() => {\n    return { update: pluginPermissions.updateAdvancedSettings };\n  }, []);\n  const {\n    isLoading: isLoadingForPermissions,\n    allowedActions: { canUpdate },\n  } = useUserPermissions(updatePermissions);\n  const [\n    { initialData, isConfirmButtonLoading, isLoading, modifiedData, roles },\n    dispatch,\n  ] = useReducer(reducer, initialState);\n  const isMounted = useRef(true);\n  const abortController = new AbortController();\n  const { signal } = abortController;\n\n  useEffect(() => {\n    const getData = async () => {\n      try {\n        dispatch({\n          type: 'GET_DATA',\n        });\n\n        const data = await request(getRequestURL('advanced'), { method: 'GET', signal });\n\n        dispatch({\n          type: 'GET_DATA_SUCCEEDED',\n          data,\n        });\n      } catch (err) {\n        if (isMounted.current) {\n          dispatch({\n            type: 'GET_DATA_ERROR',\n          });\n          console.error(err);\n          strapi.notification.toggle({\n            type: 'warning',\n            message: { id: 'notification.error' },\n          });\n        }\n      }\n    };\n\n    if (!isLoadingForPermissions) {\n      getData();\n    }\n\n    return () => {\n      abortController.abort();\n      isMounted.current = false;\n    };\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isLoadingForPermissions]);\n\n  const handleChange = useCallback(({ target }) => {\n    dispatch({\n      type: 'ON_CHANGE',\n      keys: target.name,\n      value: target.value,\n    });\n  }, []);\n\n  const handleSubmit = useCallback(\n    async e => {\n      e.preventDefault();\n\n      try {\n        dispatch({\n          type: 'ON_SUBMIT',\n        });\n\n        strapi.lockAppWithOverlay();\n        await request(getRequestURL('advanced'), { method: 'PUT', body: modifiedData });\n\n        dispatch({\n          type: 'ON_SUBMIT_SUCCEEDED',\n        });\n\n        strapi.notification.toggle({\n          type: 'success',\n          message: { id: getTrad('notification.success.submit') },\n        });\n      } catch (err) {\n        dispatch({\n          type: 'ON_SUBMIT_ERROR',\n        });\n        console.error(err);\n        strapi.notification.toggle({\n          type: 'warning',\n          message: { id: 'notification.error' },\n        });\n      }\n\n      strapi.unlockApp();\n    },\n    [modifiedData]\n  );\n\n  const handleConfirmReset = useCallback(() => {\n    dispatch({\n      type: 'ON_RESET',\n    });\n\n    setShowModalWarning(false);\n  }, []);\n\n  const handleToggleModal = useCallback(() => {\n    setShowModalWarning(prev => !prev);\n  }, []);\n\n  const headerActions = useMemo(() => {\n    const isDisabled = isEqual(initialData, modifiedData);\n\n    return [\n      {\n        disabled: isDisabled,\n        onClick: () => {\n          handleToggleModal();\n        },\n        color: 'cancel',\n        label: formatMessage({\n          id: 'app.components.Button.reset',\n        }),\n\n        type: 'button',\n        style: {\n          paddingLeft: 15,\n          paddingRight: 15,\n          fontWeight: 600,\n        },\n      },\n      {\n        disabled: isDisabled,\n        color: 'success',\n        label: formatMessage({\n          id: 'app.components.Button.save',\n        }),\n        isLoading: isConfirmButtonLoading,\n        type: 'submit',\n        style: {\n          minWidth: 150,\n          fontWeight: 600,\n        },\n      },\n    ];\n  }, [initialData, isConfirmButtonLoading, modifiedData, formatMessage, handleToggleModal]);\n\n  const showLoader = isLoadingForPermissions || isLoading;\n\n  return (\n    <>\n      <SettingsPageTitle name={pageTitle} />\n      <div>\n        <form onSubmit={handleSubmit}>\n          <Header actions={headerActions} title={{ label: pageTitle }} isLoading={showLoader} />\n          <ListBaselineAlignment />\n          <FormBloc title=\"Settings\" isLoading={showLoader}>\n            {form.map(input => {\n              return (\n                <SizedInput\n                  key={input.name}\n                  {...input}\n                  disabled={!canUpdate}\n                  onChange={handleChange}\n                  options={roles}\n                  value={modifiedData[input.name]}\n                />\n              );\n            })}\n          </FormBloc>\n        </form>\n      </div>\n      <PopUpWarning\n        isOpen={showModalWarning}\n        toggleModal={handleToggleModal}\n        content={{\n          title: getTrad('popUpWarning.title'),\n          message: getTrad('popUpWarning.warning.cancel'),\n          cancel: getTrad('popUpWarning.button.cancel'),\n          confirm: getTrad('popUpWarning.button.confirm'),\n        }}\n        popUpWarningType=\"danger\"\n        onConfirm={handleConfirmReset}\n      />\n    </>\n  );\n};\n\nexport default AdvancedSettingsPage;\n"]},"metadata":{},"sourceType":"script"}