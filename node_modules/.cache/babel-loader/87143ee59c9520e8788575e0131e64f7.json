{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof3 = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _HeaderSearch = _interopRequireDefault(require(\"./HeaderSearch\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof3(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar HeaderSearch = function HeaderSearch(_ref) {\n  var label = _ref.label,\n      queryParameter = _ref.queryParameter;\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var query = (0, _strapiHelperPlugin.useQuery)();\n  var searchValue = query.get(queryParameter) || '';\n\n  var _useState = (0, _react.useState)(searchValue),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      value = _useState2[0],\n      setValue = _useState2[1];\n\n  var _useHistory = (0, _reactRouterDom.useHistory)(),\n      push = _useHistory.push;\n\n  var displayedLabel = (0, _typeof2[\"default\"])(label) === 'object' ? formatMessage(_objectSpread(_objectSpread({}, label), {}, {\n    defaultMessage: label.defaultMessage || label.id\n  })) : label;\n  var capitalizedLabel = (0, _lodash.upperFirst)(displayedLabel);\n  (0, _react.useEffect)(function () {\n    if (searchValue === '') {\n      // Synchronise the search\n      handleClear();\n    }\n  }, [searchValue]);\n  (0, _react.useEffect)(function () {\n    var handler = setTimeout(function () {\n      var currentSearch = query;\n\n      if (value) {\n        // Create a new search in order to remove the filters\n        currentSearch = new URLSearchParams(''); // Keep the previous params _sort, pageSize, page\n\n        var pageSize = query.get('pageSize');\n        var page = query.get('page');\n\n        var _sort = query.get('_sort');\n\n        if (page) {\n          currentSearch.set('page', page);\n        }\n\n        if (pageSize) {\n          currentSearch.set('pageSize', pageSize);\n        }\n\n        if (_sort) {\n          currentSearch.set('_sort', _sort);\n        }\n\n        currentSearch.set(queryParameter, encodeURIComponent(value));\n      } else {\n        currentSearch[\"delete\"](queryParameter);\n      }\n\n      push({\n        search: currentSearch.toString()\n      });\n    }, 300);\n    return function () {\n      return clearTimeout(handler);\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [value]);\n\n  var handleChange = function handleChange(_ref2) {\n    var value = _ref2.target.value;\n    setValue(value);\n  };\n\n  var handleClear = function handleClear() {\n    setValue('');\n  };\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_HeaderSearch[\"default\"], {\n    label: capitalizedLabel,\n    name: queryParameter,\n    value: value,\n    onChange: handleChange,\n    onClear: handleClear\n  });\n};\n\nHeaderSearch.defaultProps = {\n  queryParameter: '_q'\n};\nHeaderSearch.propTypes = {\n  label: _propTypes[\"default\"].oneOfType([_propTypes[\"default\"].string, _propTypes[\"default\"].shape({\n    id: _propTypes[\"default\"].string.isRequired,\n    defaultMessage: _propTypes[\"default\"].string\n  })]).isRequired,\n  queryParameter: _propTypes[\"default\"].string\n};\nvar _default = HeaderSearch;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/admin/src/components/HeaderSearch/index.js"],"names":["HeaderSearch","label","queryParameter","formatMessage","query","searchValue","get","value","setValue","push","displayedLabel","defaultMessage","id","capitalizedLabel","handleClear","handler","setTimeout","currentSearch","URLSearchParams","pageSize","page","_sort","set","encodeURIComponent","search","toString","clearTimeout","handleChange","target","defaultProps","propTypes","PropTypes","oneOfType","string","shape","isRequired"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { upperFirst } from 'lodash';\nimport { useHistory } from 'react-router-dom';\nimport { useIntl } from 'react-intl';\nimport { useQuery } from 'strapi-helper-plugin';\nimport StyledHeaderSearch from './HeaderSearch';\n\nconst HeaderSearch = ({ label, queryParameter }) => {\n  const { formatMessage } = useIntl();\n  const query = useQuery();\n  const searchValue = query.get(queryParameter) || '';\n  const [value, setValue] = useState(searchValue);\n  const { push } = useHistory();\n  const displayedLabel =\n    typeof label === 'object'\n      ? formatMessage({ ...label, defaultMessage: label.defaultMessage || label.id })\n      : label;\n  const capitalizedLabel = upperFirst(displayedLabel);\n\n  useEffect(() => {\n    if (searchValue === '') {\n      // Synchronise the search\n      handleClear();\n    }\n  }, [searchValue]);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      let currentSearch = query;\n\n      if (value) {\n        // Create a new search in order to remove the filters\n        currentSearch = new URLSearchParams('');\n\n        // Keep the previous params _sort, pageSize, page\n        const pageSize = query.get('pageSize');\n        const page = query.get('page');\n        const _sort = query.get('_sort');\n\n        if (page) {\n          currentSearch.set('page', page);\n        }\n\n        if (pageSize) {\n          currentSearch.set('pageSize', pageSize);\n        }\n\n        if (_sort) {\n          currentSearch.set('_sort', _sort);\n        }\n\n        currentSearch.set(queryParameter, encodeURIComponent(value));\n      } else {\n        currentSearch.delete(queryParameter);\n      }\n\n      push({ search: currentSearch.toString() });\n    }, 300);\n\n    return () => clearTimeout(handler);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [value]);\n\n  const handleChange = ({ target: { value } }) => {\n    setValue(value);\n  };\n\n  const handleClear = () => {\n    setValue('');\n  };\n\n  return (\n    <StyledHeaderSearch\n      label={capitalizedLabel}\n      name={queryParameter}\n      value={value}\n      onChange={handleChange}\n      onClear={handleClear}\n    />\n  );\n};\n\nHeaderSearch.defaultProps = {\n  queryParameter: '_q',\n};\n\nHeaderSearch.propTypes = {\n  label: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.shape({\n      id: PropTypes.string.isRequired,\n      defaultMessage: PropTypes.string,\n    }),\n  ]).isRequired,\n  queryParameter: PropTypes.string,\n};\n\nexport default HeaderSearch;\n"]},"metadata":{},"sourceType":"script"}