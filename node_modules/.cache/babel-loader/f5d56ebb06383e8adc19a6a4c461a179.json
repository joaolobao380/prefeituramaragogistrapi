{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.EditView = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _core = require(\"@buffetjs/core\");\n\nvar _pluginId = _interopRequireDefault(require(\"../../pluginId\"));\n\nvar _permissions = _interopRequireDefault(require(\"../../permissions\"));\n\nvar _Container = _interopRequireDefault(require(\"../../components/Container\"));\n\nvar _DynamicZone = _interopRequireDefault(require(\"../../components/DynamicZone\"));\n\nvar _FormWrapper = _interopRequireDefault(require(\"../../components/FormWrapper\"));\n\nvar _FieldComponent = _interopRequireDefault(require(\"../../components/FieldComponent\"));\n\nvar _Inputs = _interopRequireDefault(require(\"../../components/Inputs\"));\n\nvar _SelectWrapper = _interopRequireDefault(require(\"../../components/SelectWrapper\"));\n\nvar _utils = require(\"../../utils\");\n\nvar _CollectionTypeFormWrapper = _interopRequireDefault(require(\"../CollectionTypeFormWrapper\"));\n\nvar _EditViewDataManagerProvider = _interopRequireDefault(require(\"../EditViewDataManagerProvider\"));\n\nvar _SingleTypeFormWrapper = _interopRequireDefault(require(\"../SingleTypeFormWrapper\"));\n\nvar _Header = _interopRequireDefault(require(\"./Header\"));\n\nvar _utils2 = require(\"./utils\");\n\nvar _components = require(\"./components\");\n\nvar _DeleteLink = _interopRequireDefault(require(\"./DeleteLink\"));\n\nvar _InformationCard = _interopRequireDefault(require(\"./InformationCard\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n/* eslint-disable  react/no-array-index-key */\nvar EditView = function EditView(_ref) {\n  var allowedActions = _ref.allowedActions,\n      isSingleType = _ref.isSingleType,\n      goBack = _ref.goBack,\n      layout = _ref.layout,\n      slug = _ref.slug,\n      id = _ref.id,\n      origin = _ref.origin,\n      userPermissions = _ref.userPermissions;\n\n  var _useGlobalContext = (0, _strapiHelperPlugin.useGlobalContext)(),\n      currentEnvironment = _useGlobalContext.currentEnvironment,\n      plugins = _useGlobalContext.plugins;\n\n  var _useMemo = (0, _react.useMemo)(function () {\n    return (0, _utils2.getFieldsActionMatchingPermissions)(userPermissions, slug);\n  }, [userPermissions, slug]),\n      createActionAllowedFields = _useMemo.createActionAllowedFields,\n      readActionAllowedFields = _useMemo.readActionAllowedFields,\n      updateActionAllowedFields = _useMemo.updateActionAllowedFields;\n\n  var configurationPermissions = (0, _react.useMemo)(function () {\n    return isSingleType ? _permissions[\"default\"].singleTypesConfigurations : _permissions[\"default\"].collectionTypesConfigurations;\n  }, [isSingleType]);\n  var configurationsURL = \"/plugins/\".concat(_pluginId[\"default\"], \"/\").concat(isSingleType ? 'singleType' : 'collectionType', \"/\").concat(slug, \"/configurations/edit\");\n  var currentContentTypeLayoutData = (0, _react.useMemo)(function () {\n    return (0, _lodash.get)(layout, ['contentType'], {});\n  }, [layout]);\n  var DataManagementWrapper = (0, _react.useMemo)(function () {\n    return isSingleType ? _SingleTypeFormWrapper[\"default\"] : _CollectionTypeFormWrapper[\"default\"];\n  }, [isSingleType]); // Check if a block is a dynamic zone\n\n  var isDynamicZone = (0, _react.useCallback)(function (block) {\n    return block.every(function (subBlock) {\n      return subBlock.every(function (obj) {\n        return obj.fieldSchema.type === 'dynamiczone';\n      });\n    });\n  }, []);\n  var formattedContentTypeLayout = (0, _react.useMemo)(function () {\n    if (!currentContentTypeLayoutData.layouts) {\n      return [];\n    }\n\n    return (0, _utils2.createAttributesLayout)(currentContentTypeLayoutData.layouts.edit, currentContentTypeLayoutData.attributes);\n  }, [currentContentTypeLayoutData]);\n  return /*#__PURE__*/_react[\"default\"].createElement(DataManagementWrapper, {\n    allLayoutData: layout,\n    slug: slug,\n    id: id,\n    origin: origin\n  }, function (_ref2) {\n    var componentsDataStructure = _ref2.componentsDataStructure,\n        contentTypeDataStructure = _ref2.contentTypeDataStructure,\n        data = _ref2.data,\n        isCreatingEntry = _ref2.isCreatingEntry,\n        isLoadingForData = _ref2.isLoadingForData,\n        onDelete = _ref2.onDelete,\n        onDeleteSucceeded = _ref2.onDeleteSucceeded,\n        onPost = _ref2.onPost,\n        onPublish = _ref2.onPublish,\n        onPut = _ref2.onPut,\n        onUnpublish = _ref2.onUnpublish,\n        redirectionLink = _ref2.redirectionLink,\n        status = _ref2.status;\n    return /*#__PURE__*/_react[\"default\"].createElement(_EditViewDataManagerProvider[\"default\"], {\n      allowedActions: allowedActions,\n      allLayoutData: layout,\n      createActionAllowedFields: createActionAllowedFields,\n      componentsDataStructure: componentsDataStructure,\n      contentTypeDataStructure: contentTypeDataStructure,\n      from: redirectionLink,\n      initialValues: data,\n      isCreatingEntry: isCreatingEntry,\n      isLoadingForData: isLoadingForData,\n      isSingleType: isSingleType,\n      onPost: onPost,\n      onPublish: onPublish,\n      onPut: onPut,\n      onUnpublish: onUnpublish,\n      readActionAllowedFields: readActionAllowedFields,\n      redirectToPreviousPage: goBack,\n      slug: slug,\n      status: status,\n      updateActionAllowedFields: updateActionAllowedFields\n    }, /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.BackHeader, {\n      onClick: goBack\n    }), /*#__PURE__*/_react[\"default\"].createElement(_Container[\"default\"], {\n      className: \"container-fluid\"\n    }, /*#__PURE__*/_react[\"default\"].createElement(_Header[\"default\"], {\n      allowedActions: allowedActions\n    }), /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      className: \"row\",\n      style: {\n        paddingTop: 3\n      }\n    }, /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      className: \"col-md-12 col-lg-9\",\n      style: {\n        marginBottom: 13\n      }\n    }, formattedContentTypeLayout.map(function (block, blockIndex) {\n      if (isDynamicZone(block)) {\n        var _block$0$ = block[0][0],\n            name = _block$0$.name,\n            fieldSchema = _block$0$.fieldSchema,\n            metadatas = _block$0$.metadatas,\n            labelIcon = _block$0$.labelIcon;\n        var baselineAlignementSize = blockIndex === 0 ? '3px' : '0';\n        return /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.BaselineAlignment, {\n          key: blockIndex,\n          top: true,\n          size: baselineAlignementSize\n        }, /*#__PURE__*/_react[\"default\"].createElement(_DynamicZone[\"default\"], {\n          name: name,\n          fieldSchema: fieldSchema,\n          labelIcon: labelIcon,\n          metadatas: metadatas\n        }));\n      }\n\n      return /*#__PURE__*/_react[\"default\"].createElement(_FormWrapper[\"default\"], {\n        key: blockIndex\n      }, block.map(function (fieldsBlock, fieldsBlockIndex) {\n        return /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n          className: \"row\",\n          key: fieldsBlockIndex\n        }, fieldsBlock.map(function (_ref3, fieldIndex) {\n          var name = _ref3.name,\n              size = _ref3.size,\n              fieldSchema = _ref3.fieldSchema,\n              labelIcon = _ref3.labelIcon,\n              metadatas = _ref3.metadatas;\n          var isComponent = fieldSchema.type === 'component';\n\n          if (isComponent) {\n            var component = fieldSchema.component,\n                max = fieldSchema.max,\n                min = fieldSchema.min,\n                _fieldSchema$repeatab = fieldSchema.repeatable,\n                repeatable = _fieldSchema$repeatab === void 0 ? false : _fieldSchema$repeatab;\n            var componentUid = fieldSchema.component;\n            return /*#__PURE__*/_react[\"default\"].createElement(_FieldComponent[\"default\"], {\n              key: componentUid,\n              componentUid: component,\n              labelIcon: labelIcon,\n              isRepeatable: repeatable,\n              label: metadatas.label,\n              max: max,\n              min: min,\n              name: name\n            });\n          }\n\n          return /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n            className: \"col-\".concat(size),\n            key: name\n          }, /*#__PURE__*/_react[\"default\"].createElement(_Inputs[\"default\"], {\n            autoFocus: blockIndex === 0 && fieldsBlockIndex === 0 && fieldIndex === 0,\n            fieldSchema: fieldSchema,\n            keys: name,\n            labelIcon: labelIcon,\n            metadatas: metadatas\n          }));\n        }));\n      }));\n    })), /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      className: \"col-md-12 col-lg-3\"\n    }, /*#__PURE__*/_react[\"default\"].createElement(_InformationCard[\"default\"], null), /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n      size: \"smd\",\n      top: true\n    }), currentContentTypeLayoutData.layouts.editRelations.length > 0 && /*#__PURE__*/_react[\"default\"].createElement(_components.SubWrapper, {\n      style: {\n        padding: '0 20px 1px',\n        marginBottom: '25px'\n      }\n    }, /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      style: {\n        paddingTop: '22px'\n      }\n    }, currentContentTypeLayoutData.layouts.editRelations.map(function (_ref4) {\n      var name = _ref4.name,\n          fieldSchema = _ref4.fieldSchema,\n          labelIcon = _ref4.labelIcon,\n          metadatas = _ref4.metadatas,\n          queryInfos = _ref4.queryInfos;\n      return /*#__PURE__*/_react[\"default\"].createElement(_SelectWrapper[\"default\"], (0, _extends2[\"default\"])({}, fieldSchema, metadatas, {\n        key: name,\n        labelIcon: labelIcon,\n        name: name,\n        relationsType: fieldSchema.relationType,\n        queryInfos: queryInfos\n      }));\n    }))), /*#__PURE__*/_react[\"default\"].createElement(_components.LinkWrapper, null, /*#__PURE__*/_react[\"default\"].createElement(\"ul\", null, /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.CheckPermissions, {\n      permissions: configurationPermissions\n    }, /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.LiLink, {\n      message: {\n        id: 'app.links.configure-view'\n      },\n      icon: \"layout\",\n      url: configurationsURL,\n      onClick: function onClick() {// emitEvent('willEditContentTypeLayoutFromEditView');\n      }\n    })), (0, _utils.getInjectedComponents)('editView', 'right.links', plugins, currentEnvironment, slug), allowedActions.canDelete && /*#__PURE__*/_react[\"default\"].createElement(_DeleteLink[\"default\"], {\n      isCreatingEntry: isCreatingEntry,\n      onDelete: onDelete,\n      onDeleteSucceeded: onDeleteSucceeded\n    })))))));\n  });\n};\n\nexports.EditView = EditView;\nEditView.defaultProps = {\n  id: null,\n  isSingleType: false,\n  origin: null,\n  userPermissions: []\n};\nEditView.propTypes = {\n  allowedActions: _propTypes[\"default\"].shape({\n    canRead: _propTypes[\"default\"].bool.isRequired,\n    canUpdate: _propTypes[\"default\"].bool.isRequired,\n    canCreate: _propTypes[\"default\"].bool.isRequired,\n    canDelete: _propTypes[\"default\"].bool.isRequired\n  }).isRequired,\n  layout: _propTypes[\"default\"].shape({\n    components: _propTypes[\"default\"].object.isRequired,\n    contentType: _propTypes[\"default\"].shape({\n      uid: _propTypes[\"default\"].string.isRequired,\n      settings: _propTypes[\"default\"].object.isRequired,\n      metadatas: _propTypes[\"default\"].object.isRequired,\n      options: _propTypes[\"default\"].object.isRequired,\n      attributes: _propTypes[\"default\"].object.isRequired\n    }).isRequired\n  }).isRequired,\n  id: _propTypes[\"default\"].string,\n  isSingleType: _propTypes[\"default\"].bool,\n  goBack: _propTypes[\"default\"].func.isRequired,\n  origin: _propTypes[\"default\"].string,\n  slug: _propTypes[\"default\"].string.isRequired,\n  userPermissions: _propTypes[\"default\"].array\n};\n\nvar _default = /*#__PURE__*/(0, _react.memo)(EditView);\n\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-content-manager/admin/src/containers/EditView/index.js"],"names":["EditView","allowedActions","isSingleType","goBack","layout","slug","id","origin","userPermissions","currentEnvironment","plugins","createActionAllowedFields","readActionAllowedFields","updateActionAllowedFields","configurationPermissions","pluginPermissions","singleTypesConfigurations","collectionTypesConfigurations","configurationsURL","pluginId","currentContentTypeLayoutData","DataManagementWrapper","SingleTypeFormWrapper","CollectionTypeFormWrapper","isDynamicZone","block","every","subBlock","obj","fieldSchema","type","formattedContentTypeLayout","layouts","edit","attributes","componentsDataStructure","contentTypeDataStructure","data","isCreatingEntry","isLoadingForData","onDelete","onDeleteSucceeded","onPost","onPublish","onPut","onUnpublish","redirectionLink","status","paddingTop","marginBottom","map","blockIndex","name","metadatas","labelIcon","baselineAlignementSize","fieldsBlock","fieldsBlockIndex","fieldIndex","size","isComponent","component","max","min","repeatable","componentUid","label","editRelations","length","padding","queryInfos","relationType","canDelete","defaultProps","propTypes","PropTypes","shape","canRead","bool","isRequired","canUpdate","canCreate","components","object","contentType","uid","string","settings","options","func","array"],"mappings":"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","sourcesContent":["import React, { memo, useCallback, useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport { get } from 'lodash';\nimport {\n  BackHeader,\n  BaselineAlignment,\n  LiLink,\n  CheckPermissions,\n  useGlobalContext,\n} from 'strapi-helper-plugin';\nimport { Padded } from '@buffetjs/core';\nimport pluginId from '../../pluginId';\nimport pluginPermissions from '../../permissions';\nimport Container from '../../components/Container';\nimport DynamicZone from '../../components/DynamicZone';\nimport FormWrapper from '../../components/FormWrapper';\nimport FieldComponent from '../../components/FieldComponent';\nimport Inputs from '../../components/Inputs';\nimport SelectWrapper from '../../components/SelectWrapper';\nimport { getInjectedComponents } from '../../utils';\nimport CollectionTypeFormWrapper from '../CollectionTypeFormWrapper';\nimport EditViewDataManagerProvider from '../EditViewDataManagerProvider';\nimport SingleTypeFormWrapper from '../SingleTypeFormWrapper';\nimport Header from './Header';\nimport { createAttributesLayout, getFieldsActionMatchingPermissions } from './utils';\nimport { LinkWrapper, SubWrapper } from './components';\nimport DeleteLink from './DeleteLink';\nimport InformationCard from './InformationCard';\n\n/* eslint-disable  react/no-array-index-key */\nconst EditView = ({\n  allowedActions,\n  isSingleType,\n  goBack,\n  layout,\n  slug,\n  id,\n  origin,\n  userPermissions,\n}) => {\n  const { currentEnvironment, plugins } = useGlobalContext();\n\n  const {\n    createActionAllowedFields,\n    readActionAllowedFields,\n    updateActionAllowedFields,\n  } = useMemo(() => {\n    return getFieldsActionMatchingPermissions(userPermissions, slug);\n  }, [userPermissions, slug]);\n  const configurationPermissions = useMemo(() => {\n    return isSingleType\n      ? pluginPermissions.singleTypesConfigurations\n      : pluginPermissions.collectionTypesConfigurations;\n  }, [isSingleType]);\n\n  const configurationsURL = `/plugins/${pluginId}/${\n    isSingleType ? 'singleType' : 'collectionType'\n  }/${slug}/configurations/edit`;\n  const currentContentTypeLayoutData = useMemo(() => get(layout, ['contentType'], {}), [layout]);\n\n  const DataManagementWrapper = useMemo(\n    () => (isSingleType ? SingleTypeFormWrapper : CollectionTypeFormWrapper),\n    [isSingleType]\n  );\n\n  // Check if a block is a dynamic zone\n  const isDynamicZone = useCallback(block => {\n    return block.every(subBlock => {\n      return subBlock.every(obj => obj.fieldSchema.type === 'dynamiczone');\n    });\n  }, []);\n\n  const formattedContentTypeLayout = useMemo(() => {\n    if (!currentContentTypeLayoutData.layouts) {\n      return [];\n    }\n\n    return createAttributesLayout(\n      currentContentTypeLayoutData.layouts.edit,\n      currentContentTypeLayoutData.attributes\n    );\n  }, [currentContentTypeLayoutData]);\n\n  return (\n    <DataManagementWrapper allLayoutData={layout} slug={slug} id={id} origin={origin}>\n      {({\n        componentsDataStructure,\n        contentTypeDataStructure,\n        data,\n        isCreatingEntry,\n        isLoadingForData,\n        onDelete,\n        onDeleteSucceeded,\n        onPost,\n        onPublish,\n        onPut,\n        onUnpublish,\n        redirectionLink,\n        status,\n      }) => {\n        return (\n          <EditViewDataManagerProvider\n            allowedActions={allowedActions}\n            allLayoutData={layout}\n            createActionAllowedFields={createActionAllowedFields}\n            componentsDataStructure={componentsDataStructure}\n            contentTypeDataStructure={contentTypeDataStructure}\n            from={redirectionLink}\n            initialValues={data}\n            isCreatingEntry={isCreatingEntry}\n            isLoadingForData={isLoadingForData}\n            isSingleType={isSingleType}\n            onPost={onPost}\n            onPublish={onPublish}\n            onPut={onPut}\n            onUnpublish={onUnpublish}\n            readActionAllowedFields={readActionAllowedFields}\n            redirectToPreviousPage={goBack}\n            slug={slug}\n            status={status}\n            updateActionAllowedFields={updateActionAllowedFields}\n          >\n            <BackHeader onClick={goBack} />\n            <Container className=\"container-fluid\">\n              <Header allowedActions={allowedActions} />\n              <div className=\"row\" style={{ paddingTop: 3 }}>\n                <div className=\"col-md-12 col-lg-9\" style={{ marginBottom: 13 }}>\n                  {formattedContentTypeLayout.map((block, blockIndex) => {\n                    if (isDynamicZone(block)) {\n                      const {\n                        0: {\n                          0: { name, fieldSchema, metadatas, labelIcon },\n                        },\n                      } = block;\n                      const baselineAlignementSize = blockIndex === 0 ? '3px' : '0';\n\n                      return (\n                        <BaselineAlignment key={blockIndex} top size={baselineAlignementSize}>\n                          <DynamicZone\n                            name={name}\n                            fieldSchema={fieldSchema}\n                            labelIcon={labelIcon}\n                            metadatas={metadatas}\n                          />\n                        </BaselineAlignment>\n                      );\n                    }\n\n                    return (\n                      <FormWrapper key={blockIndex}>\n                        {block.map((fieldsBlock, fieldsBlockIndex) => {\n                          return (\n                            <div className=\"row\" key={fieldsBlockIndex}>\n                              {fieldsBlock.map(\n                                ({ name, size, fieldSchema, labelIcon, metadatas }, fieldIndex) => {\n                                  const isComponent = fieldSchema.type === 'component';\n\n                                  if (isComponent) {\n                                    const { component, max, min, repeatable = false } = fieldSchema;\n                                    const componentUid = fieldSchema.component;\n\n                                    return (\n                                      <FieldComponent\n                                        key={componentUid}\n                                        componentUid={component}\n                                        labelIcon={labelIcon}\n                                        isRepeatable={repeatable}\n                                        label={metadatas.label}\n                                        max={max}\n                                        min={min}\n                                        name={name}\n                                      />\n                                    );\n                                  }\n\n                                  return (\n                                    <div className={`col-${size}`} key={name}>\n                                      <Inputs\n                                        autoFocus={\n                                          blockIndex === 0 &&\n                                          fieldsBlockIndex === 0 &&\n                                          fieldIndex === 0\n                                        }\n                                        fieldSchema={fieldSchema}\n                                        keys={name}\n                                        labelIcon={labelIcon}\n                                        metadatas={metadatas}\n                                      />\n                                    </div>\n                                  );\n                                }\n                              )}\n                            </div>\n                          );\n                        })}\n                      </FormWrapper>\n                    );\n                  })}\n                </div>\n                <div className=\"col-md-12 col-lg-3\">\n                  <InformationCard />\n                  <Padded size=\"smd\" top />\n                  {currentContentTypeLayoutData.layouts.editRelations.length > 0 && (\n                    <SubWrapper style={{ padding: '0 20px 1px', marginBottom: '25px' }}>\n                      <div style={{ paddingTop: '22px' }}>\n                        {currentContentTypeLayoutData.layouts.editRelations.map(\n                          ({ name, fieldSchema, labelIcon, metadatas, queryInfos }) => {\n                            return (\n                              <SelectWrapper\n                                {...fieldSchema}\n                                {...metadatas}\n                                key={name}\n                                labelIcon={labelIcon}\n                                name={name}\n                                relationsType={fieldSchema.relationType}\n                                queryInfos={queryInfos}\n                              />\n                            );\n                          }\n                        )}\n                      </div>\n                    </SubWrapper>\n                  )}\n                  <LinkWrapper>\n                    <ul>\n                      <CheckPermissions permissions={configurationPermissions}>\n                        <LiLink\n                          message={{\n                            id: 'app.links.configure-view',\n                          }}\n                          icon=\"layout\"\n                          url={configurationsURL}\n                          onClick={() => {\n                            // emitEvent('willEditContentTypeLayoutFromEditView');\n                          }}\n                        />\n                      </CheckPermissions>\n                      {getInjectedComponents(\n                        'editView',\n                        'right.links',\n                        plugins,\n                        currentEnvironment,\n                        slug\n                      )}\n                      {allowedActions.canDelete && (\n                        <DeleteLink\n                          isCreatingEntry={isCreatingEntry}\n                          onDelete={onDelete}\n                          onDeleteSucceeded={onDeleteSucceeded}\n                        />\n                      )}\n                    </ul>\n                  </LinkWrapper>\n                </div>\n              </div>\n            </Container>\n          </EditViewDataManagerProvider>\n        );\n      }}\n    </DataManagementWrapper>\n  );\n};\n\nEditView.defaultProps = {\n  id: null,\n  isSingleType: false,\n  origin: null,\n  userPermissions: [],\n};\n\nEditView.propTypes = {\n  allowedActions: PropTypes.shape({\n    canRead: PropTypes.bool.isRequired,\n    canUpdate: PropTypes.bool.isRequired,\n    canCreate: PropTypes.bool.isRequired,\n    canDelete: PropTypes.bool.isRequired,\n  }).isRequired,\n  layout: PropTypes.shape({\n    components: PropTypes.object.isRequired,\n    contentType: PropTypes.shape({\n      uid: PropTypes.string.isRequired,\n      settings: PropTypes.object.isRequired,\n      metadatas: PropTypes.object.isRequired,\n      options: PropTypes.object.isRequired,\n      attributes: PropTypes.object.isRequired,\n    }).isRequired,\n  }).isRequired,\n  id: PropTypes.string,\n  isSingleType: PropTypes.bool,\n  goBack: PropTypes.func.isRequired,\n  origin: PropTypes.string,\n  slug: PropTypes.string.isRequired,\n  userPermissions: PropTypes.array,\n};\n\nexport { EditView };\nexport default memo(EditView);\n"]},"metadata":{},"sourceType":"script"}