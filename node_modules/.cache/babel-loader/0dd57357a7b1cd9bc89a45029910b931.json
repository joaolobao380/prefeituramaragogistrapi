{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _generateModelsLinks2 = _interopRequireDefault(require(\"./generateModelsLinks\"));\n\nvar _checkPermissions = _interopRequireDefault(require(\"./checkPermissions\"));\n\nvar getCtOrStLinks = /*#__PURE__*/function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(userPermissions) {\n    var requestURL, _yield$request, contentTypeConfigurations, _yield$request2, data, _generateModelsLinks, collectionTypesSectionLinks, singleTypesSectionLinks, ctLinksPermissionsPromises, ctLinksPermissions, authorizedCtLinks, stLinksPermissionsPromises, stLinksPermissions, authorizedStLinks;\n\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            requestURL = '/content-manager/content-types';\n            _context.prev = 1;\n            _context.next = 4;\n            return (0, _strapiHelperPlugin.request)('/content-manager/content-types-settings', {\n              method: 'GET'\n            });\n\n          case 4:\n            _yield$request = _context.sent;\n            contentTypeConfigurations = _yield$request.data;\n            _context.next = 8;\n            return (0, _strapiHelperPlugin.request)(requestURL, {\n              method: 'GET'\n            });\n\n          case 8:\n            _yield$request2 = _context.sent;\n            data = _yield$request2.data;\n            _generateModelsLinks = (0, _generateModelsLinks2[\"default\"])(data, contentTypeConfigurations), collectionTypesSectionLinks = _generateModelsLinks.collectionTypesSectionLinks, singleTypesSectionLinks = _generateModelsLinks.singleTypesSectionLinks; // Content Types verifications\n\n            ctLinksPermissionsPromises = (0, _checkPermissions[\"default\"])(userPermissions, collectionTypesSectionLinks);\n            _context.next = 14;\n            return Promise.all(ctLinksPermissionsPromises);\n\n          case 14:\n            ctLinksPermissions = _context.sent;\n            authorizedCtLinks = collectionTypesSectionLinks.filter(function (_, index) {\n              return ctLinksPermissions[index];\n            }); // Single Types verifications\n\n            stLinksPermissionsPromises = (0, _checkPermissions[\"default\"])(userPermissions, singleTypesSectionLinks);\n            _context.next = 19;\n            return Promise.all(stLinksPermissionsPromises);\n\n          case 19:\n            stLinksPermissions = _context.sent;\n            authorizedStLinks = singleTypesSectionLinks.filter(function (_, index) {\n              return stLinksPermissions[index];\n            });\n            return _context.abrupt(\"return\", {\n              authorizedCtLinks: authorizedCtLinks,\n              authorizedStLinks: authorizedStLinks,\n              contentTypes: data\n            });\n\n          case 24:\n            _context.prev = 24;\n            _context.t0 = _context[\"catch\"](1);\n            console.error(_context.t0);\n            strapi.notification.toggle({\n              type: 'warning',\n              message: {\n                id: 'notification.error'\n              }\n            });\n            return _context.abrupt(\"return\", {\n              authorizedCtLinks: [],\n              authorizedStLinks: [],\n              contentTypes: []\n            });\n\n          case 29:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[1, 24]]);\n  }));\n\n  return function getCtOrStLinks(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar _default = getCtOrStLinks;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/admin/src/containers/LeftMenu/utils/getCtOrStLinks.js"],"names":["getCtOrStLinks","userPermissions","requestURL","method","contentTypeConfigurations","data","collectionTypesSectionLinks","singleTypesSectionLinks","ctLinksPermissionsPromises","Promise","all","ctLinksPermissions","authorizedCtLinks","filter","_","index","stLinksPermissionsPromises","stLinksPermissions","authorizedStLinks","contentTypes","console","error","strapi","notification","toggle","type","message","id"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;AACA;;AAEA,IAAMA,cAAc;AAAA,2FAAG,iBAAMC,eAAN;AAAA;;AAAA;AAAA;AAAA;AAAA;AACfC,YAAAA,UADe,GACF,gCADE;AAAA;AAAA;AAAA,mBAMT,iCAAQ,yCAAR,EAAmD;AAAEC,cAAAA,MAAM,EAAE;AAAV,aAAnD,CANS;;AAAA;AAAA;AAKXC,YAAAA,yBALW,kBAKjBC,IALiB;AAAA;AAAA,mBAQI,iCAAQH,UAAR,EAAoB;AAAEC,cAAAA,MAAM,EAAE;AAAV,aAApB,CARJ;;AAAA;AAAA;AAQXE,YAAAA,IARW,mBAQXA,IARW;AAAA,mCAS8C,sCAC/DA,IAD+D,EAE/DD,yBAF+D,CAT9C,EASXE,2BATW,wBASXA,2BATW,EASkBC,uBATlB,wBASkBA,uBATlB,EAcnB;;AACMC,YAAAA,0BAfa,GAegB,kCACjCP,eADiC,EAEjCK,2BAFiC,CAfhB;AAAA;AAAA,mBAmBcG,OAAO,CAACC,GAAR,CAAYF,0BAAZ,CAnBd;;AAAA;AAmBbG,YAAAA,kBAnBa;AAoBbC,YAAAA,iBApBa,GAoBON,2BAA2B,CAACO,MAA5B,CACxB,UAACC,CAAD,EAAIC,KAAJ;AAAA,qBAAcJ,kBAAkB,CAACI,KAAD,CAAhC;AAAA,aADwB,CApBP,EAwBnB;;AACMC,YAAAA,0BAzBa,GAyBgB,kCAAiBf,eAAjB,EAAkCM,uBAAlC,CAzBhB;AAAA;AAAA,mBA0BcE,OAAO,CAACC,GAAR,CAAYM,0BAAZ,CA1Bd;;AAAA;AA0BbC,YAAAA,kBA1Ba;AA2BbC,YAAAA,iBA3Ba,GA2BOX,uBAAuB,CAACM,MAAxB,CACxB,UAACC,CAAD,EAAIC,KAAJ;AAAA,qBAAcE,kBAAkB,CAACF,KAAD,CAAhC;AAAA,aADwB,CA3BP;AAAA,6CA+BZ;AAAEH,cAAAA,iBAAiB,EAAjBA,iBAAF;AAAqBM,cAAAA,iBAAiB,EAAjBA,iBAArB;AAAwCC,cAAAA,YAAY,EAAEd;AAAtD,aA/BY;;AAAA;AAAA;AAAA;AAiCnBe,YAAAA,OAAO,CAACC,KAAR;AAEAC,YAAAA,MAAM,CAACC,YAAP,CAAoBC,MAApB,CAA2B;AACzBC,cAAAA,IAAI,EAAE,SADmB;AAEzBC,cAAAA,OAAO,EAAE;AAAEC,gBAAAA,EAAE,EAAE;AAAN;AAFgB,aAA3B;AAnCmB,6CAwCZ;AAAEf,cAAAA,iBAAiB,EAAE,EAArB;AAAyBM,cAAAA,iBAAiB,EAAE,EAA5C;AAAgDC,cAAAA,YAAY,EAAE;AAA9D,aAxCY;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAdnB,cAAc;AAAA;AAAA;AAAA,GAApB;;eA4CeA,c","sourcesContent":["import { request } from 'strapi-helper-plugin';\nimport generateModelsLinks from './generateModelsLinks';\nimport checkPermissions from './checkPermissions';\n\nconst getCtOrStLinks = async userPermissions => {\n  const requestURL = '/content-manager/content-types';\n\n  try {\n    const {\n      data: contentTypeConfigurations,\n    } = await request('/content-manager/content-types-settings', { method: 'GET' });\n\n    const { data } = await request(requestURL, { method: 'GET' });\n    const { collectionTypesSectionLinks, singleTypesSectionLinks } = generateModelsLinks(\n      data,\n      contentTypeConfigurations\n    );\n\n    // Content Types verifications\n    const ctLinksPermissionsPromises = checkPermissions(\n      userPermissions,\n      collectionTypesSectionLinks\n    );\n    const ctLinksPermissions = await Promise.all(ctLinksPermissionsPromises);\n    const authorizedCtLinks = collectionTypesSectionLinks.filter(\n      (_, index) => ctLinksPermissions[index]\n    );\n\n    // Single Types verifications\n    const stLinksPermissionsPromises = checkPermissions(userPermissions, singleTypesSectionLinks);\n    const stLinksPermissions = await Promise.all(stLinksPermissionsPromises);\n    const authorizedStLinks = singleTypesSectionLinks.filter(\n      (_, index) => stLinksPermissions[index]\n    );\n\n    return { authorizedCtLinks, authorizedStLinks, contentTypes: data };\n  } catch (err) {\n    console.error(err);\n\n    strapi.notification.toggle({\n      type: 'warning',\n      message: { id: 'notification.error' },\n    });\n\n    return { authorizedCtLinks: [], authorizedStLinks: [], contentTypes: [] };\n  }\n};\n\nexport default getCtOrStLinks;\n"]},"metadata":{},"sourceType":"script"}