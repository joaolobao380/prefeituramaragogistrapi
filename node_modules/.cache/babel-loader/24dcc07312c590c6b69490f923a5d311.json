{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.enhanceRelationLayout = exports.enhanceEditLayout = exports.enhanceComponentsLayout = exports.enhanceComponentLayoutForRelations = exports[\"default\"] = void 0;\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _get = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _icons = require(\"@buffetjs/icons\");\n\nvar _utils = require(\"../utils\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar enhanceRelationLayout = function enhanceRelationLayout(layout, locale) {\n  return layout.map(function (current) {\n    var labelIcon = {\n      title: {\n        id: (0, _utils.getTrad)('Field.localized'),\n        defaultMessage: 'This value is unique for the selected locale'\n      },\n      icon: /*#__PURE__*/_react[\"default\"].createElement(_icons.Globe, null)\n    };\n    var queryInfos = current.queryInfos;\n\n    if ((0, _get[\"default\"])(current, ['targetModelPluginOptions', 'i18n', 'localized'], false)) {\n      queryInfos = _objectSpread(_objectSpread({}, queryInfos), {}, {\n        defaultParams: _objectSpread(_objectSpread({}, queryInfos.defaultParams), {}, {\n          _locale: locale\n        }),\n        paramsToKeep: ['plugins.i18n.locale']\n      });\n    }\n\n    return _objectSpread(_objectSpread({}, current), {}, {\n      labelIcon: labelIcon,\n      queryInfos: queryInfos\n    });\n  });\n};\n\nexports.enhanceRelationLayout = enhanceRelationLayout;\n\nvar enhanceEditLayout = function enhanceEditLayout(layout) {\n  return layout.map(function (row) {\n    var enhancedRow = row.reduce(function (acc, field) {\n      var type = (0, _get[\"default\"])(field, ['fieldSchema', 'type'], null);\n      var hasI18nEnabled = (0, _get[\"default\"])(field, ['fieldSchema', 'pluginOptions', 'i18n', 'localized'], type === 'uid');\n      var labelIcon = {\n        title: {\n          id: hasI18nEnabled ? (0, _utils.getTrad)('Field.localized') : (0, _utils.getTrad)('Field.not-localized'),\n          defaultMessage: hasI18nEnabled ? 'This value is unique for the selected locale' : 'This value is common to all locales'\n        },\n        icon: hasI18nEnabled ? /*#__PURE__*/_react[\"default\"].createElement(_icons.Globe, null) : /*#__PURE__*/_react[\"default\"].createElement(_icons.GlobeCrossed, null)\n      };\n      acc.push(_objectSpread(_objectSpread({}, field), {}, {\n        labelIcon: labelIcon\n      }));\n      return acc;\n    }, []);\n    return enhancedRow;\n  });\n};\n\nexports.enhanceEditLayout = enhanceEditLayout;\n\nvar enhanceComponentsLayout = function enhanceComponentsLayout(components, locale) {\n  return Object.keys(components).reduce(function (acc, current) {\n    var currentComponentLayout = components[current];\n    var enhancedEditLayout = enhanceComponentLayoutForRelations(currentComponentLayout.layouts.edit, locale);\n    acc[current] = _objectSpread(_objectSpread({}, currentComponentLayout), {}, {\n      layouts: _objectSpread(_objectSpread({}, currentComponentLayout.layouts), {}, {\n        edit: enhancedEditLayout\n      })\n    });\n    return acc;\n  }, {});\n};\n\nexports.enhanceComponentsLayout = enhanceComponentsLayout;\n\nvar enhanceComponentLayoutForRelations = function enhanceComponentLayoutForRelations(layout, locale) {\n  return layout.map(function (row) {\n    var enhancedRow = row.reduce(function (acc, field) {\n      if ((0, _get[\"default\"])(field, ['fieldSchema', 'type']) === 'relation' && (0, _get[\"default\"])(field, ['targetModelPluginOptions', 'i18n', 'localized'], false)) {\n        var queryInfos = _objectSpread(_objectSpread({}, field.queryInfos), {}, {\n          defaultParams: _objectSpread(_objectSpread({}, field.queryInfos.defaultParams), {}, {\n            _locale: locale\n          }),\n          paramsToKeep: ['plugins.i18n.locale']\n        });\n\n        acc.push(_objectSpread(_objectSpread({}, field), {}, {\n          queryInfos: queryInfos\n        }));\n        return acc;\n      }\n\n      acc.push(_objectSpread({}, field));\n      return acc;\n    }, []);\n    return enhancedRow;\n  });\n};\n\nexports.enhanceComponentLayoutForRelations = enhanceComponentLayoutForRelations;\n\nvar extendCMEditViewLayoutMiddleware = function extendCMEditViewLayoutMiddleware() {\n  return function () {\n    return function (next) {\n      return function (action) {\n        if (action.type !== 'ContentManager/EditViewLayoutManager/SET_LAYOUT') {\n          return next(action);\n        }\n\n        var hasi18nEnabled = (0, _get[\"default\"])(action, getPathToContentType(['pluginOptions', 'i18n', 'localized']), false);\n\n        if (!hasi18nEnabled) {\n          return next(action);\n        }\n\n        var currentLocale = (0, _get[\"default\"])(action, ['query', 'plugins', 'i18n', 'locale'], null); // This might break the cm, has the user might be redirected to the homepage\n\n        if (!currentLocale) {\n          return next(action);\n        }\n\n        var editLayoutPath = getPathToContentType(['layouts', 'edit']);\n        var editRelationsPath = getPathToContentType(['layouts', 'editRelations']);\n        var editLayout = (0, _get[\"default\"])(action, editLayoutPath);\n        var editRelationsLayout = (0, _get[\"default\"])(action, editRelationsPath);\n        var nextEditRelationLayout = enhanceRelationLayout(editRelationsLayout, currentLocale);\n        var nextEditLayout = enhanceEditLayout(editLayout);\n\n        var enhancedLayouts = _objectSpread(_objectSpread({}, action.layout.contentType.layouts), {}, {\n          editRelations: nextEditRelationLayout,\n          edit: nextEditLayout\n        });\n\n        var components = enhanceComponentsLayout(action.layout.components, currentLocale);\n\n        var enhancedAction = _objectSpread(_objectSpread({}, action), {}, {\n          layout: _objectSpread(_objectSpread({}, action.layout), {}, {\n            contentType: _objectSpread(_objectSpread({}, action.layout.contentType), {}, {\n              layouts: enhancedLayouts\n            }),\n            components: components\n          })\n        });\n\n        return next(enhancedAction);\n      };\n    };\n  };\n};\n\nvar getPathToContentType = function getPathToContentType(pathArray) {\n  return ['layout', 'contentType'].concat((0, _toConsumableArray2[\"default\"])(pathArray));\n};\n\nvar _default = extendCMEditViewLayoutMiddleware;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-i18n/admin/src/middlewares/extendCMEditViewLayoutMiddleware.js"],"names":["enhanceRelationLayout","layout","locale","map","current","labelIcon","title","id","defaultMessage","icon","queryInfos","defaultParams","_locale","paramsToKeep","enhanceEditLayout","row","enhancedRow","reduce","acc","field","type","hasI18nEnabled","push","enhanceComponentsLayout","components","Object","keys","currentComponentLayout","enhancedEditLayout","enhanceComponentLayoutForRelations","layouts","edit","extendCMEditViewLayoutMiddleware","next","action","hasi18nEnabled","getPathToContentType","currentLocale","editLayoutPath","editRelationsPath","editLayout","editRelationsLayout","nextEditRelationLayout","nextEditLayout","enhancedLayouts","contentType","editRelations","enhancedAction","pathArray"],"mappings":"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","sourcesContent":["import React from 'react';\nimport get from 'lodash/get';\nimport { Globe, GlobeCrossed } from '@buffetjs/icons';\nimport { getTrad } from '../utils';\n\nconst enhanceRelationLayout = (layout, locale) =>\n  layout.map(current => {\n    const labelIcon = {\n      title: {\n        id: getTrad('Field.localized'),\n        defaultMessage: 'This value is unique for the selected locale',\n      },\n      icon: <Globe />,\n    };\n    let queryInfos = current.queryInfos;\n\n    if (get(current, ['targetModelPluginOptions', 'i18n', 'localized'], false)) {\n      queryInfos = {\n        ...queryInfos,\n        defaultParams: { ...queryInfos.defaultParams, _locale: locale },\n        paramsToKeep: ['plugins.i18n.locale'],\n      };\n    }\n\n    return { ...current, labelIcon, queryInfos };\n  });\n\nconst enhanceEditLayout = layout =>\n  layout.map(row => {\n    const enhancedRow = row.reduce((acc, field) => {\n      const type = get(field, ['fieldSchema', 'type'], null);\n      const hasI18nEnabled = get(\n        field,\n        ['fieldSchema', 'pluginOptions', 'i18n', 'localized'],\n        type === 'uid'\n      );\n\n      const labelIcon = {\n        title: {\n          id: hasI18nEnabled ? getTrad('Field.localized') : getTrad('Field.not-localized'),\n          defaultMessage: hasI18nEnabled\n            ? 'This value is unique for the selected locale'\n            : 'This value is common to all locales',\n        },\n        icon: hasI18nEnabled ? <Globe /> : <GlobeCrossed />,\n      };\n\n      acc.push({ ...field, labelIcon });\n\n      return acc;\n    }, []);\n\n    return enhancedRow;\n  });\n\nconst enhanceComponentsLayout = (components, locale) => {\n  return Object.keys(components).reduce((acc, current) => {\n    const currentComponentLayout = components[current];\n\n    const enhancedEditLayout = enhanceComponentLayoutForRelations(\n      currentComponentLayout.layouts.edit,\n      locale\n    );\n\n    acc[current] = {\n      ...currentComponentLayout,\n      layouts: { ...currentComponentLayout.layouts, edit: enhancedEditLayout },\n    };\n\n    return acc;\n  }, {});\n};\n\nconst enhanceComponentLayoutForRelations = (layout, locale) =>\n  layout.map(row => {\n    const enhancedRow = row.reduce((acc, field) => {\n      if (\n        get(field, ['fieldSchema', 'type']) === 'relation' &&\n        get(field, ['targetModelPluginOptions', 'i18n', 'localized'], false)\n      ) {\n        const queryInfos = {\n          ...field.queryInfos,\n          defaultParams: { ...field.queryInfos.defaultParams, _locale: locale },\n          paramsToKeep: ['plugins.i18n.locale'],\n        };\n\n        acc.push({ ...field, queryInfos });\n\n        return acc;\n      }\n\n      acc.push({ ...field });\n\n      return acc;\n    }, []);\n\n    return enhancedRow;\n  });\n\nconst extendCMEditViewLayoutMiddleware = () => () => next => action => {\n  if (action.type !== 'ContentManager/EditViewLayoutManager/SET_LAYOUT') {\n    return next(action);\n  }\n\n  const hasi18nEnabled = get(\n    action,\n    getPathToContentType(['pluginOptions', 'i18n', 'localized']),\n    false\n  );\n\n  if (!hasi18nEnabled) {\n    return next(action);\n  }\n\n  const currentLocale = get(action, ['query', 'plugins', 'i18n', 'locale'], null);\n\n  // This might break the cm, has the user might be redirected to the homepage\n  if (!currentLocale) {\n    return next(action);\n  }\n\n  const editLayoutPath = getPathToContentType(['layouts', 'edit']);\n  const editRelationsPath = getPathToContentType(['layouts', 'editRelations']);\n  const editLayout = get(action, editLayoutPath);\n  const editRelationsLayout = get(action, editRelationsPath);\n  const nextEditRelationLayout = enhanceRelationLayout(editRelationsLayout, currentLocale);\n  const nextEditLayout = enhanceEditLayout(editLayout);\n\n  const enhancedLayouts = {\n    ...action.layout.contentType.layouts,\n    editRelations: nextEditRelationLayout,\n    edit: nextEditLayout,\n  };\n  const components = enhanceComponentsLayout(action.layout.components, currentLocale);\n\n  const enhancedAction = {\n    ...action,\n    layout: {\n      ...action.layout,\n      contentType: {\n        ...action.layout.contentType,\n        layouts: enhancedLayouts,\n      },\n      components,\n    },\n  };\n\n  return next(enhancedAction);\n};\n\nconst getPathToContentType = pathArray => ['layout', 'contentType', ...pathArray];\n\nexport default extendCMEditViewLayoutMiddleware;\nexport {\n  enhanceComponentLayoutForRelations,\n  enhanceComponentsLayout,\n  enhanceEditLayout,\n  enhanceRelationLayout,\n};\n"]},"metadata":{},"sourceType":"script"}