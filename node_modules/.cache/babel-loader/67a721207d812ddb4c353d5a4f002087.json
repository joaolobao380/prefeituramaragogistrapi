{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _get = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _qs = require(\"qs\");\n\nvar _getDefaultLocale = _interopRequireDefault(require(\"../../utils/getDefaultLocale\"));\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar addLocaleToLinksSearch = function addLocaleToLinksSearch(links, kind, contentTypeSchemas, locales, permissions) {\n  return links.map(function (link) {\n    var contentTypeUID = link.destination.split(\"/\".concat(kind, \"/\"))[1];\n    var contentTypeSchema = contentTypeSchemas.find(function (_ref) {\n      var uid = _ref.uid;\n      return uid === contentTypeUID;\n    });\n    var hasI18nEnabled = (0, _get[\"default\"])(contentTypeSchema, 'pluginOptions.i18n.localized', false);\n\n    if (!hasI18nEnabled) {\n      return link;\n    }\n\n    var contentTypePermissions = permissions[contentTypeUID];\n    var requiredPermissionsToViewALink = kind === 'collectionType' ? ['plugins::content-manager.explorer.read', 'plugins::content-manager.explorer.create'] : ['plugins::content-manager.explorer.read'];\n    var contentTypeNeededPermissions = Object.keys(contentTypePermissions).reduce(function (acc, current) {\n      if (requiredPermissionsToViewALink.includes(current)) {\n        acc[current] = contentTypePermissions[current];\n        return acc;\n      }\n\n      acc[current] = [];\n      return acc;\n    }, {});\n    var defaultLocale = (0, _getDefaultLocale[\"default\"])(contentTypeNeededPermissions, locales);\n\n    if (!defaultLocale) {\n      return _objectSpread(_objectSpread({}, link), {}, {\n        isDisplayed: false\n      });\n    }\n\n    var linkParams = link.search ? (0, _qs.parse)(link.search) : {};\n    var params = linkParams ? _objectSpread(_objectSpread({}, linkParams), {}, {\n      plugins: _objectSpread(_objectSpread({}, linkParams.plugins), {}, {\n        i18n: {\n          locale: defaultLocale\n        }\n      })\n    }) : {\n      plugins: {\n        i18n: {\n          locale: defaultLocale\n        }\n      }\n    };\n    var search = (0, _qs.stringify)(params, {\n      encode: false\n    });\n    return _objectSpread(_objectSpread({}, link), {}, {\n      search: search\n    });\n  });\n};\n\nvar _default = addLocaleToLinksSearch;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-i18n/admin/src/middlewares/utils/addLocaleToLinksSearch.js"],"names":["addLocaleToLinksSearch","links","kind","contentTypeSchemas","locales","permissions","map","link","contentTypeUID","destination","split","contentTypeSchema","find","uid","hasI18nEnabled","contentTypePermissions","requiredPermissionsToViewALink","contentTypeNeededPermissions","Object","keys","reduce","acc","current","includes","defaultLocale","isDisplayed","linkParams","search","params","plugins","i18n","locale","encode"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AACA;;;;;;AAEA,IAAMA,sBAAsB,GAAG,SAAzBA,sBAAyB,CAACC,KAAD,EAAQC,IAAR,EAAcC,kBAAd,EAAkCC,OAAlC,EAA2CC,WAA3C,EAA2D;AACxF,SAAOJ,KAAK,CAACK,GAAN,CAAU,UAAAC,IAAI,EAAI;AACvB,QAAMC,cAAc,GAAGD,IAAI,CAACE,WAAL,CAAiBC,KAAjB,YAA2BR,IAA3B,QAAoC,CAApC,CAAvB;AAEA,QAAMS,iBAAiB,GAAGR,kBAAkB,CAACS,IAAnB,CAAwB;AAAA,UAAGC,GAAH,QAAGA,GAAH;AAAA,aAAaA,GAAG,KAAKL,cAArB;AAAA,KAAxB,CAA1B;AAEA,QAAMM,cAAc,GAAG,qBAAIH,iBAAJ,EAAuB,8BAAvB,EAAuD,KAAvD,CAAvB;;AAEA,QAAI,CAACG,cAAL,EAAqB;AACnB,aAAOP,IAAP;AACD;;AAED,QAAMQ,sBAAsB,GAAGV,WAAW,CAACG,cAAD,CAA1C;AACA,QAAMQ,8BAA8B,GAClCd,IAAI,KAAK,gBAAT,GACI,CAAC,wCAAD,EAA2C,0CAA3C,CADJ,GAEI,CAAC,wCAAD,CAHN;AAKA,QAAMe,4BAA4B,GAAGC,MAAM,CAACC,IAAP,CAAYJ,sBAAZ,EAAoCK,MAApC,CACnC,UAACC,GAAD,EAAMC,OAAN,EAAkB;AAChB,UAAIN,8BAA8B,CAACO,QAA/B,CAAwCD,OAAxC,CAAJ,EAAsD;AACpDD,QAAAA,GAAG,CAACC,OAAD,CAAH,GAAeP,sBAAsB,CAACO,OAAD,CAArC;AAEA,eAAOD,GAAP;AACD;;AAEDA,MAAAA,GAAG,CAACC,OAAD,CAAH,GAAe,EAAf;AAEA,aAAOD,GAAP;AACD,KAXkC,EAYnC,EAZmC,CAArC;AAeA,QAAMG,aAAa,GAAG,kCAAiBP,4BAAjB,EAA+Cb,OAA/C,CAAtB;;AAEA,QAAI,CAACoB,aAAL,EAAoB;AAClB,6CAAYjB,IAAZ;AAAkBkB,QAAAA,WAAW,EAAE;AAA/B;AACD;;AAED,QAAMC,UAAU,GAAGnB,IAAI,CAACoB,MAAL,GAAc,eAAMpB,IAAI,CAACoB,MAAX,CAAd,GAAmC,EAAtD;AAEA,QAAMC,MAAM,GAAGF,UAAU,mCAChBA,UADgB;AACJG,MAAAA,OAAO,kCAAOH,UAAU,CAACG,OAAlB;AAA2BC,QAAAA,IAAI,EAAE;AAAEC,UAAAA,MAAM,EAAEP;AAAV;AAAjC;AADH,SAErB;AAAEK,MAAAA,OAAO,EAAE;AAAEC,QAAAA,IAAI,EAAE;AAAEC,UAAAA,MAAM,EAAEP;AAAV;AAAR;AAAX,KAFJ;AAIA,QAAMG,MAAM,GAAG,mBAAUC,MAAV,EAAkB;AAAEI,MAAAA,MAAM,EAAE;AAAV,KAAlB,CAAf;AAEA,2CAAYzB,IAAZ;AAAkBoB,MAAAA,MAAM,EAANA;AAAlB;AACD,GA/CM,CAAP;AAgDD,CAjDD;;eAmDe3B,sB","sourcesContent":["import get from 'lodash/get';\nimport { stringify, parse } from 'qs';\nimport getDefaultLocale from '../../utils/getDefaultLocale';\n\nconst addLocaleToLinksSearch = (links, kind, contentTypeSchemas, locales, permissions) => {\n  return links.map(link => {\n    const contentTypeUID = link.destination.split(`/${kind}/`)[1];\n\n    const contentTypeSchema = contentTypeSchemas.find(({ uid }) => uid === contentTypeUID);\n\n    const hasI18nEnabled = get(contentTypeSchema, 'pluginOptions.i18n.localized', false);\n\n    if (!hasI18nEnabled) {\n      return link;\n    }\n\n    const contentTypePermissions = permissions[contentTypeUID];\n    const requiredPermissionsToViewALink =\n      kind === 'collectionType'\n        ? ['plugins::content-manager.explorer.read', 'plugins::content-manager.explorer.create']\n        : ['plugins::content-manager.explorer.read'];\n\n    const contentTypeNeededPermissions = Object.keys(contentTypePermissions).reduce(\n      (acc, current) => {\n        if (requiredPermissionsToViewALink.includes(current)) {\n          acc[current] = contentTypePermissions[current];\n\n          return acc;\n        }\n\n        acc[current] = [];\n\n        return acc;\n      },\n      {}\n    );\n\n    const defaultLocale = getDefaultLocale(contentTypeNeededPermissions, locales);\n\n    if (!defaultLocale) {\n      return { ...link, isDisplayed: false };\n    }\n\n    const linkParams = link.search ? parse(link.search) : {};\n\n    const params = linkParams\n      ? { ...linkParams, plugins: { ...linkParams.plugins, i18n: { locale: defaultLocale } } }\n      : { plugins: { i18n: { locale: defaultLocale } } };\n\n    const search = stringify(params, { encode: false });\n\n    return { ...link, search };\n  });\n};\n\nexport default addLocaleToLinksSearch;\n"]},"metadata":{},"sourceType":"script"}