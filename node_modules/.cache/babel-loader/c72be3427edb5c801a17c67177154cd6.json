{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nvar _taggedTemplateLiteral2 = _interopRequireDefault(require(\"@babel/runtime/helpers/taggedTemplateLiteral\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _icons = require(\"@buffetjs/icons\");\n\nvar _styles = require(\"@buffetjs/styles\");\n\nvar _core = require(\"@buffetjs/core\");\n\nvar _hooks = require(\"@buffetjs/hooks\");\n\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _lodash = require(\"lodash\");\n\nvar _getTrad = _interopRequireDefault(require(\"../../utils/getTrad\"));\n\nvar _pluginId = _interopRequireDefault(require(\"../../pluginId\"));\n\nvar _getRequestUrl = _interopRequireDefault(require(\"../../utils/getRequestUrl\"));\n\nvar _RightLabel = _interopRequireDefault(require(\"./RightLabel\"));\n\nvar _Options = _interopRequireDefault(require(\"./Options\"));\n\nvar _RegenerateButton = _interopRequireDefault(require(\"./RegenerateButton\"));\n\nvar _RightContent = _interopRequireDefault(require(\"./RightContent\"));\n\nvar _InputUID = _interopRequireDefault(require(\"./InputUID\"));\n\nvar _Wrapper = _interopRequireDefault(require(\"./Wrapper\"));\n\nvar _SubLabel = _interopRequireDefault(require(\"./SubLabel\"));\n\nvar _regex = _interopRequireDefault(require(\"./regex\"));\n\nvar _RightContentLabel = _interopRequireDefault(require(\"./RightContentLabel\"));\n\nvar _templateObject, _templateObject2;\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar InputContainer = _styledComponents[\"default\"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  position: relative;\\n\"])));\n\nvar Name = (0, _styledComponents[\"default\"])(_core.Label)(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  display: block;\\n  text-transform: capitalize;\\n  margin-bottom: 1rem;\\n\"]))); // This component should be in buffetjs. It will be used in the media lib.\n// This component will be the strapi custom dropdown component.\n// TODO : Make this component generic -> InputDropdown.\n// TODO : Use the Compounds components pattern\n// https://blog.bitsrc.io/understanding-compound-components-in-react-23c4b84535b5\n\nvar InputUID = function InputUID(_ref) {\n  var attribute = _ref.attribute,\n      contentTypeUID = _ref.contentTypeUID,\n      description = _ref.description,\n      inputError = _ref.error,\n      inputLabel = _ref.label,\n      labelIcon = _ref.labelIcon,\n      name = _ref.name,\n      onChange = _ref.onChange,\n      validations = _ref.validations,\n      value = _ref.value,\n      editable = _ref.editable,\n      inputProps = (0, _objectWithoutProperties2[\"default\"])(_ref, [\"attribute\", \"contentTypeUID\", \"description\", \"error\", \"label\", \"labelIcon\", \"name\", \"onChange\", \"validations\", \"value\", \"editable\"]);\n\n  var _useContentManagerEdi = (0, _strapiHelperPlugin.useContentManagerEditViewDataManager)(),\n      modifiedData = _useContentManagerEdi.modifiedData,\n      initialData = _useContentManagerEdi.initialData,\n      layout = _useContentManagerEdi.layout;\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      isLoading = _useState2[0],\n      setIsLoading = _useState2[1];\n\n  var _useState3 = (0, _react.useState)(null),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      availability = _useState4[0],\n      setAvailability = _useState4[1];\n\n  var _useState5 = (0, _react.useState)(true),\n      _useState6 = (0, _slicedToArray2[\"default\"])(_useState5, 2),\n      isSuggestionOpen = _useState6[0],\n      setIsSuggestionOpen = _useState6[1];\n\n  var _useState7 = (0, _react.useState)(false),\n      _useState8 = (0, _slicedToArray2[\"default\"])(_useState7, 2),\n      isCustomized = _useState8[0],\n      setIsCustomized = _useState8[1];\n\n  var _useState9 = (0, _react.useState)(),\n      _useState10 = (0, _slicedToArray2[\"default\"])(_useState9, 2),\n      label = _useState10[0],\n      setLabel = _useState10[1];\n\n  var debouncedValue = (0, _hooks.useDebounce)(value, 300);\n  var debouncedTargetFieldValue = (0, _hooks.useDebounce)(modifiedData[attribute.targetField], 300);\n  var wrapperRef = (0, _react.useRef)(null);\n  var generateUid = (0, _react.useRef)();\n  var initialValue = initialData[name];\n  var createdAtName = (0, _lodash.get)(layout, ['options', 'timestamps', 0]);\n  var isCreation = !initialData[createdAtName];\n\n  var _useGlobalContext = (0, _strapiHelperPlugin.useGlobalContext)(),\n      formatMessage = _useGlobalContext.formatMessage;\n\n  generateUid.current = /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n    var shouldSetInitialValue,\n        requestURL,\n        _yield$request,\n        data,\n        _args = arguments;\n\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            shouldSetInitialValue = _args.length > 0 && _args[0] !== undefined ? _args[0] : false;\n            setIsLoading(true);\n            requestURL = (0, _getRequestUrl[\"default\"])('uid/generate');\n            _context.prev = 3;\n            _context.next = 6;\n            return (0, _strapiHelperPlugin.request)(requestURL, {\n              method: 'POST',\n              body: {\n                contentTypeUID: contentTypeUID,\n                field: name,\n                data: modifiedData\n              }\n            });\n\n          case 6:\n            _yield$request = _context.sent;\n            data = _yield$request.data;\n            onChange({\n              target: {\n                name: name,\n                value: data,\n                type: 'text'\n              }\n            }, shouldSetInitialValue);\n            setIsLoading(false);\n            _context.next = 16;\n            break;\n\n          case 12:\n            _context.prev = 12;\n            _context.t0 = _context[\"catch\"](3);\n            console.error({\n              err: _context.t0\n            });\n            setIsLoading(false);\n\n          case 16:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[3, 12]]);\n  }));\n\n  var checkAvailability = /*#__PURE__*/function () {\n    var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n      var requestURL, data;\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setIsLoading(true);\n              requestURL = (0, _getRequestUrl[\"default\"])('uid/check-availability');\n\n              if (value) {\n                _context2.next = 4;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 4:\n              _context2.prev = 4;\n              _context2.next = 7;\n              return (0, _strapiHelperPlugin.request)(requestURL, {\n                method: 'POST',\n                body: {\n                  contentTypeUID: contentTypeUID,\n                  field: name,\n                  value: value ? value.trim() : ''\n                }\n              });\n\n            case 7:\n              data = _context2.sent;\n              setAvailability(data);\n\n              if (data.suggestion) {\n                setIsSuggestionOpen(true);\n              }\n\n              setIsLoading(false);\n              _context2.next = 17;\n              break;\n\n            case 13:\n              _context2.prev = 13;\n              _context2.t0 = _context2[\"catch\"](4);\n              console.error({\n                err: _context2.t0\n              });\n              setIsLoading(false);\n\n            case 17:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[4, 13]]);\n    }));\n\n    return function checkAvailability() {\n      return _ref3.apply(this, arguments);\n    };\n  }(); // FIXME: we need to find a better way to autofill the input when it is required.\n  // useEffect(() => {\n  //   if (!value && validations.required) {\n  //     generateUid.current(true);\n  //   }\n  //   // eslint-disable-next-line react-hooks/exhaustive-deps\n  // }, []);\n\n\n  (0, _react.useEffect)(function () {\n    if (debouncedValue && debouncedValue.trim().match(_regex[\"default\"]) && debouncedValue !== initialValue) {\n      checkAvailability();\n    }\n\n    if (!debouncedValue) {\n      setAvailability(null);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [debouncedValue, initialValue]);\n  (0, _react.useEffect)(function () {\n    var timer;\n\n    if (availability && availability.isAvailable) {\n      timer = setTimeout(function () {\n        setAvailability(null);\n      }, 4000);\n    }\n\n    return function () {\n      if (timer) {\n        clearTimeout(timer);\n      }\n    };\n  }, [availability]);\n  (0, _react.useEffect)(function () {\n    if (!isCustomized && isCreation && debouncedTargetFieldValue && modifiedData[attribute.targetField]) {\n      generateUid.current(true);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [debouncedTargetFieldValue, isCustomized, isCreation]);\n  (0, _hooks.useClickAwayListener)(wrapperRef, function () {\n    return setIsSuggestionOpen(false);\n  });\n\n  var handleFocus = function handleFocus() {\n    if (availability && availability.suggestion) {\n      setIsSuggestionOpen(true);\n    }\n  };\n\n  var handleSuggestionClick = function handleSuggestionClick() {\n    setIsSuggestionOpen(false);\n    onChange({\n      target: {\n        name: name,\n        value: availability.suggestion,\n        type: 'text'\n      }\n    });\n  };\n\n  var handleGenerateMouseEnter = function handleGenerateMouseEnter() {\n    setLabel('regenerate');\n  };\n\n  var handleGenerateMouseLeave = function handleGenerateMouseLeave() {\n    setLabel(null);\n  };\n\n  var handleChange = function handleChange(e, canCheck, dispatch) {\n    if (!canCheck) {\n      dispatch({\n        type: 'SET_CHECK'\n      });\n    }\n\n    dispatch({\n      type: 'SET_ERROR',\n      error: null\n    });\n\n    if (e.target.value && isCreation) {\n      setIsCustomized(true);\n    }\n\n    onChange(e);\n  };\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_core.Error, {\n    name: name,\n    inputError: inputError,\n    type: \"text\",\n    validations: _objectSpread(_objectSpread({}, validations), {}, {\n      regex: _regex[\"default\"]\n    })\n  }, function (_ref4) {\n    var canCheck = _ref4.canCheck,\n        onBlur = _ref4.onBlur,\n        error = _ref4.error,\n        dispatch = _ref4.dispatch;\n    var hasError = Boolean(error);\n    return /*#__PURE__*/_react[\"default\"].createElement(_Wrapper[\"default\"], {\n      ref: wrapperRef\n    }, /*#__PURE__*/_react[\"default\"].createElement(Name, {\n      htmlFor: name\n    }, /*#__PURE__*/_react[\"default\"].createElement(\"span\", null, inputLabel), labelIcon && /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.LabelIconWrapper, {\n      title: labelIcon.title\n    }, labelIcon.icon)), /*#__PURE__*/_react[\"default\"].createElement(InputContainer, null, /*#__PURE__*/_react[\"default\"].createElement(_InputUID[\"default\"], (0, _extends2[\"default\"])({}, inputProps, {\n      containsEndAdornment: editable,\n      editable: editable,\n      error: hasError,\n      onFocus: handleFocus,\n      name: name,\n      onChange: function onChange(e) {\n        return handleChange(e, canCheck, dispatch);\n      },\n      type: \"text\",\n      onBlur: onBlur // eslint-disable-next-line no-irregular-whitespace\n      ,\n      value: value || ''\n    })), /*#__PURE__*/_react[\"default\"].createElement(_RightContent[\"default\"], null, label && /*#__PURE__*/_react[\"default\"].createElement(_RightContentLabel[\"default\"], {\n      color: \"blue\"\n    }, formatMessage({\n      id: (0, _getTrad[\"default\"])('components.uid.regenerate')\n    })), !isLoading && !label && availability && /*#__PURE__*/_react[\"default\"].createElement(_RightLabel[\"default\"], {\n      isAvailable: availability.isAvailable || value === availability.suggestion\n    }), editable && /*#__PURE__*/_react[\"default\"].createElement(_RegenerateButton[\"default\"], {\n      onMouseEnter: handleGenerateMouseEnter,\n      onMouseLeave: handleGenerateMouseLeave,\n      onClick: function onClick() {\n        return generateUid.current();\n      }\n    }, isLoading ? /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.LoadingIndicator, {\n      small: true\n    }) : /*#__PURE__*/_react[\"default\"].createElement(_icons.Sync, {\n      fill: label ? '#007EFF' : '#B5B7BB',\n      width: \"11px\",\n      height: \"11px\"\n    }))), availability && availability.suggestion && isSuggestionOpen && /*#__PURE__*/_react[\"default\"].createElement(_reactIntl.FormattedMessage, {\n      id: \"\".concat(_pluginId[\"default\"], \".components.uid.suggested\")\n    }, function (msg) {\n      return /*#__PURE__*/_react[\"default\"].createElement(_Options[\"default\"], {\n        title: msg,\n        options: [{\n          id: 'suggestion',\n          label: availability.suggestion,\n          onClick: handleSuggestionClick\n        }]\n      });\n    })), !hasError && description && /*#__PURE__*/_react[\"default\"].createElement(_SubLabel[\"default\"], {\n      as: _styles.Description\n    }, description), hasError && /*#__PURE__*/_react[\"default\"].createElement(_SubLabel[\"default\"], {\n      as: _styles.ErrorMessage\n    }, error));\n  });\n};\n\nInputUID.propTypes = {\n  attribute: _propTypes[\"default\"].object.isRequired,\n  contentTypeUID: _propTypes[\"default\"].string.isRequired,\n  description: _propTypes[\"default\"].string,\n  editable: _propTypes[\"default\"].bool,\n  error: _propTypes[\"default\"].string,\n  label: _propTypes[\"default\"].string.isRequired,\n  labelIcon: _propTypes[\"default\"].shape({\n    icon: _propTypes[\"default\"].node.isRequired,\n    title: _propTypes[\"default\"].string\n  }),\n  name: _propTypes[\"default\"].string.isRequired,\n  onChange: _propTypes[\"default\"].func.isRequired,\n  validations: _propTypes[\"default\"].object,\n  value: _propTypes[\"default\"].string\n};\nInputUID.defaultProps = {\n  description: '',\n  editable: false,\n  error: null,\n  labelIcon: null,\n  validations: {},\n  value: ''\n};\nvar _default = InputUID;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-content-manager/admin/src/components/InputUID/index.js"],"names":["InputContainer","styled","div","Name","Label","InputUID","attribute","contentTypeUID","description","inputError","error","inputLabel","label","labelIcon","name","onChange","validations","value","editable","inputProps","modifiedData","initialData","layout","isLoading","setIsLoading","availability","setAvailability","isSuggestionOpen","setIsSuggestionOpen","isCustomized","setIsCustomized","setLabel","debouncedValue","debouncedTargetFieldValue","targetField","wrapperRef","generateUid","initialValue","createdAtName","isCreation","formatMessage","current","shouldSetInitialValue","requestURL","method","body","field","data","target","type","console","err","checkAvailability","trim","suggestion","match","UID_REGEX","timer","isAvailable","setTimeout","clearTimeout","handleFocus","handleSuggestionClick","handleGenerateMouseEnter","handleGenerateMouseLeave","handleChange","e","canCheck","dispatch","regex","onBlur","hasError","Boolean","title","icon","id","pluginId","msg","onClick","Description","ErrorMessage","propTypes","PropTypes","object","isRequired","string","bool","shape","node","func","defaultProps"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { Sync } from '@buffetjs/icons';\nimport { ErrorMessage, Description } from '@buffetjs/styles';\nimport { Label, Error } from '@buffetjs/core';\nimport { useDebounce, useClickAwayListener } from '@buffetjs/hooks';\nimport styled from 'styled-components';\nimport {\n  request,\n  LabelIconWrapper,\n  LoadingIndicator,\n  useGlobalContext,\n  useContentManagerEditViewDataManager,\n} from 'strapi-helper-plugin';\nimport { FormattedMessage } from 'react-intl';\nimport { get } from 'lodash';\nimport getTrad from '../../utils/getTrad';\nimport pluginId from '../../pluginId';\nimport getRequestUrl from '../../utils/getRequestUrl';\nimport RightLabel from './RightLabel';\nimport Options from './Options';\nimport RegenerateButton from './RegenerateButton';\nimport RightContent from './RightContent';\nimport Input from './InputUID';\nimport Wrapper from './Wrapper';\nimport SubLabel from './SubLabel';\nimport UID_REGEX from './regex';\nimport RightContentLabel from './RightContentLabel';\n\nconst InputContainer = styled.div`\n  position: relative;\n`;\nconst Name = styled(Label)`\n  display: block;\n  text-transform: capitalize;\n  margin-bottom: 1rem;\n`;\n\n// This component should be in buffetjs. It will be used in the media lib.\n// This component will be the strapi custom dropdown component.\n// TODO : Make this component generic -> InputDropdown.\n// TODO : Use the Compounds components pattern\n// https://blog.bitsrc.io/understanding-compound-components-in-react-23c4b84535b5\nconst InputUID = ({\n  attribute,\n  contentTypeUID,\n  description,\n  error: inputError,\n  label: inputLabel,\n  labelIcon,\n  name,\n  onChange,\n  validations,\n  value,\n  editable,\n  ...inputProps\n}) => {\n  const { modifiedData, initialData, layout } = useContentManagerEditViewDataManager();\n  const [isLoading, setIsLoading] = useState(false);\n  const [availability, setAvailability] = useState(null);\n  const [isSuggestionOpen, setIsSuggestionOpen] = useState(true);\n  const [isCustomized, setIsCustomized] = useState(false);\n  const [label, setLabel] = useState();\n  const debouncedValue = useDebounce(value, 300);\n  const debouncedTargetFieldValue = useDebounce(modifiedData[attribute.targetField], 300);\n  const wrapperRef = useRef(null);\n  const generateUid = useRef();\n  const initialValue = initialData[name];\n  const createdAtName = get(layout, ['options', 'timestamps', 0]);\n  const isCreation = !initialData[createdAtName];\n  const { formatMessage } = useGlobalContext();\n\n  generateUid.current = async (shouldSetInitialValue = false) => {\n    setIsLoading(true);\n    const requestURL = getRequestUrl('uid/generate');\n    try {\n      const { data } = await request(requestURL, {\n        method: 'POST',\n        body: {\n          contentTypeUID,\n          field: name,\n          data: modifiedData,\n        },\n      });\n\n      onChange({ target: { name, value: data, type: 'text' } }, shouldSetInitialValue);\n      setIsLoading(false);\n    } catch (err) {\n      console.error({ err });\n      setIsLoading(false);\n    }\n  };\n\n  const checkAvailability = async () => {\n    setIsLoading(true);\n\n    const requestURL = getRequestUrl('uid/check-availability');\n\n    if (!value) {\n      return;\n    }\n\n    try {\n      const data = await request(requestURL, {\n        method: 'POST',\n        body: {\n          contentTypeUID,\n          field: name,\n          value: value ? value.trim() : '',\n        },\n      });\n      setAvailability(data);\n\n      if (data.suggestion) {\n        setIsSuggestionOpen(true);\n      }\n      setIsLoading(false);\n    } catch (err) {\n      console.error({ err });\n      setIsLoading(false);\n    }\n  };\n\n  // FIXME: we need to find a better way to autofill the input when it is required.\n  // useEffect(() => {\n  //   if (!value && validations.required) {\n  //     generateUid.current(true);\n  //   }\n  //   // eslint-disable-next-line react-hooks/exhaustive-deps\n  // }, []);\n\n  useEffect(() => {\n    if (\n      debouncedValue &&\n      debouncedValue.trim().match(UID_REGEX) &&\n      debouncedValue !== initialValue\n    ) {\n      checkAvailability();\n    }\n    if (!debouncedValue) {\n      setAvailability(null);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [debouncedValue, initialValue]);\n\n  useEffect(() => {\n    let timer;\n\n    if (availability && availability.isAvailable) {\n      timer = setTimeout(() => {\n        setAvailability(null);\n      }, 4000);\n    }\n\n    return () => {\n      if (timer) {\n        clearTimeout(timer);\n      }\n    };\n  }, [availability]);\n\n  useEffect(() => {\n    if (\n      !isCustomized &&\n      isCreation &&\n      debouncedTargetFieldValue &&\n      modifiedData[attribute.targetField]\n    ) {\n      generateUid.current(true);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [debouncedTargetFieldValue, isCustomized, isCreation]);\n\n  useClickAwayListener(wrapperRef, () => setIsSuggestionOpen(false));\n\n  const handleFocus = () => {\n    if (availability && availability.suggestion) {\n      setIsSuggestionOpen(true);\n    }\n  };\n\n  const handleSuggestionClick = () => {\n    setIsSuggestionOpen(false);\n    onChange({ target: { name, value: availability.suggestion, type: 'text' } });\n  };\n\n  const handleGenerateMouseEnter = () => {\n    setLabel('regenerate');\n  };\n\n  const handleGenerateMouseLeave = () => {\n    setLabel(null);\n  };\n\n  const handleChange = (e, canCheck, dispatch) => {\n    if (!canCheck) {\n      dispatch({\n        type: 'SET_CHECK',\n      });\n    }\n\n    dispatch({\n      type: 'SET_ERROR',\n      error: null,\n    });\n\n    if (e.target.value && isCreation) {\n      setIsCustomized(true);\n    }\n\n    onChange(e);\n  };\n\n  return (\n    <Error\n      name={name}\n      inputError={inputError}\n      type=\"text\"\n      validations={{ ...validations, regex: UID_REGEX }}\n    >\n      {({ canCheck, onBlur, error, dispatch }) => {\n        const hasError = Boolean(error);\n\n        return (\n          <Wrapper ref={wrapperRef}>\n            <Name htmlFor={name}>\n              <span>{inputLabel}</span>\n              {labelIcon && (\n                <LabelIconWrapper title={labelIcon.title}>{labelIcon.icon}</LabelIconWrapper>\n              )}\n            </Name>\n            <InputContainer>\n              <Input\n                {...inputProps}\n                containsEndAdornment={editable}\n                editable={editable}\n                error={hasError}\n                onFocus={handleFocus}\n                name={name}\n                onChange={e => handleChange(e, canCheck, dispatch)}\n                type=\"text\"\n                onBlur={onBlur}\n                // eslint-disable-next-line no-irregular-whitespace\n                value={value || ''}\n              />\n              <RightContent>\n                {label && (\n                  <RightContentLabel color=\"blue\">\n                    {formatMessage({\n                      id: getTrad('components.uid.regenerate'),\n                    })}\n                  </RightContentLabel>\n                )}\n                {!isLoading && !label && availability && (\n                  <RightLabel\n                    isAvailable={availability.isAvailable || value === availability.suggestion}\n                  />\n                )}\n                {editable && (\n                  <RegenerateButton\n                    onMouseEnter={handleGenerateMouseEnter}\n                    onMouseLeave={handleGenerateMouseLeave}\n                    onClick={() => generateUid.current()}\n                  >\n                    {isLoading ? (\n                      <LoadingIndicator small />\n                    ) : (\n                      <Sync fill={label ? '#007EFF' : '#B5B7BB'} width=\"11px\" height=\"11px\" />\n                    )}\n                  </RegenerateButton>\n                )}\n              </RightContent>\n              {availability && availability.suggestion && isSuggestionOpen && (\n                <FormattedMessage id={`${pluginId}.components.uid.suggested`}>\n                  {msg => (\n                    <Options\n                      title={msg}\n                      options={[\n                        {\n                          id: 'suggestion',\n                          label: availability.suggestion,\n                          onClick: handleSuggestionClick,\n                        },\n                      ]}\n                    />\n                  )}\n                </FormattedMessage>\n              )}\n            </InputContainer>\n            {!hasError && description && <SubLabel as={Description}>{description}</SubLabel>}\n            {hasError && <SubLabel as={ErrorMessage}>{error}</SubLabel>}\n          </Wrapper>\n        );\n      }}\n    </Error>\n  );\n};\n\nInputUID.propTypes = {\n  attribute: PropTypes.object.isRequired,\n  contentTypeUID: PropTypes.string.isRequired,\n  description: PropTypes.string,\n  editable: PropTypes.bool,\n  error: PropTypes.string,\n  label: PropTypes.string.isRequired,\n  labelIcon: PropTypes.shape({\n    icon: PropTypes.node.isRequired,\n    title: PropTypes.string,\n  }),\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func.isRequired,\n  validations: PropTypes.object,\n  value: PropTypes.string,\n};\n\nInputUID.defaultProps = {\n  description: '',\n  editable: false,\n  error: null,\n  labelIcon: null,\n  validations: {},\n  value: '',\n};\n\nexport default InputUID;\n"]},"metadata":{},"sourceType":"script"}