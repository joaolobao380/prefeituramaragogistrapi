{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _lodash = require(\"lodash\");\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _core = require(\"@buffetjs/core\");\n\nvar _SettingsPageTitle = _interopRequireDefault(require(\"../../../components/SettingsPageTitle\"));\n\nvar _hooks = require(\"../../../hooks\");\n\nvar _Users = require(\"../../../components/Users\");\n\nvar _permissions = _interopRequireDefault(require(\"../../../permissions\"));\n\nvar _Header = _interopRequireDefault(require(\"./Header\"));\n\nvar _ModalForm = _interopRequireDefault(require(\"./ModalForm\"));\n\nvar _getFilters = _interopRequireDefault(require(\"./utils/getFilters\"));\n\nvar _init = _interopRequireDefault(require(\"./init\"));\n\nvar _reducer = require(\"./reducer\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar ListPage = function ListPage() {\n  var _useUserPermissions = (0, _strapiHelperPlugin.useUserPermissions)(_permissions[\"default\"].settings.users),\n      isLoadingForPermissions = _useUserPermissions.isLoading,\n      _useUserPermissions$a = _useUserPermissions.allowedActions,\n      canCreate = _useUserPermissions$a.canCreate,\n      canDelete = _useUserPermissions$a.canDelete,\n      canRead = _useUserPermissions$a.canRead,\n      canUpdate = _useUserPermissions$a.canUpdate;\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      isWarningDeleteAllOpened = _useState2[0],\n      setIsWarningDeleteAllOpened = _useState2[1];\n\n  var _useState3 = (0, _react.useState)(false),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      isModalOpened = _useState4[0],\n      setIsModalOpened = _useState4[1];\n\n  var _useSettingsHeaderSea = (0, _hooks.useSettingsHeaderSearchContext)(),\n      toggleHeaderSearch = _useSettingsHeaderSea.toggleHeaderSearch;\n\n  var query = (0, _strapiHelperPlugin.useQuery)();\n\n  var _useHistory = (0, _reactRouterDom.useHistory)(),\n      push = _useHistory.push;\n\n  var _useLocation = (0, _reactRouterDom.useLocation)(),\n      search = _useLocation.search;\n\n  var filters = (0, _react.useMemo)(function () {\n    return (0, _getFilters[\"default\"])(search);\n  }, [search]);\n\n  var _useReducer = (0, _react.useReducer)(_reducer.reducer, _reducer.initialState, _init[\"default\"]),\n      _useReducer2 = (0, _slicedToArray2[\"default\"])(_useReducer, 2),\n      _useReducer2$ = _useReducer2[0],\n      data = _useReducer2$.data,\n      dataToDelete = _useReducer2$.dataToDelete,\n      isLoading = _useReducer2$.isLoading,\n      total = _useReducer2$.pagination.total,\n      shouldRefetchData = _useReducer2$.shouldRefetchData,\n      showModalConfirmButtonLoading = _useReducer2$.showModalConfirmButtonLoading,\n      dispatch = _useReducer2[1];\n\n  var pageSize = parseInt(query.get('pageSize') || 10, 10);\n  var page = parseInt(query.get('page') || 0, 10);\n\n  var _sort = decodeURIComponent(query.get('_sort'));\n\n  var _q = decodeURIComponent(query.get('_q') || '');\n\n  var getDataRef = (0, _react.useRef)();\n  var listRef = (0, _react.useRef)();\n  getDataRef.current = /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n    var _yield$request, _yield$request$data, results, pagination;\n\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (canRead) {\n              _context.next = 3;\n              break;\n            }\n\n            dispatch({\n              type: 'UNSET_IS_LOADING'\n            });\n            return _context.abrupt(\"return\");\n\n          case 3:\n            // Show the loading state and reset the state\n            dispatch({\n              type: 'GET_DATA'\n            });\n            _context.prev = 4;\n            _context.next = 7;\n            return (0, _strapiHelperPlugin.request)(\"/admin/users\".concat(search), {\n              method: 'GET'\n            });\n\n          case 7:\n            _yield$request = _context.sent;\n            _yield$request$data = _yield$request.data;\n            results = _yield$request$data.results;\n            pagination = _yield$request$data.pagination;\n            dispatch({\n              type: 'GET_DATA_SUCCEEDED',\n              data: results,\n              pagination: pagination\n            });\n            _context.next = 18;\n            break;\n\n          case 14:\n            _context.prev = 14;\n            _context.t0 = _context[\"catch\"](4);\n            console.error(_context.t0.response);\n            strapi.notification.toggle({\n              type: 'warning',\n              message: {\n                id: 'notification.error'\n              }\n            });\n\n          case 18:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[4, 14]]);\n  }));\n  (0, _react.useEffect)(function () {\n    if (!isLoadingForPermissions) {\n      getDataRef.current();\n    }\n  }, [search, isLoadingForPermissions]);\n  (0, _react.useEffect)(function () {\n    if (canRead) {\n      toggleHeaderSearch({\n        id: 'Settings.permissions.menu.link.users.label'\n      });\n    }\n\n    return function () {\n      if (canRead) {\n        toggleHeaderSearch();\n      }\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [canRead]);\n\n  var handleChangeDataToDelete = function handleChangeDataToDelete(ids) {\n    dispatch({\n      type: 'ON_CHANGE_DATA_TO_DELETE',\n      dataToDelete: ids\n    });\n  };\n\n  var handleChangeFilter = function handleChangeFilter(_ref2) {\n    var filter = _ref2.filter,\n        name = _ref2.name,\n        value = _ref2.value;\n    var filterName = \"\".concat(name).concat(filter);\n    updateSearchParams(filterName, encodeURIComponent(value), true);\n  };\n\n  var handleChangeFooterParams = function handleChangeFooterParams(_ref3) {\n    var _ref3$target = _ref3.target,\n        name = _ref3$target.name,\n        value = _ref3$target.value;\n    var paramName = name.split('.')[1].replace('_', '');\n\n    if (paramName === 'limit') {\n      paramName = 'pageSize';\n    }\n\n    updateSearchParams(paramName, value);\n  };\n\n  var handleChangeSort = function handleChangeSort(_ref4) {\n    var _ref4$target = _ref4.target,\n        name = _ref4$target.name,\n        value = _ref4$target.value;\n    updateSearchParams(name, value);\n  };\n\n  var handleClickDeleteFilter = function handleClickDeleteFilter(_ref5) {\n    var name = _ref5.target.name;\n    var currentSearch = new URLSearchParams(search);\n    currentSearch[\"delete\"](name);\n    push({\n      search: currentSearch.toString()\n    });\n  };\n\n  var handleClickDelete = (0, _react.useCallback)(function (id) {\n    handleToggleModal();\n    dispatch({\n      type: 'ON_CHANGE_DATA_TO_DELETE',\n      dataToDelete: [id]\n    });\n  }, []);\n\n  var handleCloseModal = function handleCloseModal() {\n    // Refetch data\n    getDataRef.current();\n  };\n\n  var handleClosedModalDelete = function handleClosedModalDelete() {\n    if (shouldRefetchData) {\n      getDataRef.current();\n    } else {\n      // Empty the selected ids when the modal closes\n      dispatch({\n        type: 'RESET_DATA_TO_DELETE'\n      }); // Reset the list's reducer dataToDelete state using a ref so we don't need an effect\n\n      listRef.current.resetDataToDelete();\n    }\n  };\n\n  var handleConfirmDeleteData = (0, _react.useCallback)( /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n    var shouldDispatchSucceededAction, errorMessage;\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            dispatch({\n              type: 'ON_DELETE_USERS'\n            });\n            shouldDispatchSucceededAction = false;\n            _context2.prev = 2;\n            _context2.next = 5;\n            return (0, _strapiHelperPlugin.request)('/admin/users/batch-delete', {\n              method: 'POST',\n              body: {\n                ids: dataToDelete\n              }\n            });\n\n          case 5:\n            shouldDispatchSucceededAction = true;\n            _context2.next = 12;\n            break;\n\n          case 8:\n            _context2.prev = 8;\n            _context2.t0 = _context2[\"catch\"](2);\n            errorMessage = (0, _lodash.get)(_context2.t0, 'response.payload.data', 'An error occured');\n            strapi.notification.toggle({\n              type: 'warning',\n              message: errorMessage\n            });\n\n          case 12:\n            // Only dispatch the action once\n            if (shouldDispatchSucceededAction) {\n              dispatch({\n                type: 'ON_DELETE_USERS_SUCCEEDED'\n              });\n            }\n\n            handleToggleModal();\n\n          case 14:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[2, 8]]);\n  })), [dataToDelete]);\n\n  var handleToggle = function handleToggle() {\n    return setIsModalOpened(function (prev) {\n      return !prev;\n    });\n  };\n\n  var handleToggleModal = function handleToggleModal() {\n    return setIsWarningDeleteAllOpened(function (prev) {\n      return !prev;\n    });\n  };\n\n  var updateSearchParams = function updateSearchParams(name, value) {\n    var shouldDeleteSearch = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    var currentSearch = new URLSearchParams(search); // Update the currentSearch\n\n    currentSearch.set(name, value);\n\n    if (shouldDeleteSearch) {\n      currentSearch[\"delete\"]('_q');\n    }\n\n    push({\n      search: currentSearch.toString()\n    });\n  };\n\n  if (isLoadingForPermissions) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.LoadingIndicatorPage, null);\n  }\n\n  return /*#__PURE__*/_react[\"default\"].createElement(\"div\", null, /*#__PURE__*/_react[\"default\"].createElement(_SettingsPageTitle[\"default\"], {\n    name: \"Users\"\n  }), /*#__PURE__*/_react[\"default\"].createElement(_Header[\"default\"], {\n    canCreate: canCreate,\n    canDelete: canDelete,\n    canRead: canRead,\n    count: total,\n    dataToDelete: dataToDelete,\n    onClickAddUser: handleToggle,\n    onClickDelete: handleToggleModal,\n    isLoading: isLoading\n  }), canRead && /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.BaselineAlignment, {\n    top: true,\n    size: \"1px\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_core.Flex, {\n    flexWrap: \"wrap\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Users.SortPicker, {\n    onChange: handleChangeSort,\n    value: _sort\n  }), /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n    right: true,\n    size: \"10px\"\n  }), /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.BaselineAlignment, {\n    bottom: true,\n    size: \"6px\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Users.FilterPicker, {\n    onChange: handleChangeFilter\n  })), /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n    right: true,\n    size: \"10px\"\n  }), filters.map(function (filter, i) {\n    return (\n      /*#__PURE__*/\n      // eslint-disable-next-line react/no-array-index-key\n      _react[\"default\"].createElement(_Users.Filter, (0, _extends2[\"default\"])({\n        key: i\n      }, filter, {\n        onClick: handleClickDeleteFilter\n      }))\n    );\n  }))), /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.BaselineAlignment, {\n    top: true,\n    size: \"8px\"\n  }), /*#__PURE__*/_react[\"default\"].createElement(_core.Padded, {\n    top: true,\n    size: \"sm\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_Users.List, {\n    canDelete: canDelete,\n    canUpdate: canUpdate,\n    dataToDelete: dataToDelete,\n    isLoading: isLoading,\n    data: data,\n    onChange: handleChangeDataToDelete,\n    onClickDelete: handleClickDelete,\n    searchParam: _q,\n    filters: filters,\n    ref: listRef\n  })), /*#__PURE__*/_react[\"default\"].createElement(_Users.Footer, {\n    count: total,\n    onChange: handleChangeFooterParams,\n    params: {\n      _limit: pageSize,\n      _page: page\n    }\n  })), /*#__PURE__*/_react[\"default\"].createElement(_ModalForm[\"default\"], {\n    isOpen: isModalOpened,\n    onClosed: handleCloseModal,\n    onToggle: handleToggle\n  }), /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.PopUpWarning, {\n    isOpen: isWarningDeleteAllOpened,\n    onClosed: handleClosedModalDelete,\n    onConfirm: handleConfirmDeleteData,\n    toggleModal: handleToggleModal,\n    isConfirmButtonLoading: showModalConfirmButtonLoading\n  }));\n};\n\nvar _default = ListPage;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/admin/src/containers/Users/ListPage/index.js"],"names":["ListPage","adminPermissions","settings","users","isLoadingForPermissions","isLoading","allowedActions","canCreate","canDelete","canRead","canUpdate","isWarningDeleteAllOpened","setIsWarningDeleteAllOpened","isModalOpened","setIsModalOpened","toggleHeaderSearch","query","push","search","filters","reducer","initialState","init","data","dataToDelete","total","pagination","shouldRefetchData","showModalConfirmButtonLoading","dispatch","pageSize","parseInt","get","page","_sort","decodeURIComponent","_q","getDataRef","listRef","current","type","method","results","console","error","response","strapi","notification","toggle","message","id","handleChangeDataToDelete","ids","handleChangeFilter","filter","name","value","filterName","updateSearchParams","encodeURIComponent","handleChangeFooterParams","target","paramName","split","replace","handleChangeSort","handleClickDeleteFilter","currentSearch","URLSearchParams","toString","handleClickDelete","handleToggleModal","handleCloseModal","handleClosedModalDelete","resetDataToDelete","handleConfirmDeleteData","shouldDispatchSucceededAction","body","errorMessage","handleToggle","prev","shouldDeleteSearch","set","map","i","_limit","_page"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useMemo, useReducer, useRef, useState } from 'react';\nimport {\n  BaselineAlignment,\n  useQuery,\n  request,\n  useUserPermissions,\n  LoadingIndicatorPage,\n  PopUpWarning,\n} from 'strapi-helper-plugin';\nimport { get } from 'lodash';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport { Flex, Padded } from '@buffetjs/core';\nimport PageTitle from '../../../components/SettingsPageTitle';\nimport { useSettingsHeaderSearchContext } from '../../../hooks';\nimport { Footer, List, Filter, FilterPicker, SortPicker } from '../../../components/Users';\nimport adminPermissions from '../../../permissions';\nimport Header from './Header';\nimport ModalForm from './ModalForm';\nimport getFilters from './utils/getFilters';\nimport init from './init';\nimport { initialState, reducer } from './reducer';\n\nconst ListPage = () => {\n  const {\n    isLoading: isLoadingForPermissions,\n    allowedActions: { canCreate, canDelete, canRead, canUpdate },\n  } = useUserPermissions(adminPermissions.settings.users);\n  const [isWarningDeleteAllOpened, setIsWarningDeleteAllOpened] = useState(false);\n  const [isModalOpened, setIsModalOpened] = useState(false);\n  const { toggleHeaderSearch } = useSettingsHeaderSearchContext();\n  const query = useQuery();\n  const { push } = useHistory();\n  const { search } = useLocation();\n  const filters = useMemo(() => {\n    return getFilters(search);\n  }, [search]);\n\n  const [\n    {\n      data,\n      dataToDelete,\n      isLoading,\n      pagination: { total },\n      shouldRefetchData,\n      showModalConfirmButtonLoading,\n    },\n    dispatch,\n  ] = useReducer(reducer, initialState, init);\n  const pageSize = parseInt(query.get('pageSize') || 10, 10);\n  const page = parseInt(query.get('page') || 0, 10);\n  const _sort = decodeURIComponent(query.get('_sort'));\n  const _q = decodeURIComponent(query.get('_q') || '');\n  const getDataRef = useRef();\n  const listRef = useRef();\n\n  getDataRef.current = async () => {\n    if (!canRead) {\n      dispatch({\n        type: 'UNSET_IS_LOADING',\n      });\n\n      return;\n    }\n    // Show the loading state and reset the state\n    dispatch({\n      type: 'GET_DATA',\n    });\n\n    try {\n      const {\n        data: { results, pagination },\n      } = await request(`/admin/users${search}`, { method: 'GET' });\n\n      dispatch({\n        type: 'GET_DATA_SUCCEEDED',\n        data: results,\n        pagination,\n      });\n    } catch (err) {\n      console.error(err.response);\n      strapi.notification.toggle({\n        type: 'warning',\n        message: { id: 'notification.error' },\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (!isLoadingForPermissions) {\n      getDataRef.current();\n    }\n  }, [search, isLoadingForPermissions]);\n\n  useEffect(() => {\n    if (canRead) {\n      toggleHeaderSearch({ id: 'Settings.permissions.menu.link.users.label' });\n    }\n\n    return () => {\n      if (canRead) {\n        toggleHeaderSearch();\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [canRead]);\n\n  const handleChangeDataToDelete = ids => {\n    dispatch({\n      type: 'ON_CHANGE_DATA_TO_DELETE',\n      dataToDelete: ids,\n    });\n  };\n\n  const handleChangeFilter = ({ filter, name, value }) => {\n    const filterName = `${name}${filter}`;\n\n    updateSearchParams(filterName, encodeURIComponent(value), true);\n  };\n\n  const handleChangeFooterParams = ({ target: { name, value } }) => {\n    let paramName = name.split('.')[1].replace('_', '');\n\n    if (paramName === 'limit') {\n      paramName = 'pageSize';\n    }\n\n    updateSearchParams(paramName, value);\n  };\n\n  const handleChangeSort = ({ target: { name, value } }) => {\n    updateSearchParams(name, value);\n  };\n\n  const handleClickDeleteFilter = ({ target: { name } }) => {\n    const currentSearch = new URLSearchParams(search);\n\n    currentSearch.delete(name);\n\n    push({ search: currentSearch.toString() });\n  };\n\n  const handleClickDelete = useCallback(id => {\n    handleToggleModal();\n\n    dispatch({\n      type: 'ON_CHANGE_DATA_TO_DELETE',\n      dataToDelete: [id],\n    });\n  }, []);\n\n  const handleCloseModal = () => {\n    // Refetch data\n    getDataRef.current();\n  };\n\n  const handleClosedModalDelete = () => {\n    if (shouldRefetchData) {\n      getDataRef.current();\n    } else {\n      // Empty the selected ids when the modal closes\n      dispatch({\n        type: 'RESET_DATA_TO_DELETE',\n      });\n\n      // Reset the list's reducer dataToDelete state using a ref so we don't need an effect\n      listRef.current.resetDataToDelete();\n    }\n  };\n\n  const handleConfirmDeleteData = useCallback(async () => {\n    dispatch({\n      type: 'ON_DELETE_USERS',\n    });\n\n    let shouldDispatchSucceededAction = false;\n\n    try {\n      await request('/admin/users/batch-delete', {\n        method: 'POST',\n        body: {\n          ids: dataToDelete,\n        },\n      });\n      shouldDispatchSucceededAction = true;\n    } catch (err) {\n      const errorMessage = get(err, 'response.payload.data', 'An error occured');\n\n      strapi.notification.toggle({\n        type: 'warning',\n        message: errorMessage,\n      });\n    }\n\n    // Only dispatch the action once\n    if (shouldDispatchSucceededAction) {\n      dispatch({\n        type: 'ON_DELETE_USERS_SUCCEEDED',\n      });\n    }\n\n    handleToggleModal();\n  }, [dataToDelete]);\n\n  const handleToggle = () => setIsModalOpened(prev => !prev);\n\n  const handleToggleModal = () => setIsWarningDeleteAllOpened(prev => !prev);\n\n  const updateSearchParams = (name, value, shouldDeleteSearch = false) => {\n    const currentSearch = new URLSearchParams(search);\n    // Update the currentSearch\n    currentSearch.set(name, value);\n\n    if (shouldDeleteSearch) {\n      currentSearch.delete('_q');\n    }\n\n    push({\n      search: currentSearch.toString(),\n    });\n  };\n\n  if (isLoadingForPermissions) {\n    return <LoadingIndicatorPage />;\n  }\n\n  return (\n    <div>\n      <PageTitle name=\"Users\" />\n      <Header\n        canCreate={canCreate}\n        canDelete={canDelete}\n        canRead={canRead}\n        count={total}\n        dataToDelete={dataToDelete}\n        onClickAddUser={handleToggle}\n        onClickDelete={handleToggleModal}\n        isLoading={isLoading}\n      />\n      {canRead && (\n        <>\n          <BaselineAlignment top size=\"1px\">\n            <Flex flexWrap=\"wrap\">\n              <SortPicker onChange={handleChangeSort} value={_sort} />\n              <Padded right size=\"10px\" />\n              <BaselineAlignment bottom size=\"6px\">\n                <FilterPicker onChange={handleChangeFilter} />\n              </BaselineAlignment>\n              <Padded right size=\"10px\" />\n              {filters.map((filter, i) => (\n                // eslint-disable-next-line react/no-array-index-key\n                <Filter key={i} {...filter} onClick={handleClickDeleteFilter} />\n              ))}\n            </Flex>\n          </BaselineAlignment>\n          <BaselineAlignment top size=\"8px\" />\n          <Padded top size=\"sm\">\n            <List\n              canDelete={canDelete}\n              canUpdate={canUpdate}\n              dataToDelete={dataToDelete}\n              isLoading={isLoading}\n              data={data}\n              onChange={handleChangeDataToDelete}\n              onClickDelete={handleClickDelete}\n              searchParam={_q}\n              filters={filters}\n              ref={listRef}\n            />\n          </Padded>\n          <Footer\n            count={total}\n            onChange={handleChangeFooterParams}\n            params={{ _limit: pageSize, _page: page }}\n          />\n        </>\n      )}\n      <ModalForm isOpen={isModalOpened} onClosed={handleCloseModal} onToggle={handleToggle} />\n      <PopUpWarning\n        isOpen={isWarningDeleteAllOpened}\n        onClosed={handleClosedModalDelete}\n        onConfirm={handleConfirmDeleteData}\n        toggleModal={handleToggleModal}\n        isConfirmButtonLoading={showModalConfirmButtonLoading}\n      />\n    </div>\n  );\n};\n\nexport default ListPage;\n"]},"metadata":{},"sourceType":"script"}