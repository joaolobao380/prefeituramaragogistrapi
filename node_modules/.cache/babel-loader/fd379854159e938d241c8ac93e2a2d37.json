{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = require(\"react\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _utils = require(\"../../utils\");\n\nvar _reducer = _interopRequireWildcard(require(\"./reducer\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nvar useUserForm = function useUserForm(endPoint, permissions) {\n  var _useUserPermissions = (0, _strapiHelperPlugin.useUserPermissions)(permissions),\n      isLoadingForPermissions = _useUserPermissions.isLoading,\n      allowedActions = _useUserPermissions.allowedActions;\n\n  var _useReducer = (0, _react.useReducer)(_reducer[\"default\"], _reducer.initialState),\n      _useReducer2 = (0, _slicedToArray2[\"default\"])(_useReducer, 2),\n      _useReducer2$ = _useReducer2[0],\n      formErrors = _useReducer2$.formErrors,\n      initialData = _useReducer2$.initialData,\n      isLoading = _useReducer2$.isLoading,\n      modifiedData = _useReducer2$.modifiedData,\n      dispatch = _useReducer2[1];\n\n  var isMounted = (0, _react.useRef)(true);\n  var abortController = new AbortController();\n  var signal = abortController.signal;\n  (0, _react.useEffect)(function () {\n    var getData = /*#__PURE__*/function () {\n      var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n        var data;\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                dispatch({\n                  type: 'GET_DATA'\n                });\n                _context.next = 4;\n                return (0, _strapiHelperPlugin.request)((0, _utils.getRequestURL)(endPoint), {\n                  method: 'GET',\n                  signal: signal\n                });\n\n              case 4:\n                data = _context.sent;\n                dispatch({\n                  type: 'GET_DATA_SUCCEEDED',\n                  data: data\n                });\n                _context.next = 11;\n                break;\n\n              case 8:\n                _context.prev = 8;\n                _context.t0 = _context[\"catch\"](0);\n\n                // The user aborted the request\n                if (isMounted.current) {\n                  dispatch({\n                    type: 'GET_DATA_ERROR'\n                  });\n                  console.error(_context.t0);\n                  strapi.notification.toggle({\n                    type: 'warning',\n                    message: {\n                      id: 'notification.error'\n                    }\n                  });\n                }\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 8]]);\n      }));\n\n      return function getData() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    if (!isLoadingForPermissions) {\n      getData();\n    }\n\n    return function () {\n      abortController.abort();\n      isMounted.current = false;\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isLoadingForPermissions, endPoint]);\n  var handleChange = (0, _react.useCallback)(function (_ref2) {\n    var _ref2$target = _ref2.target,\n        name = _ref2$target.name,\n        value = _ref2$target.value;\n    dispatch({\n      type: 'ON_CHANGE',\n      keys: name,\n      value: value\n    });\n  }, []);\n  var dispatchResetForm = (0, _react.useCallback)(function () {\n    dispatch({\n      type: 'RESET_FORM'\n    });\n  }, []);\n  var dispatchSetFormErrors = (0, _react.useCallback)(function (errors) {\n    dispatch({\n      type: 'SET_ERRORS',\n      errors: errors\n    });\n  }, []);\n  var dispatchSubmitSucceeded = (0, _react.useCallback)(function () {\n    dispatch({\n      type: 'ON_SUBMIT_SUCCEEDED'\n    });\n  }, []);\n  return {\n    allowedActions: allowedActions,\n    dispatch: dispatch,\n    dispatchResetForm: dispatchResetForm,\n    dispatchSetFormErrors: dispatchSetFormErrors,\n    dispatchSubmitSucceeded: dispatchSubmitSucceeded,\n    formErrors: formErrors,\n    handleChange: handleChange,\n    initialData: initialData,\n    isLoading: isLoading,\n    isLoadingForPermissions: isLoadingForPermissions,\n    modifiedData: modifiedData\n  };\n};\n\nvar _default = useUserForm;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/plugins/strapi-plugin-users-permissions/admin/src/hooks/useForm/index.js"],"names":["useUserForm","endPoint","permissions","isLoadingForPermissions","isLoading","allowedActions","reducer","initialState","formErrors","initialData","modifiedData","dispatch","isMounted","abortController","AbortController","signal","getData","type","method","data","current","console","error","strapi","notification","toggle","message","id","abort","handleChange","target","name","value","keys","dispatchResetForm","dispatchSetFormErrors","errors","dispatchSubmitSucceeded"],"mappings":"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","sourcesContent":["import { useCallback, useEffect, useReducer, useRef } from 'react';\nimport { useUserPermissions, request } from 'strapi-helper-plugin';\nimport { getRequestURL } from '../../utils';\nimport reducer, { initialState } from './reducer';\n\nconst useUserForm = (endPoint, permissions) => {\n  const { isLoading: isLoadingForPermissions, allowedActions } = useUserPermissions(permissions);\n  const [{ formErrors, initialData, isLoading, modifiedData }, dispatch] = useReducer(\n    reducer,\n    initialState\n  );\n\n  const isMounted = useRef(true);\n\n  const abortController = new AbortController();\n  const { signal } = abortController;\n\n  useEffect(() => {\n    const getData = async () => {\n      try {\n        dispatch({\n          type: 'GET_DATA',\n        });\n\n        const data = await request(getRequestURL(endPoint), { method: 'GET', signal });\n\n        dispatch({\n          type: 'GET_DATA_SUCCEEDED',\n          data,\n        });\n      } catch (err) {\n        // The user aborted the request\n        if (isMounted.current) {\n          dispatch({\n            type: 'GET_DATA_ERROR',\n          });\n          console.error(err);\n          strapi.notification.toggle({\n            type: 'warning',\n            message: { id: 'notification.error' },\n          });\n        }\n      }\n    };\n\n    if (!isLoadingForPermissions) {\n      getData();\n    }\n\n    return () => {\n      abortController.abort();\n      isMounted.current = false;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isLoadingForPermissions, endPoint]);\n\n  const handleChange = useCallback(({ target: { name, value } }) => {\n    dispatch({\n      type: 'ON_CHANGE',\n      keys: name,\n      value,\n    });\n  }, []);\n\n  const dispatchResetForm = useCallback(() => {\n    dispatch({\n      type: 'RESET_FORM',\n    });\n  }, []);\n\n  const dispatchSetFormErrors = useCallback(errors => {\n    dispatch({ type: 'SET_ERRORS', errors });\n  }, []);\n\n  const dispatchSubmitSucceeded = useCallback(() => {\n    dispatch({\n      type: 'ON_SUBMIT_SUCCEEDED',\n    });\n  }, []);\n\n  return {\n    allowedActions,\n    dispatch,\n    dispatchResetForm,\n    dispatchSetFormErrors,\n    dispatchSubmitSucceeded,\n    formErrors,\n    handleChange,\n    initialData,\n    isLoading,\n    isLoadingForPermissions,\n    modifiedData,\n  };\n};\n\nexport default useUserForm;\n"]},"metadata":{},"sourceType":"script"}