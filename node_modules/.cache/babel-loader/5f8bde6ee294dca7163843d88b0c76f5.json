{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _custom = require(\"@buffetjs/custom\");\n\nvar _core = require(\"@buffetjs/core\");\n\nvar _icons = require(\"@buffetjs/icons\");\n\nvar _lodash = require(\"lodash\");\n\nvar _reactIntl = require(\"react-intl\");\n\nvar _strapiHelperPlugin = require(\"strapi-helper-plugin\");\n\nvar _permissions = _interopRequireDefault(require(\"../../../permissions\"));\n\nvar _SettingsPageTitle = _interopRequireDefault(require(\"../../../components/SettingsPageTitle\"));\n\nvar _Webhooks = require(\"../../../components/Webhooks\");\n\nvar _Wrapper = _interopRequireDefault(require(\"./Wrapper\"));\n\nvar _reducer = _interopRequireWildcard(require(\"./reducer\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction ListView() {\n  var _useUserPermissions = (0, _strapiHelperPlugin.useUserPermissions)(_permissions[\"default\"].settings.webhooks),\n      isLoading = _useUserPermissions.isLoading,\n      _useUserPermissions$a = _useUserPermissions.allowedActions,\n      canCreate = _useUserPermissions$a.canCreate,\n      canRead = _useUserPermissions$a.canRead,\n      canUpdate = _useUserPermissions$a.canUpdate,\n      canDelete = _useUserPermissions$a.canDelete;\n\n  var isMounted = (0, _react.useRef)(true);\n\n  var _useIntl = (0, _reactIntl.useIntl)(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      showModal = _useState2[0],\n      setShowModal = _useState2[1];\n\n  var _useReducer = (0, _react.useReducer)(_reducer[\"default\"], _reducer.initialState),\n      _useReducer2 = (0, _slicedToArray2[\"default\"])(_useReducer, 2),\n      reducerState = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var _useHistory = (0, _reactRouterDom.useHistory)(),\n      push = _useHistory.push;\n\n  var _useLocation = (0, _reactRouterDom.useLocation)(),\n      pathname = _useLocation.pathname;\n\n  var _reducerState$toJS = reducerState.toJS(),\n      webhooks = _reducerState$toJS.webhooks,\n      webhooksToDelete = _reducerState$toJS.webhooksToDelete,\n      webhookToDelete = _reducerState$toJS.webhookToDelete;\n\n  (0, _react.useEffect)(function () {\n    isMounted.current = true;\n    return function () {\n      isMounted.current = false;\n    };\n  }, []);\n  (0, _react.useEffect)(function () {\n    if (canRead) {\n      fetchData();\n    }\n  }, [canRead]);\n\n  var getWebhookIndex = function getWebhookIndex(id) {\n    return webhooks.findIndex(function (webhook) {\n      return webhook.id === id;\n    });\n  }; // New button\n\n\n  var addBtnLabel = formatMessage({\n    id: 'Settings.webhooks.list.button.add'\n  });\n  var newButtonProps = {\n    label: addBtnLabel,\n    onClick: function onClick() {\n      return handleGoTo('create');\n    },\n    color: 'primary',\n    type: 'button',\n    icon: /*#__PURE__*/_react[\"default\"].createElement(_icons.Plus, {\n      fill: \"#007eff\",\n      width: \"11px\",\n      height: \"11px\"\n    }),\n    Component: function Component(props) {\n      if (canCreate) {\n        return /*#__PURE__*/_react[\"default\"].createElement(_core.Button, props);\n      }\n\n      return null;\n    }\n  }; // Header props\n\n  var actions = [_objectSpread(_objectSpread({}, newButtonProps), {}, {\n    icon: true,\n    style: {\n      paddingLeft: 15,\n      paddingRight: 15\n    }\n  })];\n  var headerProps = {\n    title: {\n      label: formatMessage({\n        id: 'Settings.webhooks.title'\n      })\n    },\n    content: formatMessage({\n      id: 'Settings.webhooks.list.description'\n    }),\n    actions: actions\n  }; // List props\n\n  var rowsCount = webhooks.length;\n  var titleLabel = \"\".concat(rowsCount > 1 ? formatMessage({\n    id: 'Settings.webhooks.title'\n  }) : formatMessage({\n    id: 'Settings.webhooks.singular'\n  }));\n  var title = \"\".concat(rowsCount, \" \").concat(titleLabel);\n  /* eslint-disable indent */\n\n  var deleteButtonProps = canDelete ? {\n    color: 'delete',\n    disabled: !(webhooksToDelete.length > 0),\n    label: formatMessage({\n      id: 'app.utils.delete'\n    }),\n    onClick: function onClick() {\n      return setShowModal(true);\n    },\n    type: 'button'\n  } : null;\n  /* eslint-enable indent */\n\n  var listProps = {\n    title: title,\n    button: deleteButtonProps,\n    items: webhooks\n  };\n\n  var fetchData = /*#__PURE__*/function () {\n    var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n      var _yield$request, data;\n\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return (0, _strapiHelperPlugin.request)('/admin/webhooks', {\n                method: 'GET'\n              });\n\n            case 3:\n              _yield$request = _context.sent;\n              data = _yield$request.data;\n\n              if (isMounted.current) {\n                dispatch({\n                  type: 'GET_DATA_SUCCEEDED',\n                  data: data\n                });\n              }\n\n              _context.next = 11;\n              break;\n\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](0);\n\n              if (isMounted.current) {\n                if (_context.t0.code !== 20) {\n                  strapi.notification.toggle({\n                    type: 'warning',\n                    message: {\n                      id: 'notification.error'\n                    }\n                  });\n                }\n              }\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 8]]);\n    }));\n\n    return function fetchData() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleChange = function handleChange(value, id) {\n    dispatch({\n      type: 'SET_WEBHOOKS_TO_DELETE',\n      value: value,\n      id: id\n    });\n  };\n\n  var handleConfirmDelete = function handleConfirmDelete() {\n    if (webhookToDelete) {\n      handleConfirmDeleteOne();\n    } else {\n      handleConfirmDeleteAll();\n    }\n  };\n\n  var handleConfirmDeleteOne = /*#__PURE__*/function () {\n    var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return (0, _strapiHelperPlugin.request)(\"/admin/webhooks/\".concat(webhookToDelete), {\n                method: 'DELETE'\n              });\n\n            case 3:\n              dispatch({\n                type: 'WEBHOOK_DELETED',\n                index: getWebhookIndex(webhookToDelete)\n              });\n              _context2.next = 9;\n              break;\n\n            case 6:\n              _context2.prev = 6;\n              _context2.t0 = _context2[\"catch\"](0);\n\n              if (_context2.t0.code !== 20) {\n                strapi.notification.toggle({\n                  type: 'warning',\n                  message: {\n                    id: 'notification.error'\n                  }\n                });\n              }\n\n            case 9:\n              setShowModal(false);\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 6]]);\n    }));\n\n    return function handleConfirmDeleteOne() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleConfirmDeleteAll = /*#__PURE__*/function () {\n    var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3() {\n      var body;\n      return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              body = {\n                ids: webhooksToDelete\n              };\n              _context3.prev = 1;\n              _context3.next = 4;\n              return (0, _strapiHelperPlugin.request)('/admin/webhooks/batch-delete', {\n                method: 'POST',\n                body: body\n              });\n\n            case 4:\n              if (isMounted.current) {\n                dispatch({\n                  type: 'WEBHOOKS_DELETED'\n                });\n              }\n\n              _context3.next = 10;\n              break;\n\n            case 7:\n              _context3.prev = 7;\n              _context3.t0 = _context3[\"catch\"](1);\n\n              if (isMounted.current) {\n                if (_context3.t0.code !== 20) {\n                  strapi.notification.toggle({\n                    type: 'warning',\n                    message: {\n                      id: 'notification.error'\n                    }\n                  });\n                }\n              }\n\n            case 10:\n              setShowModal(false);\n\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[1, 7]]);\n    }));\n\n    return function handleConfirmDeleteAll() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleDeleteClick = function handleDeleteClick(id) {\n    setShowModal(true);\n    dispatch({\n      type: 'SET_WEBHOOK_TO_DELETE',\n      id: id\n    });\n  };\n\n  var handleEnabledChange = /*#__PURE__*/function () {\n    var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(value, id) {\n      var webhookIndex, initialWebhookProps, keys, body;\n      return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              webhookIndex = getWebhookIndex(id);\n              initialWebhookProps = webhooks[webhookIndex];\n              keys = [webhookIndex, 'isEnabled'];\n              body = _objectSpread(_objectSpread({}, initialWebhookProps), {}, {\n                isEnabled: value\n              });\n              delete body.id;\n              _context4.prev = 5;\n              dispatch({\n                type: 'SET_WEBHOOK_ENABLED',\n                keys: keys,\n                value: value\n              });\n              _context4.next = 9;\n              return (0, _strapiHelperPlugin.request)(\"/admin/webhooks/\".concat(id), {\n                method: 'PUT',\n                body: body\n              });\n\n            case 9:\n              _context4.next = 14;\n              break;\n\n            case 11:\n              _context4.prev = 11;\n              _context4.t0 = _context4[\"catch\"](5);\n\n              if (isMounted.current) {\n                dispatch({\n                  type: 'SET_WEBHOOK_ENABLED',\n                  keys: keys,\n                  value: !value\n                });\n\n                if (_context4.t0.code !== 20) {\n                  strapi.notification.toggle({\n                    type: 'warning',\n                    message: {\n                      id: 'notification.error'\n                    }\n                  });\n                }\n              }\n\n            case 14:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[5, 11]]);\n    }));\n\n    return function handleEnabledChange(_x, _x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var handleGoTo = function handleGoTo(to) {\n    push(\"\".concat(pathname, \"/\").concat(to));\n  };\n\n  if (isLoading) {\n    return /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.LoadingIndicatorPage, null);\n  }\n\n  return /*#__PURE__*/_react[\"default\"].createElement(_Wrapper[\"default\"], null, /*#__PURE__*/_react[\"default\"].createElement(_SettingsPageTitle[\"default\"], {\n    name: \"Webhooks\"\n  }), /*#__PURE__*/_react[\"default\"].createElement(_custom.Header, headerProps), canRead && /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    className: \"list-wrapper\"\n  }, rowsCount > 0 ? /*#__PURE__*/_react[\"default\"].createElement(_custom.List, (0, _extends2[\"default\"])({}, listProps, {\n    customRowComponent: function customRowComponent(props) {\n      return /*#__PURE__*/_react[\"default\"].createElement(_Webhooks.ListRow, (0, _extends2[\"default\"])({}, props, {\n        canUpdate: canUpdate,\n        canDelete: canDelete,\n        onCheckChange: handleChange,\n        onEditClick: handleGoTo,\n        onDeleteCLick: handleDeleteClick,\n        onEnabledChange: handleEnabledChange,\n        itemsToDelete: webhooksToDelete\n      }));\n    }\n  })) : /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.EmptyState, {\n    title: formatMessage({\n      id: 'Settings.webhooks.list.empty.title'\n    }),\n    description: formatMessage({\n      id: 'Settings.webhooks.list.empty.description'\n    }),\n    link: \"https://strapi.io/documentation/developer-docs/latest/concepts/webhooks.html\",\n    linkText: formatMessage({\n      id: 'Settings.webhooks.list.empty.link'\n    })\n  }), /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.ListButton, null, canCreate && /*#__PURE__*/_react[\"default\"].createElement(_core.Button, (0, _lodash.omit)(newButtonProps, 'Component')))), /*#__PURE__*/_react[\"default\"].createElement(_strapiHelperPlugin.PopUpWarning, {\n    isOpen: showModal,\n    toggleModal: function toggleModal() {\n      return setShowModal(!showModal);\n    },\n    popUpWarningType: \"danger\",\n    onConfirm: handleConfirmDelete\n  }));\n}\n\nvar _default = ListView;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/joaovictorlobao/prefeituramaragogistrapi/.cache/admin/src/containers/Webhooks/ListView/index.js"],"names":["ListView","adminPermissions","settings","webhooks","isLoading","allowedActions","canCreate","canRead","canUpdate","canDelete","isMounted","formatMessage","showModal","setShowModal","reducer","initialState","reducerState","dispatch","push","pathname","toJS","webhooksToDelete","webhookToDelete","current","fetchData","getWebhookIndex","id","findIndex","webhook","addBtnLabel","newButtonProps","label","onClick","handleGoTo","color","type","icon","Component","props","actions","style","paddingLeft","paddingRight","headerProps","title","content","rowsCount","length","titleLabel","deleteButtonProps","disabled","listProps","button","items","method","data","code","strapi","notification","toggle","message","handleChange","value","handleConfirmDelete","handleConfirmDeleteOne","handleConfirmDeleteAll","index","body","ids","handleDeleteClick","handleEnabledChange","webhookIndex","initialWebhookProps","keys","isEnabled","to"],"mappings":"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","sourcesContent":["/**\n *\n * ListView\n *\n */\n\nimport React, { useEffect, useReducer, useRef, useState } from 'react';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport { Header, List } from '@buffetjs/custom';\nimport { Button } from '@buffetjs/core';\nimport { Plus } from '@buffetjs/icons';\nimport { omit } from 'lodash';\nimport { useIntl } from 'react-intl';\nimport {\n  request,\n  ListButton,\n  PopUpWarning,\n  useUserPermissions,\n  LoadingIndicatorPage,\n  EmptyState,\n} from 'strapi-helper-plugin';\nimport adminPermissions from '../../../permissions';\nimport PageTitle from '../../../components/SettingsPageTitle';\nimport { ListRow } from '../../../components/Webhooks';\nimport Wrapper from './Wrapper';\nimport reducer, { initialState } from './reducer';\n\nfunction ListView() {\n  const {\n    isLoading,\n    allowedActions: { canCreate, canRead, canUpdate, canDelete },\n  } = useUserPermissions(adminPermissions.settings.webhooks);\n\n  const isMounted = useRef(true);\n  const { formatMessage } = useIntl();\n  const [showModal, setShowModal] = useState(false);\n  const [reducerState, dispatch] = useReducer(reducer, initialState);\n  const { push } = useHistory();\n  const { pathname } = useLocation();\n\n  const { webhooks, webhooksToDelete, webhookToDelete } = reducerState.toJS();\n\n  useEffect(() => {\n    isMounted.current = true;\n\n    return () => {\n      isMounted.current = false;\n    };\n  }, []);\n\n  useEffect(() => {\n    if (canRead) {\n      fetchData();\n    }\n  }, [canRead]);\n\n  const getWebhookIndex = id => webhooks.findIndex(webhook => webhook.id === id);\n\n  // New button\n  const addBtnLabel = formatMessage({\n    id: 'Settings.webhooks.list.button.add',\n  });\n\n  const newButtonProps = {\n    label: addBtnLabel,\n    onClick: () => handleGoTo('create'),\n    color: 'primary',\n    type: 'button',\n    icon: <Plus fill=\"#007eff\" width=\"11px\" height=\"11px\" />,\n    Component: props => {\n      if (canCreate) {\n        return <Button {...props} />;\n      }\n\n      return null;\n    },\n  };\n\n  // Header props\n  const actions = [\n    {\n      ...newButtonProps,\n      icon: true,\n      style: {\n        paddingLeft: 15,\n        paddingRight: 15,\n      },\n    },\n  ];\n\n  const headerProps = {\n    title: {\n      label: formatMessage({ id: 'Settings.webhooks.title' }),\n    },\n    content: formatMessage({ id: 'Settings.webhooks.list.description' }),\n    actions,\n  };\n\n  // List props\n  const rowsCount = webhooks.length;\n  const titleLabel = `${\n    rowsCount > 1\n      ? formatMessage({ id: 'Settings.webhooks.title' })\n      : formatMessage({ id: 'Settings.webhooks.singular' })\n  }`;\n  const title = `${rowsCount} ${titleLabel}`;\n\n  /* eslint-disable indent */\n  const deleteButtonProps = canDelete\n    ? {\n        color: 'delete',\n        disabled: !(webhooksToDelete.length > 0),\n        label: formatMessage({ id: 'app.utils.delete' }),\n        onClick: () => setShowModal(true),\n        type: 'button',\n      }\n    : null;\n  /* eslint-enable indent */\n\n  const listProps = {\n    title,\n    button: deleteButtonProps,\n    items: webhooks,\n  };\n\n  const fetchData = async () => {\n    try {\n      const { data } = await request('/admin/webhooks', {\n        method: 'GET',\n      });\n\n      if (isMounted.current) {\n        dispatch({\n          type: 'GET_DATA_SUCCEEDED',\n          data,\n        });\n      }\n    } catch (err) {\n      if (isMounted.current) {\n        if (err.code !== 20) {\n          strapi.notification.toggle({\n            type: 'warning',\n            message: { id: 'notification.error' },\n          });\n        }\n      }\n    }\n  };\n\n  const handleChange = (value, id) => {\n    dispatch({\n      type: 'SET_WEBHOOKS_TO_DELETE',\n      value,\n      id,\n    });\n  };\n\n  const handleConfirmDelete = () => {\n    if (webhookToDelete) {\n      handleConfirmDeleteOne();\n    } else {\n      handleConfirmDeleteAll();\n    }\n  };\n\n  const handleConfirmDeleteOne = async () => {\n    try {\n      await request(`/admin/webhooks/${webhookToDelete}`, {\n        method: 'DELETE',\n      });\n\n      dispatch({\n        type: 'WEBHOOK_DELETED',\n        index: getWebhookIndex(webhookToDelete),\n      });\n    } catch (err) {\n      if (err.code !== 20) {\n        strapi.notification.toggle({\n          type: 'warning',\n          message: { id: 'notification.error' },\n        });\n      }\n    }\n    setShowModal(false);\n  };\n\n  const handleConfirmDeleteAll = async () => {\n    const body = {\n      ids: webhooksToDelete,\n    };\n\n    try {\n      await request('/admin/webhooks/batch-delete', {\n        method: 'POST',\n        body,\n      });\n\n      if (isMounted.current) {\n        dispatch({\n          type: 'WEBHOOKS_DELETED',\n        });\n      }\n    } catch (err) {\n      if (isMounted.current) {\n        if (err.code !== 20) {\n          strapi.notification.toggle({\n            type: 'warning',\n            message: { id: 'notification.error' },\n          });\n        }\n      }\n    }\n    setShowModal(false);\n  };\n\n  const handleDeleteClick = id => {\n    setShowModal(true);\n\n    dispatch({\n      type: 'SET_WEBHOOK_TO_DELETE',\n      id,\n    });\n  };\n\n  const handleEnabledChange = async (value, id) => {\n    const webhookIndex = getWebhookIndex(id);\n\n    const initialWebhookProps = webhooks[webhookIndex];\n    const keys = [webhookIndex, 'isEnabled'];\n\n    const body = {\n      ...initialWebhookProps,\n      isEnabled: value,\n    };\n\n    delete body.id;\n\n    try {\n      dispatch({\n        type: 'SET_WEBHOOK_ENABLED',\n        keys,\n        value,\n      });\n\n      await request(`/admin/webhooks/${id}`, {\n        method: 'PUT',\n        body,\n      });\n    } catch (err) {\n      if (isMounted.current) {\n        dispatch({\n          type: 'SET_WEBHOOK_ENABLED',\n          keys,\n          value: !value,\n        });\n\n        if (err.code !== 20) {\n          strapi.notification.toggle({\n            type: 'warning',\n            message: { id: 'notification.error' },\n          });\n        }\n      }\n    }\n  };\n\n  const handleGoTo = to => {\n    push(`${pathname}/${to}`);\n  };\n\n  if (isLoading) {\n    return <LoadingIndicatorPage />;\n  }\n\n  return (\n    <Wrapper>\n      <PageTitle name=\"Webhooks\" />\n      <Header {...headerProps} />\n      {canRead && (\n        <div className=\"list-wrapper\">\n          {rowsCount > 0 ? (\n            <List\n              {...listProps}\n              customRowComponent={props => {\n                return (\n                  <ListRow\n                    {...props}\n                    canUpdate={canUpdate}\n                    canDelete={canDelete}\n                    onCheckChange={handleChange}\n                    onEditClick={handleGoTo}\n                    onDeleteCLick={handleDeleteClick}\n                    onEnabledChange={handleEnabledChange}\n                    itemsToDelete={webhooksToDelete}\n                  />\n                );\n              }}\n            />\n          ) : (\n            <EmptyState\n              title={formatMessage({ id: 'Settings.webhooks.list.empty.title' })}\n              description={formatMessage({ id: 'Settings.webhooks.list.empty.description' })}\n              link=\"https://strapi.io/documentation/developer-docs/latest/concepts/webhooks.html\"\n              linkText={formatMessage({ id: 'Settings.webhooks.list.empty.link' })}\n            />\n          )}\n          <ListButton>{canCreate && <Button {...omit(newButtonProps, 'Component')} />}</ListButton>\n        </div>\n      )}\n      <PopUpWarning\n        isOpen={showModal}\n        toggleModal={() => setShowModal(!showModal)}\n        popUpWarningType=\"danger\"\n        onConfirm={handleConfirmDelete}\n      />\n    </Wrapper>\n  );\n}\n\nexport default ListView;\n"]},"metadata":{},"sourceType":"script"}